<?xml version="1.0" encoding="utf-8"?>
<mx:Panel 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	xmlns:view="com.efi.printsmith.view.*" 
	xmlns:vo="com.efi.printsmith.vo.*" 
	xmlns:fc="http://www.adobe.com/2006/fc" 
	xmlns:hc="com.hillelcoren.components.*"
	xmlns:comp="com.efi.printsmith.components.*"
	xmlns:components="com.efi.printsmith.common.components.*"
	width="100%" height="100%" 
	headerHeight="0" 
	title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Customer')}"
	label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Customer')}"
	preinitialize="preInit();"
	name="Customer Editor" 
	xmlns:ns1="com.efi.printsmith.components.*"
	implements="com.efi.mdi.IMDIWindowAware,com.efi.printsmith.security.ISecureComponent">
<mx:Metadata>
    [Event(name="SaveAddressEvent", type="SaveAddressEvent")]
    [Protected(permissions="Account_AddressPanel",notInPermissionAction="invisible",componentId="canvasAddress")]
    [Protected(permissions="Account_AddressPanel",notInPermissionAction="visible",componentId="accessAddress")]
    [Protected(permissions="Account_CreditControlPanel",notInPermissionAction="invisible",componentId="canvasCreditControl")]
    [Protected(permissions="Account_CreditControlPanel",notInPermissionAction="visible",componentId="accessCreditControl")]
    [Protected(permissions="Account_SettingsPanel",notInPermissionAction="invisible",componentId="canvasSettings")]
    [Protected(permissions="Account_SettingsPanel",notInPermissionAction="visible",componentId="accessSettings")]
    [Protected(permissions="Account_SalesPanel",notInPermissionAction="invisible",componentId="canvasSales")]
    [Protected(permissions="Account_SalesPanel",notInPermissionAction="visible",componentId="accessSales")]
    [Protected(permissions="Account_LogPanel",notInPermissionAction="invisible",componentId="canvasLog")]
    [Protected(permissions="Account_LogPanel",notInPermissionAction="visible",componentId="accessLog")]
    [Protected(permissions="Account_NotesPanel",notInPermissionAction="invisible",componentId="canvasNotes")]
    [Protected(permissions="Account_NotesPanel",notInPermissionAction="visible",componentId="accessNotes")]
    [Protected(permissions="Account_MarketingPanel",notInPermissionAction="invisible",componentId="canvasMarketing")]
    [Protected(permissions="Account_MarketingPanel",notInPermissionAction="visible",componentId="accessMarketing")]
    [Protected(permissions="Account_WEBPanel",notInPermissionAction="invisible",componentId="canvasWeb")]
    [Protected(permissions="Account_WEBPanel",notInPermissionAction="visible",componentId="accessWeb")]
    [Protected(permissions="Account_TemplatesPanel",notInPermissionAction="invisible",componentId="canvasTemplates")]
    [Protected(permissions="Account_TemplatesPanel",notInPermissionAction="visible",componentId="accessTemplates")]
   	[Protected(permissions="Account_Delete",notInPermissionAction="disable",componentId="select_button0")]
</mx:Metadata>
<mx:RemoteObject id="dataService" destination="dataService" >
	<mx:method name="getAccountPicker" fault="handleFault(event)" result="handleLoadResult(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveResult(event)"/>
	<mx:method name="deleteItem" fault="handleFault(event)" result="handleDeleteResult(event)"/>
	<mx:method name="getAccount" fault="handleFault(event)" result="handleGetResult(event)"/>
	<mx:method name="getByIdMaster" fault="handleFault(event)" result="handleGetMasterResult(event)"/>
	<mx:method name="getByAccountId" fault="handleFault(event)" result="handleGetaccountIDResult(event)"/>
	<mx:method name="getAllQuery" fault="handleFault(event)" result="handleInvoicesResult(event)"/>
	
</mx:RemoteObject>
<mx:RemoteObject id="contactdataService" destination="dataService">
		<mx:method name="getContactsByAccountId" fault="handleFault(event)"  result="handleLoadContacts(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="logDataService" destination="dataService">
	<mx:method name="getAccountCustomerLogByAccountId" fault="handleFault(event)" result="handleLoadCustomerLogs(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveLogResult(event)"/>
	<mx:method name="deleteItem" fault="handleFault(event)" result="handleDeleteLogResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="dataServiceSystemPreferences" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadSystemPreferencesResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="salesRepDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadSalesReps(event)"/>
    <mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveSalesRepResult(event)"/>
	
</mx:RemoteObject>
<mx:RemoteObject id="businessTypeDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadBusinessTypes(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveBusinessTypeResult(event)"/>
</mx:RemoteObject>

<mx:RemoteObject id="shippingMethodDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadShippingMethods(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveShippingMethodResult(event)"/>
</mx:RemoteObject>

<mx:RemoteObject id="taxTableDataService" destination="dataService">
	<mx:method name="getCurrentTaxTables" fault="handleFault(event)" result="handleLoadTaxTables(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveTaxTableResult(event)"/>
</mx:RemoteObject>

<mx:RemoteObject id="taxCodeDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadTaxCodes(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveTaxCodeResult(event)"/>
</mx:RemoteObject>

<mx:Producer id="producer" destination="accounts"/>
<mx:Consumer id="consumer" destination="accounts" message="messageHandler(event.message)"/>
<mx:Consumer id="notification_consumer" destination="notifications" message="messageHandler(event.message)"/>

<mx:StringValidator id="nameValidator" source="{name_edit}"	property="text"	minLength="2" required="true"/>

<mx:Script source="../common/scripts/StringUtils.as"/>

<mx:Script source="../common/scripts/CommonUtils.as"/>
<mx:Script source="../security/PSSecurityInclude.as" />

<mx:Script>                                   
<![CDATA[
	import com.efi.printsmith.data.Users;
	import mx.events.CloseEvent;
	import mx.events.FlexEvent;
	import com.efi.printsmith.events.ContactCreateUpdateEvent;
	import mx.rpc.mxml.Concurrency;
	import com.efi.mdi.event.window.WindowSaveSuccessEvent;
	import com.efi.mdi.event.compare.MDICompareObjectEvent;
	import mx.utils.ObjectUtil;
	import com.efi.printsmith.common.components.CommonLoadComponent;
	import com.efi.printsmith.data.PreferencesAccounting;
	import com.efi.mdi.view.window.MDIWindow;
	import com.efi.printsmith.data.SportsInterest;
	import com.efi.printsmith.data.CommonInterest;
	import com.efi.printsmith.events.SaveAddressEvent;
	import com.efi.printsmith.data.ModelBase;
	import com.efi.printsmith.data.Marketing;
	import com.efi.printsmith.data.BusinessType;
	import com.efi.printsmith.data.SalesRep;
	import com.efi.printsmith.data.Contact;
	import com.efi.printsmith.data.Address;
    import com.efi.printsmith.data.CustomerLog;
    import com.efi.printsmith.data.City;
	import com.efi.printsmith.data.Country;
	import com.efi.printsmith.data.State;
	import com.efi.printsmith.data.Zip;
	import com.efi.printsmith.data.ShippingMethod;
	import com.efi.printsmith.data.TaxTable;
	import com.efi.printsmith.data.TaxCodes;           
	import com.efi.printsmith.data.Account; 
	import com.efi.printsmith.events.UpdateDataProviderEvent;
	import com.efi.printsmith.events.AccountPickerSelectEvent;
	import com.efi.printsmith.events.ChargeDefinitionSelectEvent;
	import com.efi.printsmith.events.commandEvents.EditForms.EditContactEvent;

	import com.efi.printsmith.events.commandEvents.Accounts.*;
	import mx.utils.StringUtil;  
	import mx.controls.Alert;                                         
	import mx.managers.PopUpManager;                                         
	import mx.containers.TitleWindow;                                         
	import mx.collections.ArrayCollection;                                         
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;
	import mx.rpc.Responder;                                         
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
    import mx.printing.FlexPrintJob;
    import mx.printing.PrintAdvancedDataGrid;
    import mx.printing.PrintDataGrid;
    import mx.core.Application;
    import mx.validators.Validator;
    import mx.events.ValidationResultEvent;    
    import mx.collections.SortField;
	import mx.collections.Sort;
	import com.efi.printsmith.security.PSSecurityCommands;
	
	private var myWindowId:int;
    
    private var accounts:ArrayCollection = new ArrayCollection();
    [Bindable]
    private var contacts:ArrayCollection = new ArrayCollection();
                 
	[Bindable]                                         
	private var account:Account;
	
	[Bindable] private var originalAccount:Account;
                
	[Bindable]
	private var autoDiscountRadioValue:String = "discount_dollar";
	
	[Bindable]
	private var acctStatusRadioValue:String = "acct_status_new_radio";
	[Bindable]                                
	private var systemPreferencesArray:ArrayCollection = new ArrayCollection();
    
	[Bindable]
	private var acctTypeRadioValue:String = "cash_check_credit";
	 [Bindable]                                         
    private var systemPreferences:PreferencesAccounting;              
	[Bindable]
	private var balances:ArrayCollection = new ArrayCollection([
            {Aged:"Current", Value:0},
            {Aged:"30", Value:0},
            {Aged:"60", Value:0},
            {Aged:"90", Value:0}
         ]);                   
    
    [Bindable] private var loadComponent:CommonLoadComponent;

    [Bindable]
    private var customerLogs:ArrayCollection = new ArrayCollection();
     [Bindable]
    private var creditLimitAbb:String = new String();         
    [Bindable]
    private var financeRateAbb:String = new String();
    [Bindable]
    private var salesReps:ArrayCollection = new ArrayCollection();
    [Bindable]
    private var businessTypes:ArrayCollection = new ArrayCollection();
    [Bindable]
    private var taxTables:ArrayCollection = new ArrayCollection();
    [Bindable]
    private var taxCodes:ArrayCollection = new ArrayCollection();
    [Bindable]
    private var defaultSalesRep:String = new String();   
    [Bindable]	
    private var defaultShipVia:String = new String();                    	
    [Bindable]
    private var shippingMethods:ArrayCollection = new ArrayCollection();                
    [Bindable]
    private var formIsValid:Boolean = false;
    [Bindable]
	private var EstInvCharges:ArrayCollection=new ArrayCollection();
	[Bindable]
	private var JobCharges:ArrayCollection=new ArrayCollection();
	[Bindable]
	private var first:Boolean = false;
    private var focussedFormControl:DisplayObject;
    
    public function getSecurityCommand():String {
    	return PSSecurityCommands.AR_ACCOUNTS;
    }
    
	public function init(event:FlexEvent = null):void {
		consumer.subscribe();
		notification_consumer.subscribe();     
		first = true;
		setSettings();
		this.enabled = false;
		dataServiceSystemPreferences.getAll("PreferencesAccounting");
		
		openAccountPicker();

		var eventAddress:AccountsAddressPanelEvent = new AccountsAddressPanelEvent(canvasAddress, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventAddress.dispatch();

		var eventCreditControl:AccountsCreditControlPanelEvent = new AccountsCreditControlPanelEvent(canvasCreditControl, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventCreditControl.dispatch();

		var eventLog:AccountsLogPanelEvent = new AccountsLogPanelEvent(canvasLog, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventLog.dispatch();

		var eventMarketing:AccountsMarketingPanelEvent = new AccountsMarketingPanelEvent(canvasMarketing, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventMarketing.dispatch();

		var eventNotes:AccountsNotesPanelEvent = new AccountsNotesPanelEvent(canvasNotes, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventNotes.dispatch();

		var eventSales:AccountsSalesPanelEvent = new AccountsSalesPanelEvent(canvasSales, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventSales.dispatch();

		var eventSettings:AccountsSettingsPanelEvent = new AccountsSettingsPanelEvent(canvasSettings, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventSettings.dispatch();

		var eventWeb:AccountsWebPanelEvent = new AccountsWebPanelEvent(canvasWeb, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventWeb.dispatch();
		this.ship_to_contact_editor.addEventListener("SaveContactEvent", saveShipToContactHandler, false, 1);
		this.bill_to_contact_editor.addEventListener("SaveContactEvent", saveBillToContactHandler, false, 1);
		
		myWindowId = Snowmass.getInstance().containerManager.getWindowWithChild(this, true).windowID;
		
	}

	public function saveShipToContactHandler(event:Event):void {
		doContactUpdate();
	}
	
	public function saveBillToContactHandler(event:Event):void {
		doContactUpdate2();
	}

	public function handleUIEvent(evt:ResultEvent):void {
		if (evt.result != null){
			dataService.deleteItem("Account", evt.result.id);
		}
	}		

	public function handleUIPanelEvent(evt:ResultEvent):void {
		evt.result.panel.enabled = evt.result.enabled;
	}		
	private function handleUIPanelFault(ev:FaultEvent):void {  
	}
	
	private function handleInvoicesResult(event:ResultEvent):void	{
		var ac:ArrayCollection = event.result as ArrayCollection;
		if (ac.length > 0)	{
			cust_prospect_radio_group.enabled = false;
		}
		else	{
			cust_prospect_radio_group.enabled = true; 
		}
	}
	private function doDelete():void {
		var event:DeleteAccountEvent = new DeleteAccountEvent(account, new mx.rpc.Responder(handleUIEvent, handleFault));
		event.dispatch();
	}
	private function handleAccountPickerCancel(evt:AccountPickerSelectEvent):void {
	
		doNewOperation();
		
			
		
	}
	private function handleAccountPickerMasterCancel(evt:AccountPickerSelectEvent):void {
		
		

	}
	private function handleAccountPickerMasterSelect(evt:AccountPickerSelectEvent):void {
		if (evt.account != null) {
			account.masterAcct = evt.account.id;
			if ( account.id != account.masterAcct)
				dataService.getByIdMaster("Account", account.masterAcct ); 
					
			
		} else {
			
			Alert.show("Account Master Picker returned a null account", "Error");
		}
	}
	
	
	
	private function handleAccountPickerSelect(evt:AccountPickerSelectEvent):void {
		
		var user:Users;
	
		user = Snowmass.getInstance().currentUser;
		if ( evt.account.access_level > user.accessLevel){
			Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'usecCmd.Sorryaccesstothisite'));
			this.enabled = true;
		}else{
		
			var inputArguments:Array = new Array();
			inputArguments.push(evt.account);
			var mDICompareObjectEvent:MDICompareObjectEvent = new MDICompareObjectEvent(MDICompareObjectEvent.MDI_COMPAREOBJECT,this,doSelectOperation,inputArguments);
			dispatchEvent(mDICompareObjectEvent);
			/* if (evt.account != null) {
				this.setAccount(evt.account);
				contactdataService.getContactsByAccountId("Contact", account.id);
				setMarketing();
				this.JobCharges = evt.account.jobCharges;
				this.EstInvCharges = evt.account.invoiceEstimateCharges;
			} else {
				this.setAccount(new Account());
				Alert.show("Account Picker returned a null account", "Error");
			} */
		}
	}
	
	private function doSelectOperation(accountObj:Account):void {
		this.enabled = true;
		selected_comment_edit.text = "";
		if (accountObj != null)
			dataService.getAccount(accountObj.id);
	}
	
	private function handleAccountPickerNew(evt:AccountPickerSelectEvent):void {
		doNew(evt.account.prospect);

	}
	private function handleAccountPickerUnassigned(evt:AccountPickerSelectEvent):void {
		doNewOperation();
		
		var ac:ArrayCollection = new ArrayCollection();
		ac.addItem(evt.account.contact);
		
		contacts = ac;
		
		updateInvoiceContact();
		updateStatementContact();
		
	}

	private function handleGetResult(ev:ResultEvent):void {
		this.setAccount(ev.result as Account);
		this.formIsValid = true;
		contactdataService.getContactsByAccountId("Contact", account.id);

		setMarketing();
		mapFromAccountData();
		setOriginalAccount();
		this.JobCharges = ev.result.jobCharges;
		if ( this.JobCharges.length >0){
			job_charges_edit.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'extPBookCmd.Charges')
			job_charges_edit.label = StringUtil.substitute(job_charges_edit.label,this.JobCharges.length );
		}else
			job_charges_edit.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AddCharges')
		this.EstInvCharges = ev.result.invoiceEstimateCharges;
		if  ( this.EstInvCharges.length > 0){
	     	inv_estimate_charges_edit.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'extPBookCmd.Charges')
	     	inv_estimate_charges_edit.label = StringUtil.substitute(inv_estimate_charges_edit.label,this.EstInvCharges.length);
		 }
		 else
	 		inv_estimate_charges_edit.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AddCharges')
	 		
	 		
	 	switch ( account.status){
	 		case "CustomerStatusNew" :
	 			acct_status_text.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.New');
	 			break;
	 		case "CustomerStatusCurrent":
	 			acct_status_text.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.Current');
	 			break;
	 		case "CustomerStatusDeliguent":
	 			acct_status_text.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.Delinquent');
	 			break;
	 		case "CustomerStatusInactive":
	 			acct_status_text.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.Inactive');
	 			break;
	 		case "CustomerStatusFrozen":
	 			acct_status_text.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.Frozen');
	 			break;
	 		case "CustomerStatusPastDue":
	 			acct_status_text.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.PastDue')
	 			break;
	 		
	 	}
	 		
	 		
	 			}
	private function handleLoadSystemPreferencesResult(ev:ResultEvent):void {
		systemPreferencesArray = ev.result as ArrayCollection;
		if (systemPreferencesArray.length > 0)
		{
			systemPreferences = systemPreferencesArray.getItemAt(0) as PreferencesAccounting;
			creditLimitAbb = systemPreferences.creditLimit.toString();
			financeRateAbb = systemPreferences.financeChange.toString();
			defaultSalesRep = systemPreferences.defaultSalesRep as String;
			defaultShipVia = systemPreferences.defaultShipping as String;
		}else{
			creditLimitAbb = "";
			financeRateAbb = "";

		}
	}	                                 
	private function handleGetMasterResult(ev:ResultEvent):void {
		var tempmaster:Account = new Account();
		tempmaster = ev.result as Account
		if ( tempmaster != null){
			masteracctId.text= tempmaster.accountId;
			master_acct_edit.text = tempmaster.title
		}else
		{
			masteracctId.text = ""
			master_acct_edit.text= ""
		}
	}
	
	private function doNew(isProspect:Boolean = false):void {
		var a:Array = new Array();
		a.push(isProspect);
		var mDICompareObjectEvent:MDICompareObjectEvent = new MDICompareObjectEvent(MDICompareObjectEvent.MDI_COMPAREOBJECT,this,doNewOperation,a);
		dispatchEvent(mDICompareObjectEvent);
	}
	
	private function doNewOperation(isProspect:Boolean = false):void {
	    business_type_combo.selectedIndex = -1 
		business_type_combo.text = "";
		
		tax_table_combo.selectedIndex = -1;
		tax_code_combo.selectedIndex = -1;
		
		certificate_expires_edit.text = "";
	    masteracctId.text = ""
		master_acct_edit.text= ""
	    account = new Account();
	    account.prospect = isProspect;
	    account.marketing = new Marketing();
	    selected_comment_edit.text = "";
	    contacts = new ArrayCollection();
	    
	  	 customerLogs = new ArrayCollection();
	    
	    log_dataGrid.invalidateDisplayList();
	     	   
	    
	    setMarketing();
	    acctTypeRadioValue = "cash_check_credit";
	 	acctStatusRadioValue = "CustomerStatusNew";
	    account.type = "cash_check_credit";
	    account.status = "CustomerStatusNew";
	    setAccount(account);
	    this.formIsValid = false;
	 	tabNav.selectedIndex = 0;
	 	job_charges_edit.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AddCharges');
		inv_estimate_charges_edit.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AddCharges');
		ship_via_combo.selectedIndex = findItem(defaultShipVia, shippingMethods);
		sales_rep_combo.selectedIndex = findItem(defaultSalesRep, salesReps);
		sales_rep_combo2.selectedIndex = findItem(defaultSalesRep, salesReps);
		this.JobCharges = new ArrayCollection;
		this.EstInvCharges = new ArrayCollection;
		
		mapToAccountData();
		setOriginalAccount();
	 	if ( this.enabled == false)
	 		this.enabled = true;
	}  
	
	
	private function doGet():void{
	    var   accountPickerWindow:AccountPicker = AccountPicker(PopUpManager.createPopUp(this, AccountPicker, true));
	    accountPickerWindow.setStyle("borderAlpha", 0.9);
	    accountPickerWindow.formIsEmpty = true;
	    accountPickerWindow.prospect_boolean = true;
	    accountPickerWindow.setAccounts(accounts);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.CANCELSELECTACCOUNT, handleAccountPickerCancel);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.SELECTACCOUNT, handleAccountPickerSelect);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.SELECTNEWACCOUNT, handleAccountPickerNew);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.SELECTUNASSIGNEDCONTACT, handleAccountPickerUnassigned);	   	    
	}    
	private function doMaster():void{
		 var accountPickerWindow:AccountPicker = AccountPicker(PopUpManager.createPopUp(this, AccountPicker, true));
	    accountPickerWindow.setStyle("borderAlpha", 0.9);
	    accountPickerWindow.formIsEmpty = true;
	    accountPickerWindow.contact_boolean  = false;
	    accountPickerWindow.prospect_boolean = false;
	    accountPickerWindow.setAccounts(accounts);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.CANCELSELECTACCOUNT, handleAccountPickerMasterCancel);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.SELECTACCOUNT, handleAccountPickerMasterSelect);
	    	   	    
	}
	
	private function doNext():void {
		var mDICompareObjectEvent:MDICompareObjectEvent = new MDICompareObjectEvent(MDICompareObjectEvent.MDI_COMPAREOBJECT,this,doNextOperation);
		dispatchEvent(mDICompareObjectEvent);
	}
	
	private function doNextOperation():void {  
		var itemp:int;
		var temp: Account;
		//itemp = accounts.getItemIndex(account);
		if (account == null)
			itemp = 0;
		else	{
		 	itemp =	findItemID(account.id, accounts); 
			itemp++;
		}
		if (itemp == accounts.length){
			itemp = accounts.length - 1;
		}
		temp = accounts.getItemAt(itemp,0) as Account;   
	   dataService.getAccount(temp.id );                            
	}
	
	private function doRevert():void{
		dataService.getAccount(account.id);
	}
	
	private function doPrev():void {
		var mDICompareObjectEvent:MDICompareObjectEvent = new MDICompareObjectEvent(MDICompareObjectEvent.MDI_COMPAREOBJECT,this,doPrevOperation);
		dispatchEvent(mDICompareObjectEvent);
	}
	
	private function doPrevOperation():void {              
	    var itemp:int;
	    var temp: Account;
	//	itemp = accounts.getItemIndex(account); 
		 itemp =	findItemID(account.id, accounts);
		itemp--;
		if (itemp < 0){
			itemp = 0; 
		}
		temp = accounts.getItemAt(itemp,0) as Account;   
	    dataService.getAccount(temp.id );                                           
	} 
	
	private function findItemID(id:int, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (id == element.id) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}                                               	
	private function send():void
	{
		var message:IMessage = new AsyncMessage();
		message.body.accounts = "*";
		//producer.send(message);
	}
		
	public function setAccount(account:Account):void
	{
		
		this.account = account;
		if (account.contact == null){
			account.contact = new Contact();
			account.contact.lastName = account.title;
		}
		
		if( account.contact.lastName == null || account.contact.lastName == "")
			if ( account.contact.firstName == "")
				account.contact.lastName = account.title;
			
		if (account.contact != null) {
			account.contact.parentAccount = account;
		}
		
		if(account.billToContact==null) {
			account.billToContact = account.contact;
		}
		
		mapFromAccountData();
		ship_to_address_editor.setLabel(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.InvoiceAddress'));
		bill_to_address_editor.setLabel(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.StatementAddress'));
		
		if (!isNaN(account.id) && account.id != 0) {
			dataService.getAllQuery("Invoice", " where account.id=" + account.id + " and onPendingList='t'");
		}
			
		var mdiWin:MDIWindow = Snowmass.getInstance().containerManager.getWindowWithChild(this);
		if ( account.prospect)
			mdiWin.title= resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Prospect')+"  #" + account.accountId+"  "+account.title;
		else{
			if ( account.accountId == "")
				mdiWin.title= resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'labelFormCmd.New')+" "+resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posPendCmd.Account')
			else
				mdiWin.title= resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Customer')+"  #" + account.accountId+"  "+account.title;
		}
		setOriginalAccount();
	}			
	
	private function messageHandler(message:IMessage):void
	{
	}
                                  
	private function deleteAccount():void {              
	                                         
	}
	
	
	                                                         
	private function updateUser():void {
	}
	
	private function mapToAccountData():void {
		account.title = name_edit.text;
		account.externalRef = external_ref_edit.text;
		account.externalAcctId = external_acct_id_edit.text;
		account.customerPO = po_number_edit.text;
		account.shipToAddress = ship_to_address_editor.getAddress();
		account.billToAddress = bill_to_address_editor.getAddress();
		if ( account.billToAddress!=null && account.billToAddress.street1 == ""){
			account.billToAddress.city = account.shipToAddress.city;
			account.billToAddress.country = account.shipToAddress.country;
			account.billToAddress.name = account.shipToAddress.name;
			account.billToAddress.state = account.shipToAddress.state;
			account.billToAddress.street1 = account.shipToAddress.street1;
			account.billToAddress.street2 = account.shipToAddress.street2;
			account.billToAddress.zip = account.shipToAddress.zip;
			account.billToAddress.zone = account.shipToAddress.zone;
		}
		account.contact = ship_to_contact_editor.getContact();
		if (account.contact == null){
			account.contact = new Contact();
			account.contact.lastName = account.title;
		}
		if( account.contact.lastName == null || account.contact.lastName == "")
			if (account.contact.firstName == "")
				account.contact.lastName = account.title;
		account.billToContact = bill_to_contact_editor.getContact();
		if (account.contact != null) {
			account.contact.parentAccount = account;
		}
		if (account.billToContact != null) {
			account.billToContact.parentAccount = account;
		}
		else
			account.billToContact = account.contact
	
		account.prospect = prospect.selected;
		
		if (account.marketing != null){
			
		
			if (account.marketing.birthDate != null)
				account.marketing.birthDate = birthDate.selectedDate;
			if (account.marketing.followup != null)
				account.marketing.followup=  followUp.selectedDate;
			if (account.marketing.commonInterst != null)	
				account.marketing.commonInterst = commonInterest.text;
			if (account.marketing.sportsInterst != null)
				account.marketing.sportsInterst = sportsInterest.text;
			
			account.marketing.leadSource = leadSource.text;
			account.marketing.leadSource2 = leadSource1.text;
			account.marketing.mailerType = mailerType.text;
			account.marketing.typeWork = typeofWork.text;
			if (account.marketing.user3 != null)
				account.marketing.user3 =  userDate3.selectedDate;
			if (account.marketing.user4 != null)
				account.marketing.user4 = userDate4.selectedDate;
			if (account.marketing.user5 != null)
				account.marketing.user5 = userDate5.selectedDate;
			account.marketing.user6 = user3Tag.text
			account.marketing.user7 = user4Tag.text;
			account.marketing.user8 = user8Tag.text;
			account.marketing.user9 = user9Tag.text; 
			account.marketing.annualRev = parseInt(annualRev.text);
			account.marketing.customer = customer.selected;
			account.marketing.prospect = prospect.selected;
			account.marketing.noMail = noMail.selected;
			account.marketing.personalAcct = personalAccount.selected;
			account.marketing.numberofEmployees= parseInt(numberofEmployees.text);
			
			if (business_type_combo != null && business_type_combo.selectedItem != null) 
				account.marketing.businessType = business_type_combo.selectedItem as BusinessType;
		}
		
		if (sales_rep_combo != null && sales_rep_combo.selectedItem != null && sales_rep_combo.text != "") 
			account.salesRep = sales_rep_combo.selectedItem as SalesRep;
		else
			account.salesRep = null;
		
		if (tax_table_combo != null && tax_table_combo.selectedItem != null && tax_table_combo.text != "") 
			if (tax_table_combo.selectedIndex == 0)
				account.taxTable = null
			else
				account.taxTable = tax_table_combo.selectedItem as TaxTable;
		else
			account.taxTable = null;
			
		if (tax_code_combo != null && tax_code_combo.selectedItem != null && tax_code_combo.text != "" ) 
			account.taxCode = tax_code_combo.selectedItem as TaxCodes;
		else
			account.taxCode = null;
			
		if (ship_via_combo != null && ship_via_combo.selectedItem != null && ship_via_combo.text != "" ) 
			account.shippingMode = ship_via_combo.selectedItem as ShippingMethod;
		else
			account.shippingMode = null;
			
		account.financeRate = parseFloat(monthly_finance_charge_edit.text)* .01;
		account.creditLimit = parseCurrencyFloat(credit_limit_edit.text);
		account.termsNet = parseInt(due_days_edit.text);
		account.applyFinanceCharges = never_calculate_finance_check.selected;
		account.oneTimeDiscount = one_time_discount_check.selected;
		
		account.poRequired = po_required_check.selected;
		account.generateStatements = do_not_generate_statements_check .selected;
		account.payCommissions = account_is_commissioned.selected;
		account.fileOriginals = always_file_originals.selected;
		account.taxExempt = tax_exempt_check.selected;
		account.resaleNumber = resale_number_edit.text;
		account.resaleCertExpirationDate = certificate_expires_edit.selectedDate;
		account.accountNote = acct_selection_note_edit.text;
		account.statementNote = statement_note_edit.text;
		account.jobNote = job_note_edit.text;
		
		if (auto_discount.selectedValue == "discount_dollar") {
			account.dollarDiscount = true;
			account.discountDollarAmt = parseCurrencyFloat(auto_discount_dollar_text.text);
		} else {
			account.dollarDiscount = false; 
			account.discount = parseFloat(auto_discount_percent_edit.text) * .01;
						
		}
		
		if (acct_type.selectedValue != null)
			account.type = acct_type.selectedValue.toString();
		if (acct_status.selectedValue != null)
			account.status = acct_status.selectedValue.toString();
		if( security_level_edit.text != null)
			account.access_level = parseInt(security_level_edit.text);
	}
	private function addSymbolFinance():void{
		var index:int;
	
		index = monthly_finance_charge_edit.text.indexOf('%',0);
		if ( index == -1){
			monthly_finance_charge_edit.text = monthly_finance_charge_edit.text + '%';
		}
		ClearLabel()
	} 
	private function addSymbolDiscount():void{
		var index:int;
		var temp:Number;
		temp = parseFloat(auto_discount_percent_edit.text);
		if ( temp > 100)
			auto_discount_percent_edit.text = '100%';
		index = auto_discount_percent_edit.text.indexOf('%',0);
		if ( index == -1){
			auto_discount_percent_edit.text = auto_discount_percent_edit.text + '%';
		}
	} 
	private function mapFromAccountData():void{
		balances = new ArrayCollection([
			{Aged:"Current", Value:account.balanceCurrent},
			{Aged:"30", Value:account.balance30Day},
			{Aged:"60", Value:account.balance60Day},
			{Aged:"90", Value:account.balance90Day}
		]);
		if (account.dollarDiscount) {
			autoDiscountRadioValue = "discount_dollar";
		} else {
			autoDiscountRadioValue = "discount_percent";
						
		}
	
		certificate_expires_edit.formatString="MM/DD/YYYY";
		setEditBox();
		acctStatusRadioValue = account.status;
		acctTypeRadioValue = account.type;
		acct_type.selectedValue = acctTypeRadioValue;
		logDataService.getAccountCustomerLogByAccountId(account.id);
		
		if (account.shippingMode != null)			
			ship_via_combo.selectedIndex = findItem(account.shippingMode.name, shippingMethods);
		else
			ship_via_combo.selectedIndex = -1;
		if (account.taxCode != null)		
			tax_code_combo.selectedIndex = findItem(account.taxCode.name, taxCodes);
		else
			tax_code_combo.selectedIndex = -1;
		if (account.salesRep != null){
			sales_rep_combo.selectedIndex = findItem(account.salesRep.name, salesReps);
			sales_rep_combo2.selectedIndex = findItem(account.salesRep.name, salesReps);
		}
		else{
			sales_rep_combo.selectedIndex = -1
			sales_rep_combo2.selectedIndex = -1
		}
		if (account.taxTable!= null)
			tax_table_combo.selectedIndex = findItem(account.taxTable.name, taxTables);
		else
			tax_table_combo.selectedIndex = 0;
		

		ship_to_address_editor.setAddress(account.shipToAddress);
        ship_to_contact_editor.setContact(account.contact);
        
		bill_to_address_editor.setAddress(account.billToAddress);
		bill_to_contact_editor.setContact(account.billToContact);
		
		if (account.marketing != null){
			
			account.marketing.prospect  = account.prospect;
			account.marketing.customer = !account.prospect;
			if (account.marketing.businessType != null)
				business_type_combo.selectedItem = account.marketing.businessType;
				//business_type_combo.selectedIndex = findItem(account.marketing.businessType.name, businessTypes);
			if (account.marketing.followup != null)
				followUp.selectedDate =account.marketing.followup;
			if (account.marketing.birthDate != null)
				birthDate.selectedDate =account.marketing.birthDate;
			if (account.marketing.user3!= null)
				userDate3.selectedDate =account.marketing.user3;
			if (account.marketing.user4!= null)
				userDate4.selectedDate =account.marketing.user4;
			if (account.marketing.user5!= null)
				userDate5.selectedDate =account.marketing.user5;
			
		}
		certificate_expires_edit.selectedDate = account.resaleCertExpirationDate;
		ClearLabel();
		if ( account.masterAcct > 0)
			dataService.getByIdMaster("Account", account.masterAcct );
		else
		{
			masteracctId.text = ""
			master_acct_edit.text= ""
		}
	}
	
	private function doSave():void {
		var index:int;
		var temp:String;
		
		if(account!=null){
			index = findItemCase(name_edit.text, accounts, account);
			if ( index > -1)
				{
					temp = resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'msg_4Thereisalreadyacust');
					temp = StringUtil.substitute(temp,name_edit.text);
					Alert.show(temp);
					return;
				}
							
			mapToAccountData();
			if(account.title==null || account.title==""){
				Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'msg_Cantfileanaccountift'));
			} else {
				this.enabled = false;
				dataService.addUpdate(account);
			}
			
		} else {
			doNewOperation();
		}                                        		
	} 
	private function findContactItem(contact:Contact, array:ArrayCollection):int{
		for each(var element:Object in array) {
			if (contact.firstName == element.firstName && contact.lastName == element.lastName) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function findItem(name:String, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (name == element.name) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function findItemCase(name:String, array:ArrayCollection, temp:Account):int {
		for each(var element:Object in array) {
			if (name.toUpperCase() == element.title.toUpperCase()) {
				if (temp.id == element.id)
					return -1;
				else
					return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function doSaleRep(): void{                             
		var sales:SalesRep;
		var result:Boolean;
		
			var item:int = findItem(sales_rep_combo.text, salesReps);
			if (item == -1) {
				sales = new SalesRep();
				sales.name = sales_rep_combo.text;
				salesRepDataService.addUpdate(sales);
				account.salesRep = sales
				sales_rep_combo2.text=sales_rep_combo.text;
			}
			else {
				sales_rep_combo.selectedIndex = item;
				sales_rep_combo2.selectedIndex = item;
			}
	
	}
	private function doSaleRep2(): void{                             
		var sales:SalesRep;
		var result:Boolean;
		
			var item:int = findItem(sales_rep_combo2.text, salesReps);
			if (item == -1) {
				sales = new SalesRep();
				sales.name = sales_rep_combo2.text;
				salesRepDataService.addUpdate(sales);
				account.salesRep = sales
				sales_rep_combo.text=sales_rep_combo2.text;
			}
			else {
				sales_rep_combo.selectedIndex = item;
				sales_rep_combo2.selectedIndex = item;
			}
	
	}
	private function doTaxTable(): void{                             
		var taxtable:TaxTable;
		var result:Boolean;
		
		if (tax_table_combo.text != null && tax_table_combo.text != "" && tax_table_combo.selectedIndex == -1) {
			var item:int = findItem(tax_table_combo.text, taxTables);
			if (item == -1) {
				taxtable = new TaxTable();
				taxtable.name = tax_table_combo.text;
				taxTableDataService.addUpdate(taxtable);
				account.taxTable = taxtable;
			}
			else {
				tax_table_combo.selectedIndex = item;
			}
		}
	}
	private function doTaxCode(): void{                             
		var taxcode:TaxCodes;
		var result:Boolean;
		
		if (tax_code_combo.text != null && tax_code_combo.text != "" && tax_code_combo.selectedIndex == -1) {
			var item:int = findItem(tax_code_combo.text, taxCodes);
			if (item == -1) {
				taxcode = new TaxCodes();
				taxcode.name = tax_code_combo.text;
				taxCodeDataService.addUpdate(taxcode);
				account.taxCode = taxcode;
			}
			else {
				tax_table_combo.selectedIndex = item;
			}
		}
	}
	private function doShipVia(): void{                             
		var shipv:ShippingMethod;
		var result:Boolean;
		
		if (ship_via_combo.text != null && ship_via_combo.text != "" && ship_via_combo.selectedIndex == -1) {
			var item:int = findItem(ship_via_combo.text, shippingMethods);
			if (item == -1) {
				shipv = new ShippingMethod();
				shipv.name = ship_via_combo.text;
				shippingMethodDataService.addUpdate(shipv);
				account.shippingMode = shipv;
			}
			else {
				ship_via_combo.selectedIndex = item;
			}
		}
	}
	private function doBusinessType(): void{                             
		var business:BusinessType;
		var result:Boolean;
		
		if (business_type_combo.typedText != null && business_type_combo.typedText != "" && business_type_combo.selectedIndex == -1) {
			var item:int = findItem(business_type_combo.typedText, businessTypes);
			if (item == -1) {
				business = new BusinessType();
				business.name = business_type_combo.text;
				businessTypeDataService.addUpdate(business);
				account.marketing.businessType= business;
			}
			else {
				business_type_combo.selectedIndex = item;
			}
		}
	}
	
	private function handleSaveResult(ev:ResultEvent):void {
		openConfirmationComponent(StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'CommonConfirmation.SAVE'),resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'custCmd.Customer')));
		this.account = ev.result as Account;
		this.EstInvCharges = this.account.invoiceEstimateCharges;
		this.JobCharges = this.account.jobCharges;
//		accounts.addItem(account);
		doNewOperation();
		openAccountPicker();
		var windowSaveSuccessEvent:WindowSaveSuccessEvent = new WindowSaveSuccessEvent(WindowSaveSuccessEvent.WINDOW_SAVESUCCESS_STATUS,true);
		dispatchEvent(windowSaveSuccessEvent);
	}
//// load
	private function handleLoadResult(ev:ResultEvent):void {
		accounts = ev.result as ArrayCollection;
		if (first){
			this.doGet();
			first = false;
		}
		else
			this.enabled = true;
		
		if(loadComponent) {
			loadComponent.close();
		}	
	}
	private function containsBlank(ac:ArrayCollection, field:String):Boolean	{
	 	for (var i:int = 0; i<ac.length; i++)	{
	 		if (StringUtil.trim(ac.getItemAt(i)[field] as String) == "")	{
	 			return true;
	 		}
	 	}
	 	return false;
	 } 	
	private function handleLoadSalesReps(ev:ResultEvent):void {
		var selectedItem:Object = sales_rep_combo.selectedItem;
		var sort:Sort = new Sort();
		salesReps = ev.result as ArrayCollection;
		sort.fields = [new SortField("name",true)];
	 	salesReps.sort = sort;
	 	salesReps.refresh();
		if (!containsBlank(salesReps,"name"))	{
			var salesRep:SalesRep = new SalesRep();
			salesRep.name = "";
			salesReps.addItemAt(salesRep, 0);
		}
		sales_rep_combo.selectedItem = selectedItem;
	}
	private function handleLoadBusinessTypes(ev:ResultEvent):void {
		var selectedItem:Object = business_type_combo.selectedItem;
		businessTypes = ev.result as ArrayCollection;
		business_type_combo.selectedItem = selectedItem;
	}
	
	private function handleLoadTaxTables(ev:ResultEvent):void {
		var selectedItem:Object = tax_table_combo.selectedItem;
		var temp:TaxTable = new TaxTable();
		taxTables = ev.result as ArrayCollection;
		temp.name = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'taxCmd.Default')+' ' + resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custDataCmd.TaxTable');
		taxTables.addItemAt(temp, 0);
		tax_table_combo.selectedItem= selectedItem;
	}
	
	private function handleLoadTaxCodes(ev:ResultEvent):void {
		var selectedItem:Object = tax_code_combo.selectedItem;
		taxCodes = ev.result as ArrayCollection;
		tax_code_combo.selectedItem = selectedItem;
	}
	
	
	private function handleLoadShippingMethods(ev:ResultEvent):void {
		var selectedItem:Object = ship_via_combo.selectedItem;
		shippingMethods = ev.result as ArrayCollection;
		ship_via_combo.selectedItem = selectedItem;
	}
	
	private function handleLoadCustomerLogs(ev:ResultEvent):void {
		
		customerLogs = ev.result as ArrayCollection;
	}
	
	
	private function openAccountPicker():void	{
		if (first){
			loadComponent = PopUpManager.createPopUp(this,CommonLoadComponent,true) as CommonLoadComponent;
		}
		dataService.getAccountPicker();
		
	}
//EndLOAD	
	
	private function handleSaveLogResult(ev:ResultEvent):void {
		selected_comment_edit.text = "";
		logDataService.getAccountCustomerLogByAccountId(account.id);
	}
	
	private function handleDeleteLogResult(ev:ResultEvent):void {
		logDataService.getAccountCustomerLogByAccountId(account.id);
	}
	
	
	                                 
	private function handleDeleteResult(ev:ResultEvent):void {
		openConfirmationComponent(StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'CommonConfirmation.DELETE'),resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'custCmd.Customer')));
		openAccountPicker();
		doNew();
	}
		
	      
//SAVE 	
	private function handleSaveBusinessTypeResult(ev:ResultEvent):void {
		businessTypeDataService.getAll("BusinessType");
	}      
	private function handleSaveTaxTableResult(ev:ResultEvent):void {
		taxTableDataService.getAll("TaxTable");
	}      
	private function handleSaveTaxCodeResult(ev:ResultEvent):void {
		taxCodeDataService.getAll("TaxCodes");
	}    
	private function handleSaveShippingMethodResult(ev:ResultEvent):void {
		shippingMethodDataService.getAll("ShippingMethod");
	}      

	private function handleSaveSalesRepResult(ev:ResultEvent):void {
		salesRepDataService.getAll("SalesRep");
	}   
	   

	private function handleFault(ev:FaultEvent):void {  
		var message:String;
		              
		message = "Error: "                          
		+ ev.fault.faultCode + " - "                                  
		+ ev.fault.faultDetail + " - "                                  
		+ ev.fault.faultString;
		Alert.show(message, "Error", 0);    
		
		if(loadComponent) {
			loadComponent.close();
		}                             
	}
	
 
 	private function deleteCustomerLog():void {
 		var log:CustomerLog = log_dataGrid.selectedItem as CustomerLog;
 		logDataService.deleteItem("CustomerLog", log.id);
 	}
 	
 	private function printCustomerLog():void {
		var myPrintJob:FlexPrintJob = new FlexPrintJob();
	
		if (myPrintJob.start()) {
			var myPrintDataGrid:PrintDataGrid = new PrintDataGrid();
	
			//Set the print view properties.
			myPrintDataGrid.width = myPrintJob.pageWidth;
			myPrintDataGrid.height = myPrintJob.pageHeight;
	
			// Set the data provider of the FormPrintView component's data grid
			// to be the data provider of the displayed data grid.
			myPrintDataGrid.dataProvider = log_dataGrid.dataProvider;
			myPrintDataGrid.columns = log_dataGrid.columns;
			myPrintDataGrid.visible = false;
			myPrintDataGrid.includeInLayout = false;
			
			Application.application.addChild(myPrintDataGrid);
	
			if(!myPrintDataGrid.validNextPage) {
				myPrintJob.addObject(myPrintDataGrid);
			} else {
				myPrintJob.addObject(myPrintDataGrid);
	
				while(true) {
					// Move the next page of data to the top of the print grid.
					myPrintDataGrid.nextPage();
	
					if(!myPrintDataGrid.validNextPage) {
						// This is the last page; queue it and exit the print loop.
						myPrintJob.addObject(myPrintDataGrid);
	
						break;
					} else {
						myPrintJob.addObject(myPrintDataGrid);
					}
				} 
	
			}
	
			Application.application.removeChild(myPrintDataGrid);
			myPrintJob.send();
	 	}
 	}
 	private function setMarketing():void{
 		
 		if ( account.marketing == null)
 			account.marketing = new Marketing();
 		else{
// 			if (account.marketing.birthDate == null)
// 				account.marketing.birthDate = new Date();
// 			if (account.marketing.followup == null)
// 				account.marketing.followup = new Date();
// 			if (account.marketing.user3 == null)
// 				account.marketing.user3 = new Date();
// 			if (account.marketing.user4 == null)
// 				account.marketing.user4 = new Date();
// 			if (account.marketing.user5 == null)
// 				account.marketing.user5 = new Date();
 			
 		}
// 		if (account.creditCardExpiration == null)
// 			account.creditCardExpiration = new Date();	
// 		if ( account.resaleCertExpirationDate == null)
// 			account.resaleCertExpirationDate = new Date();
 			
 		
 		
 	}
 	private function setSettings():void{
 		
 		salesRepDataService.getAll("SalesRep");
	    businessTypeDataService.getAll("BusinessType");
	    shippingMethodDataService.getAll("ShippingMethod");
	    taxTableDataService.getCurrentTaxTables("TaxTable");
	    taxCodeDataService.getAll("TaxCodes");
 		
 	}
 	
 	private function addCustomerLog():void {
 		var customerLog:CustomerLog = new CustomerLog();
 		customerLog.id = 0; // Always created new log entries - don't allow editing old ones.
 		customerLog.logEntry = selected_comment_edit.text;
 		customerLog.account = account;
 		logDataService.addUpdate(customerLog);
 	}
 	
    private function validateForm(event:Event):void 
    {                    
        focussedFormControl = event.target as DisplayObject;    

        formIsValid = true;            
        validate(nameValidator);
    }
 
    private function validate(validator:Validator):Boolean
	{                
        var validatorSource:DisplayObject = validator.source as DisplayObject;
     	var suppressEvents:Boolean = (validatorSource != focussedFormControl);
        var event:ValidationResultEvent = validator.validate(null, suppressEvents); 
        var currentControlIsValid:Boolean = (event.type == ValidationResultEvent.VALID);
		formIsValid = formIsValid && currentControlIsValid;
         
		return currentControlIsValid;
	}
	
    private function changeName(evt:Event):void {
    	validateForm(evt);
    	if (name_edit.text != "") {
    		if ( account == null){
    			account = new Account();
    			setMarketing();
				this.setAccount(account); 
    			}
    			
	    	if (account.shipToAddress == null) {
	    		account.shipToAddress = new Address();
	    		account.shipToAddress.name = name_edit.text;
	    		account.shipToAddress.street1 = "";
	    		account.shipToAddress.street2 = "";
	    		account.shipToAddress.city = "";
	    		account.shipToAddress.state = "";
	    		account.shipToAddress.zip = "";
	    		account.shipToAddress.country = "";
	    		account.shipToAddress.zone = "";
	    	}
	    	if (account.billToAddress == null) {
	    		account.billToAddress = new Address();
	    		account.billToAddress.name = name_edit.text;
	    		account.billToAddress.street1 = "";
	    		account.billToAddress.street2 = "";
	    		account.billToAddress.city = "";
	    		account.billToAddress.state = "";
	    		account.billToAddress.zip = "";
	    		account.billToAddress.country = "";
	    		account.billToAddress.zone = "";
	    	}
	    	this.ship_to_address_editor.setAddress(account.shipToAddress);
	    	this.bill_to_address_editor.setAddress(account.billToAddress);
	    }
    }
   private function ClearLabel():void{
    	
    	if (credit_limit_edit.text == "" || credit_limit_edit.text == "0.00") {
    		limit.visible = true;
    		if ( creditLimitAbb != "0")
    			limit.text = StringUtil.substitute(limit.text,creditLimitAbb);
    		else
    			limit.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.UnlimitedCredit');
    	}
    	else
    		limit.visible = false;
    		
    	if (monthly_finance_charge_edit.text == "" || monthly_finance_charge_edit.text == "0%"){
    		standardratelabel.visible = true;
    		if ( financeRateAbb != "0")
    			standardratelabel.text = StringUtil.substitute(standardratelabel.text,financeRateAbb);
    		else
    			standardratelabel.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.financechargesarenev');
    	}
    	else
    		standardratelabel.visible = false;
    }
    
    private function doEstInvCharge():void{
        var chargePicker:ChargeDefinitionPicker=ChargeDefinitionPicker(PopUpManager.createPopUp(this, ChargeDefinitionPicker, true));
		chargePicker.charges = this.EstInvCharges;
		chargePicker.setTitle(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeListCmd.ChargeSelector'));
		chargePicker.setStyle("borderAlpha", 0.9);
		chargePicker.addEventListener(ChargeDefinitionSelectEvent.CHARGEDEFINITIONCOMPLETE, handleChargeDefinitionEstInvComplete);
		chargePicker.addEventListener(ChargeDefinitionSelectEvent.CHARGEDEFINITIONCANCEL, handleChargeDefinitionCancel);
    }
     private function doJobCharges():void{
        var chargePicker1:ChargeDefinitionPicker=ChargeDefinitionPicker(PopUpManager.createPopUp(this, ChargeDefinitionPicker, true));
		chargePicker1.charges = this.JobCharges;
		chargePicker1.setStyle("borderAlpha", 0.9);
		chargePicker1.setTitle(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeListCmd.ChargeSelector'));
		chargePicker1.addEventListener(ChargeDefinitionSelectEvent.CHARGEDEFINITIONCOMPLETE, handleChargeDefinitionJobComplete);
		chargePicker1.addEventListener(ChargeDefinitionSelectEvent.CHARGEDEFINITIONCANCEL, handleChargeDefinitionCancel);
    }
	
	private function handleChargeDefinitionEstInvComplete(evt:ChargeDefinitionSelectEvent):void
	{
		this.account.invoiceEstimateCharges = evt.chargeArray;
		
		
		if  ( this.account.invoiceEstimateCharges.length > 0){
	     	inv_estimate_charges_edit.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'extPBookCmd.Charges')
	     	inv_estimate_charges_edit.label = StringUtil.substitute(inv_estimate_charges_edit.label,this.account.invoiceEstimateCharges.length);
		 }
		else
	 		inv_estimate_charges_edit.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AddCharges')
	 		
	}
	private function handleChargeDefinitionJobComplete(evt:ChargeDefinitionSelectEvent):void
	{
		this.account.jobCharges=evt.chargeArray;
		if ( this.account.jobCharges.length >0){
			job_charges_edit.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'extPBookCmd.Charges')
			job_charges_edit.label = StringUtil.substitute(job_charges_edit.label,this.JobCharges.length );
		}
		else
	 		job_charges_edit.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AddCharges')
	}
	private function handleChargeDefinitionCancel(evt:ChargeDefinitionSelectEvent):void
	{
		
	}
	
	private function handleLoadContacts(ev:ResultEvent):void
	{
		contacts=ev.result as ArrayCollection
		invoicecontactlist.selectedIndex = findContactItem(account.contact, contacts)
		statementcontactlist.selectedIndex = findContactItem(account.billToContact, contacts);
	}

    private function updateStatementContact():void{
    	account.billToContact = statementcontactlist.selectedItem as Contact;
    	bill_to_contact_editor.setContact(account.billToContact);
    }
    
    private function updateInvoiceContact():void{
     account.contact= invoicecontactlist.selectedItem as Contact;
     ship_to_contact_editor.setContact(account.contact);
    }
    
     public function doName(item:Object):String{
		var tmpItem:Contact ;
		tmpItem = item as Contact;
		var tmpString:String;
		
		if (tmpItem != null && tmpItem.lastName != null) {
			if (tmpItem.firstName == null)
				tmpString = tmpItem.lastName
			else{
				tmpString = tmpItem.lastName
				if (tmpItem.firstName != "")
					tmpString = tmpString + ", " + tmpItem.firstName; 
			}
			return(tmpString);
		} else {
			return "None";
		}
	}    
 public function doBusinessName(item:Object):String{
		var tmpItem:BusinessType ;
		tmpItem = item as BusinessType;
		var tmpString:String;
		
		if (tmpItem != null && tmpItem.name != null ) {
			tmpString = tmpItem.name
			return(tmpString);
		} else {
			return "";
		}
	}    
	private function setEditBox():void{
		if (auto_discount.selectedValue == "discount_percent"){
			auto_discount_percent_edit.enabled = true;
			auto_discount_dollar_text.enabled = false;
			one_time_discount_check.enabled = false;
		
		}else{
			auto_discount_percent_edit.enabled = false;
			auto_discount_dollar_text.enabled = true;
			one_time_discount_check.enabled = true;
		
		}
	
	}
		public function handleUIContactEvent(evt:ResultEvent):void {
			var child:Panel = evt.result as Panel;
			//addUniqueTab(child);
			var win:MDIWindow = Application.application.containerManager.getWindowWithChild(child);
			if (win == null)	{
				Application.application.containerManager.openNewMDIWindow(child.title,child);
			}
			else	{
				win.bringWindowToFront();	
			}
			

		}		
	private function doContact():void{
		
		if (Snowmass.getInstance().security.commandEnabled(EditContactEvent.COMMANDID)) {
			var child:EditContact = new EditContact();
			child.addEventListener(ContactCreateUpdateEvent.CONTACT_CREATE, onNewContactAdded);
			var c:Contact = new Contact();
			c.parentAccount = account;
			child.mode = EditContact.CT_NEW;
			child.contactFromParent = c;

			Snowmass.getInstance().containerManager.openNewMDIWindow(child.title, child,-1,-1,-1,-1, myWindowId); 
			
		}
		
//		var event:EditContactEvent = new EditContactEvent(null, new mx.rpc.Responder(handleUIContactEvent, handleFault));
//		event.dispatch();
	}
	
	private function onNewContactAdded(event:ContactCreateUpdateEvent):void	{
		contacts.addItem(event.contact);
		if (contacts.length == 1) {
			updateInvoiceContact();
			updateStatementContact();
		}
	}
	

	private function doRemoveContact():void{
//		var event:EditContactEvent = new EditContactEvent(null, new mx.rpc.Responder(handleUIContactEvent, handleFault));
//		event.dispatch();
		
		if ((contacts != null) && (contacts.length > 1))	{
			var nameStr:String = account.billToContact.lastName + ", " + this.account.billToContact.firstName;
			var deleteStr:String = StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'msg_Oktodelete0'), nameStr);
			Alert.show(deleteStr,"Warning",Alert.YES|Alert.NO,this,handleDeleteContact,null,Alert.OK);
			//Snowmass.getInstance().containerManager.openNewMDIWindow(contactWin.title, contactWin, -1,-1,-1,-1,myWindowId);
		}
	}
	
	private function handleDeleteContact(event:CloseEvent):void {
		if(event.detail == Alert.YES) {
			var contactWin:EditContact = new EditContact();
				
			contactWin.addEventListener(ContactCreateUpdateEvent.CONTACT_DELETE, onContactDelete);
				
			contactWin.mode = EditContact.CT_DELETE;
			contactWin.contactFromParent = account.billToContact;
			contactWin.deleteContact();
		}
	}
	
	private function onContactDelete(event:ContactCreateUpdateEvent):void	{
		//MS: add confirm popup here....
		
		var ac:ArrayCollection = contacts;
		var stmtContact:Contact = statementcontactlist.selectedItem as Contact;
		var invContact:Contact = invoicecontactlist.selectedItem as Contact;
		
		if (ac)	{
			var i:int = 0;
			for (i=0; i<ac.length; i++)	{
				if ((ac.getItemAt(i) as Contact).contactId == event.contact.contactId)	{
					ac.removeItemAt(i);
					//ac.addItemAt(event.contact, i);
					break;
				}
			}	
			contacts = ac;	
		}
		
		if ((stmtContact) && (stmtContact.contactId == event.contact.contactId))	{
			statementcontactlist.selectedIndex = i;
			updateStatementContact();
						
		}
		if ((invContact) && (invContact.contactId == event.contact.contactId))	{
			invoicecontactlist.selectedIndex = i;
			updateInvoiceContact();			
		}
	}
//	private function doStatContact():void{
//		var event:EditContactEvent = new EditContactEvent(account.contact, new mx.rpc.Responder(handleUIContactEvent, handleFault));
//		event.dispatch();
//		
//	}
	private function doContactEdit(isBillToContact:Boolean):void{
		if (Snowmass.getInstance().security.commandEnabled(EditContactEvent.COMMANDID)) {
			var contact:Contact;
			if (isBillToContact)	{
				// invoice contact
				contact = account.billToContact;			
			}
			else	{
				// statement contact
				contact = account.contact;
			}
	//		if (contactWindow)	{
	//			Alert.show("Window already in use");
	//			Snowmass.getInstance().containerManager.getWindowWithChild(contactWindow, true).;
	//		}
			var contactWin:EditContact = new EditContact();
			
			if (isBillToContact)	
				contactWin.addEventListener(ContactCreateUpdateEvent.CONTACT_UPDATE, onBillToContactEdit);
			else
				contactWin.addEventListener(ContactCreateUpdateEvent.CONTACT_UPDATE, onStmtContactEdit);
				
			contactWin.mode = EditContact.CT_EDIT;
			contactWin.contactFromParent = contact;

			Snowmass.getInstance().containerManager.openNewMDIWindow(contactWin.title, contactWin, -1,-1,-1,-1,myWindowId);

		}
	}
	
	private function onContactEdit(event:ContactCreateUpdateEvent):void	{
		var ac:ArrayCollection = contacts;
		var stmtContact:Contact = statementcontactlist.selectedItem as Contact;
		var invContact:Contact = invoicecontactlist.selectedItem as Contact;
		
		if (ac)	{
			var i:int = 0;
			for (i=0; i<ac.length; i++)	{
				if ((ac.getItemAt(i) as Contact).contactId == event.contact.contactId)	{
					ac.removeItemAt(i);
					ac.addItemAt(event.contact, i);
					break;
				}
			}	
			contacts = ac;			
		}
		
		if ((stmtContact) && (stmtContact.contactId == event.contact.contactId))	{
			statementcontactlist.selectedIndex = i;		
			updateStatementContact();			
		}
		if ((invContact) && (invContact.contactId == event.contact.contactId))	{
			invoicecontactlist.selectedIndex = i;
			updateInvoiceContact();					
		}
		
		setAccount(account);
		
	}
	private function onBillToContactEdit(event:ContactCreateUpdateEvent):void	{
		this.account.billToContact = event.contact;
		onContactEdit(event);
	}
	
	private function onStmtContactEdit(event:ContactCreateUpdateEvent):void	{
		this.account.contact = event.contact;
		onContactEdit(event);
	}
	
	private function getAccount():void{
		if ( (account.accountId ==  masteracctId.text) || (masteracctId.text == "")){
			masteracctId.text = "";
			account.masterAcct = 0;
			master_acct_edit.text= ""
		}
		else
		
			dataService.getByAccountId(masteracctId.text); 
	}
	private function handleGetaccountIDResult(ev:ResultEvent):void{
		var tempAccount:Account = new Account();
		
		tempAccount = ev.result as Account;
		if ((tempAccount != null )&&( !tempAccount.prospect)){
			account.masterAcct = tempAccount.id;
			dataService.getByIdMaster("Account", account.masterAcct ); 
			}
		else{
			masteracctId.text = "";
		}
		
	}
	private function doDateDisplay(item:Object, column:DataGridColumn):String{
		var tmpItem:CustomerLog ;
		tmpItem = item as CustomerLog;
		
		if (tmpItem != null ) {
			return Snowmass.getShortDateTimeFormatter().format(tmpItem.modified);
		} else {
			return "";
		}
	}
	private function doContactUpdate():void{
		if(account!=null){
			if ((account.contact != null) && (account.billToContact != null))
				if ( account.contact.id == account.billToContact.id)
					ship_to_contact_editor.setContact(account.billToContact);
				if ( account.contact.id == account.billToContact.id)
					bill_to_contact_editor.setContact(account.contact);	
		}
		
	}
	private function doContactUpdate2():void{
		if(account!=null){
			if ((account.contact != null) && (account.billToContact != null))
				if ( account.contact.id == account.billToContact.id)
					bill_to_contact_editor.setContact(account.contact);
				if ( account.contact.id == account.billToContact.id)
					ship_to_contact_editor.setContact(account.billToContact);		
		}	
	}	
	
	public function getOriginalObject():ArrayCollection {
		var originalList:ArrayCollection = new ArrayCollection();
		if(originalAccount!=null){
			if(originalAccount.marketing!=null){
				if(originalAccount.marketing.birthDate!=null){
					originalAccount.marketing.birthDate = scrubTimeValue(originalAccount.marketing.birthDate);
				}
				if(originalAccount.marketing.followup!=null){
					originalAccount.marketing.followup = scrubTimeValue(originalAccount.marketing.followup);
				}
				if(originalAccount.marketing.user3!=null){
					originalAccount.marketing.user3 = scrubTimeValue(originalAccount.marketing.user3);
				}
				if(originalAccount.marketing.user4!=null){
					originalAccount.marketing.user4 = scrubTimeValue(originalAccount.marketing.user4);
				}
				if(originalAccount.marketing.user5!=null){
					originalAccount.marketing.user5 = scrubTimeValue(originalAccount.marketing.user5);
				}
			}
			if(originalAccount.resaleCertExpirationDate!=null){
				originalAccount.resaleCertExpirationDate = scrubTimeValue(originalAccount.resaleCertExpirationDate);
			}
		}
		originalList.addItem(originalAccount);
		return originalList;
	}
		
	public function getUpdatedObject():ArrayCollection {
		var updatedList:ArrayCollection = new ArrayCollection();
		updatedList.addItem(account);
		return updatedList;
	}
	
	public function getConfirmationText():String {
		var mdiWin:MDIWindow = Snowmass.getInstance().containerManager.getWindowWithChild(this);
		return "\n"+mdiWin.title;
	}
	
	public function onClose():void {
		if(account!=null){
			mapToAccountData()
		}
	}
	
	public function onSave():void {
		doSave();
	}
	
	public function onDontSave():void {
		
	}
	
	public function onCancel():void {
		
	}
	
	public function setOriginalAccount():void {
		registerClassAlias("com.efi.printsmith.data.Account",Account);
		originalAccount = ObjectUtil.copy(account) as Account;
	}
     
]]>
                             
</mx:Script>

<mx:VBox width="100%" height="100%">
	<mx:Canvas width="742" height="661" verticalScrollPolicy="off">
		<mx:TabNavigator x="10" y="74" width="723" height="587"  creationPolicy="all" id="tabNav">
			<mx:Canvas id="outerAddress" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Address')}" >
				<mx:Label x="184" y="40" visible="false" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'usecCmd.Sorryaccesstothisite')}" id="accessAddress" />
				<mx:Canvas id="canvasAddress" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Address')}" width="100%" height="100%">
					<mx:TextInput x="282" y="10" id="name_edit" width="387" text="{account.title}" focusOut="changeName(event)"/>
					<mx:Text x="10" y="12" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Acct')}" width="46"/>
					<mx:Text x="55" y="12" width="76" id="acct_text" text="{account.accountId}"/>
					<mx:Label x="232" y="12" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Name')}" textAlign="right"/>
					<mx:TextInput x="282" y="38" id="external_ref_edit"  text="{account.externalRef}"/>
					<mx:TextInput x="282" y="66" id="external_acct_id_edit" text="{account.externalAcctId}"/>
					<mx:Label x="139" y="68" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.ExternalAccountingID')}" textAlign="right"/>
					<mx:Label x="184" y="40" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'prospectCmd.ExternalRef')}" textAlign="right"/>
					<ns1:AddressEditor  x="10" y="94" id="ship_to_address_editor" addressLabel="Shipping Address" height="157" width="325"/>
					<ns1:AddressEditor x="343" y="94" id="bill_to_address_editor" addressLabel="Billing Address" height="157" width="325"/>
					<ns1:ContactInfoEditor deactivate="doContactUpdate2()"  x="10" y="259" height="198" width="325" id="ship_to_contact_editor" contactLabel="Invoice Contact"/>
					<ns1:ContactInfoEditor deactivate="doContactUpdate()" x="344" y="259" height="198" width="325" id="bill_to_contact_editor" contactLabel="Statement Contact"/>
					<mx:Label x="10" y="468" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.ContactList')}"/>
					<mx:Label x="344" y="468" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.ContactList')}"/>
					<mx:ComboBox x="127" y="465" height="22" id="invoicecontactlist" labelFunction="doName" enabled="{contacts.length >0}" width="160" dataProvider="{contacts}" change="updateInvoiceContact();"/>
					<mx:ComboBox x="461" y="465" height="21" id="statementcontactlist" enabled="{contacts.length >0}" dataProvider="{contacts}" labelFunction="doName" change="updateStatementContact();" width="160"/>
					<mx:Label x="404" y="506"  textAlign="right" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.DeleteAdd')}"/>
					<mx:LinkButton x="546"
						   id="remove_contact_button"
						   click="doRemoveContact()"
						   enabled="{contacts.length > 1}" 
						   icon="@Embed(source='../../../../assets/delete16.png')"
						   width="24"
						   bottom="29"/>
					<mx:LinkButton x="578"
								   id="add_contact_button"
								   click="doContact()"
								   icon="@Embed(source='../../../../assets/add16.png')"
								   width="24"
								   bottom="29"/>
					<mx:LinkButton x="295" y="466" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Edit')}" width="41" id="edit_inv_contact" enabled="{contacts.length > 0}" click="doContactEdit(false);"/>
					<mx:LinkButton x="629" y="466"  label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Edit')}" width="52" id="edit_stat_contact" enabled="{contacts.length > 0}" click="doContactEdit(true);"/>
				</mx:Canvas>
			</mx:Canvas>		
			<mx:Canvas id="outerCreditControl" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.CreditControl')}" >
				<mx:Label x="184" y="40" visible="false" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'usecCmd.Sorryaccesstothisite')}" id="accessCreditControl" />

				<mx:Canvas id="canvasCreditControl" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.CreditControl')}" width="100%" height="100%">
					<mx:TextInput restrict="0-9\." x="181" y="10" id="credit_limit_edit" width="160" text="{Snowmass.getCurrencyFormatter(false,2).format(account.creditLimit)}"  focusOut="ClearLabel();"/>
					<mx:Label x="99" y="12" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'otherPrefCmd.CreditLimit')}" textAlign="right"/>
					<mx:TextInput x="181" y="38" id="due_days_edit" text="{account.termsNet}"/> 
					<mx:TextInput x="181" y="66" id="monthly_finance_charge_edit" text="{account.financeRate * 100}%"  focusOut="addSymbolFinance();"/>
					<mx:Label x="10" y="68" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.MonthlyFinanceCharge')}" textAlign="right"/>
					<mx:Label x="45" y="94" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.FinanceChargesYTD')}" textAlign="right"/>
					<mx:Label x="45" y="120" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.CurrentBalance')}" textAlign="right" width="128"/>
					<mx:Label x="181" y="120" text="{account.balance}" textAlign="right" width="160" id="current_balance_edit" />
					<mx:Label x="181" y="94" text="0.00" textAlign="right" width="160" id="finance_charges_ytd_edit"/>
					<mx:Label x="36" y="40" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Duedaysfromposting')}" textAlign="right"/>
					<mx:Text x="349" y="12" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Usingsystemlimitof0')}" width="348" fontWeight="bold" id="limit"/>
					<mx:Text x="349" y="40" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'salesCmd.AvgDaystoPay')}" width="304" fontWeight="bold"/>
					<mx:Text x="349" y="68" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Usingstandardrateof0')}" width="348" fontWeight="bold"  id="standardratelabel"/>
					<mx:CheckBox x="384" y="92" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Nevercalculatefinanc')}" id="never_calculate_finance_check"  selected="{account.applyFinanceCharges}"/>
					<mx:Panel x="10" y="146" width="402" height="118" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AutomaticDiscount')}" dropShadowEnabled="false">
						<mx:TextInput x="85" y="10" restrict="0-9\-" width="132" id="auto_discount_percent_edit" text="{account.discount * 100}%" focusOut="addSymbolDiscount()"/>
						<mx:TextInput x="85" y="40" width="132" id="auto_discount_dollar_text" text="{Snowmass.getCurrencyFormatter(false,2).format(account.discountDollarAmt)}"/>
						
						<mx:RadioButtonGroup id="auto_discount" selectedValue="{autoDiscountRadioValue}" change="setEditBox();"/>
						<mx:RadioButton  x="10" y="10" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Percent')}" id="auto_discount_percent_radio" value="discount_percent" groupName="auto_discount"/>
						<mx:RadioButton  x="10" y="40" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Dollars')}" id="auto_discount_dollar_radio" value="discount_dollar" groupName="auto_discount"/>
						<mx:CheckBox x="225" y="40" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Onetimediscount')}" id="one_time_discount_check" selected="{account.oneTimeDiscount}"/>
					</mx:Panel>
					<mx:Panel x="10" y="272" width="402" height="115" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AccountStatus')}" dropShadowEnabled="false">
						<mx:RadioButtonGroup id="acct_status" selectedValue="{acctStatusRadioValue}"/>
						<mx:RadioButton x="10" y="10" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.New')}" id="acct_status_new_radio" groupName="acct_status" value="CustomerStatusNew"/>
						<mx:RadioButton x="138" y="10" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.Current')}" id="acct_status_current_radio" groupName="acct_status" value="CustomerStatusCurrent"/>
						<mx:RadioButton x="138" y="40" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.Delinquent')}" id="acct_status_delinquent_radio" groupName="acct_status" value ="CustomerStatusDeliguent"/>
						<mx:RadioButton x="303" y="10" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.Inactive')}" id="acct_status_inactive_radio" groupName="acct_status" value="CustomerStatusInactive"/>
						<mx:RadioButton x="303" y="43" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.Frozen')}" id="acct_status_frozen_radio" groupName="acct_status"  value="CustomerStatusFrozen"/>
						<mx:RadioButton x="10" y="40" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custStatus.PastDue')}" id="acct_status_past_due_radio" groupName="acct_status" value="CustomerStatusPastDue" />
					</mx:Panel>
					<mx:Panel x="420" y="146" width="208" height="241" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Type')}" dropShadowEnabled="false">
						<mx:RadioButtonGroup id="acct_type" selectedValue="{acctTypeRadioValue}"/>
						<mx:RadioButton x="10" y="10" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custType.FullDeposit')}" id="type_full_deposit_radio" groupName="acct_type" value="full_deposit"/>
						<mx:RadioButton x="10" y="40" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custType.CashOnly')}" id="type_cash_only_radio" groupName="acct_type" value="cash_only"/>
						<mx:RadioButton x="10" y="70" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custType.CashCheckCreditCard')}" id="type_cash_check_credit_radio" groupName="acct_type" value="cash_check_credit"/>
						<mx:RadioButton x="10" y="100" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custType.ChargeAccount')}" id="type_charge_account_radio" groupName="acct_type" value="charge_acct"/>
						<mx:RadioButton x="10" y="130" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custType.CreditCardonFile')}" id="type_credit_card_on_file_radio" groupName="acct_type" value="credit_card_on_file"/>
					</mx:Panel>
				</mx:Canvas>
			</mx:Canvas>
			<mx:Canvas id="outerSettings" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'stockCatCmd.Settings')}" width="100%" height="100%" >
				<mx:Label x="184" y="40" visible="false" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'usecCmd.Sorryaccesstothisite')}" id="accessSettings" />	
				<mx:Canvas id="canvasSettings" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'stockCatCmd.Settings')}" width="100%" height="100%" >
				
					<mx:Label x="84" y="36" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'prospectCmd.SalesRep')}" textAlign="right" width="93"/>
					<mx:Label x="25" y="62" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.BusinessTypeCode')}" textAlign="right" width="152"/>
					<mx:Label x="84" y="116" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.PONumber')}" textAlign="right" width="93"/>
					<mx:Label x="369" y="234" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Securitylevelofthisa')}" textAlign="right" width="229"/>
					<mx:TextInput x="185" y="116" width="160" id="po_number_edit" text="{account.customerPO}"/>
					<mx:Text x="369" y="10" width="287" id="master_acct_edit" text=""/>
					<mx:Button x="10" y="8" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.SelectMasterAccount')}" click="doMaster();" width="236"/>
					<mx:ComboBox id="sales_rep_combo" x="185" y="34" width="160" dataProvider="{salesReps}"  labelField="name" focusOut="doSaleRep();"/>
					<fc:AutoComplete id="business_type_combo"  x="185" y="60" width="160" dataProvider="{businessTypes}" labelFunction="doBusinessName" focusOut="doBusinessType();" lookAhead="true" />
						
					<mx:Label x="57" y="90" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.ShipVia')}" textAlign="right" width="120"/>
					<mx:ComboBox id="ship_via_combo" x="185" y="88" width="160" dataProvider="{shippingMethods}"  labelField="name" focusOut="doShipVia()"/>
					
					<mx:Label x="10" y="264" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.DefaultInvoice')}" textAlign="right" width="102"/>
					<mx:ComboBox x="120" y="262" width="160" id="default_invoice_combo"></mx:ComboBox>
					<mx:Label x="10" y="292" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.DefaultEstimate')}" textAlign="right" width="102"/>
					<mx:ComboBox x="120" y="290" width="160" id="default_estimate_combo"></mx:ComboBox>
					<mx:CheckBox x="10" y="142" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.POrequiredonInvoice')}" width="236" id="po_required_check" selected="{account.poRequired}"/>
					<mx:CheckBox x="10" y="172" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.DoNOTgeneratestateme')}" width="236" id="do_not_generate_statements_check" selected="{account.generateStatements}"/>
					<mx:CheckBox x="10" y="202" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Accountiscommissione')}" width="236" id="account_is_commissioned" selected="{account.payCommissions}"/>
					<mx:CheckBox x="10" y="232" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Alwaysfileoriginals')}" width="236" id="always_file_originals" selected="{account.fileOriginals}"/>
					<mx:Panel x="353" y="38" width="303" height="186" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.TaxSetup')}" dropShadowEnabled="false">
						<mx:Label x="0" y="12" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'taxCmd.TaxTable')}" textAlign="right" width="93"/>
						
						<mx:ComboBox id="tax_table_combo" x="101" y="10" width="160" dataProvider="{taxTables}"  labelField="name" focusOut="doTaxTable()"  />
						<mx:ComboBox id="tax_code_combo" x="101" y="38" width="160" dataProvider="{taxCodes}"  labelField="name" focusOut="doTaxCode()" />
				
						<mx:Label x="0" y="38" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custDataCmd.TaxCode')}" textAlign="right" width="93"/>
						<mx:Label x="10" y="64" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custDataCmd.Resale')}" textAlign="right" width="83"/>
						<mx:TextInput x="101" y="64" width="160" id="resale_number_edit"  text="{account.resaleNumber}"/>
						<mx:Label x="10" y="90" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.CertExpires')}" textAlign="right" width="83"/>
						<mx:CheckBox x="101" y="116" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.TaxExempt')}" width="160" id="tax_exempt_check" selected="{account.taxExempt}"/>
						<mx:DateField x="101" y="88" width="151" id="certificate_expires_edit" text="{Snowmass.getDateFormatter().format(account.resaleCertExpirationDate)}" editable="true" enabled="true"/>
					</mx:Panel>
					<mx:Panel x="10" y="318" width="397" height="103" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'changePriceCmd.PresetCharges')}" dropShadowEnabled="false">
						<mx:Label x="10" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AddtoInvoicesandEsti')}" textAlign="right" width="198"/>
						<mx:Label x="10" y="35" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AddtoJobs')}" textAlign="right" width="198"/>
						<mx:Button x="216" y="8" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AddCharges')}" id="inv_estimate_charges_edit" click="doEstInvCharge();"/>
						<mx:Button x="216" y="31" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AddCharges')}" id="job_charges_edit" click="doJobCharges();"/>
					</mx:Panel>
					<mx:TextInput x="606" y="232" id="security_level_edit" width="50" restrict="0-9" maxChars="2" text="{account.access_level}"/>
					<mx:TextInput x="254" y="10" width="91" id="masteracctId" focusOut="getAccount()" />
				</mx:Canvas>
			</mx:Canvas>

			<mx:Canvas id="outerSales" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.SalesInfo')}" width="100%" height="100%" >
				<mx:Label x="184" y="40" visible="false" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'usecCmd.Sorryaccesstothisite')}" id="accessSales" />	

				<mx:Canvas id="canvasSales" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.SalesInfo')}" width="100%" height="100%">
					<mx:Panel x="10" y="10" width="377" height="163" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Balance')}" dropShadowEnabled="false">
						<mx:Label x="22" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'agingLabelText.Current')}"/>
						<mx:Label x="18" y="36" text="30 Days:"/>
						<mx:Text x="81" y="10" width="64" id="balance_current_text"  text="{account.balanceCurrent}"/>
						<mx:Label x="140" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rCustSort.AccountStatus')}" textAlign="right"/>
						<mx:Label x="140" y="36" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.POSCharges')}" textAlign="right" width="83"/>
						<mx:Text x="259" y="36" text="" width="88" textAlign="right" height="18" id="pos_charges_text"/>
						<mx:Label x="128" y="62" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.CurrentBalance')}" width="106"/>
						<mx:Text x="259" y="10" width="88" textAlign="right" height="18" id="acct_status_text"/>
						<mx:Text x="259" y="64" width="88" textAlign="right" height="18" id="current_balance_text" text="{account.balance}"/>
						<mx:Text x="81" y="36" width="64" id="balance_30_day_text" text="{account.balance30Day}"/>
						<mx:Label x="18" y="62" text="60 Days:"/>
						<mx:Text x="81" y="62" width="64" id="balance_60_day_text" text="{account.balance60Day}"/>
						<mx:Label x="10" y="88" text="90+ Days:"/>
						<mx:Text x="81" y="88" width="64" id="balance_90_day_text" text="{account.balance90Day}"/>
						<mx:Button x="259" y="86" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Agenow')}" id="age_now_button"/>
					</mx:Panel>
					<mx:ColumnChart x="395" y="10" id="balance_chart" width="274" height="163" dataProvider="{balances}" showDataTips="true">
			            <mx:horizontalAxis>
			                   <mx:CategoryAxis 
			                   		dataProvider="{balances}" 
			                    	categoryField="Aged"
			                   />
			            </mx:horizontalAxis>
			            <mx:series>
			                   <mx:ColumnSeries 
			                    	xField="Aged" 
			                    	yField="Value" 		                   
			                   />
			            </mx:series>				
			        </mx:ColumnChart>
					<mx:Label x="39" y="181" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.SalesRanking')}"/>
					<mx:Label x="63" y="207" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.SalesRep')}"/>
					<!--<mx:Text x="137" y="207" width="64" id="sales_rep_text" text="{account.salesRep.name}"/>-->
					<mx:ComboBox id="sales_rep_combo2" x="137" y="207" width="160" dataProvider="{salesReps}"  labelField="name" focusOut="doSaleRep2();" />
					<mx:Text x="137" y="181" width="64" id="sales_ranking_text"/>
					<mx:Panel x="10" y="233" width="377" height="191" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowInvHistoryCmd.History')}" dropShadowEnabled="false">
						<mx:Label x="56" y="29" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Sales')}" textAlign="right"/>
						<mx:Label x="37" y="55" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.orders')}" textAlign="right"/>
						<mx:Text x="99" y="29" width="64" text="{Snowmass.getCurrencyFormatter(false,2).format(account.salesMonth)}" height="20" textAlign="right"/>
						<mx:Text x="99" y="55" width="64" text="{account.ordersMonth}" height="20" textAlign="right"/>
						<mx:Label x="0" y="81" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AverageOrder')}" textAlign="right"/>
						<mx:Text x="99" y="81" width="64" text="{Snowmass.getCurrencyFormatter(false,2).format((account.salesMonth / account.ordersMonth))}" height="20" textAlign="right"/>
						<mx:Label x="-1" y="107" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.QuotesOrders')}" textAlign="right"/>
						<mx:Text x="171" y="29" width="64" text="{Snowmass.getCurrencyFormatter(false,2).format(account.salesYear)}" height="20" textAlign="right"/>
						<mx:Text x="171" y="55" width="64" text="{account.ordersYear}" height="20" textAlign="right"/>
						<mx:Text x="171" y="81" width="64" text="{Snowmass.getCurrencyFormatter(false,2).format((account.salesYear / account.ordersYear))}" textAlign="right"/>
						<mx:Text x="171" y="107" width="64" text="{account.estimateCount}:{account.ordersYear}" textAlign="right"/>
						<mx:Text x="243" y="29" width="64" text="{Snowmass.getCurrencyFormatter(false,2).format(account.salesPriorYear)}" textAlign="right"/>
						<mx:Label x="86" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.ThisMonth')}" width="77" textAlign="center" fontWeight="bold"/>
						<mx:Label x="171" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.ThisYear')}" width="64" textAlign="center" fontWeight="bold"/>
						<mx:Label x="243" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.LastYear')}" width="64" textAlign="center" fontWeight="bold"/>
					</mx:Panel>
					<mx:Label x="458" y="181" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Created')}"/>
					<mx:Label x="433" y="207" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Totalorders')}"/>
					<mx:Text x="520" y="181" width="149" id="created_date_text" text="{Snowmass.getDateFormatter().format(account.created)}"/>
					<mx:Text x="520" y="207" width="149" id="total_orders_qty_text" text="{account.ordersYear}"/>
					<mx:Label x="445" y="233" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.LastBilled')}"/>
					<mx:Text x="520" y="233" width="149" id="last_billed_text" text="{Snowmass.getDateFormatter().format(account.lastBilledDate)}"/>
					<mx:Label x="426" y="259" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.LastPayment')}"/>
					<mx:Text x="520" y="259" width="149" id="last_payment_date_text" text="{Snowmass.getDateFormatter().format(account.lastPaymentDate)}"/>
					<mx:Label x="447" y="285" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.LastAged')}"/>
					<mx:Text x="520" y="285" width="149" id="last_aged_date_text" text="{Snowmass.getDateFormatter().format(account.lastAgedDate)}"/>
					<mx:Label x="435" y="311" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.LastInvoice')}"/>
					<mx:Text x="520" y="311" width="149" id="last_invoice_date_text" text="{Snowmass.getDateFormatter().format(account.lastInvoiceDate)}"/>
					<mx:Label x="427" y="337" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.LastEstimate')}"/>
					<mx:Text x="520" y="337" width="149" id="last_estimate_date_text" text="{Snowmass.getDateFormatter().format(account.lastEstimateDate)}"/>
					<mx:Label x="435" y="363" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.FirstInvoice')}"/>
					<mx:Label x="427" y="389" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.FirstEstimate')}"/>
					<mx:Label x="395" y="415" textAlign="right" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.EstimatesWonLost')}"/>
					<mx:Text x="520" y="363" width="149" id="first_invoice_date_text" text="{Snowmass.getDateFormatter().format(account.firstInvoiceDate)}"/>
					<mx:Text x="520" y="389" width="149" id="first_estimate_date_text" text="{Snowmass.getDateFormatter().format(account.firstEstimateDate)}"/>
					<mx:Text x="520" y="415" width="149" id="won_lost_text" text="{account.estimatesWon}:{account.estimatesLost}"/>
				</mx:Canvas>
			</mx:Canvas>

			<mx:Canvas id="outerLog" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'otherPrefCmd.Log')}" width="100%" height="100%" >
				<mx:Label x="184" y="40" visible="false" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'usecCmd.Sorryaccesstothisite')}" id="accessLog" />	
			
				<mx:Canvas id="canvasLog" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'otherPrefCmd.Log')}" width="100%" height="100%">
					<mx:DataGrid x="10" y="10" width="659" height="226" id="log_dataGrid" dataProvider="{customerLogs}">
						<mx:columns>
							<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Date')}" labelFunction="doDateDisplay"/>
							<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Comment')}" dataField="logEntry"/>
						</mx:columns>
					</mx:DataGrid>
					<mx:TextArea x="134" y="244" width="535" height="103" id="selected_comment_edit"/>
					<mx:Label x="10" y="245" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Comment')}" textAlign="right" fontWeight="bold"/>
					<mx:Button x="589" y="355" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Delete')}" width="80" id="delete_log_button" click="deleteCustomerLog()"/>
					<mx:Button x="501" y="355" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Add')}" width="80" id="add_log_button"  enabled="{selected_comment_edit.text.length > 0}" click="addCustomerLog()"/>
					<mx:Button x="320" y="355" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.PrintLog')}" width="97" id="print_log_button" click="printCustomerLog()"/>
				</mx:Canvas>
			</mx:Canvas>
			
			<mx:Canvas id="outerNotes" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Notes')}" width="100%" height="100%" >
				<mx:Label x="184" y="40" visible="false" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'usecCmd.Sorryaccesstothisite')}" id="accessNotes" />	
			
				<mx:Canvas id="canvasNotes" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Notes')}" width="100%" height="100%">
					<mx:TextArea x="10" y="36" editable="true" width="659" height="80" id="acct_selection_note_edit" text= "{account.accountNote}"/>
					<mx:Label x="10" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custNotesCmd.Accountselectionnoti')}"/>
					<mx:TextArea x="10" y="150" editable="true" width="659" height="80" id="job_note_edit" text="{account.jobNote}"/>
					<mx:TextArea x="10" y="264" editable="true" width="659" height="80" id="statement_note_edit" text="{account.statementNote}"/>
					<mx:Label x="10" y="238" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custNotesCmd.Noticetoplaceonstate')}"/>
					<mx:Label x="10" y="124" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custNotesCmd.Notestoinsertineachj')}"/>
				</mx:Canvas>
			</mx:Canvas>
			<mx:Canvas id="outerMarketing" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Marketing')}" width="100%" height="100%" >
				<mx:Label x="184" y="40" visible="false" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'usecCmd.Sorryaccesstothisite')}" id="accessMarketing" />	

				<mx:Canvas id="canvasMarketing" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Marketing')}" width="100%" height="100%" >
					<mx:RadioButtonGroup id="cust_prospect_radio_group"/>
					<mx:RadioButton x="10" y="10" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Customer')}" groupName="cust_prospect_radio_group" id="customer" selected="{!account.prospect}"/>
					<mx:RadioButton x="10" y="36" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Prospect')}" groupName="cust_prospect_radio_group" id="prospect" selected="{account.prospect}"/>
					<mx:CheckBox x="123" y="10" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.PersonalAccount')}" id="personalAccount" selected="{account.marketing.personalAcct}"/>
					<mx:CheckBox x="123" y="36" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Donotmail')}" id="noMail" selected="{account.marketing.noMail}"/>
					<mx:Panel x="10" y="66" width="301" height="134" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'genericPrefCmd.Company')}" dropShadowEnabled="false">
						<mx:Label x="12" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.NumberofEmployees')}" textAlign="right"/>
						<mx:Label x="10" y="38" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.AnnualRevenue')}" textAlign="right"/>
						<mx:TextInput x="148" y="38" width="123" id="annualRev" text="{account.marketing.annualRev}"/>
						<mx:TextInput x="148" y="10" width="123" id="numberofEmployees" text="{account.marketing.numberofEmployees}"/>
						<!--<mx:ComboBox x="119" y="64" width="152" id="businessType_combo" text="{account.marketing.businessType.name}"></mx:ComboBox>
						
						<fc:AutoComplete id="business_type_combo" x="119" y="64" width="152" dataProvider="{businessTypes}"  labelField="name" focusOut="doBusinessType();" lookAhead="true" />
					-->
					</mx:Panel>
					<mx:Panel x="309" y="10" width="350" height="190" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.MarketingDates')}" dropShadowEnabled="false">
						<mx:Label x="12" y="10" text="Follow Up:" textAlign="right"/>
						<mx:Label x="10" y="38" text="Birthdate:" textAlign="right"/>
						<mx:Label x="21" y="66" text="User 3:" textAlign="right"/>
						<mx:Label x="21" y="94" text="User 4:" textAlign="right"/>
						<mx:Label x="21" y="122" text="User 5:" textAlign="right"/>
						<mx:DateField x="94" y="8" id="followUp" text="{account.marketing.followup}" showToday="false" width="136" />
						<mx:DateField x="94" y="36" id="birthDate" text="{account.marketing.birthDate}" showToday="false" width="136"/>
						<mx:DateField x="94" y="64" id="userDate3" text="{account.marketing.user3}" showToday="false" width="136"/>
						<mx:DateField x="94" y="92" id="userDate4" text="{account.marketing.user4}" showToday="false" width="136"/>
						<mx:DateField x="94" y="120" id="userDate5" text="{account.marketing.user5}" showToday="false" width="136"/>
					</mx:Panel>
					<mx:Panel x="10" y="208" width="659" height="195" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.MarketingTags')}" dropShadowEnabled="false">
						<mx:Label x="28" y="10" text="Lead Source:" textAlign="right"/>
						<mx:Label x="-3" y="38" text="Common Interest:" textAlign="right"/>
						<mx:TextInput x="114" y="36" width="175" id="commonInterest" text="{account.marketing.commonInterst}"/>
						<mx:TextInput x="114" y="64" width="175" id="user3Tag"  text="{account.marketing.user6}"/>
						<mx:Label x="60" y="66" text="User 3:" textAlign="right"/>
						<mx:TextInput x="114" y="92" width="175" id="user4Tag"  text="{account.marketing.user7}"/>
						<mx:Label x="60" y="94" text="User 4:" textAlign="right"/>
						<mx:TextInput x="114" y="118" width="175" id="typeofWork"  text="{account.marketing.typeWork}"/>
						<mx:Label x="21" y="122" text="Type of Work:" textAlign="right"/>
						<mx:TextInput x="114" y="8" width="175" id="leadSource"  text="{account.marketing.leadSource}"/>
						<mx:TextInput x="454" y="38" width="175" id="sportsInterest"  text="{account.marketing.sportsInterst}"/>
						<mx:TextInput x="454" y="66" width="175" id="user8Tag"  text="{account.marketing.user8}"/>
						<mx:TextInput x="454" y="94" width="175" id="user9Tag"  text="{account.marketing.user9}"/>
						<mx:TextInput x="454" y="120" width="175" id="mailerType"  text="{account.marketing.mailerType}"/>
						<mx:TextInput x="454" y="10" width="175" id="leadSource1"  text="{account.marketing.leadSource2}"/>
						<mx:Label x="368" y="12" text="Lead Source:" textAlign="right"/>
						<mx:Label x="359" y="40" text="Sport Interest:" textAlign="right"/>
						<mx:Label x="400" y="68" text="User 8:" textAlign="right"/>
						<mx:Label x="400" y="96" text="User 9:" textAlign="right"/>
						<mx:Label x="372" y="127" text="Mailer Type:" textAlign="right"/>
					</mx:Panel>
				</mx:Canvas>
			</mx:Canvas>
			<mx:Canvas id="outerTemplates" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Templates')}" width="100%" height="100%" >
				<mx:Label x="184" y="40" visible="false" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'usecCmd.Sorryaccesstothisite')}" id="accessTemplates" />	
				<mx:Canvas id="canvasTemplates" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Templates')}" width="100%" height="100%" >
				</mx:Canvas>
			</mx:Canvas>
			<mx:Canvas id="outerWeb" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Web')}" width="100%" height="100%" >
				<mx:Label x="184" y="40" visible="false" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'usecCmd.Sorryaccesstothisite')}" id="accessWeb" />	
				<mx:Canvas id="canvasWeb" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Web')}" width="100%" height="100%">
				</mx:Canvas>
			</mx:Canvas>
		</mx:TabNavigator>
		<mx:Button x="10" y="10" width="48" height="38" click="doPrev();">
			<mx:icon>@Embed(source='../../../../assets/previous_page.png')</mx:icon>
		</mx:Button>
		<mx:Button x="74" y="10" width="48" height="38" click="doNext();">
			<mx:icon>@Embed(source='../../../../assets/next_page.png')</mx:icon>
		</mx:Button>
		<mx:Label x="0" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'invoiceDeliveryTicketCmd.Previous')}" width="66" textAlign="center"/>
		<mx:Label x="74" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Next')}" width="45" textAlign="center"/>
		
		
		<components:CustomSaveButtonComponent enabled="{formIsValid}" x="171" y="10" width="38" id="select_button1" clickFuncName="doSave" 
				saveLabel="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Customer')}" height="38"/>
		
		
		<!--<mx:Button x="171" y="10" width="38" height="38" click="doSave();" enabled="{formIsValid}">
			<mx:icon>@Embed(source='../../../../assets/file.png')</mx:icon>
		</mx:Button>-->
		<mx:Label x="171" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Save')}" width="38" textAlign="center"/>
		<mx:Button x="217" y="10" width="38" height="38" click="doGet();">
			<mx:icon>@Embed(source='../../../../assets/get.png')</mx:icon>
		</mx:Button>
		<mx:Label x="217" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Get')}" width="38" textAlign="center"/>
		<mx:Button x="263" y="10" width="38" height="38" click="doNew();">
			<mx:icon>@Embed(source='../../../../assets/new.png')</mx:icon>
		</mx:Button>
		
		<components:CustomDeleteButtonComponent x="370" y="10" width="38" 
				id="select_button0" clickFuncName="doDelete" 
				deleteLabel="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Customer')}" height="38"/>
		
	    <mx:Label x="360" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Delete')}" width="58" textAlign="center"/>
		<mx:Button x="493" y="10" width="38" height="38" click="doRevert();">
			<mx:icon>@Embed(source='../../../../assets/cancel.png')</mx:icon>
		</mx:Button>
		<mx:Label x="483" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Revert')}" width="58" textAlign="center"/>
		<mx:Label x="263" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.New')}" width="38" textAlign="center"/>
	</mx:Canvas>
</mx:VBox>
</mx:Panel>