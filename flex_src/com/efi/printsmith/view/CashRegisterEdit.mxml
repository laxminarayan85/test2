<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	layout="absolute" 
	width="800" 
	height="686" 
	title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.CashRegister')}" 
	label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.CashRegister')}" 
	name="CashRegisterEdit" 
	creationComplete="init()" 
	xmlns:components="com.efi.printsmith.components.*" 
	xmlns:vo="com.efi.printsmith.vo.*">

	<mx:CurrencyFormatter precision="2" id="currencyFormatter"/>
	<mx:NumberFormatter precision="2" id="numberFormatter"/>
	<mx:NumberFormatter precision="0" id="quantityFormatter"/>
	
 	<mx:states>
 	 	<mx:State name="invoiceState">
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
				<mx:Label x="40" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Invoice')}" id="invstate_label1"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
				<mx:Label x="38" y="35" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.TotalDue')}" id="invstate_label2"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
				<mx:Label x="31" y="60" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Description')}" id="invstate_label3"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
				<mx:TextInput x="105" y="8" width="75" id="txtInvoiceNumber"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
 	 	 	 	<mx:TextInput x="105" y="33" width="75" id="txtInvoiceTotalDue"/>
 	 	 	</mx:AddChild>


 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
				<mx:Label x="68" y="110" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Paid')}" id="invstate_label4"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
				<mx:Label x="46" y="135" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.StillDue')}" id="invstate_label5"/>
 	 	 	</mx:AddChild>

 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
				<mx:TextInput x="105" y="108" width="75" id="txtInvoicePaid"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
 	 	 	 	<mx:TextInput x="105" y="133" width="75" id="txtInvoiceStillDue"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:SetProperty target="{pickTaxCodes}" name="enabled" value="false"/>
 	 	 	<mx:SetProperty target="{pickTaxTable}" name="enabled" value="false"/>
 	 	 	<mx:SetEventHandler target="{tax_canvas1}" name="activate"/>
 	 	 	<mx:SetProperty target="{chkNonTax}" name="enabled" value="false"/>

 	 	</mx:State>
 	 	<mx:State name="paymentState">
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
 	 	 	 	<mx:Label x="46" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Quantity')}" id="label1"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
 	 	 	 	<mx:Label x="41" y="35" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.UnitPrice')}" id="label2"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
 	 	 	 	<mx:Label x="65" y="60" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Total')}" id="label3"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
 	 	 	 	<mx:TextInput  restrict="0-9\." x="105" y="8" width="75" id="txtPaymentQuantity" text="{numberFormatter.format(itemQty)}" focusOut="UpdateCashRegister()"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
 	 	 	 	<mx:TextInput  restrict="0-9\."  x="105" y="33" width="75" id="txtPaymentUnitPrice" text="{numberFormatter.format(itemUnitPrice)}"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
 	 	 	 	<mx:TextInput restrict="0-9\."  x="105" y="58" width="75" id="txtPaymentTotal" text="{numberFormatter.format(itemTotal)}"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
 	 	 	 	<mx:Label x="10" y="86" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Description')}" id="label4"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild">
 	 	 	 	<mx:TextArea x="10" y="112" width="170" height="62" id="txtPaymentDescription"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:SetProperty target="{chkNonTax}" name="enabled" value="true"/>
 	 	 	<mx:SetProperty target="{cashReg_grid}" name="x" value="10"/>
 	 	 	<mx:SetProperty target="{subtotal_edit}" name="editable" value="false"/>
 	 	 	<mx:SetProperty target="{tax_edit}" name="editable" value="false"/>
 	 	 	<mx:SetProperty target="{total_edit}" name="editable" value="false"/>
 	 	 	<mx:SetProperty target="{tender_edit}" name="editable" value="false"/>
 	 	 	<mx:SetProperty target="{change_edit}" name="editable" value="false"/>
 	 	</mx:State>
 	 	<mx:State name="invoicePaymentMethod" basedOn="invoiceState">
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:Label x="65" y="154" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Amount')}"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:TextInput x="121" y="152" width="75"/>
 	 	 	</mx:AddChild>
 	 	</mx:State>
 	 	<mx:State name="paymentPaymentMethod" basedOn="paymentState">
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:Label x="65" y="154" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Amount')}"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:TextInput  restrict="0-9\." x="121" y="152" width="75" id="payment_cash_edit"/>
 	 	 	</mx:AddChild>
 	 	</mx:State>
 	 	<mx:State name="paymentCash" basedOn="paymentPaymentMethod">
 	 	</mx:State>
 	 	<mx:State name="paymentCreditCard" basedOn="paymentPaymentMethod">
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:Label x="10" y="90" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'paymentsCmd.CardType')}"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:Label x="72" y="116" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'paymentsCmd.Ref')}"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:ComboBox x="76" y="88" width="120"></mx:ComboBox>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:TextInput x="121" y="114" width="75"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas1}" position="lastChild" target="{checkbox1}"/>
 	 	 	<mx:SetProperty target="{checkbox1}" name="x" value="267"/>
 	 	 	<mx:SetProperty target="{checkbox1}" name="y" value="230"/>
 	 	</mx:State>
 	 	<mx:State name="paymentCheck" basedOn="paymentPaymentMethod">
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:Label x="62" y="116" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'paymentsCmd.Check')}"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:TextInput x="121" y="114" width="75"/>
 	 	 	</mx:AddChild>
 	 	</mx:State>
 	 	<mx:State name="paymentCharge" basedOn="paymentPaymentMethod"/>
 	 	<mx:State name="invoiceCash" basedOn="invoicePaymentMethod">
 	 	</mx:State>
 	 	<mx:State name="invoiceCreditCard" basedOn="invoicePaymentMethod">
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:Label x="10" y="90" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'paymentsCmd.CardType')}"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:Label x="72" y="116" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'paymentsCmd.Ref')}"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:ComboBox x="76" y="88" width="120"></mx:ComboBox>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:TextInput x="121" y="114" width="75"/>
 	 	 	</mx:AddChild>
 	 	</mx:State>
 	 	<mx:State name="invoiceCheck" basedOn="invoicePaymentMethod">
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:Label x="62" y="116" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'paymentsCmd.Check')}"/>
 	 	 	</mx:AddChild>
 	 	 	<mx:AddChild relativeTo="{tax_canvas2}" position="lastChild">
 	 	 	 	<mx:TextInput x="121" y="114" width="75"/>
 	 	 	</mx:AddChild>
 	 	</mx:State>
 	 	<mx:State name="invoiceCharge" basedOn="invoicePaymentMethod">
 	 	</mx:State>
 	</mx:states>
 
 	<mx:RemoteObject id="dataService" destination="dataService">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadResult(event)"/>
		<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveResult(event)"/>
		<mx:method name="getAccount" fault="handleFault(event)" result="handleGetResult(event)"/>
	</mx:RemoteObject>

 	<mx:RemoteObject id="dataServiceTaxCodes" destination="dataService">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadTaxCodesResult(event)"/>
	</mx:RemoteObject>
 	<mx:RemoteObject id="dataServiceTaxTable" destination="dataService">
		<mx:method name="getCurrentTaxTables" fault="handleFault(event)" result="handleLoadTaxTableResult(event)"/>
	</mx:RemoteObject>

	<mx:RemoteObject id="dataServiceSystemPreferences" destination="dataService">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadSystemPreferencesResult(event)"/>
	</mx:RemoteObject>
	<mx:RemoteObject id="dataServiceCashPreferences" destination="dataService">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadCashRegPreferencesResult(event)"/>
	</mx:RemoteObject>

	<mx:Producer id="producer" destination="cashregister"/>
	<mx:Consumer id="consumer" destination="cashregister" message="messageHandler(event.message)"/>
	<mx:Consumer id="notification_consumer" destination="notifications" message="messageHandler(event.message)"/>
<mx:Script>
<![CDATA[
	import com.efi.printsmith.data.PreferencesCashRegister;
	import mx.events.StateChangeEvent;
	import mx.controls.Text;

	import com.efi.printsmith.data.TaxTable;
	import com.efi.printsmith.data.TaxCodes;
	import com.efi.printsmith.data.CashRegister;
	import com.efi.printsmith.data.PreferencesSystem;
	import com.efi.printsmith.events.AccountPickerSelectEvent;
	import com.efi.printsmith.data.Account;

	import mx.controls.Alert;                                         
	import mx.managers.PopUpManager;                                         
	import mx.containers.TitleWindow;                                         
	import mx.collections.ArrayCollection;                                         
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;                                         
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
	import mx.collections.XMLListCollection;

	[Bindable]
	private var enableSave:Boolean = true;

	[Bindable]                                         
    private var systemPreferences:PreferencesSystem;

	[Bindable]                                
	private var systemPreferencesArray:ArrayCollection = new ArrayCollection();

	[Bindable]
	private var cashRegisterTransacations:ArrayCollection = new ArrayCollection();
	[Bindable]
	private var systemCashPreferencesArray:ArrayCollection = new ArrayCollection();
	
	[Bindable]
	private var itemQty:String;
	[Bindable]
	private var itemUnitPrice:String;
	[Bindable]
	private var itemTotal:String;

	[Bindable]
	private var subTotal:String;
	[Bindable]
	private var taxTotal:String;
	[Bindable]
	private var payTotal:String;
	[Bindable]
	private var payTendered:String;
	[Bindable]
	private var payChange:String;
	[Bindable]
	private var AustrailianRounding:Boolean;
	
	[Bindable]
	private var posTransactions:ArrayCollection;
	
//Data field arrays
	[Bindable]
	private var CashRegisterArray:ArrayCollection = new ArrayCollection();
	[Bindable]
	private var TaxTableArray:ArrayCollection = new ArrayCollection();
	[Bindable]
	private var TaxCodesArray:ArrayCollection = new ArrayCollection();
	[Bindable]
	private var FormatArray:ArrayCollection = new ArrayCollection();
	
//Data view variables
	
	[Bindable]
	private var cashRegister:CashRegister;
	[Bindable]
	private var cashRegister2:CashRegister;
	[Bindable]
	private var payment:CashRegister;
//Tree view XML table
	
	private function handleLoadTaxTableResult(ev:ResultEvent):void {
	     TaxTableArray = ev.result as ArrayCollection;
	}
	private function handleLoadTaxCodesResult(ev:ResultEvent):void {
	     TaxCodesArray = ev.result as ArrayCollection;
	}
	private function handleLoadCashRegPreferencesResult(ev:ResultEvent):void{
		systemCashPreferencesArray = ev.result as ArrayCollection;
	}
	private function handleLoadSystemPreferencesResult(ev:ResultEvent):void {
		systemPreferencesArray = ev.result as ArrayCollection;
		if (systemPreferencesArray.length > 0)
		{
			systemPreferences = systemPreferencesArray.getItemAt(0) as PreferencesSystem;
			AustrailianRounding = systemPreferences.austrailianInvoiceRounding;
		}else {
			AustrailianRounding = false;
		}

	}	                                 
		
	public function init():void {
		consumer.subscribe();
		notification_consumer.subscribe();
		cashRegister = new CashRegister();
		cashRegister.cashRegisterDept = new PreferencesCashRegister();
		cashRegister.cashRegisterDept.title = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'salesCmd.POS');
		cashRegister2 = new CashRegister();

		cashRegister.customerAccount = new Account();
		dataServiceSystemPreferences.getAll("PreferencesSystem");
		dataServiceCashPreferences.getAll("PreferencesCashRegister");
		//openTree();
		setup();
	}
	
	private function setup():void{
		dataServiceTaxCodes.getAll("TaxCodes")	
		dataServiceTaxTable.getCurrentTaxTables("TaxTable")
		fillDefaultDocumentsArray(FormatArray);
		this.addEventListener(mx.events.StateChangeEvent.CURRENT_STATE_CHANGE, paymentStateHandler);
	}
	
	private function messageHandler(message:IMessage):void{
		var messageBody:Object = message.body;// as com.efi.messaging.MessageBody;
		
		var messageType:String = messageBody.messageType;
		if (messageType == "ADDUPDATE" || messageType == "DELETE") {
			var payloadType:String = messageBody.payloadType as String; // What kind of item was added/deleted
			var payload:Number = messageBody.payload as Number; // ID if item added or deleted
			if (payloadType == "TaxTable") {
				dataServiceTaxTable.getAll("TaxTable")
			}
			if (payloadType == "TaxCodes") {
				dataServiceTaxCodes.getAll("TaxCodes")
			}
		}
	}
     
	private function handleFault(ev:FaultEvent):void {  
		var message:String;
		              
		message = "Error: "                          
		+ ev.fault.faultCode + " - "                                  
		+ ev.fault.faultDetail + " - "                                  
		+ ev.fault.faultString;
		Alert.show(message, "Error", 0, null, null, null, 4);                                 
	}


// Data Load Handlers
	private function handleLoadResult(ev:ResultEvent):void {
		CashRegisterArray = ev.result as ArrayCollection;
	}

// Data Save Handlers
	private function handleSaveResult(ev:ResultEvent):void {
    	//dataService.getAll("PreferencesSystem");
	}

	private function UpdateCashRegister():void{
		var temp:Number;
		var tempString:String;
		temp = parseFloat(txtPaymentUnitPrice.text)* parseFloat(txtPaymentQuantity.text)
		txtPaymentTotal.text = numberFormatter.format(temp) ;
		cashRegister.subtotal = temp;
		//subtotal_edit.text = txtPaymentTotal.text;
		tempString = numberFormatter.format(cashRegister.subtotal + cashRegister.taxamount);
		cashRegister.totalprice = parseFloat(tempString);
		cashRegister.change = cashRegister.tendered - cashRegister.totalprice;
	}
	
	private function openTree():void {
		var nodeList:XMLListCollection = 
			tvItems.dataProvider as XMLListCollection;
		tvItems.selectedIndex = 0;

		var node:XML = XML(tvItems.selectedItem);
	}

	private var treeStateString:String = "";
	private function treeSelect(event:Event):void {
		var treeItem:PreferencesCashRegister = tvItems.selectedItem as PreferencesCashRegister;
	
	
		this.currentState = "";
		
		this.currentState = "paymentState";
		treeStateString = this.currentState;
		txtPaymentUnitPrice.text = treeItem.rate.toString()
		txtPaymentDescription.text = treeItem.title;
		txtPaymentQuantity.text ="";
		txtPaymentTotal.text = "";
		cashRegister2 = new CashRegister;
		cashRegister2.cashRegisterDept = treeItem;
	
	}

	private function doInvoice():void {
		this.currentState = "invoiceState";
	}
	private var paymentMethodStateString:String = "";
	private function paymentMethodChanged(event:Event):void {
		var rbvalue:String = event.currentTarget.selectedValue;
		payment = new CashRegister();
		this.currentState = "";
		paymentMethodStateString = "";
		if (rbvalue == "Cash")
		{	payment.paymentMethod= "Cash"
			if (treeStateString == "invoiceState")
			{
				this.currentState = "invoiceCash";
			} 
			else 
			{
				this.currentState = "paymentCash";
			}
		}
		if (rbvalue == "Credit Card")
		{
			payment.paymentMethod = "Credit Card";
			if (treeStateString == "invoiceState")
			{
				this.currentState = "invoiceCreditCard";
			} 
			else 
			{
				this.currentState = "paymentCreditCard";
			}
		}
		if (rbvalue == "Check")
		{
			payment.paymentMethod= "Check"
			if (treeStateString == "invoiceState")
			{
				this.currentState = "invoiceCheck";
			} 
			else 
			{
				this.currentState = "paymentCheck";
			}
		}
		if (rbvalue == "Charge")
		{
			payment.paymentMethod= "Charge"
			if (treeStateString == "invoiceState")
			{
				this.currentState = "invoiceCharge";
			} 
			else 
			{
				this.currentState = "paymentCharge";
			}
		}
	}
	
	private function paymentStateHandler (e:Event):void {
		if (this.currentState == "paymentState")
		{
			var node:XML = XML(tvItems.selectedItem);
			txtPaymentDescription.text = node.@label;
		}
	}

	private function doPayment():void{
		if ((this.currentState = "invoiceCash") && (AustrailianRounding == true)) {
			
		}else{
				cashRegister.tendered = parseFloat(payment_cash_edit.text);	
				payment.tendered = parseFloat(payment_cash_edit.text);	
				payment.subtotal = parseFloat(payment_cash_edit.text);
				UpdateCashRegister();
		}
		cashRegisterTransacations.addItem(payment);
	}	
	private function doAccount():void{
		 var accountPickerWindow:AccountPicker = AccountPicker(PopUpManager.createPopUp(this, AccountPicker, true));
	    accountPickerWindow.setStyle("borderAlpha", 0.9);
	    accountPickerWindow.formIsEmpty = true;
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.CANCELSELECTACCOUNT, handleAccountPickerCancel);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.SELECTACCOUNT, handleAccountPickerSelect);
	    	   	    
	}
	private function handleAccountPickerSelect(evt:AccountPickerSelectEvent):void {
		
		dataService.getAccount(evt.account.id);
			
	}
	private function doTotalPrice(item:Object,column:DataGridColumn):String{
		var temp:CashRegister;
		temp = item as CashRegister;
		return(numberFormatter.format(temp.totalprice));
		
	}
	private function doSubtotalPrice(item:Object,column:DataGridColumn):String{
		var temp:CashRegister;
		temp = item as CashRegister;
		return(numberFormatter.format(temp.subtotal));
		
	}
	private function doDescript(item:Object, column:DataGridColumn):String{
		var temp:CashRegister;
		var tempString:String;
		temp = item as CashRegister;
		if (temp.paymentMethod != "" && temp.tendered >0){
			tempString = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Payment')+" " + temp.paymentMethod
		}else{
			if ( temp.cashRegisterDept.title != resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'salesCmd.POS'))
				tempString = temp.cashRegisterDept.title + " " + temp.quantity.toString() + "x"+ temp.unitprice.toString();
			else
				tempString = temp.cashRegisterDept.title;
		}
		return tempString;
	}
	private function doAccept():void{
	
		cashRegister2.quantity = parseInt(txtPaymentQuantity.text);
		cashRegister2.unitprice = parseFloat(txtPaymentUnitPrice.text);
		cashRegister2.subtotal = parseFloat(txtPaymentTotal.text);
		if (cashRegisterTransacations.length ==0)
			cashRegisterTransacations.addItem(cashRegister);
		else{
			cashRegister.subtotal = cashRegister.subtotal + cashRegister2.subtotal
		}
			
		cashRegisterTransacations.addItem(cashRegister2);
		this.currentState = "";
	}
	private function handleAccountPickerCancel(evt:AccountPickerSelectEvent):void {
		
		
	}
	private function handleGetResult(ev:ResultEvent):void {
	
		cashRegister.customerAccount = ev.result as Account;
		
	     
	}
	
	private function doSave():void{
	}
	
	private function doRevert():void{
	}
	
	private function fillDefaultDocumentsArray(fillArray:ArrayCollection):void{
		var setting:Object = new Object();
		setting.name="No default specified";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Alternate Currency";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Credit Memo";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Estimate - Long Form";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Estimate - Short Form";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Fax Form";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Invoice - Long Form";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Invoice - Short Form";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Quote Form";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Quote Letter";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Standard";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Thank You Letter";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Unit Price / each";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="Unit Price / thousand";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="[en]!TaxName !Remarks";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="[en]!TaxName +Remarks";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="[en]+TaxName !Remarks";
		fillArray.addItem(setting);
		setting = new Object();
		setting.name="[en]+TaxName +Remarks";
		fillArray.addItem(setting);
	}


]]>
                             
</mx:Script>

	

	<mx:Label x="20" y="20" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.DEPARTMENT')}" textAlign="right"/>	
	<mx:Tree x="0" y="80" width="130"  
		id="tvItems" 
		dataProvider="{systemCashPreferencesArray}"
		labelField="title"
		height="100%" change="treeSelect(event);"></mx:Tree>

	<mx:Button x="150" y="10" width="38" height="38" click="doSave();" enabled="{enableSave}" id="btnSave">
		<mx:icon>@Embed(source='../../../../assets/file.png')</mx:icon>
	</mx:Button>
	<mx:Button x="196" y="10" width="38" height="38" click="doRevert();" enabled="{enableSave}" id="btnRevert">
		<mx:icon>@Embed(source='../../../../assets/cancel.png')</mx:icon>
	</mx:Button>
	<mx:Button x="242" y="10" width="38" height="38" click="doInvoice();" enabled="{enableSave}" id="btnInvoice">
		<mx:icon>@Embed(source='../../../../assets/InvoiceWONotes.png')</mx:icon>
	</mx:Button>

	<mx:Canvas x="130" y="80" width="100%" height="100%" id="cashregister_canvas" hideEffect="effect" showEffect="effect">
		<mx:Button x="19" y="10" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.CustAcct')}" click="doAccount();"/>
		<mx:TextInput x="158" y="10" text="{cashRegister.customerAccount.title}" width="252"/>
		<mx:Canvas x="0" y="40" width="200" height="95" id="tax_canvas" borderStyle="inset">
			<mx:Label x="5" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custDataCmd.TaxTable')}"/>
			<mx:Label x="5" y="35" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custDataCmd.TaxCode')}"/>

		    <mx:ComboBox x="77" y="8" id="pickTaxCodes" width="100" dataProvider="{TaxTableArray}" labelField="name" selectedItem="{data.name}"/>
		    <mx:ComboBox x="77" y="33" id="pickTaxTable" width="100" dataProvider="{TaxCodesArray}" labelField="name" selectedItem="{data.name}"/>
		    <mx:CheckBox x="77" y="63" label="Non-Tax" id="chkNonTax" />
		</mx:Canvas>
		<mx:Canvas x="198" y="40" width="210" height="95" id="tax_canvas0" hideEffect="effect" showEffect="effect" borderStyle="inset">
			<mx:Label x="10" y="12" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'labelCmd.Format')}"/>
			<mx:ComboBox x="58" y="10" id="cboFormat"  dataProvider="{FormatArray}" labelField="name" width="132"/>
			<mx:CheckBox x="10" y="35" id="chkPrintInvoice" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.PrintInvoice')}"/>
				
		</mx:Canvas>
		<mx:Canvas x="0" y="133" width="408" height="279" id="tax_canvas1" hideEffect="effect" showEffect="effect" borderStyle="inset">
			<mx:Button x="10" y="200" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Accept')}" click="doAccept();" width="176" enabled="true"/>
			<mx:CheckBox x="10" y="243" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.PrintReceipt')}" id="checkbox1"/>
		</mx:Canvas>
		<mx:Canvas x="407" y="40" width="210" height="216" id="tax_canvas2" hideEffect="effect" showEffect="effect" borderStyle="inset">
			<mx:Label x="50" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.PAYMENTMETHOD')}"/>
			<mx:Button x="10" y="180" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Payment')}" width="186" id="btPayment" click="doPayment();"/>
			<mx:RadioButtonGroup id="rgPaymentMethod" change="paymentMethodChanged(event)"/>
			<mx:RadioButton x="10" y="34" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.CASH')}" id="rbCash" groupName="rgPaymentMethod" value="Cash"/>
			<mx:RadioButton x="10" y="60" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.CRCARD')}" id="rbCreditCard" groupName="rgPaymentMethod" value="Credit Card"/>
			<mx:RadioButton x="131" y="34" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.CHECK')}" id="rbCheck" groupName="rgPaymentMethod" value="Check"/>
			<mx:RadioButton x="131" y="60" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.CHARGE')}" id="rbCharge" groupName="rgPaymentMethod" value="Charge"/>

		</mx:Canvas>
		<mx:Canvas x="407" y="252" width="210" height="160" id="tax_canvas3" hideEffect="effect" showEffect="effect" borderStyle="inset">
			<mx:Label x="43" y="12" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.SubTotal')}"/>
			<mx:Label x="76" y="38" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Tax')}"/>
			<mx:Label x="69" y="64" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Total')}"/>
			<mx:Label x="44" y="90" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Tendered')}"/>
			<mx:Label x="54" y="116" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Change')}"/>
			<mx:TextInput   id="subtotal_edit" x="110" y="10" width="86" text="{Snowmass.getCurrencyFormatter(false,2).format(cashRegister.subtotal)}"/>
			<mx:TextInput id="tax_edit" x="110" y="36" width="86" text="{Snowmass.getCurrencyFormatter(false,2).format(cashRegister.taxamount)}"/>
			<mx:TextInput  id="total_edit" x="110" y="62" width="86" text="{Snowmass.getCurrencyFormatter(false,2).format(cashRegister.totalprice)}"/>
			<mx:TextInput id="tender_edit" x="110" y="88" width="86" text="{Snowmass.getCurrencyFormatter(false,2).format(cashRegister.tendered)}"/>
			<mx:TextInput  id="change_edit" x="110" y="114" width="86" text="{Snowmass.getCurrencyFormatter(false,2).format(cashRegister.change)}"/>

		</mx:Canvas>
		<mx:DataGrid x="4" y="414" width="613" id="cashReg_grid" dataProvider="{cashRegisterTransacations}">
			<mx:columns>
				<mx:DataGridColumn headerText="Column 1" labelFunction="doDescript"/>
				<mx:DataGridColumn headerText="Column 3" labelFunction="doSubtotalPrice"/>
				<mx:DataGridColumn headerText="Column 2"  labelFunction="doTotalPrice" />
			</mx:columns>
		</mx:DataGrid>
	</mx:Canvas>
	<mx:Label x="150" y="54" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'posRegisterCmd.Post')}"/>
	<mx:Label x="199" y="54" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Cancel')}"/>
	<mx:Label x="242" y="54" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'barcodeCmd.Invoice')}"/>
</mx:TitleWindow>
