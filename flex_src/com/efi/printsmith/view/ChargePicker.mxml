<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml"
				xmlns:view="com.efi.printsmith.view.*"
				xmlns:vo="com.efi.printsmith.vo.*"
				xmlns:fc="http://www.adobe.com/2006/fc"
				xmlns:hc="com.hillelcoren.components.*"
				xmlns:comp="com.efi.printsmith.components.*"
				xmlns:common="com.efi.printsmith.common.components.filter.*" 
				width="1100"
				height="700"
				title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowJobDetailsCmd.JobCharges')}"
				creationComplete="init()"
				label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowJobDetailsCmd.JobCharges')}"
				name="Job Charges"
				horizontalScrollPolicy="off"
				verticalScrollPolicy="auto"
				xmlns:ns1="com.adobe.flex.extras.controls.*"
				xmlns:comcomp="com.efi.printsmith.common.components.*"
				fontSize="9"
				titleIcon="@Embed(source='../../../../assets/new_job.png')"
				defaultButton="{done_button}"
				close="this.doDone()"
				showCloseButton="true">
	<mx:RemoteObject id="chargeService"
					 destination="chargeService">
		<mx:method name="createChargeFromChargeDefinition"
				   fault="handleFault(event)"
				   result="handleNewChargeResult(event)"/>
				   
	</mx:RemoteObject>
	<mx:RemoteObject id="dataService"
					 destination="dataService">
		<mx:method name="addUpdate"
				   fault="handleFault(event)"
				   result="handleSaveResult(event)"/>
		<mx:method name="deleteItem"
				   fault="handleFault(event)"
				   result="handleDeleteResult(event)"/>
	</mx:RemoteObject>
	<mx:RemoteObject id="shippingMethodDataService" destination="dataService">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadShippingMethods(event)"/>
	</mx:RemoteObject>
	<mx:RemoteObject id="locationDataService"
					 destination="dataService">
		<mx:method name="getAll"
				   fault="handleFault(event)"
				   result="handleLoadLocationResult(event)"/>
	</mx:RemoteObject>
	<mx:RemoteObject id="productDataService"
					 destination="dataService">
		<mx:method name="getAll"
				   fault="handleFault(event)"
				   result="handleLoadProductResult(event)"/>
	</mx:RemoteObject>

	<mx:RemoteObject id="chargeCommandDataService"
					 destination="dataService">
		<mx:method name="getChargeList"
				   fault="handleFault(event)"
				   result="handleLoadChargeCommandResult(event)"/>
	</mx:RemoteObject>
	<mx:RemoteObject id="dataServiceSystemPreferences" destination="dataService">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadSystemPreferencesResult(event)"/>
	</mx:RemoteObject>
	
	<mx:Script source="../common/scripts/StringUtils.as"/>
	
	<mx:Script>
		<![CDATA[
			import mx.controls.dataGridClasses.DataGridColumn;
			import com.efi.printsmith.data.Dimension;
			import mx.validators.CurrencyValidator;
			import com.efi.printsmith.common.components.filter.FilterSearchBy;
			import com.efi.printsmith.common.components.filter.FilterProperty;
			import com.efi.printsmith.common.components.ChargeRenderer;
			
			import com.efi.printsmith.data.ShippingCharge;
			import com.efi.printsmith.data.InkCharge;
			import com.efi.printsmith.data.CuttingCharge;
			import com.efi.printsmith.data.SquareAreaCharge;
			import com.efi.printsmith.events.JobEditCompleteEvent;
			import com.efi.printsmith.events.PriceChargeEvent;
			import com.efi.printsmith.data.Location;
			import com.efi.printsmith.data.Account;
			import com.efi.printsmith.data.ProductCode;
			import com.efi.printsmith.data.Charge;
			import com.efi.printsmith.data.ChargeCategory;
			import com.efi.printsmith.data.ChargeCommand;
			import com.efi.printsmith.data.ChargeDefinition;
			import com.efi.printsmith.data.PreferencesSystem;
			import com.efi.printsmith.data.Job;
			
			import com.efi.printsmith.data.enums.ChargeMethod;
			import com.efi.printsmith.data.enums.ChargeQtyType;
			
			import com.efi.printsmith.events.ChargeDefinitionSelectEvent;
			import mx.events.TreeEvent;                                
			import flash.events.MouseEvent;                                

			import mx.controls.Alert;
			import mx.managers.PopUpManager;
			import mx.containers.TitleWindow;
			import mx.collections.ArrayCollection;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.events.FaultEvent;
			import mx.messaging.messages.AsyncMessage;
			import mx.messaging.messages.IMessage;
			import mx.printing.FlexPrintJob;
			import mx.printing.PrintAdvancedDataGrid;
			import mx.printing.PrintDataGrid;
			import mx.core.Application;
			import mx.validators.Validator;
			import mx.events.ValidationResultEvent;
			import mx.collections.ICollectionView;
			import mx.rpc.Responder;
		    import mx.utils.GraphicsUtil;    
			import mx.utils.ObjectUtil;
			
			[Bindable]                                         
		    private var systemPreferences:PreferencesSystem;
		
			[Bindable]                                
			private var systemPreferencesArray:ArrayCollection = new ArrayCollection();

			private var accounts:ArrayCollection=new ArrayCollection();
			private var presses:ArrayCollection=new ArrayCollection();
			private var locations:ArrayCollection=new ArrayCollection();
			private var productCodes:ArrayCollection=new ArrayCollection();
			[Bindable]
			public var charges:ArrayCollection;

			[Bindable] public var charge:Charge;
			[Bindable] public var chargeCommands:ArrayCollection=new ArrayCollection();
			[Bindable] public var tempOpen:Object=new Object();
			[Bindable] public var refreshSO:Boolean=false;
			[Bindable] private var chargeDefinition:ChargeDefinition = new ChargeDefinition();
			[Bindable] private var startTimeString:String = "00:00";
			[Bindable] private var stopTimeString:String = "00:00";
    		[Bindable] private var shippingMethods:ArrayCollection = new ArrayCollection();                
			[Bindable] private var shipToArray:ArrayCollection = new ArrayCollection();
			[Bindable] private var cutDescription:String = "";
			
			private var addCharge:Boolean = false;
			
			private var focussedFormControl:DisplayObject;
			public var job:Job;
			
			private var editingCharge:Boolean = false;
			private var currencyValidator:CurrencyValidator = Snowmass.getCurrencyValidator();
			
			private function handleLoadSystemPreferencesResult(ev:ResultEvent):void {
				systemPreferencesArray = ev.result as ArrayCollection;
				if (systemPreferencesArray.length > 0)
				{
					systemPreferences = systemPreferencesArray.getItemAt(0) as PreferencesSystem;
					taxable_check.visible = !systemPreferences.disableNonTaxableOptions; 
				}else {
					taxable_check.visible = true;
				}
		
			}	                                 

			public function init():void
			{
				this.height = parent.height - 80;
				PopUpManager.centerPopUp(this);
				chargeCommandDataService.getChargeList();
				dataServiceSystemPreferences.getAll("PreferencesSystem");
			    shippingMethodDataService.getAll("ShippingMethod");
			    buildShipToArray();
				updateFieldVisibility();			
			}
			
			private function buildShipToArray():void {
				if (shipToArray == null) {
					shipToArray = new ArrayCollection();
				}
				var menuItem:Object = new Object();
				
				menuItem.name = "Invoice Address";
				shipToArray.addItem(menuItem);
				
				menuItem = new Object();
				menuItem.name = "Delivery Intent";
				shipToArray.addItem(menuItem);
				
				if (this.job != null) {
					if (this.job.parentInvoice != null) {
						if (this.job.parentInvoice.contact != null) {
							
						}
					}
				}
			}

			private function findItem(name:String, array:ArrayCollection):int
			{
				for each (var element:Object in array)
				{
					if (name == element.name)
					{
						return array.getItemIndex(element);
					}
				}
				return -1;
			}
			
			private function handleLoadShippingMethods(ev:ResultEvent):void {
				shippingMethods = ev.result as ArrayCollection;
			}

			private function handleLoadPressResult(ev:ResultEvent):void
			{
				presses=ev.result as ArrayCollection;
			}

			private function handleLoadLocationResult(ev:ResultEvent):void
			{
				locations=ev.result as ArrayCollection;
			}

			private function handleLoadProductResult(ev:ResultEvent):void
			{
				productCodes=ev.result as ArrayCollection;
			}

			private function handleDeleteResult(ev:ResultEvent):void
			{
			}

			private function handleLoadChargeCommandResult(ev:ResultEvent):void
			{
				chargeCommands=ev.result as ArrayCollection;
			}

			private function handleSaveResult(ev:ResultEvent):void
			{

			}


			private function handleFault(ev:FaultEvent):void
			{
				var message:String;

				message="Error: " + ev.fault.faultCode + " - " + ev.fault.faultDetail + " - " + ev.fault.faultString;
				Alert.show(message, "Error", 0, null);
			}



			private function validateForm(event:Event):void
			{
				focussedFormControl=event.target as DisplayObject;

				//formIsValid = true;                    

			}

			private function validate(validator:Validator):Boolean
			{
				return true;
			}

//			private function refreshData():void
//			{
//				//reset the root node to its original unfiltered data
//				var i:int;
//				for (i=0; i < chargeCommands.length; i++)
//				{
//					chargeCommands[i].children=new ArrayCollection(chargeCommands[i].children.source);
//					refreshRecursiveChildren(chargeCommands.source[i]);
//				}
//				//update the Tree after the data has been filtered
//				chargeTree.invalidateList();
//			}
//
//			private function refreshRecursiveChildren(item:Object):void
//			{
//				var classInfo:XML=describeType(item);
//
//				if (classInfo.@name.toString() == "com.efi.vo::ChargeCommand" && item.children != null)
//				{
//					//loop through each child and filter its children
//					for each (var chargeCategoryItem:ChargeCategory in item.children.source)
//					{
//						refreshRecursiveChildren(chargeCategoryItem);
//					}
//					item.children=new ArrayCollection(item.children.source);
//					item.children.filterFunction=filterData;
//					item.children.refresh();
//				}
//				else if (classInfo.@name.toString() == "com.efi.vo::ChargeCategory" && item.children != null)
//				{
//					//loop through each child and filter its children
//					for each (var chargeItem:Charge in item.children.source)
//					{
//						refreshRecursiveChildren(chargeItem);
//					}
//					item.children=new ArrayCollection(item.children.source);
//					item.children.filterFunction=filterData;
//					item.children.refresh();
//				}
//			}
//
//			public function filterData(item:Object):Boolean
//			{
//				//get the string to filter the nodes by
//				var searchString:String=tree_filter.text;
//				//if string is found in node return true.
//				//since the recursive filtering takes place from bottom up, if
//				//a collection still has children after filtering, also return true
//				if (searchString.length == 0 || item.name.toLowerCase().indexOf(searchString.toLowerCase()) >= 0)
//					return true;
//				var classInfo:XML=describeType(item);
//
//				if (classInfo.@name.toString() == "com.efi.vo::ChargeCommand" && item.children != null)
//				{
//					return true;
//				}
//				if (classInfo.@name.toString() == "com.efi.vo::ChargeCategory" && item.children != null)
//				{
//					return true;
//				}
//				return false;
//			}

			private function tree_itemClick(evt:Event):void
			{

			}

			private function updateDataProvider():void
			{
				tempOpen=chargeTree.openItems;
				refreshSO=true;
			}

			private function renderFunction():void
			{
				if (refreshSO)
				{
					refreshSO=false;
					chargeTree.invalidateList();
					chargeTree.openItems=tempOpen;
					chargeTree.validateNow();
				}
			}

			private function invoiceChargeLabel(item:Object):String
			{
				return item.name;
			}

			private function treeLabel(item:Object):String
			{
				var children:ICollectionView;

				var suffix:String="";
				if (chargeTree.dataDescriptor.isBranch(item))
				{
					children=chargeTree.dataDescriptor.getChildren(item);
					suffix=" (" + children.length + ")";
				}
				return item.name + suffix;
			}
			
			private function getSearchBy():ArrayCollection {
				var sc:ArrayCollection = new ArrayCollection();
			
				var fp:FilterProperty = new FilterProperty(null, "name");
				var sc1:FilterSearchBy = new FilterSearchBy("", fp);
				sc.addItem(sc1);
				
				return sc;
			}

			private function handleNewChargeResult(event:ResultEvent):void
			{
				if (chargeDefinition.method == ChargeMethod.SquareArea) {
					charge = event.result as SquareAreaCharge;
				} else if (chargeDefinition.method == ChargeMethod.Cut) {
					charge = event.result as CuttingCharge;
				} else if (chargeDefinition.method == ChargeMethod.Ink) {
					charge = event.result as InkCharge;
				} else if (chargeDefinition.method == ChargeMethod.Shipping) {
					charge = event.result as ShippingCharge;
				} else {
					charge = event.result as Charge;
				}
				charge.parentJob = job;
				updatePrice();
			}
			
			private function treeSelectionChanged(event:Event):void
			{
				chargeDefinition = getSelectedTreeChargeDefinition();

				if (chargeDefinition != null)
				{
					chargeService.createChargeFromChargeDefinition(chargeDefinition);

					this.editingCharge = false;
					this.add_button.label = "Add";
					var hourStr:String = (chargeDefinition.presetTimeStartHour < 10?"0":"") + chargeDefinition.presetTimeStartHour;
					var minStr:String = (chargeDefinition.presetTimeStartMinute < 10?"0":"") + chargeDefinition.presetTimeStartMinute;
					startTimeString = hourStr + ":" + minStr;
					hourStr = (chargeDefinition.presetTimeStopHour < 10?"0":"") + chargeDefinition.presetTimeStopHour;
					minStr = (chargeDefinition.presetTimeStopMinute < 10?"0":"") + chargeDefinition.presetTimeStopMinute;
					stopTimeString = hourStr + ":" + minStr;
				}
				else
				{
					startTimeString = "00:00";
					stopTimeString = "00:00";
					charge=null;
				}
				updateFieldVisibility();			
			}

			private function gridSelectionChanged():void
			{
				charge = ObjectUtil.copy(invoice_charge_datagrid.selectedItem) as Charge;
				//invoice_charge_datagrid.selectedItem as Charge;
				chargeDefinition = charge.chargeDefinition;
				this.editingCharge = true;
				this.add_button.label = "Save";
				updateFieldVisibility();
		}
			
			private function getSelectedTreeChargeDefinition():ChargeDefinition
			{
				var treeItem:Object=chargeTree.selectedItem;
				var classInfo:XML=describeType(treeItem);
				var className:String = classInfo.@name.toString();
				if (className == "com.efi.printsmith.data::ChargeDefinition")
				{
					return treeItem as ChargeDefinition;
				}
				return null;
			}

			private function doDone():void
			{
				var doneEvent:ChargeDefinitionSelectEvent=new ChargeDefinitionSelectEvent(ChargeDefinitionSelectEvent.CHARGEDEFINITIONCOMPLETE, charges);
				dispatchEvent(doneEvent);
				PopUpManager.removePopUp(this);
			}

			private function doAdd():void
			{
				addCharge = true;
				updatePrice();
			}

			private function addChargeToList():void
			{
				if (charges == null)
				{
					charges = new ArrayCollection;
				}
				if (!editingCharge) {
					charges.addItem(this.charge);
				} else {
					charges.setItemAt(this.charge, this.invoice_charge_datagrid.selectedIndex);
				}
				
				chargeTree.selectedItem = null;
				invoice_charge_datagrid.selectedItem = null;
				invoice_charge_datagrid.invalidateList();
				currentState = "";
				this.charge = null;
				this.chargeDefinition = null;
				editingCharge = false;
				updateFieldVisibility();
			}
			
			private function mapToChargeData():void {
				startTimeString = time_start_edit.text;
				stopTimeString = time_stop_edit.text;
				if(this.charge!=null) {
					this.charge.finished=finished_check.selected;
					this.charge.taxable=taxable_check.selected;
					this.charge.brokered=brokered_check.selected;
					this.charge.displayQty=displayQty_check.selected;
					this.charge.hidden=hidden_check.selected;
					this.charge.hidePrice=hidePrice_check.selected;
					this.charge.description=charge_description_edit.text;
					this.charge.notes=charge_notes_edit.text;
					this.charge.showNotes=showNotes_check.selected;
					this.charge.rate=parseCurrencyFloat(rate_edit.text);
					this.charge.price=parseCurrencyFloat(price_edit.text);
					this.charge.quantity=parseCurrencyFloat(quantity_edit.text);
					this.charge.materialQty=parseCurrencyFloat(material_quantity_edit.text);
					this.charge.linearX1 = this.linear_bottom.selected;
					this.charge.linearX2 = this.linear_top.selected;
					this.charge.linearY1 = this.linear_right.selected;
					this.charge.linearY2 = this.linear_left.selected;
					if (time_start_edit != null) {
						if (startTimeString.indexOf(":") != -1) {
							charge.startHours = parseInt(startTimeString.substr(0,startTimeString.indexOf(":")));
							charge.startMinutes = parseInt(startTimeString.substr(startTimeString.indexOf(":")+1));
						} if (startTimeString.indexOf(".") != -1) {
							charge.startHours = parseInt(startTimeString.substr(0,startTimeString.indexOf(".")));
							charge.startMinutes = parseInt(startTimeString.substr(startTimeString.indexOf(".")+1));
						} else {
							charge.startHours = parseInt(startTimeString);
						}
					}
							
					if (time_stop_edit != null) {
						if (stopTimeString.indexOf(":") != -1) {
							charge.endHours = parseInt(stopTimeString.substr(0,stopTimeString.indexOf(":")));
							charge.endMinutes = parseInt(stopTimeString.substr(stopTimeString.indexOf(":")+1));
						} if (startTimeString.indexOf(".") != -1) {
							charge.endHours = parseInt(stopTimeString.substr(0,stopTimeString.indexOf(".")));
							charge.endMinutes = parseInt(stopTimeString.substr(stopTimeString.indexOf(".")+1));
						} else {
							charge.startHours = parseInt(startTimeString);
						}
					}
					if (this.charge is InkCharge) {
						(charge as InkCharge).coverage=parseCurrencyFloat(percent_coverage_edit.text);
						(charge as InkCharge).poundsOfInk=parseCurrencyFloat(lbs_of_ink_edit.text);
						(charge as InkCharge).coverPerPound=parseCurrencyFloat(cover_lb_edit.text);
						(charge as InkCharge).pricePerPound=parseCurrencyFloat(price_lb_edit.text);
					}
				}
			}
			
			private function updatePrice():void
			{
				mapToChargeData();
				var priceChargeEvent:PriceChargeEvent = new PriceChargeEvent(this.charge, new mx.rpc.Responder(handlePriceChargeComplete, handlePriceChargeFault));
				priceChargeEvent.dispatch();
				refresh_price_btn.visible = false;
				refresh_price_btn.enabled = false;
				pricing_throbber.visible = true;
				pricing_throbber.play();
			}

			private function handlePriceChargeComplete(ev:ResultEvent):void
			{
				pricing_throbber.stop();
				pricing_throbber.visible = false;
				if (charge == null) return;
				
				var localCharge:Charge = ev.result as Charge;
				refresh_price_btn.visible = true;
				refresh_price_btn.enabled = true;		
				charge.price = localCharge.price;
				charge.quantity = localCharge.quantity;
				charge.materialQty = localCharge.materialQty;
				charge.rate = localCharge.rate;
				charge.sets = localCharge.sets;
				charge.materialSets = localCharge.materialSets;
				if (this.charge is InkCharge) {
					(charge as InkCharge).poundsOfInk = (localCharge as InkCharge).poundsOfInk;
					(charge as InkCharge).pricePerPound = (localCharge as InkCharge).pricePerPound;
					(charge as InkCharge).coverage = (localCharge as InkCharge).coverage;
					if (isNaN((charge as InkCharge).poundsOfInk)) {
						lbs_of_ink_edit.text = "0";
					} else {
						lbs_of_ink_edit.text = (charge as InkCharge).poundsOfInk.toString();
					}
					if (isNaN((charge as InkCharge).coverPerPound)) {
						cover_lb_edit.text = "0";
					} else {
						cover_lb_edit.text = (charge as InkCharge).coverPerPound.toString();
					}
					if (isNaN((charge as InkCharge).pricePerPound)) {
						price_lb_edit.text = "0";
					} else {
						price_lb_edit.text = (charge as InkCharge).pricePerPound.toString();
					}
				} else if (this.charge is ShippingCharge) {
					(charge as ShippingCharge).totalWeight = (localCharge as ShippingCharge).totalWeight;
					this.total_weight_text.text = (charge as ShippingCharge).totalWeight.toString();
				} else if (this.charge is CuttingCharge) {
					(charge as CuttingCharge).cuts = (localCharge as CuttingCharge).cuts;
					this.cuts_edit.text = (charge as CuttingCharge).cuts.toString();
				} else if (this.charge is SquareAreaCharge) {
					(charge as SquareAreaCharge).area = (localCharge as SquareAreaCharge).area;
					this.area_text.text = (charge as SquareAreaCharge).area.toString();
				}
				if (addCharge) {
					addCharge = false;
					addChargeToList();
				}
			}
			
			private function handlePriceChargeFault(ev:FaultEvent):void
			{
				pricing_throbber.stop();
				pricing_throbber.visible = false;
				if (ev != null && ev.fault != null && ev.fault.faultString != null) {				
					Alert.show(ev.fault.faultString, "Error in Pricing", 0, null);
				} else {
					Alert.show("Unknown error when pricing job", "Error in Pricing", 0, null);
				}
			}

			private function updateQty():void {
	    		if (quantity_edit.text == "") {
	    			this.charge.overrideQuantity = false;
	    			this.charge.quantity = 0;
	    		} else {
	    			this.charge.overrideQuantity = true;
	    			this.charge.quantity = parseCurrencyFloat(quantity_edit.text); 
	    		}
	    		updatePrice();
	  		}	
	  		
	  		private function updateMaterialQty():void {
	  			if (material_quantity_edit.text == "") {
	    			this.charge.overrideMaterialQuantity = false;
	    			this.charge.materialQty = 0;
	    		} else {
	    			this.charge.overrideMaterialQuantity = true;
	    			this.charge.materialQty = parseCurrencyFloat(material_quantity_edit.text); 
	    		}
	    		updatePrice();
	  		}	
	  		
	  		private function updateMaterialRate():void {
	  			if (this.material_rate.text == "") {
	    			this.charge.overrideMaterial = false;
	    			this.charge.material = 0;
	    		} else {
	    			this.charge.overrideMaterial = true;
	    			this.charge.material = parseCurrencyFloat(material_rate.text); 
	    		}
	    		updatePrice();
	  		}	
	  		
	  		private function updateRate():void {
	  			if (this.rate_edit.text == "") {
	    			this.charge.overrideRate = false;
	    			this.charge.rate = 0;
	    		 	this.rate_edit.setStyle("textDecoration", "none");
	    		 	this.rate_edit.setStyle("fontStyle", "none");
	    		} else {
	    			this.charge.overrideRate = true;
	    			this.charge.rate = parseCurrencyFloat(rate_edit.text); 
	    		 	this.rate_edit.setStyle("textDecoration", "underline");
	    		 	this.rate_edit.setStyle("fontStyle", "italic");
	    		}
	  		}	

			private function updateCuts():void {
				if (this.cuts_edit.text == "") {
					(this.charge as CuttingCharge).cuts = chargeDefinition.presetCuts;
					(this.charge as CuttingCharge).overrideCuts = false;
				} else {
					(this.charge as CuttingCharge).cuts = parseInt(this.cuts_edit.text);
					(this.charge as CuttingCharge).overrideCuts = true;
				}
			}
			
			private function updateRateSets():void {
				if (this.in_sets_of_text.text == "") {
					this.charge.sets = chargeDefinition.rateSetCount;
				} else {
					this.charge.sets = parseInt(this.in_sets_of_text.text);
				}
			}
			
			private function updateMaterialRateSets():void {
				if (this.material_sets_of_text.text == "") {
					this.charge.materialSets = chargeDefinition.materialSetCount;
				} else {
					this.charge.materialSets = parseInt(this.material_sets_of_text.text);
				}				
			}
			
			private function updatePriceEdit():void {
	  			if (this.price_edit.text == "") {
	    			this.charge.overridePrice = false;
	    			this.charge.rate = 0;
	    		} else {
	    			this.charge.overridePrice = true;
	    			this.charge.price = parseCurrencyFloat(price_edit.text); 
	    		}
			}
			
			private function updateTotalWeightEdit():void {
				if (this.total_weight_text.text == "") {
					this.charge.overrideTotalWeight = false;
					this.charge.totalWeight = 0;
				} else {
					this.charge.overrideTotalWeight = true;
					this.charge.totalWeight = parseFloat(total_weight_text.text);
				}
			}
			
			private function drawLinearPageImage():void {
				linear_image.graphics.clear();
				
				if (this.job != null && this.job.runSize != null) {
					var runSize:Dimension = this.job.runSize;
					if (runSize.height != 0 && runSize.width != 0) {
						
						this.linear_top.label = runSize.width.toString();
						this.linear_right.label = runSize.height.toString();
						var imageHeight:Number = 0;
						var imageWidth:Number = 0;
						linear_image.graphics.beginFill(0xbcbcbc);
						GraphicsUtil.drawRoundRectComplex(linear_image.graphics, 0, 0, 80, 80, 0, 0, 0, 0);
						linear_image.graphics.beginFill(0xf9f6cc);

						if (runSize.height > runSize.width) {
							imageHeight = 60;
							
							imageWidth = 60 * (runSize.width/runSize.height);
							if (imageWidth < 5) imageWidth = 5;
							GraphicsUtil.drawRoundRectComplex(linear_image.graphics, 40-(imageWidth/2), 10, imageWidth, imageHeight, 0, 0, 0, 0);
						} else {
							imageWidth = 60;
							
							imageHeight = 60 * (runSize.height/runSize.width);
							if (imageHeight < 5) imageHeight = 5;
							GraphicsUtil.drawRoundRectComplex(linear_image.graphics, 10, 40-(imageHeight/2), imageWidth, imageHeight, 0, 0, 0, 0);
						}
					}
				}
			}

			public function updateFieldVisibility():void {
				charge_special_info.selectedChild = blank;
				description_box.visible = true;
				notes_box.visible = true;
				production_location_box.visible = true;
				check_boxes_box.visible = true;
				showNotes_check.visible = true;
				cut_description_box.visible = cut_description_box.includeInLayout = false;
				if (this.chargeDefinition == null) {
					description_box.visible = false;
					notes_box.visible = false;
					production_location_box.visible = false;
					check_boxes_box.visible = false;
					showNotes_check.visible = false;
					quantity_box.includeInLayout = quantity_box.visible = false;
					material_quantity_box.includeInLayout = material_quantity_box.visible = false;
					material_rate_box.includeInLayout = material_rate_box.visible = false;
					in_sets_of_box.includeInLayout = in_sets_of_box.visible = false;
					rate_box.includeInLayout = rate_box.visible = false;
					material_sets_of_box.includeInLayout = material_sets_of_box.visible = false;
					price_box.includeInLayout = price_box.visible = false;
					price_edit.editable = false;
					setup_box.includeInLayout = setup_box.visible = false;
					number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
					pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
					coverage_box.includeInLayout = coverage_box.visible = false;
					price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
					cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
					weight_box.includeInLayout = weight_box.visible = false;
					area_box.includeInLayout = area_box.visible = false;
					up_box.includeInLayout = up_box.visible = false;
					cuts_box.includeInLayout = cuts_box.visible = false;
					sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;					
				} else if (this.chargeDefinition.method == ChargeMethod.Ask) {
					this.rate_box.visible = false;
					if (chargeDefinition.quantityType == ChargeQtyType.Sets ||
						chargeDefinition.quantityType == ChargeQtyType.Quantity ||
						chargeDefinition.quantityType == ChargeQtyType.SetupSets) {
						quantity_box.includeInLayout = quantity_box.visible = true;
						material_quantity_box.includeInLayout = material_quantity_box.visible = chargeDefinition.useMaterial
						material_rate_box.includeInLayout = material_rate_box.visible = chargeDefinition.useMaterial && chargeDefinition.adjustableMaterial;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = chargeDefinition.useMaterialSets && chargeDefinition.adjustableSets;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = ((chargeDefinition.quantityType == ChargeQtyType.Sets) && chargeDefinition.useSetup);
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = false;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;
						if (chargeDefinition.quantityType == ChargeQtyType.Sets ||
							chargeDefinition.quantityType == ChargeQtyType.SetupSets) {
							quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = true;
							quantity_box.includeInLayout = quantity_box.visible = false;
						} else {
							quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
							quantity_box.includeInLayout = quantity_box.visible = true;	
						}
					} else if (chargeDefinition.quantityType == ChargeQtyType.Time) {
						quantity_box.includeInLayout = quantity_box.visible = false;
						material_quantity_box.includeInLayout = material_quantity_box.visible = chargeDefinition.useMaterial
						material_rate_box.includeInLayout = material_rate_box.visible = chargeDefinition.useMaterial && chargeDefinition.adjustableMaterial;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = chargeDefinition.useMaterialSets && chargeDefinition.adjustableSets;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = false;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;
						charge_special_info.selectedChild = time;				
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
					} else if (chargeDefinition.quantityType == ChargeQtyType.None) {
						quantity_box.includeInLayout = quantity_box.visible = false;
						material_quantity_box.includeInLayout = material_quantity_box.visible = chargeDefinition.useMaterial
						material_rate_box.includeInLayout = material_rate_box.visible = chargeDefinition.useMaterial && chargeDefinition.adjustableMaterial;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = chargeDefinition.useMaterialSets && chargeDefinition.adjustableSets && chargeDefinition.adjustableMaterial;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = false;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
					}
				} else if (this.chargeDefinition.method == ChargeMethod.Cut) {
					quantity_box.includeInLayout = quantity_box.visible = false;
					material_quantity_box.includeInLayout = material_quantity_box.visible = chargeDefinition.useMaterial
					material_rate_box.includeInLayout = material_rate_box.visible = chargeDefinition.useMaterial && chargeDefinition.adjustableMaterial;
					in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
					rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
					material_sets_of_box.includeInLayout = material_sets_of_box.visible = chargeDefinition.useMaterialSets && chargeDefinition.adjustableSets;
					price_box.includeInLayout = price_box.visible = true;
					price_edit.editable = !chargeDefinition.noOverrides;
					setup_box.includeInLayout = setup_box.visible = false;
					number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
					pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
					coverage_box.includeInLayout = coverage_box.visible = false;
					price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
					cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
					weight_box.includeInLayout = weight_box.visible = false;
					area_box.includeInLayout = area_box.visible = false;
					up_box.includeInLayout = up_box.visible = (chargeDefinition.useDivideByUpCount || chargeDefinition.useMultiplyUpCount) && chargeDefinition.adjustUps;
					cuts_box.includeInLayout = cuts_box.visible = true;
					sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = chargeDefinition.sheet_lift_check && chargeDefinition.adjustableSets;
					quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
					if (this.chargeDefinition.cutsArePrePress) {
						cutDescription = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.ParenttoRunSize');
 					} else {
						cutDescription = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.RuntoFinishSize');
 					}
					cut_description_box.visible = cut_description_box.includeInLayout = true;
				} else if (this.chargeDefinition.method == ChargeMethod.FlatRate) {
					quantity_box.includeInLayout = quantity_box.visible = false;
					material_quantity_box.includeInLayout = material_quantity_box.visible = false
					material_rate_box.includeInLayout = material_rate_box.visible = false;
					in_sets_of_box.includeInLayout = in_sets_of_box.visible = false;
					rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
					material_sets_of_box.includeInLayout = material_sets_of_box.visible = false;
					price_box.includeInLayout = price_box.visible = true;
					price_edit.editable = !chargeDefinition.noOverrides;
					setup_box.includeInLayout = setup_box.visible = false;
					number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
					pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
					coverage_box.includeInLayout = coverage_box.visible = false;
					price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
					cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
					weight_box.includeInLayout = weight_box.visible = false;
					area_box.includeInLayout = area_box.visible = false;
					up_box.includeInLayout = up_box.visible = false;
					cuts_box.includeInLayout = cuts_box.visible = false;
					sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;			
					quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
				} else if (this.chargeDefinition.method == ChargeMethod.Fold) {			
					if (chargeDefinition.quantityType == ChargeQtyType.Quantity) {
						quantity_box.includeInLayout = quantity_box.visible = true;
						material_quantity_box.includeInLayout = material_quantity_box.visible = chargeDefinition.useMaterial
						material_rate_box.includeInLayout = material_rate_box.visible = chargeDefinition.useMaterial && chargeDefinition.adjustableMaterial;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = chargeDefinition.useMaterialSets && chargeDefinition.adjustableSets;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = (chargeDefinition.useDivideByUpCount || chargeDefinition.useMultiplyUpCount) && chargeDefinition.adjustUps;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = chargeDefinition.sheet_lift_check && chargeDefinition.adjustableSets;				
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
						charge_special_info.selectedChild = fold;				
						if (chargeDefinition.foldTemplate != null) {
							fold_description.text = chargeDefinition.foldTemplate.description;
							var imageSource:String = "assets/fold_diagrams/" + chargeDefinition.foldTemplate.imageFile;
							fold_image.source = imageSource;
						}
					} else if (chargeDefinition.quantityType == ChargeQtyType.Sets ||
							   chargeDefinition.quantityType == ChargeQtyType.SetupSets) {
						quantity_box.includeInLayout = quantity_box.visible = false;
						material_quantity_box.includeInLayout = material_quantity_box.visible = chargeDefinition.useMaterial
						material_rate_box.includeInLayout = material_rate_box.visible = chargeDefinition.useMaterial && chargeDefinition.adjustableMaterial;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = chargeDefinition.useMaterialSets && chargeDefinition.adjustableSets;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = ((chargeDefinition.quantityType == ChargeQtyType.Sets) && chargeDefinition.useSetup);
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = (chargeDefinition.useDivideByUpCount || chargeDefinition.useMultiplyUpCount) && chargeDefinition.adjustUps;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = chargeDefinition.sheet_lift_check && chargeDefinition.adjustableSets;				
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = true;
					}			
				} else if (this.chargeDefinition.method == ChargeMethod.Ink) {
					if (chargeDefinition.quantityType == ChargeQtyType.Sets) {
						quantity_box.includeInLayout = quantity_box.visible = false;
						material_quantity_box.includeInLayout = material_quantity_box.visible = false;
						material_rate_box.includeInLayout = material_rate_box.visible = false;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = false;
						rate_box.includeInLayout = rate_box.visible = false
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = false;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = true;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = true;
						coverage_box.includeInLayout = coverage_box.visible = true;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = chargeDefinition.adjustableRate;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = chargeDefinition.coverlb_check && chargeDefinition.adjustableSets;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = (chargeDefinition.useDivideByUpCount || chargeDefinition.useMultiplyUpCount) && chargeDefinition.adjustUps;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;								
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = true;
					} else if (chargeDefinition.quantityType == ChargeQtyType.Quantity) {
						quantity_box.includeInLayout = quantity_box.visible = false;
						material_quantity_box.includeInLayout = material_quantity_box.visible = false;
						material_rate_box.includeInLayout = material_rate_box.visible = false;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = false;
						rate_box.includeInLayout = rate_box.visible = false
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = false;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = true;
						coverage_box.includeInLayout = coverage_box.visible = true;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = chargeDefinition.adjustableRate;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = chargeDefinition.coverlb_check && chargeDefinition.adjustableSets;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = (chargeDefinition.useDivideByUpCount || chargeDefinition.useMultiplyUpCount) && chargeDefinition.adjustUps;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;								
					}			
				} else if (this.chargeDefinition.method == ChargeMethod.JobAware) {
					if (chargeDefinition.quantityType == ChargeQtyType.Sets ||
						chargeDefinition.quantityType == ChargeQtyType.SetupSets) {
						quantity_box.includeInLayout = quantity_box.visible = false;
						material_quantity_box.includeInLayout = material_quantity_box.visible = chargeDefinition.useMaterial;
						material_rate_box.includeInLayout = material_rate_box.visible = chargeDefinition.useMaterial && chargeDefinition.adjustableMaterial;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = chargeDefinition.useMaterialSets && chargeDefinition.adjustableSets;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = ((chargeDefinition.quantityType == ChargeQtyType.Sets) && chargeDefinition.useSetup);
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = (chargeDefinition.useDivideByUpCount || chargeDefinition.useMultiplyUpCount) && chargeDefinition.adjustUps;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = true;								
					} else if (chargeDefinition.quantityType == ChargeQtyType.Quantity) {
						quantity_box.includeInLayout = quantity_box.visible = true;
						material_quantity_box.includeInLayout = material_quantity_box.visible = chargeDefinition.useMaterial;
						material_rate_box.includeInLayout = material_rate_box.visible = chargeDefinition.useMaterial && chargeDefinition.adjustableMaterial;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = chargeDefinition.useMaterialSets && chargeDefinition.adjustableSets;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = (chargeDefinition.useDivideByUpCount || chargeDefinition.useMultiplyUpCount) && chargeDefinition.adjustUps;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;		
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
					}
				} else if (this.chargeDefinition.method == ChargeMethod.Linear) {
					if (chargeDefinition.quantityType == ChargeQtyType.Sets ||
						chargeDefinition.quantityType == ChargeQtyType.SetupSets) {
						quantity_box.includeInLayout = quantity_box.visible = false;
						material_quantity_box.includeInLayout = material_quantity_box.visible = chargeDefinition.useMaterial;
						material_rate_box.includeInLayout = material_rate_box.visible = chargeDefinition.useMaterial && chargeDefinition.adjustableMaterial;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = chargeDefinition.useMaterialSets && chargeDefinition.adjustableSets;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = ((chargeDefinition.quantityType == ChargeQtyType.Sets) && chargeDefinition.useSetup);
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = (chargeDefinition.useDivideByUpCount || chargeDefinition.useMultiplyUpCount) && chargeDefinition.adjustUps;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;				
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
						charge_special_info.selectedChild = linear;		
						drawLinearPageImage();		
	    			} else if (chargeDefinition.quantityType == ChargeQtyType.Quantity) {
						quantity_box.includeInLayout = quantity_box.visible = true;
						material_quantity_box.includeInLayout = material_quantity_box.visible = chargeDefinition.useMaterial;
						material_rate_box.includeInLayout = material_rate_box.visible = chargeDefinition.useMaterial && chargeDefinition.adjustableMaterial;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = chargeDefinition.useMaterialSets && chargeDefinition.adjustableSets;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = (chargeDefinition.useDivideByUpCount || chargeDefinition.useMultiplyUpCount) && chargeDefinition.adjustUps;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;								
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
						charge_special_info.selectedChild = linear;		
						drawLinearPageImage();		
					}
				} else if (this.chargeDefinition.method == ChargeMethod.Markup) {
						quantity_box.includeInLayout = quantity_box.visible = false;
						material_quantity_box.includeInLayout = material_quantity_box.visible = false;
						material_rate_box.includeInLayout = material_rate_box.visible = false;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = false;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = false;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;				
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
				} else if (this.chargeDefinition.method == ChargeMethod.PriceList ||
						   this.chargeDefinition.method == ChargeMethod.RateList) {
						quantity_box.includeInLayout = quantity_box.visible = true;
						material_quantity_box.includeInLayout = material_quantity_box.visible = false;
						material_rate_box.includeInLayout = material_rate_box.visible = false;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = false;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = false;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;						
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
				} else if (this.chargeDefinition.method == ChargeMethod.Shipping) {
					if (chargeDefinition.quantityType == ChargeQtyType.TotalWeight) {
						quantity_box.includeInLayout = quantity_box.visible = false;
						material_quantity_box.includeInLayout = material_quantity_box.visible = false;
						material_rate_box.includeInLayout = material_rate_box.visible = false;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = false;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = true;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = false;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
					} else if (chargeDefinition.quantityType == ChargeQtyType.ShippingQty) {
						quantity_box.includeInLayout = quantity_box.visible = true;
						material_quantity_box.includeInLayout = material_quantity_box.visible = false;
						material_rate_box.includeInLayout = material_rate_box.visible = false;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = false;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = true;
						area_box.includeInLayout = area_box.visible = false;
						up_box.includeInLayout = up_box.visible = false;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
					}
				} else if (this.chargeDefinition.method == ChargeMethod.SquareArea) {
					if (chargeDefinition.quantityType == ChargeQtyType.Quantity) {
						quantity_box.includeInLayout = quantity_box.visible = true;
						material_quantity_box.includeInLayout = material_quantity_box.visible = false;
						material_rate_box.includeInLayout = material_rate_box.visible = false;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = false;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = true;
						up_box.includeInLayout = up_box.visible = false;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = false;
					} else if (chargeDefinition.quantityType == ChargeQtyType.Sets) {
						quantity_box.includeInLayout = quantity_box.visible = false;
						material_quantity_box.includeInLayout = material_quantity_box.visible = false;
						material_rate_box.includeInLayout = material_rate_box.visible = false;
						in_sets_of_box.includeInLayout = in_sets_of_box.visible = chargeDefinition.useRateSets && chargeDefinition.adjustableSets;
						rate_box.includeInLayout = rate_box.visible = chargeDefinition.adjustableRate;
						material_sets_of_box.includeInLayout = material_sets_of_box.visible = false;
						price_box.includeInLayout = price_box.visible = true;
						price_edit.editable = !chargeDefinition.noOverrides;
						setup_box.includeInLayout = setup_box.visible = false;
						number_of_colors_box.includeInLayout = number_of_colors_box.visible = false;
						pounds_of_ink_box.includeInLayout = pounds_of_ink_box.visible = false;
						coverage_box.includeInLayout = coverage_box.visible = false;
						price_per_pound_box.includeInLayout = price_per_pound_box.visible = false;
						cover_per_pound_box.includeInLayout = cover_per_pound_box.visible = false;
						weight_box.includeInLayout = weight_box.visible = false;
						area_box.includeInLayout = area_box.visible = true;
						up_box.includeInLayout = up_box.visible = false;
						cuts_box.includeInLayout = cuts_box.visible = false;
						sheets_per_lift_box.includeInLayout = sheets_per_lift_box.visible = false;
						quantity_per_set_box.includeInLayout = quantity_per_set_box.visible = true;
					}
				}
			}
			
			private function chargeTreeOpening(event:TreeEvent):void {
				var trigger:Event = event.triggerEvent;
				
				if (trigger is MouseEvent) {
					if ((trigger as MouseEvent).ctrlKey == true) {
						chargeTree.expandChildrenOf(event.item, event.opening);
					}
				}
			}
			
			private function formatChargePrice(item:Object, column:DataGridColumn):String {
				return numFormatter.format(item[column.dataField]);
			}
			
			private function onRenderDescription (evt:Event):void {
				var text_label:Text = evt.target as Text;
				text_label.setStyle("textDecoration", "underline");
			}
			
			private function doDoubleClick(evt:Event):void {
				this.updatePrice();
				addCharge = true;
			}
	]]>

	</mx:Script>
	
	<mx:NumberFormatter id="numFormatter" precision="2" rounding="nearest"  useNegativeSign="true" useThousandsSeparator="true"/>

	<mx:VBox width="100%"
			 height="100%"
			 creationPolicy="all" horizontalScrollPolicy="off">
		<mx:Canvas width="100%"
				   height="100%"
				   verticalScrollPolicy="off"
				   horizontalScrollPolicy="off">
			<mx:HDividedBox x="10"
							y="10"
							width="100%"
							height="100%"
							verticalScrollPolicy="off"
							horizontalScrollPolicy="off">
				<mx:Canvas width="230"
						   height="100%" id="canvas1">
					<mx:Tree width="100%"
							 render="renderFunction()"
							 folderClosedIcon="{null}"
							 folderOpenIcon="{null}"
							 defaultLeafIcon="{null}"
							 id="chargeTree"
							 dataProvider="{chargeCommands}"
							 labelFunction="treeLabel"
							 visible="true"
							 enabled="true"
							 click="tree_itemClick(event);"
							 dataChange="treeSelectionChanged(event)"
							 change="treeSelectionChanged(event);"
							 itemOpening="chargeTreeOpening(event)" 
							 doubleClick="doDoubleClick(event);"
							 doubleClickEnabled="true"
							 bottom="30"
							 top="19">
					</mx:Tree>
				<common:TreePickerFilter searchClassName="com.efi.printsmith.data::ChargeDefinition" height="22" bottom="5" showExtendedSearch="true"  searchComponent="{chargeTree}"  listData="{chargeCommands}" searchCriteria="{getSearchBy()}"  right="0" width="100%">
				</common:TreePickerFilter>
					<mx:Text x="3"
							 y="3"
							 text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.ChargeDefinitions')}"
							 fontWeight="bold"/>
				</mx:Canvas>
				<mx:Canvas width="100%"
						   height="643" horizontalScrollPolicy="off">
					<mx:VDividedBox width="100%"
									left="0"
									right="6"
									bottom="0"
									top="0">
						<mx:Canvas width="100%"
								   height="142"
								   verticalScrollPolicy="off"
								   horizontalScrollPolicy="off">
							<mx:DataGrid top="5"
										 bottom="0"
										 width="100%"
										 id="invoice_charge_datagrid"
										 dataProvider="{charges}"
										 left="10"
										 change="gridSelectionChanged()">
								<mx:columns>
									<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeCmd.DocumentCharges')}"
													   dataField="description" itemRenderer="com.efi.printsmith.common.components.ChargeRenderer"/>
									<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Price')}"
													   width="90"
													   dataField="price"
													   labelFunction="formatChargePrice"
													   itemRenderer="com.efi.printsmith.common.components.ChargeRenderer"
													   textAlign="right"/>
								</mx:columns>
							</mx:DataGrid>
						</mx:Canvas>

						<mx:VBox width="100%" height="491">
							<mx:HBox width="100%" id="check_boxes_box">
								<mx:Spacer width="8"/>
								<mx:CheckBox
											 label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rPresetInfo.Finished')}"
											 id="finished_check"
											 fontSize="9"
											 selected="{charge.finished}"/>
								<mx:CheckBox
											 label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rPresetInfo.Taxable')}"
											 id="taxable_check"
											 fontSize="9"
											 selected="{charge.taxable}"/>
								<mx:CheckBox
											 label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rPresetInfo.Brokered')}"
											 id="brokered_check"
											 fontSize="9"
											 selected="{charge.brokered}"/>
								<mx:CheckBox
											 label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rPresetInfo.DisplayQuantity')}"
											 id="displayQty_check"
											 fontSize="9"
											 selected="{charge.displayQty}"/>
								<mx:CheckBox
											 label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rPresetInfo.Hidden')}"
											 id="hidden_check"
											 fontSize="9"
											 selected="{charge.hidden}"/>
								<mx:CheckBox
											 label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rPresetInfo.HidePrice')}"
											 id="hidePrice_check"
											 fontSize="9"
											 selected="{charge.hidePrice}"/>
							</mx:HBox>
							<mx:HBox width="100%" id="description_box">
								<mx:Spacer width="8"/>
								<mx:Text text="{chargeDefinition.presetDescriptionLabel}" width="25%" id="charge_description_label_text" textAlign="right"/>
								<mx:TextInput text="{charge.description}" width="100%" id="charge_description_edit"/>
							</mx:HBox>
							<mx:HBox width="100%" id="notes_box">
								<mx:Spacer width="8"/>
								<mx:Text text="{chargeDefinition.presetNotesLabel}" width="25%" id="charge_notes_label_text" textAlign="right"/>
								<mx:TextInput text="{charge.notes}" width="100%" id="charge_notes_edit"/>
							</mx:HBox>
							<mx:HBox width="100%" id="production_location_box">
								<mx:Spacer width="8"/>
								<mx:Text text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.ProductionLocation')}" width="25%" id="production_location_label" textAlign="right"/>
								<mx:TextInput text="{chargeDefinition.location.name}" width="100%" id="location_text" enabled="false"/>
							</mx:HBox>
							<mx:HBox width="100%">
								<mx:Spacer width="30%" height="5"/>
								<mx:CheckBox
											 label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rPresetInfo.ShowNotes')}"
											 id="showNotes_check"
											 fontSize="9"
											 selected="{chargeDefinition.presetShowNotes}" width="100%"/>
							</mx:HBox>
							<mx:ViewStack id="charge_special_info" width="100%" height="129">
								<mx:HBox label="blank" width="100%" height="100%" id="blank">
								</mx:HBox>
								<mx:HBox label="linear" width="100%" height="100%" id="linear" creationPolicy="all">
									<mx:Canvas width="100%" height="100%">
										<mx:CheckBox x="327" y="56" id="linear_left" selected="{charge.linearY2}" change="updatePrice()"/>
										<mx:CheckBox x="380" y="4" id="linear_top" selected="{charge.linearX2}" change="updatePrice()"/>
										<mx:CheckBox x="380" y="107" id="linear_bottom" selected="{charge.linearX1}" change="updatePrice()"/>
										<mx:Box width="80" height="80" id="linear_image" borderColor="#000000" borderThickness="1" borderStyle="solid" cornerRadius="5" x="347" y="25"/>
										<mx:CheckBox x="432" y="56" id="linear_right" selected="{charge.linearY1}" change="updatePrice()"/>
									</mx:Canvas>
								</mx:HBox>
								<mx:VBox label="time" width="100%" height="100%" id="time" creationPolicy="all">
									<mx:HBox width="100%" height="50%" horizontalAlign="right">
										<mx:Text text="{chargeDefinition.presetTimeStartLabel}" id="time_start_label_text" textAlign="right"/>
										<mx:TextInput text="{startTimeString}" id="time_start_edit" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="30"/>
					                </mx:HBox>
									<mx:HBox width="100%" height="50%" horizontalAlign="right">
										<mx:Text text="{chargeDefinition.presetTimeStopLabel}" id="time_end_label_text" textAlign="right"/>
										<mx:TextInput text="{stopTimeString}" id="time_stop_edit" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="30"/>
					                </mx:HBox>
								</mx:VBox>
								<mx:HBox label="fold" width="100%" height="100%" id="fold" creationPolicy="all">
									<mx:HBox width="100%" height="100%">
										<mx:Spacer width="130"/>
										<mx:Image width="85" height="82" id="fold_image"/>
										<mx:Text text="" id="fold_description" width="100%" height="83"/>
									</mx:HBox>
								</mx:HBox>
								<mx:HBox label="shipping" width="100%" height="100%" id="shipping" creationPolicy="all" horizontalAlign="center">
									<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.ShipVia')}" textAlign="right"/>
									<mx:ComboBox id="ship_via_combo" width="160" dataProvider="{shippingMethods}" labelField="name" textAlign="right"/>
									<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.ShipTo')}" textAlign="right"/>
									<mx:ComboBox id="ship_to_combo" width="160" dataProvider="{shipToArray}" labelField="name" textAlign="right"/>									
								</mx:HBox>
							</mx:ViewStack>

							<mx:HBox width="100%" height="111" verticalScrollPolicy="off">
								<mx:VBox width="50%" height="110" verticalScrollPolicy="off" verticalAlign="bottom">
									<mx:HBox width="100%" id="setup_box" visible="false">
										<mx:Spacer width="8"/>
										<mx:Text text="{chargeDefinition.presetSetupLabel}" width="50%" id="setup_label_text" textAlign="right"/>
										<mx:TextInput text="{chargeDefinition.setupPrice}" width="50%" id="setup_edit" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="40"/>
									</mx:HBox>
									<mx:HBox width="100%" id="cuts_box" visible="false">
										<mx:Spacer width="8"/>
										<mx:Text text="{chargeDefinition.presetCutsLabel}" width="50%" id="cuts_label_text" textAlign="right"/>
										<mx:TextInput text="{(charge as CuttingCharge).cuts}" width="50%" id="cuts_edit" textAlign="right" change="this.updateCuts()" focusOut="this.updatePrice()"/>
										<mx:Spacer width="40"/>
									</mx:HBox>
									<mx:HBox width="100%" id="number_of_colors_box" visible="false">
										<mx:Spacer width="8"/>
										<mx:Text text="{chargeDefinition.presetNumberOfColorsLabel}" width="50%" id="number_of_colors_label_text" textAlign="right"/>
										<mx:TextInput text="{chargeDefinition.presetNumberOfColors}" width="50%" id="number_of_colors_edit" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="40"/>
									</mx:HBox>
									<mx:HBox width="100%" id="coverage_box" visible="false">
										<mx:Spacer width="8"/>
										<mx:Text text="{chargeDefinition.presetCoverageLabel}" width="50%" id="percent_coverage_label_text" textAlign="right"/>
										<mx:TextInput text="{(charge as InkCharge).coverage}" width="50%" id="percent_coverage_edit" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="40"/>
									</mx:HBox>
									<mx:HBox width="100%" id="pounds_of_ink_box" visible="false">
										<mx:Spacer width="8"/>
										<mx:Text text="{chargeDefinition.presetPoundsOfInkLabel}" width="50%" id="lbs_of_ink_label_text" textAlign="right"/>
										<mx:TextInput text="{chargeDefinition.presetPoundsofInk}" width="50%" id="lbs_of_ink_edit" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="40"/>
									</mx:HBox>
									<mx:HBox width="100%" id="quantity_box" visible="false">
										<mx:Spacer width="8"/>
										<mx:Text text="{chargeDefinition.presetQuantityLabel}" width="50%" id="quantity_label_text" textAlign="right"/>
										<mx:TextInput text="{charge.quantity}" width="50%" id="quantity_edit" textAlign="right" focusOut="this.updateQty()"/>
										<mx:Spacer width="40"/>
									</mx:HBox>
									<mx:HBox width="100%" id="material_quantity_box" visible="false">
										<mx:Spacer width="8"/>
										<mx:Text text="{chargeDefinition.presetMaterialQuantityLabel}" width="50%" id="material_quantity_label_text" textAlign="right"/>
										<mx:TextInput text="{charge.materialQty}" width="50%" id="material_quantity_edit" textAlign="right" focusOut="this.updateMaterialQty()"/>
										<mx:Spacer width="40"/>
									</mx:HBox>
									<mx:HBox width="100%" id="material_rate_box" visible="false">
										<mx:Spacer width="8"/>
										<mx:Text text="{chargeDefinition.presetMaterialRateLabel}" width="50%" id="material_rate_label_text" textAlign="right"/>
										<mx:TextInput text="{chargeDefinition.material}" width="50%" id="material_rate" textAlign="right" focusOut="this.updateMaterialRate()"/>
										<mx:Spacer width="40"/>
									</mx:HBox>					
							</mx:VBox>
								<mx:VBox width="50%" height="110" verticalScrollPolicy="off" verticalAlign="bottom">					
									<mx:HBox width="100%" id="price_per_pound_box" visible="false">
										<mx:Text text="{chargeDefinition.presetPricePerPoundLabel}" width="50%" id="price_lb_label_text" textAlign="right"/>
										<mx:TextInput text="{chargeDefinition.presetPricePerPound}" width="50%" id="price_lb_edit" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="49"/>
									</mx:HBox>
									<mx:HBox width="100%" id="cover_per_pound_box" visible="false">
										<mx:Text text="{chargeDefinition.presetCoverPerPoundLabel}" width="50%" id="cover_lb_label_text" textAlign="right"/>
										<mx:TextInput text="{chargeDefinition.presetCoverPerPound}" width="50%" id="cover_lb_edit" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="49"/>
									</mx:HBox>
									<mx:HBox width="100%" id="weight_box" visible="false">
										<mx:Text text="{chargeDefinition.presetTotalWeightLabel}" width="50%" id="total_weight_label_text" textAlign="right"/>
										<mx:TextInput text="{chargeDefinition.presetTotalWeight}" width="50%" id="total_weight_text" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="49"/>
									</mx:HBox>
									<mx:HBox width="100%" id="in_sets_of_box" visible="false">
										<mx:Text text="{chargeDefinition.presetInSetsOfLabel}" width="50%" id="in_sets_of_label_text" textAlign="right"/>
										<mx:TextInput text="{charge.sets}" width="50%" id="in_sets_of_text" textAlign="right" change="this.updateRateSets()" focusOut="this.updatePrice()"/>
										<mx:Spacer width="49"/>
									</mx:HBox>
									<mx:HBox width="100%" id="rate_box" visible="false">
										<mx:Text text="{chargeDefinition.presetRateLabel}" width="50%" id="rate_label_text" textAlign="right"/>
										<mx:TextInput text="{chargeDefinition.rate}" width="50%" id="rate_edit" textAlign="right" change="this.updateRate()" focusOut="updatePrice()"/>
										<mx:Spacer width="49"/>
									</mx:HBox>
									<mx:HBox width="100%" id="sheets_per_lift_box" visible="false">
										<mx:Text text="{chargeDefinition.presetSheetsPerLiftLabel}" width="50%" id="sheets_per_lift_label_text" textAlign="right"/> 
										<mx:TextInput text="{chargeDefinition.presetSheetsPerLift}" width="50%" id="sheets_per_lift_text" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="49"/>
									</mx:HBox>
									<mx:HBox width="100%" id="material_sets_of_box" visible="false">
										<mx:Text text="{chargeDefinition.presetMaterialSetsOfLabel}" width="50%" id="material_sets_of_label_text" textAlign="right"/>
										<mx:TextInput text="{charge.materialSets}" width="50%" id="material_sets_of_text" textAlign="right" change="this.updateMaterialRateSets()" focusOut="this.updatePrice()"/>
										<mx:Spacer width="49"/>
									</mx:HBox>
									<mx:HBox width="100%" id="quantity_per_set_box" visible="false">
										<mx:Text text="{chargeDefinition.presetQuantityPerSetLabel}" width="50%" id="quantity_per_set_label_text" textAlign="right"/>
										<mx:TextInput text="{chargeDefinition.presetQuantityPerSet}" width="50%" id="quantity_per_set_text" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="49"/>
									</mx:HBox>
									<mx:HBox width="100%" id="area_box" visible="false">
										<mx:Text text="{chargeDefinition.presetAreaLabel}" width="50%" id="area_label_text" textAlign="right"/>
										<mx:TextInput text="{charge.area}" width="50%" id="area_text" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="49"/>
									</mx:HBox>
									<mx:HBox width="100%" id="up_box" visible="false">
										<mx:Text text="{chargeDefinition.presetUpLabel}" width="50%" id="up_label_text" textAlign="right"/>
										<mx:TextInput text="{charge.up}" width="50%" id="up_text" textAlign="right" focusOut="this.updatePrice()"/>
										<mx:Spacer width="49"/>
									</mx:HBox>
									<mx:HBox width="100%" id="price_box" visible="false">
										<mx:Text text="{chargeDefinition.presetPriceLabel}" width="50%" id="price_label_text" textAlign="right"/>
										<mx:TextInput text="{Snowmass.getCurrencyFormatter(false, 2).format(charge.price)}" width="50%" id="price_edit" textAlign="right" change="this.updatePriceEdit()" focusOut="this.updatePrice()"/>
										<comp:SmallThrobber visible="false" id="pricing_throbber" height="20" width="20"/>
										<mx:LinkButton width="20" id="refresh_price_btn" height="20" click="updatePrice()" visible="false">
											<mx:icon>@Embed(source='../../../../assets/refresh_small.png')</mx:icon>
										</mx:LinkButton>
									</mx:HBox>
								</mx:VBox>
							</mx:HBox>
							<mx:HBox width="100%" horizontalAlign="right">
							<mx:HBox width="100%" id="cut_description_box" visible="false">
								<mx:Spacer width="8"/>
								<mx:Text text="{cutDescription}" width="50%" id="cut_description_text" fontWeight="bold" textAlign="left"/>
								<mx:Spacer width="40"/>
							</mx:HBox>					
							<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Done')}"
									   click="doDone()"
									   width="65"
									   id="done_button"/>
							<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Add')}"
									   click="doAdd()"
									   width="65"
									   id="add_button"
									   enabled="{charge != null}"/>
							</mx:HBox>
						</mx:VBox>
					</mx:VDividedBox>
				</mx:Canvas>
			</mx:HDividedBox>

		</mx:Canvas>
	</mx:VBox>
</mx:TitleWindow>
