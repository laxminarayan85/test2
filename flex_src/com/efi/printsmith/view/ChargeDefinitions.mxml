<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:view="com.efi.printsmith.view.*" xmlns:vo="com.efi.printsmith.data.*" xmlns:comp="com.efi.printsmith.components.*" xmlns:effect="com.adobe.ac.mxeffects.*" 
				xmlns:common="com.efi.printsmith.common.components.filter.*" 
width="100%" height="100%" headerHeight="0" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.ChargeDefinitions')}"
 preinitialize="preInit();"
 implements="com.efi.printsmith.security.ISecureComponent"
 label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.ChargeDefinitions')}" name="Charge Definitions" xmlns:ns1="*" fontSize="9">
   <mx:Script source="../security/PSSecurityInclude.as" />
<mx:NumberFormatter id="pricingNumberFormatter" precision="8" />         
<mx:RemoteObject id="dataService" destination="dataService">
	<mx:method name="addChargeToCategory" fault="handleFault(event)" result="handleAddChargeToCategory(event)"/>
	<mx:method name="addChargeCategoryToCommand" fault="handleFault(event)" result="handleAddChargeCategoryToCommand(event)"/>
	<mx:method name="getChargeList" fault="handleFault(event)" result="handleLoadChargeCommandResult(event)"/>
	<mx:method name="getById" fault="handleFault(event)" result="handleRevertCharge(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="dataServiceSystemPreferences" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadSystemPreferencesResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="chargeService" destination="chargeService">
	<mx:method name="calculateChargeCostingRate" fault="handleFault(event)" result="handleChargeCostingRateResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="foldTemplateService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadFoldTemplates(event)"/>
</mx:RemoteObject>

<mx:Producer id="producer" destination="accounts"/>
<mx:Consumer id="consumer" destination="accounts" message="messageHandler(event.message)"/>
<mx:Consumer id="notification_consumer" destination="notifications" message="messageHandler(event.message)"/>

<mx:Script source="../common/scripts/StringUtils.as"/>

<mx:Script>                                   
<![CDATA[
	import mx.events.FlexEvent;
	import com.efi.printsmith.security.PSSecurityCommands;
	import com.efi.mdi.view.window.MDIWindow;
	import mx.events.CloseEvent;
	import com.efi.printsmith.common.components.filter.FilterSearchBy;
	import com.efi.printsmith.common.components.filter.FilterProperty;
	import com.efi.printsmith.data.SalesCategory;
	import com.efi.printsmith.pricing.ChargeCostingPrices;
	
	import com.efi.printsmith.events.PriceListPickerSelectEvent;
	import com.efi.printsmith.events.ChargePresetInfoEvent;
	import com.efi.printsmith.events.ChargeCostingEvent;
	import com.efi.printsmith.events.SavePriceListEvent;
	
	import com.efi.printsmith.pages.ChargeCosting;
	import com.efi.printsmith.data.ShippingMethod;
    import com.efi.printsmith.data.PriceList;
	import com.efi.printsmith.data.PriceListElement;
	import com.efi.printsmith.data.WasteChart;	
	import com.efi.printsmith.data.ChargeCost;
	import com.efi.printsmith.data.ChargeCommand;
	import com.efi.printsmith.data.ProductionLocations;
	import com.efi.printsmith.data.ChargeCategory;
	import com.efi.printsmith.data.ChargeDefinition;
    import com.efi.printsmith.data.Charge;
    import com.efi.printsmith.data.CostCenter;
    import com.efi.printsmith.data.FoldTemplate;
    import com.efi.printsmith.data.TaxTable;
    import com.efi.printsmith.data.Substrate;
    import com.efi.printsmith.data.PriceListBase;
	import com.efi.printsmith.data.ModelBase;
	import com.efi.printsmith.data.PreferencesSystem;
	import com.efi.printsmith.data.ProductCode;
	
	import com.efi.printsmith.data.enums.ChargeCostMethod;
    import com.efi.printsmith.data.enums.ChargeMethod;
	import com.efi.printsmith.data.enums.ChargeQtyType;
	import com.efi.printsmith.data.enums.ChargeInkCoverage;
	import com.efi.printsmith.data.enums.ChargeMarkupType;
	import com.efi.printsmith.data.enums.ChargePriceMethod;
	import com.efi.printsmith.data.enums.ChargeJobQuantity;
	
	import com.efi.printsmith.events.ModelAddUpdateEvent;
	import com.efi.printsmith.events.ModelGetAllEvent;
	import com.efi.printsmith.events.ModelDeleteItemEvent;
	import mx.utils.StringUtil;                     
	import mx.controls.Alert;                                         
	import mx.managers.PopUpManager;                                         
	import mx.containers.TitleWindow;                                         
	import mx.collections.ArrayCollection; 
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;         
	import mx.events.TreeEvent;                                
	import flash.events.MouseEvent;                                
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
    import mx.printing.FlexPrintJob;
    import mx.printing.PrintAdvancedDataGrid;
    import mx.printing.PrintDataGrid;
    import mx.core.Application;
    import mx.validators.*;
    import mx.events.ListEvent;
    import mx.collections.ICollectionView;
    import mx.utils.ObjectUtil;
  	import com.adobe.ac.mxeffects.Flip;
	import com.adobe.ac.mxeffects.DistortionConstants;
	import mx.rpc.IResponder;

    private var formDirty:Boolean = false;
    
    private var accounts:ArrayCollection = new ArrayCollection();
	[Bindable]                                         
    private var systemPreferences:PreferencesSystem;

	[Bindable]		
    private var enableSave:Boolean = true;

	[Bindable]                                         
	private var charge:ChargeDefinition;
                
//	[Bindable]
//	private var charges:ArrayCollection = new ArrayCollection();
//
	[Bindable]
	private var productCodes:ArrayCollection = new ArrayCollection();
	
	[Bindable]
	private var salesCategories:ArrayCollection = new ArrayCollection();

	[Bindable]                                
	private var systemPreferencesArray:ArrayCollection = new ArrayCollection();
	
		
	[Bindable]
	private var selected_area_group:String;
	
	[Bindable]
	private var selected_markup_type_group:String;
	
	
	[Bindable]
	private var pricingMethodRadioValue:String = "PiecePrice";
	
	[Bindable]
	private var chargeCommands:ArrayCollection = new ArrayCollection();

//	[Bindable]
//	private var chargeCategories:ArrayCollection = new ArrayCollection();
	
	[Bindable]
	private var costCenters:ArrayCollection = new ArrayCollection();
	
	[Bindable]
	private var locations:ArrayCollection = new ArrayCollection();

	[Bindable]
	public var tempOpen:ArrayCollection = new ArrayCollection();
	
	[Bindable]
	public var refreshSO:Boolean = false;
	
	[Bindable]
	public var selectedItem:Object = null;
	
	[Bindable]
	public var chargeCategory:ChargeCategory = null;
	
	[Bindable]
	public var chargeCommand:ChargeCommand = null;
	
	[Bindable]
	public var enableNewCommand:Boolean = true;
	
	[Bindable]
	public var enableNewCategory:Boolean = false;
	
	[Bindable]
	public var enableNewCharge:Boolean = false;
	
	[Bindable]
	public var enableDuplicate:Boolean = false;

	[Bindable]
	public var enableExport:Boolean = false;

	[Bindable]
	public var enableDelete:Boolean = false;

	[Bindable]
	public var enableRevert:Boolean = false;

	[Bindable]
	public var enablePresetInfo:Boolean = false;

	[Bindable]
	public var enableCosting:Boolean = false;

	[Bindable]
	public var qtyTypes:ArrayCollection = new ArrayCollection();
	
	[Bindable]
	public var costPricingString:String = new String("");
	
	[Bindable]
	public var foldTemplates:ArrayCollection = new ArrayCollection();
	
	[Bindable]
    [Embed("/assets/NoPricing.png")]
    private var noCostingIcon:Class;

	private var currencyValidator:CurrencyValidator = Snowmass.getCurrencyValidator();
    
    private var isDirty:Boolean = false;
    private var scrollToItem:ModelBase = null;
    
    [Bindable] private var deleteBtnEnabled:Boolean = false;
    [Bindable] private var inkCoverageLabel:String = "";
    [Bindable] private var inkPriceLabel:String = "";
    
    public function getSecurityCommand():String {
    	return PSSecurityCommands.PRICING_CHARGEDEF;
    }
	public function init(event:FlexEvent = null):void {
		consumer.subscribe();
		notification_consumer.subscribe();
		
		var mdiWin:MDIWindow = Snowmass.getInstance().containerManager.getWindowWithChild(this);
		mdiWin.title = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.ChargeDefinitions');
		     
	    charge = new ChargeDefinition();
	    fireGetAllEvent("SalesCategory", new mx.rpc.Responder(handleLoadSalesCategoryResult, handleFault));
	    fireGetAllEvent("ProductCode", new mx.rpc.Responder(handleLoadProductCodeResult, handleFault));
	    fireGetAllEvent("CostCenter", new mx.rpc.Responder(handleLoadCostCenterResult, handleFault));
	    fireGetAllEvent("ProductionLocations", new mx.rpc.Responder(handleLoadProductionLocationsResult, handleFault));
	    getChargeList(true);
		charge_stack.selectedChild = charge_blank_canvas;
		updateControlState();
		dataServiceSystemPreferences.getAll("PreferencesSystem");
		foldTemplateService.getAll("FoldTemplate");
		
		inkCoverageLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Cover0');
		inkPriceLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Price0');
	}      
	     
	private function fireGetAllEvent(modelType:String, callbacks:IResponder):void {
		var getAllEvent:ModelGetAllEvent = new ModelGetAllEvent(modelType, callbacks);
		getAllEvent.dispatch();			
	}
                                              	
	private function send():void
	{
		var message:IMessage = new AsyncMessage();
		message.body.accounts = "*";
	}
			
	private function messageHandler(message:IMessage):void
	{
	}
	
	private function handleLoadSystemPreferencesResult(ev:ResultEvent):void {
		var tempString:String;
		systemPreferencesArray = ev.result as ArrayCollection;
		
		if (systemPreferencesArray.length > 0)
		{
			systemPreferences = systemPreferencesArray.getItemAt(0) as PreferencesSystem;
			this.btnExport.enabled = systemPreferences.enablePricingSystem;
			
			tempString = systemPreferences.inkWeightSingular;
			inkCoverageLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Cover0');
			inkCoverageLabel = StringUtil.substitute(inkCoverageLabel, tempString);
			inkPriceLabel = StringUtil.substitute(inkPriceLabel, tempString); 
		}else{
			this.btnExport.enabled = false;
		}
	}
	private function doSave():void {
		if (charge_stack.selectedChild == charge_canvas && charge != null) {
			mapToCharge();		
			fireSaveEvent(charge);
		} else if (charge_stack.selectedChild == charge_category_canvas && chargeCategory != null) {
			chargeCategory.name = charge_category_name_edit.text;
			fireSaveEvent(chargeCategory);
		} else if (charge_stack.selectedChild == charge_command_canvas && chargeCommand != null) {
			chargeCommand.name = charge_command_name_edit.text;
			fireSaveEvent(chargeCommand);
		}
	}                 
	
	private function fireSaveEvent(item:ModelBase):void {
		var callbacks:IResponder = new mx.rpc.Responder(handleSaveResult, handleFault);	
		var addUpdateEvent:ModelAddUpdateEvent = new ModelAddUpdateEvent(item, callbacks);
		addUpdateEvent.dispatch();			
	}

    private function handleChargeCostingComplete(evt:ChargeCostingEvent):void {
 		if (evt.chargeCost != null) {
			charge.chargeCost = evt.chargeCost;
			chargeService.calculateChargeCostingRate(charge, null);	
		} else {
			Alert.show("Charge Cost Dialog returned a null charge cost record", "Error");
		}     	
    }

	private function doCosting():void {
	    var costingWindow:ChargeCosting = ChargeCosting(PopUpManager.createPopUp(this, ChargeCosting, true));
	    costingWindow.addEventListener(ChargeCostingEvent.CHARGECOSTINGOK, handleChargeCostingComplete);
	    if(charge != null){
	    	if (charge.chargeCost == null) {
	    		charge.chargeCost = new ChargeCost();
	    		charge.chargeCost.piecesPerHour = 1;
	    	}
	   		costingWindow.chargeCost = charge.chargeCost;
	   		costingWindow.formIsEmpty = false;
	   	}
	    PopUpManager.centerPopUp(costingWindow);
	    costingWindow.setStyle("borderAlpha", 0.9);
	}
	
	private function sampleResult(evt:Event):void {
		
	}
	
    private function charge_group_1_change(evt:Event):void {
		charge.jobQty = charge_group_1.selectedValue as String;
    }

    private function charge_group_2_change(evt:Event):void {
		if (charge_group_2.selectedValue == "Colors") {
			charge.useColors = true;
			charge.useSides = false;			
		} else if (charge_group_2.selectedValue == "Side") {
			charge.useColors = false;
			charge.useSides = true;
		} else {
			charge.useColors = false;
			charge.useSides = false;
		}
    }

    private function charge_group_3_change(evt:Event):void {
		if (charge_group_3.selectedValue == "Sheets") {
			charge.useOriginals = true;
			charge.useSignatures = false;
		} else if (charge_group_3.selectedValue == "Signatures") {
			charge.useOriginals = false;
			charge.useSignatures = true;			
		} else {
			charge.useOriginals = false;
			charge.useSignatures = false;						
		}
    }

    private function charge_group_4_change(evt:Event):void {
		if (charge_group_4.selectedValue == "xUp") {
			charge.useMultiplyUpCount = true;
			charge.useDivideByUpCount = false;
		} else if (charge_group_4.selectedValue == "/Up") {
			charge.useMultiplyUpCount = false;
			charge.useDivideByUpCount = true;			
		} else {
			charge.useMultiplyUpCount = false;
			charge.useDivideByUpCount = false;			
		}
    }
	
	private function markup_type_group_change(evt:Event):void {
		charge.markupType = markup_type_group.selectedValue as String;
	}
	
	private function area_group_change(evt:Event):void {
		if (area_group.selectedValue =="RunArea")
			charge.useRunArea = true;
		else
			charge.useRunArea = false;
	}
	
	private function handleLoadCostCenterResult(ev:ResultEvent):void {
		costCenters = ev.result as ArrayCollection;
	}

	private function handleLoadFoldTemplates(ev:ResultEvent):void {
		this.foldTemplates = ev.result as ArrayCollection;
	}	
	
	private function handleChargeCostingRateResult(ev:ResultEvent):void {
		if (this.charge.chargeCost != null && this.charge.chargeCost.speedTable == null && this.charge.chargeCost.rateTable == null) {
			var temp:String;
			var roudV:Number;
			var prices:ChargeCostingPrices = ev.result as ChargeCostingPrices;
			
			if (prices.setupPrice != 0) {
				costPricingString = Number(pricingNumberFormatter.format(prices.unitPrice)).toFixed(2) + " + " +
									Number(pricingNumberFormatter.format(prices.setupPrice + prices.materialSetupPrice)).toFixed(2);
			} else {
				costPricingString = Number(pricingNumberFormatter.format(prices.unitPrice)).toFixed(2);
			}
		} else {
			costPricingString = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'pressDefCmd.variable');
		}
	}
	
//	private function handleLoadChargeCategoryResult(ev:ResultEvent):void {
//		chargeCategories = ev.result as ArrayCollection;
//	}
	
	private function handleLoadProductionLocationsResult(ev:ResultEvent):void {
		locations = ev.result as ArrayCollection;
	}
	
	private function handleRevertCharge(ev:ResultEvent):void {
		this.charge = ev.result as ChargeDefinition;
		this.isDirty = false;	
	}
	
	private function handleLoadChargeCommandResult(ev:ResultEvent):void {
		throbber.stop();
		throbber.visible = false;
		var selectedIndex:int = this.chargeTree.selectedIndex;
		updateDataProvider();
		chargeCommands = ev.result as ArrayCollection;
		
		chargeCommands.filterFunction = filterData;
		chargeTree.selectedIndex = selectedIndex;
	}
	
	private function handleLoadProductCodeResult(ev:ResultEvent):void {
		productCodes = ev.result as ArrayCollection;
	}
	
	private function handleLoadSalesCategoryResult(ev:ResultEvent):void {
		salesCategories = ev.result as ArrayCollection;
	}
	
//	private function handleLoadChargeResult(ev:ResultEvent):void {
//		charges = ev.result as ArrayCollection;
//	}

	private function handleAddChargeCategoryToCommand(ev:ResultEvent):void {
		if (ev.result == null) {
			Alert.show("Unable to add new Category.", "Error", 0, this, null);                                 
		} else {
			charge = null;
			chargeCategory = ev.result as ChargeCategory;
			getChargeList();
			//fireGetAllEvent("ChargeCommand", new mx.rpc.Responder(handleLoadChargeCommandResult, handleFault));
		}
	}
	
	private function getChargeList(showThrobber:Boolean = false):void {
		dataService.getChargeList();
		charge_stack.selectedChild = charge_blank_canvas;
		if (showThrobber) {
			throbber.visible = true;
	    	throbber.play();
		}
		updateControlState();
	}
	
	private function handleAddChargeToCategory(ev:ResultEvent):void {
		if (ev.result == null) {
			Alert.show("Unable to add new charge.", "Error", 0, this, null);                                 
		} else {
			var localCharge:ChargeDefinition = ev.result as ChargeDefinition;

			charge = localCharge;
			costPricingString = "";
			getChargeList();
			//fireGetAllEvent("ChargeCommand", new mx.rpc.Responder(handleLoadChargeCommandResult, handleFault));
		}
	}
	
	private function handleSaveResult(ev:ResultEvent):void {
		isDirty = false;
		updateDataProvider();
	}
	                                 
	private function handleDeleteResult(ev:ResultEvent):void {
		this.chargeCommand = null;
		this.chargeCategory = null;
		this.charge = null;
		deleteBtnEnabled = false;
		getChargeList();
	}
	      
	private function handleFault(ev:FaultEvent):void {  
		var message:String;
		              
		message = "Error: "                          
		+ ev.fault.faultCode + " - "                                  
		+ ev.fault.faultDetail + " - "                                  
		+ ev.fault.faultString;
		Alert.show(message, "Error", 0, this, null);                                 
	}
	
	private function treeLabel(item:Object):String {
		var children:ICollectionView;
		
		var suffix:String = "";
		if (chargeTree.dataDescriptor.isBranch(item)) {
		    children = chargeTree.dataDescriptor.getChildren(item);
		    suffix = " (" + children.length + ")";
		}
		return item.name + suffix;
	}
	
	private function doNewCommand():void {
		var chargeCommand:ChargeCommand = new ChargeCommand();
		chargeCommand.name = "Untitled";
		dataService.addUpdate(chargeCommand);
		dataService.getChargeList();
		//fireGetAllEvent("ChargeCommand", new mx.rpc.Responder(handleLoadChargeCommandResult, handleFault));
	}
	
	private function doNewCategory():void {
		var treeItem:Object = chargeTree.selectedItem;
        var classInfo:XML = describeType(treeItem);

		if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeCommand") {
			var chargeCategory:ChargeCategory = new ChargeCategory();
			chargeCategory.name = "Untitled Category";
			dataService.addChargeCategoryToCommand(chargeCategory, treeItem);
		}
	}
	
	private function doDuplicateCharge():void {
		//TODO: verify that this copy is valid to use. We probably need to create a clone method for the .as objects.
		var newCharge:ChargeDefinition = ObjectUtil.copy(charge) as ChargeDefinition;
		var category:ChargeCategory = charge.parent;
		
		
	//	updateDataProvider();
		newCharge.id = 0;
		newCharge.parent = null;
		newCharge.name = newCharge.name +' '+ resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rStandardMenuText.Copy');
		newCharge.title = newCharge.name;
		
		dataService.addChargeToCategory(newCharge, category);
		
	}
	
	private function getSelectedTreeCommand(deep:Boolean):ChargeCommand {
		var treeItem:Object = chargeTree.selectedItem;
		if (treeItem == null) return null;
		
        var classInfo:XML = describeType(treeItem);

		if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeCommand") {
			return treeItem as ChargeCommand;
		}
		if (deep) {
			if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeDefinition") {
				var tmpCategory:ChargeCategory = treeItem.parent as ChargeCategory;
				if (tmpCategory != null) {
					return tmpCategory.parent;
				}
				return chargeTree.getParentItem(tmpCategory);
			} else {
				return treeItem as ChargeCommand;				
			}
		}
		return null;
	}
	
	private function getSelectedTreeCategory(deep:Boolean):ChargeCategory {
		var treeItem:Object = chargeTree.selectedItem;
        var classInfo:XML = describeType(treeItem);

		if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeCategory") {
			return treeItem as ChargeCategory;
		}
		
		if (deep) {
			if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeDefinition") {
				return treeItem.parent as ChargeCategory;
			}
		}
		return null
	}
	
	private function getSelectedTreeCharge():ChargeDefinition {
		var treeItem:Object = chargeTree.selectedItem;
        var classInfo:XML = describeType(treeItem);

		if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeDefinition") {
			return treeItem as ChargeDefinition;
		}
		return null;
	}

	private function treeSelectionChanged(event:Event):void {
		if (this.isDirty) {
			var infoStr:String;
			if (this.charge != null) {
				infoStr = StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'INFO.Doyouwanttosavethech'), charge.title);
				Alert.show(infoStr,"Warning",Alert.YES|Alert.NO|Alert.CANCEL,this,handleConfirmSaveCharge,null,Alert.YES);
			}
		} else {
			updateTreeSelection();
		}
	}
	
	private function handleConfirmSaveCharge(event:CloseEvent):void {
		if (event.detail == Alert.YES) { 
			this.doSave();
			updateTreeSelection();
		} else if (event.detail == Alert.CANCEL) {
			if (charge != null) {
				var treeItem:ModelBase = findItemInChargeTree(charge.id);				
				if (treeItem != null) {
					chargeTree.selectedItem = treeItem;
				}
			}
		} else {
			updateTreeSelection();
		}
	}
	

	private function updateTreeSelection():void {
		var selectedCharge:ChargeDefinition = getSelectedTreeCharge();
		if (selectedCharge == null) {
			charge = null;
			chargeCategory = getSelectedTreeCategory(false);
			if (chargeCategory == null) {
				chargeCommand = getSelectedTreeCommand(false);
				if (chargeCommand == null) {
					charge_stack.selectedChild = charge_blank_canvas;
				} else {
					charge_stack.selectedChild = charge_command_canvas;
				}
			} else {
				charge_stack.selectedChild = charge_category_canvas;			
				chargeCommand = getSelectedTreeCommand(true);
			}
		} else {
			if (selectedCharge != charge) {
				charge = selectedCharge;
				isDirty = false;
				costPricingString = "";
				chargeService.calculateChargeCostingRate(charge, null);		
				MapfromChargeData();
			}
			charge_stack.selectedChild = charge_canvas;
			chargeCategory = getSelectedTreeCategory(true);
			chargeCommand = getSelectedTreeCommand(true);
		}	
		updateButtons();
	
		updateControlState();
	}
	
	private function doNewCharge():void {
		var category:ChargeCategory = getSelectedTreeCategory(true);
		chargeTree.validateNow();
		chargeTree.expandItem(category, true);
//		if ((chargeTree.openItems as Array).indexOf(category) == -1) {
//			(chargeTree.openItems as Array).push(category);
//		}
		chargeTree.validateNow();
		var localCharge:ChargeDefinition = new ChargeDefinition();
		
		if (category != null) {
			localCharge = new ChargeDefinition();				
			localCharge.name = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.untitled');
			localCharge.title = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.untitled');
			localCharge.method = ChargeMethod.Ask;
			localCharge.quantityType = ChargeQtyType.Quantity;
			localCharge.priceMethod = "PiecePrice";
			localCharge.presetDescriptionLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Description');
			localCharge.presetInSetsOfLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Insetsof');
			localCharge.presetMaterialRateLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Material');
			localCharge.presetMaterialQuantityLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.MtrlQty');
			localCharge.presetMaterialSetsOfLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Insetsof');
			localCharge.presetNotesLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Notes');
			localCharge.presetPriceLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Price');
			localCharge.presetQuantityLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Quantity');
			localCharge.presetQuantityPerSetLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Qtyset');
			localCharge.presetRateLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Rate');
			localCharge.presetSetupLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Setup');
			localCharge.presetUpLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Up');
			localCharge.presetTimeStartLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Timestart');
			localCharge.presetTimeStopLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Timestop');
			localCharge.presetNumberOfColorsLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.ofColors');
			localCharge.presetCoverageLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.PctCoverage');
			localCharge.presetPricePerPoundLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Price0');
			localCharge.presetPoundsOfInkLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.0ofInk');
			localCharge.presetTotalWeightLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.TotalWeight');
			localCharge.presetAreaLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Area');
			localCharge.presetUpLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Up');
			localCharge.presetCutsLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Cuts');				
			localCharge.presetSheetsPerLiftLabel = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.SheetsLift');				

			dataService.addChargeToCategory(localCharge, category);
		}
	}
	
	private function handleDeleteCharge(event:CloseEvent):void {
		if (event.detail == Alert.OK) {
			scrollToItem = this.charge.parent;
			fireDeleteEvent(this.charge, new mx.rpc.Responder(handleDeleteResult, handleFault));
		}
	}
	
	private function handleDeleteCategory(event:CloseEvent):void {
		if (event.detail == Alert.OK) {
			if(this.chargeCategory!=null){
				var catIndex:int = getNextCategoryIndex();
				if (catIndex != -1) {
					if (catIndex < this.chargeCategory.parent.children.length) {
						scrollToItem = this.chargeCategory.parent.children.getItemAt(catIndex) as ModelBase;
					} else {
						scrollToItem = this.chargeCategory.parent;
					}
				} else {
					scrollToItem = this.chargeCategory.parent;
				}
				if(this.chargeCategory.children!=null && this.chargeCategory.children.length>0){
					var deleteStr:String = resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'chargeDefCmd.OKtodeletetheentirec');
					deleteStr = deleteStr+"\n"+StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Thiswillaffectthe4ch'),null,null,null,null,this.chargeCategory.children.length);
					Alert.show(deleteStr,"Warning",Alert.OK|Alert.CANCEL,this,function(event:CloseEvent):void {
						if(event.detail == Alert.OK) {
							fireDeleteEvent(chargeCategory, new mx.rpc.Responder(handleDeleteResult, handleFault));
						}
					},null,Alert.OK);
				} else {
					fireDeleteEvent(this.chargeCategory, new mx.rpc.Responder(handleDeleteResult, handleFault));
				}
			}
		}
	}
	
	private function getNextCategoryIndex():int {
		var i:int = 0;
		
		if (chargeCategory == null || chargeCategory.parent == null) return -1;
		
		for (i = 0; i < chargeCategory.parent.children.length ; i++) {
			if (chargeCategory.id == (chargeCategory.parent.children.getItemAt(i) as ModelBase).id) {
				if (i == chargeCategory.parent.children.length-1) {
					return i-1; /* return previous element in this case */
				} else {
					return i+1; /* not the last element so return next element */
				}
			}
		}
		
		return -1;
	}
	
	private function handleDeleteCommand(event:CloseEvent):void {
		if (event.detail == Alert.OK) 
			fireDeleteEvent(this.chargeCommand, new mx.rpc.Responder(handleDeleteResult, handleFault));
	}
		
	private function doDelete():void {
		var deleteStr:String;
		if(chargeTree.selectedItem!=null && deleteBtnEnabled){
			if (chargeTree.selectedItem is ChargeCategory) {
				this.chargeCategory = chargeTree.selectedItem as ChargeCategory;
				deleteStr = StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'msg_Oktodelete0'), this.chargeCategory.name);
				Alert.show(deleteStr,"Warning",Alert.OK|Alert.CANCEL,this,handleDeleteCategory,null,Alert.OK);
			} else if (chargeTree.selectedItem is ChargeDefinition) {
				this.charge = chargeTree.selectedItem as ChargeDefinition; 
				deleteStr = StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'msg_Oktodelete0'), this.charge.title);
				Alert.show(deleteStr,"Warning",Alert.OK|Alert.CANCEL,this,handleDeleteCharge,null,Alert.OK);
			} else if (chargeTree.selectedItem is ChargeCommand) {
				this.chargeCommand = chargeTree.selectedItem as ChargeCommand;
				deleteStr = StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'msg_Oktodelete0'), this.chargeCommand.title);
				Alert.show(deleteStr,"Warning",Alert.OK|Alert.CANCEL,this,handleDeleteCommand,null,Alert.OK);
			}
		}
		/* if (this.charge != null) {
			deleteStr = StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'msg_Oktodelete0'), charge.title);
			Alert.show(deleteStr,"Warning",Alert.OK|Alert.CANCEL,this,handleDeleteCharge,null,Alert.OK);
		} else if (this.chargeCategory != null) {
			deleteStr = StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'msg_Oktodelete0'), chargeCategory.name);
			Alert.show(deleteStr,"Warning",Alert.OK|Alert.CANCEL,this,handleDeleteCategory,null,Alert.OK);
		} else if (this.chargeCommand != null) {
			deleteStr = StringUtil.substitute(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'msg_Oktodelete0'), chargeCommand.name);
			Alert.show(deleteStr,"Warning",Alert.OK|Alert.CANCEL,this,handleDeleteCommand,null,Alert.OK);
		} */
	}

	private function doRevert():void {
		dataService.getById("ChargeDefinition", this.charge.id); // TODO: Need to be working on a copy rather than reverting from server...
	}
	
	private function fireDeleteEvent(item:ModelBase, callbacks:IResponder):void {
		var deleteEvent:ModelDeleteItemEvent = new ModelDeleteItemEvent(item, callbacks);
		deleteEvent.dispatch();			
	}

	private function selectCharge():void {
		
	}
	private function MapfromChargeData():void{
		if( charge != null){
	
			if (charge.method.length > 0)
				charge_method_combo.selectedIndex = findItem(charge.method,ChargeMethod.toArray());
			cut_prepress_radio.selected = charge.cutsArePrePress;
			Ignorecuts_radio.selected = charge.ignoreCuts;
			pricingMethodRadioValue = charge.priceMethod;
			UpdatePriceMethod();
			markup_type_group.selectedValue = charge.markupType;
			if(charge.useArea){
				if(charge.useRunArea)
					area_group.selectedValue = "RunArea";
				else
					area_group.selectedValue = "FinishArea";
			}
			updateQtyComboBox(charge.method);
			if( charge.costCenter != null){
				cost_center_combo.selectedIndex = findItem2(charge.costCenter.name, costCenters);
				if ( cost_center_combo.selectedIndex == -1)
					cost_center_combo.text = "";
			}
			else{
				cost_center_combo.selectedIndex = -1;
				cost_center_combo.text = "";
			}
			//cej
			if( charge.location != null){
				location_combo.selectedIndex = findItem2(charge.location.name, locations);
				if ( location_combo.selectedIndex == -1)
					location_combo.text = "";
			}
			else{
				location_combo.selectedIndex = -1;
				location_combo.text = "";	
			}
			if (charge.productCode != null){
				product_code_combo.selectedIndex = findItem2(charge.productCode.name, productCodes)
				if( product_code_combo.selectedIndex == -1)
					product_code_combo.text = "";
				
			}else{
				product_code_combo.selectedIndex = -1;
				product_code_combo.text= "";
			}
		
			charge_quantity_combo.selectedIndex = findItem(charge.quantityType,qtyTypes.toArray());
			if (charge.salesCategory != null) {
				charge_sales_category_combo.selectedIndex = findItem2(charge.salesCategory.name, salesCategories);
			}
			
			if (charge.foldTemplate != null && charge.foldTemplate.id != 0) {
				this.fold_template_combo.selectedIndex = findItem2(charge.foldTemplate.name, this.foldTemplates);
			} else {
				this.fold_template_combo.selectedIndex = -1;
			}
			
			charge_group_1.selectedValue = charge.jobQty;
			if(charge.useColors)
				charge_group_2.selectedValue = "Colors";
			else if (charge.useSides)
				charge_group_2.selectedValue = "Sides";
			else
				charge_group_2.selectedValue = "NA";
			
			if(charge.useSignatures)
				charge_group_3.selectedValue = "Signatures";
			else if(charge.useOriginals)
				charge_group_3.selectedValue = "Sheets";
			else
				charge_group_3.selectedValue = "NA";
				
			if (charge.useMultiplyUpCount)
				charge_group_4.selectedValue = "xUp";
			else if (charge.useDivideByUpCount)
				charge_group_4.selectedValue = "/Up";
			else
				charge_group_4.selectedValue = "NA";
			
			waste_chart_link.label = wasteChartLabel();	
			price_list_link.label = priceListLabel();	
			UpdateAdjset();
			UpdateAdj();	
		}
	}
	
	private function findItem(name:String, array:Array):int {
		for each(var element:Object in array) {
			if (name == element.data) {
				return array.indexOf(element);
			}
		}
		return -1;
	}
	
	private function findItem2(name:String, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (name == element.name) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	
	private function findItemInChargeTree(id:Number):ModelBase {
		for each(var commandItem:ChargeCommand in chargeTree.dataProvider) {
			if (id == commandItem.id) {
				return commandItem;
			} else {
				for each(var categoryItem:ChargeCategory in commandItem.children) {
					if (id == categoryItem.id) {
						return categoryItem;
					} else {
						for each(var chargeItem:ChargeDefinition in categoryItem.children) {
							if (id == chargeItem.id) {
								return chargeItem;
							}
						}
					}
				}
			}
		}
		return null;
	}
	
	private function mapToCharge():void {
		charge.title = charge_name_edit.text;
		charge.name = charge_name_edit.text;
		charge.location = location_combo.selectedItem as ProductionLocations;
		charge.costCenter = cost_center_combo.selectedItem as CostCenter;
		charge.method = charge_method_combo.selectedItem.data as String;
		charge.quantityType = charge_quantity_combo.selectedItem.data as String;
		charge.salesCategory = charge_sales_category_combo.selectedItem as SalesCategory;
		charge.productCode = product_code_combo.selectedItem as ProductCode;
		charge.ignoreCuts = Ignorecuts_radio.selected;
		charge.cutsArePrePress = cut_prepress_radio.selected;
		
		
		if (pricing_method.selectedValue != null)
			charge.priceMethod = pricing_method.selectedValue.toString();

		charge.noOverrides = no_overrides_check.selected;
		charge.adjustableSets = adjustable_sets_check.selected;
		charge.adjustableRate = adjustable_rate_check.selected;
		charge.adjustableMaterial = adjustable_material_check.selected;
		charge.adjustUps = adjustable_up_check.selected;
		charge.doNotDiscount = do_not_discount_check.selected;
		charge.hidePrice = hide_price_only_check.selected;
		charge.hideChargeInPrintouts = hide_charge_in_printouts_check.selected;
		charge.binderyCharge = bindery_operation_check.selected;
		charge.excludedFromWorkflow = excluded_from_workflow_check.selected;
		charge.preproduction = tracker_pre_production_check.selected;
		charge.ignoreGlobalPriceChanges = ignore_global_price_changes_check.selected;
		charge.integratedCTP = integrated_ctp_device_check.selected;
		charge.fixedWaste = parseInt(fixed_spoilage_edit.text);
		charge.baseLinearNumber = parseInt(base_linear_quantity_edit.text);
		charge.useMinimumCharge = minimum_charge_check.selected;
		charge.minimum = parseCurrencyFloat(minimum_charge_edit.text);
		charge.useMinimumTime = minimum_time_check.selected;
		charge.minimumTime = parseCurrencyFloat(minimum_time_edit.text);

		// Note: Radio buttons are updated dynamically via change events (see charge_group_1_change, etc.)
		charge.markup = parseCurrencyFloat(markup_edit.text);
		charge.useSetup = setup_check.selected;
		
		
		charge.setupPrice = parseCurrencyFloat(setup_edit.text);
		charge.useRate = rate_check.selected;
		charge.rate = parseCurrencyFloat(rate_edit.text);
		charge.useMaterial = material_check.selected;
		charge.material = parseCurrencyFloat(material_edit.text);

		charge.useRateSets = in_sets_check.selected;
		//charge.rateSetCount = parseInt(in_sets_edit.text);
		charge.rateSetCount = parseCurrencyFloat(in_sets_edit.text);
		charge.useArea =  area_check.selected;
		charge.area= parseCurrencyFloat(area_edit.text);
		charge.sheet_lift_check = sheet_lift_check.selected;
		charge.sheetliftCut= parseCurrencyFloat(sheet_lift_edit.text);
		charge.coverlb_check= cover_ink_check.selected;
		charge.coverlbInk = parseCurrencyFloat(cover_ink_edit.text);
		charge.ship_markup_check = ship_markup_check.selected;
		charge.shipMarkup= parseCurrencyFloat(ship_markup_edit.text);
		charge.useMaterialSets =  in_set_mat_check.selected;
		//charge.materialSetCount = parseInt(in_sets_mat_edit.text);
		charge.materialSetCount = parseCurrencyFloat(in_sets_mat_edit.text);
		
		if (this.fold_template_combo.visible == true) {
			charge.foldTemplate = this.fold_template_combo.selectedItem as FoldTemplate;
		}
	}
	
	private function updateQtyComboBox(chargeMethod:String):void {
		var index:int;
		var i:int;
		index = charge_quantity_combo.selectedIndex;
		qtyTypes.removeAll();
		qtyTypes = new ArrayCollection(ChargeQtyType.toArray());
		switch (chargeMethod) {
		case ChargeMethod.Ask: 
			for (i = qtyTypes.length-1; i  >= 0 ; i--) {
				if (qtyTypes.getItemAt(i).data == ChargeQtyType.TotalWeight) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.ShippingQty) {
					qtyTypes.removeItemAt(i);
				}
			}
//			qtyTypes.addItem(ChargeQtyType.Sets);
//			qtyTypes.addItem(ChargeQtyType.Quantity);
//			qtyTypes.addItem(ChargeQtyType.Time);
//			qtyTypes.addItem(ChargeQtyType.None);
//			qtyTypes.addItem(ChargeQtyType.SetupSets);
			break;
		case ChargeMethod.Cut:
			for (i = qtyTypes.length-1; i  >= 0 ; i--) {
				if (qtyTypes.getItemAt(i).data == ChargeQtyType.Quantity) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.Time) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.None) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.TotalWeight) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.ShippingQty) {
					qtyTypes.removeItemAt(i);
				}
			}
//			qtyTypes.addItem(ChargeQtyType.Sets);
//			qtyTypes.addItem(ChargeQtyType.SetupSets);
			break;
		case ChargeMethod.FlatRate:
		case ChargeMethod.Markup:
			for (i = qtyTypes.length-1; i  >= 0 ; i--) {
				if (qtyTypes.getItemAt(i).data == ChargeQtyType.Sets) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.Quantity) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.Time) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.SetupSets) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.TotalWeight) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.ShippingQty) {
					qtyTypes.removeItemAt(i);
				}
			}
//			qtyTypes.addItem(ChargeQtyType.None);
			break;
		case ChargeMethod.Fold:
		case ChargeMethod.JobAware:
		case ChargeMethod.Linear:
			// Remove unused elements
			for (i = qtyTypes.length-1; i  >= 0 ; i--) {
				if (qtyTypes.getItemAt(i).data == ChargeQtyType.Time) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.None) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.TotalWeight) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.ShippingQty) {
					qtyTypes.removeItemAt(i);
				}
			}
//			qtyTypes.addItem(ChargeQtyType.Sets);
//			qtyTypes.addItem(ChargeQtyType.Quantity);
//			qtyTypes.addItem(ChargeQtyType.SetupSets);
			break;
		case ChargeMethod.Ink:
			for (i = qtyTypes.length-1; i  >= 0 ; i--) {
				if (qtyTypes.getItemAt(i).data == ChargeQtyType.Time) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.None) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.SetupSets) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.TotalWeight) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.ShippingQty) {
					qtyTypes.removeItemAt(i);
				}
			}
//			qtyTypes.addItem(ChargeQtyType.Sets);
//			qtyTypes.addItem(ChargeQtyType.Quantity);
			break;
		case ChargeMethod.PriceList:
		case ChargeMethod.RateList:
			for (i = qtyTypes.length-1; i  >= 0 ; i--) {
				if (qtyTypes.getItemAt(i).data == ChargeQtyType.Time) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.None) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.SetupSets) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.TotalWeight) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.ShippingQty) {
					qtyTypes.removeItemAt(i);
				}
			}
//			qtyTypes.addItem(ChargeQtyType.Quantity);
			break;
		case ChargeMethod.Shipping:
			for (i = qtyTypes.length-1; i  >= 0 ; i--) {
				if (qtyTypes.getItemAt(i).data == ChargeQtyType.Sets) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.Quantity) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.Time) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.None) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.SetupSets) {
					qtyTypes.removeItemAt(i);
				}
			}
//			qtyTypes.addItem(ChargeQtyType.TotalWeight);
//			qtyTypes.addItem(ChargeQtyType.ShippingQty);
			break;
		case ChargeMethod.SquareArea:
			for (i = qtyTypes.length-1; i  >= 0 ; i--) {
				if (qtyTypes.getItemAt(i).data == ChargeQtyType.Time) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.None) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.SetupSets) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.TotalWeight) {
					qtyTypes.removeItemAt(i);
				} else if (qtyTypes.getItemAt(i).data == ChargeQtyType.ShippingQty) {
					qtyTypes.removeItemAt(i);
				}
			}
//			qtyTypes.addItem(ChargeQtyType.Sets);
//			qtyTypes.addItem(ChargeQtyType.Quantity);
			break;
		}
		charge_quantity_combo.selectedIndex = index;
	}
	
	private function updateControlState():void {
		var newCanvas:Canvas=blank_canvas;
		if (charge_method_combo.selectedItem != null)
			updateQtyComboBox(charge_method_combo.selectedItem.data);
		if (charge_method_combo.selectedItem.data == ChargeMethod.Ask) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = false;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = true;
			waste_chart_button.enabled = true;
			newCanvas = blank_canvas;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = true;
			in_sets_edit.visible = true;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = false;
			run_area_radio.visible = false;
			minimum_charge_check.enabled = true;
			minimum_time_check.enabled = true;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible = false;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
		} else if (charge_method_combo.selectedItem.data == ChargeMethod.Cut) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = true;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = true;
			waste_chart_button.enabled = true;
			newCanvas = job_aware_canvas;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = false;
			in_sets_edit.visible = false;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = true;
			sheet_lift_edit.visible = true;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = false;
			run_area_radio.visible = false;
			minimum_charge_check.enabled = true;
			minimum_time_check.enabled = true;
			cut_prepress_radio.visible = true;
			Ignorecuts_radio.visible =true;
			charge_group_2.enabled = false;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
		} else if (charge_method_combo.selectedItem.data == ChargeMethod.FlatRate) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = false;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = false;
			waste_chart_button.enabled = false;
			newCanvas = blank_canvas;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = true;
			in_sets_edit.visible = true;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = false;
			label4.visible = false;
			finished_area_radio.visible = false;
			run_area_radio.visible = false;
			minimum_charge_check.enabled = false;
			minimum_time_check.enabled = false;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible =false;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
	 	} else if (charge_method_combo.selectedItem.data == ChargeMethod.Fold) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = true;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			newCanvas = job_aware_canvas;
			price_list_button.enabled = true;
			waste_chart_button.enabled = true;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = true;
			in_sets_edit.visible = true;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = false;
			run_area_radio.visible = false;
			minimum_charge_check.enabled = true;
			minimum_time_check.enabled = false;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible =false;
			charge_group_2.enabled = true;
			fold_template_label.visible = true;
			fold_template_combo.visible = true;
	 	} else if (charge_method_combo.selectedItem.data == ChargeMethod.Ink) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = true;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = true;
			waste_chart_button.enabled = false;
			newCanvas = job_aware_canvas;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = false;
			in_sets_edit.visible = false;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = true;
			cover_ink_edit.visible = true;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = true;
			run_area_radio.visible = true;
			minimum_charge_check.enabled = true;
			minimum_time_check.enabled = false;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible =false;
			charge_group_2.enabled = true;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
	 	} else if (charge_method_combo.selectedItem.data == ChargeMethod.JobAware) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = true;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = true;
			waste_chart_button.enabled = true;
			newCanvas = job_aware_canvas;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = true;
			in_sets_edit.visible = true;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = false;
			run_area_radio.visible = false;
			minimum_charge_check.enabled = true;
			minimum_time_check.enabled = false;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible =false;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
		} else if (charge_method_combo.selectedItem.data == ChargeMethod.Linear) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = true;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = true;
			waste_chart_button.enabled = true;
			newCanvas = job_aware_canvas;
			base_linear_quantity_edit.visible = true;	
			label3.visible =true;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = true;
			in_sets_edit.visible = true;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = true;
			run_area_radio.visible = true;
			minimum_charge_check.enabled = true;
			minimum_time_check.enabled = false;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible =false;
			charge_group_2.enabled = true;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
	 	} else if (charge_method_combo.selectedItem.data == ChargeMethod.Markup) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = false;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = true;
			waste_chart_button.enabled = false;
			newCanvas = markup_canvas;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = true;
			in_sets_edit.visible = true;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = false;
			run_area_radio.visible = false;
			minimum_charge_check.visible = true;
			minimum_time_check.enabled = false;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible =false;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
	 	} else if (charge_method_combo.selectedItem.data == ChargeMethod.PriceList) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = false;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = true;
			waste_chart_button.enabled = true;
			newCanvas = blank_canvas;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = true;
			in_sets_edit.visible = true;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = false;
			run_area_radio.visible = false;
			minimum_charge_check.visible = true;
			minimum_time_check.enabled = false;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible =false;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
	 	} else if (charge_method_combo.selectedItem.data == ChargeMethod.RateList) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = false;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = true;
			waste_chart_button.enabled = true;
			newCanvas = blank_canvas;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = true;
			in_sets_edit.visible = true;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = false;
			run_area_radio.visible = false;
			minimum_charge_check.visible = true;
			minimum_time_check.enabled = false;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible =false;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
	 	} else if (charge_method_combo.selectedItem.data == ChargeMethod.Shipping) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = false;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = true;
			waste_chart_button.enabled = false;
			newCanvas = blank_canvas;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = false;
			area_check.visible = false;
			in_sets_check.visible = false;
			in_sets_edit.visible = false;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = true;
			ship_markup_edit.visible = true;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = false;
			run_area_radio.visible = false;
			minimum_charge_check.visible = true;
			minimum_time_check.enabled = false;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible =false;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
	 	} else if (charge_method_combo.selectedItem.data == ChargeMethod.SquareArea) {
			no_overrides_check.enabled = true;
			do_not_discount_check.enabled = true;
			hide_price_only_check.enabled = true;
			hide_charge_in_printouts_check.enabled = true;
			bindery_operation_check.enabled = true;
			excluded_from_workflow_check.enabled = true;
			tracker_pre_production_check.enabled = true;
			ignore_global_price_changes_check.enabled = true;
			integrated_ctp_device_check.enabled = true;
			price_list_button.enabled = true;
			waste_chart_button.enabled = true;
			newCanvas = job_aware_canvas;
			base_linear_quantity_edit.visible = false;	
			label3.visible =false;
			area_edit.visible = true;
			area_check.visible = true;
			in_sets_check.visible = false;
			in_sets_edit.visible = false;
			in_set_mat_check.visible = true;
			in_sets_mat_edit.visible = true;
			sheet_lift_check.visible = false;
			sheet_lift_edit.visible = false;
			cover_ink_check.visible = false;
			cover_ink_edit.visible = false;
			ship_markup_check.visible = false;
			ship_markup_edit.visible = false;
			fixed_spoilage_edit.visible = true;
			label4.visible = true;
			finished_area_radio.visible = true;
			run_area_radio.visible = true;
			minimum_charge_check.visible = true;
			minimum_time_check.enabled = false;
			cut_prepress_radio.visible = false;
			Ignorecuts_radio.visible =false;
			charge_group_2.enabled = true;
			fold_template_label.visible = false;
			fold_template_combo.visible = false;
		}
		if (this.charge_method_combo.selectedItem.data == ChargeMethod.Ink) {
			this.rate_check.label = inkPriceLabel; 
		} else {
			this.rate_check.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Rate');
		}
		price_calc_stack.selectedChild = newCanvas;	
		UpdatePriceMethod();	
	}
	private function changeChargeMethod(event:ListEvent):void {
		updateControlState();
		if (charge_method_combo.selectedItem.data == ChargeMethod.PriceList || 
		    charge_method_combo.selectedItem.data == ChargeMethod.RateList) {
			if (charge.priceList == null) {
				this.doPriceList();
			}
		}
		this.isDirty = true;
	}
	
	private function tree_itemClick(evt:Event):void {
		if(evt.currentTarget.selectedItem!=null){
//			if(evt.currentTarget.selectedItem is ChargeCommand) {
//				deleteBtnEnabled = false;
//			} else {
				deleteBtnEnabled = true;
//			}
		} else if(evt.currentTarget.selectedItem==null){
			deleteBtnEnabled = false;
		}
	}
	
	private function updateDataProvider():void {
		tempOpen = new ArrayCollection();
		chargeTree.validateNow();
		var openItems:Array = chargeTree.openItems as Array;
		var i:int;
		
		for (i=0; i<openItems.length; i++) {
			tempOpen.addItem(openItems[i].id);
		}
		refreshSO = true;	
	}

	/* The charge that's returned by the server is not the same object
	   as its equivalent in the tree. Search the tree for the charge and
	   replace the charge object in the tree */	
	private function setCurrentChargeToTreeItem():void {
		var found:Boolean = false;
        var i:int;
        var j:int;
        var k:int;
        
        if (chargeCommand == null) return;
       	for (i = 0; i < chargeCommands.length; i++ ) {
       		var localChargeCommand:ChargeCommand = chargeCommands.getItemAt(i) as ChargeCommand;
       		if (chargeCategory == null) {
       			if (localChargeCommand.id == chargeCommand.id) {
       				chargeCommand = localChargeCommand;
       				found = true;
       			}
       		} else if (localChargeCommand.children != null) {
	       		for (j = 0; j < localChargeCommand.children.length; j++) {
	       			var localChargeCategory:ChargeCategory = localChargeCommand.children.getItemAt(j) as ChargeCategory;
	       			if (charge == null) {
	       				if (localChargeCategory.id == chargeCategory.id) {
	       					chargeCategory = localChargeCategory;
	       					chargeCommand = chargeCategory.parent;
	       					found = true;
	       					break;
	       				}
	       			} else if (localChargeCategory.children != null) {
	       				for (k = 0; k < localChargeCategory.children.length; k++) {
		       				var chargeDefinition:ChargeDefinition = localChargeCategory.children.getItemAt(k) as ChargeDefinition;
		       				if (chargeDefinition.id == charge.id) {
		       					charge = chargeDefinition;
								if (charge != null) {
									chargeService.calculateChargeCostingRate(charge, null);
								}
								chargeCategory = charge.parent;
		       					chargeCommand = chargeCategory.parent;
		       					found = true;
		       					break;
		       				}
		       			}
	       			}
	       			if (found) break;
	       		}
       		}
       		if (found) break;
       	}
	}
	
	private function tree_iconFunction(item:Object):Class {
		var iconClass:Class = null;
	
		if (!(item is ChargeCommand) && !(item is ChargeCategory)) {
			if ((item as ChargeDefinition).chargeCost == null ||
				(item as ChargeDefinition).chargeCost.initialized == false) {
					
				iconClass = this.noCostingIcon;
			}
		}
		
		return iconClass;
	}
	
	private function renderFunction():void {
		if (refreshSO) {
			refreshSO = false;
			
           	chargeTree.invalidateList();
           	var openItems:Array = new Array();
           	var i:int;
           	var j:int;
           	
           	for (i = 0; i < chargeCommands.length; i++) {
           		var chargeCommand:ChargeCommand = chargeCommands.getItemAt(i) as ChargeCommand;
           		if (tempOpen.contains(chargeCommand.id)) {
           			openItems.push(chargeCommand);
           		}
           		
           		for (j=0; j<chargeCommand.children.length; j++) {
           			if (tempOpen.contains(chargeCommand.children.getItemAt(j).id)) {
           				openItems.push(chargeCommand.children.getItemAt(j));
           			}
           		}
           	}
           	
			setCurrentChargeToTreeItem();
           	if (charge != null) {
				if (charge.parent != null) openItems.push(charge.parent);
           	}
           	
           	if (chargeCategory != null) {
           		if (chargeCategory.parent != null) openItems.push(chargeCategory.parent);
           	}
           	
			chargeTree.openItems = openItems;
			chargeTree.validateNow();
			
			var treeItem:ModelBase = null;
	        if (scrollToItem != null) {
				var treeItem:ModelBase = null;
				treeItem = findItemInChargeTree(scrollToItem.id);
				chargeTree.selectedItem = treeItem;
				if(chargeTree.selectedItem is ChargeCommand){
					deleteBtnEnabled = false;
				} else {
					deleteBtnEnabled = true;
				}
				scrollToItem = null;				
			} else {
				if (charge != null) {
					treeItem = findItemInChargeTree(charge.id);				
				} else if (chargeCategory != null) {
					treeItem = findItemInChargeTree(chargeCategory.id);				
				} else if (chargeCommand != null) {
					treeItem = findItemInChargeTree(chargeCommand.id);				
				}
				if (treeItem != null) {
					chargeTree.selectedItem = treeItem;
				}
			}
			updateTreeSelection();
		}
	}

	private function refreshData():void{
		//reset the root node to its original unfiltered data
		var i:int;
		for (i=0; i< chargeCommands.length; i++) {
			chargeCommands[i].children = new ArrayCollection(chargeCommands[i].children.source);
			refreshRecursiveChildren(chargeCommands.source[i]);
		} 
		//update the Tree after the data has been filtered
		chargeCommands.refresh();
		chargeTree.invalidateList();
	}
	
	private function refreshRecursiveChildren(item:Object):void{
        var classInfo:XML = describeType(item);

		if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeCommand" && item.children != null) {
			//loop through each child and filter its children
			for each(var chargeCategoryItem:ChargeCategory in item.children.source){
				refreshRecursiveChildren(chargeCategoryItem);
			}
			item.children = new ArrayCollection(item.children.source);
			item.children.filterFunction = filterData;
			item.children.refresh();
		} else if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeCategory" && item.children != null) {
			//loop through each child and filter its children
			for each(var chargeItem:ChargeDefinition in item.children.source){
				refreshRecursiveChildren(chargeItem);
			}
			item.children = new ArrayCollection(item.children.source);
			item.children.filterFunction = filterData;
			item.children.refresh();
		}
	}
	
	public function filterData(item:Object):Boolean{
		//get the string to filter the nodes by
		var searchString:String = ""; //tree_filter.text;
		//if string is found in node return true.
		//since the recursive filtering takes place from bottom up, if
		//a collection still has children after filtering, also return true
		if(searchString.length == 0 || item.name.toLowerCase().indexOf(searchString.toLowerCase()) >= 0)
			return true;
					
        var classInfo:XML = describeType(item);

		if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeCommand") {
			return false;
		}
		if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeCommand" && item.children != null && item.children.length > 0) {
			return true;
		}
		if (classInfo.@name.toString() == "com.efi.printsmith.data::ChargeCategory" && item.children != null && item.children.length > 0) {
			return true;
		}
		return false;
	}
	private function doPressPriceList():void {
	    var priceListPickerWindow:PriceListPicker = PriceListPicker(PopUpManager.createPopUp(this, PriceListPicker, true));
	    priceListPickerWindow.setStyle("borderAlpha", 0.9);
	    priceListPickerWindow.itemType = "PriceList";
	    priceListPickerWindow.addEventListener(PriceListPickerSelectEvent.CANCELSELECTPRICELIST, handlePriceListPickerCancel);
	    priceListPickerWindow.addEventListener(PriceListPickerSelectEvent.SELECTPRICELIST, handleSelectPriceList);
	   
	}

	private function doPriceList():void {
	    var priceListPickerWindow:PriceListPicker = PriceListPicker(PopUpManager.createPopUp(this, PriceListPicker, true));
	    priceListPickerWindow.setStyle("borderAlpha", 0.9);
	    priceListPickerWindow.itemType = "PriceList";
	    if( charge.priceList != null)
	    	priceListPickerWindow.setPriceList(charge.priceList);
	    priceListPickerWindow.addEventListener(PriceListPickerSelectEvent.CANCELSELECTPRICELIST, handlePriceListPickerCancel);
	    priceListPickerWindow.addEventListener(PriceListPickerSelectEvent.SELECTPRICELIST, handleSelectPriceList);
	    priceListPickerWindow.addEventListener(PriceListPickerSelectEvent.CLEARPRICELIST, handleClearPriceList);
	    this.isDirty = true;
	}

	private function doWasteChart():void {
	    var priceListPickerWindow:PriceListPicker = PriceListPicker(PopUpManager.createPopUp(this, PriceListPicker, true));
	    priceListPickerWindow.setStyle("borderAlpha", 0.9);
	    priceListPickerWindow.itemType = "WasteChart";
	    if( charge.wasteChart != null)
	    	priceListPickerWindow.setPriceList(charge.wasteChart);
	    priceListPickerWindow.addEventListener(PriceListPickerSelectEvent.CANCELSELECTPRICELIST, handlePriceListPickerCancel);
	    priceListPickerWindow.addEventListener(PriceListPickerSelectEvent.SELECTPRICELIST, handleSelectWasteChart);
	    priceListPickerWindow.addEventListener(PriceListPickerSelectEvent.CLEARPRICELIST, handleClearWasteChart);
	    this.isDirty = true;
	}
	
	private function doEditWasteChart():void {
		var titleWindow:PriceListEditor = PriceListEditor(PopUpManager.createPopUp(this, PriceListEditor, true));
	    titleWindow.setStyle("borderAlpha", 0.9);
	    titleWindow.setPriceList(charge.wasteChart as PriceListBase);
	    titleWindow.addEventListener(SavePriceListEvent.Save, handleSaveWasteTable);
	    this.isDirty = true;		
	}
	private function handleSaveWasteTable(ev:SavePriceListEvent):void
	{ 
			charge.wasteChart = ev.priceList as WasteChart;
			waste_chart_link.label = wasteChartLabel();
				   
	}
	private function handleSavePriceList(ev:SavePriceListEvent):void
	{ 
			charge.priceList = ev.priceList as PriceList;
			price_list_link.label = priceListLabel();
				   
	}
	private function doEditPriceList():void {
		var titleWindow:PriceListEditor = PriceListEditor(PopUpManager.createPopUp(this, PriceListEditor, true));
	    titleWindow.setStyle("borderAlpha", 0.9);
	    titleWindow.setPriceList(charge.priceList as PriceListBase);
	    titleWindow.addEventListener(SavePriceListEvent.Save, handleSavePriceList);
	    this.isDirty = true;				
	}
	
	private function doPresetInfo():void {
		this.mapToCharge();
		var chargePresetInfoWindow:ChargePresetInfo = ChargePresetInfo(PopUpManager.createPopUp(this,ChargePresetInfo, true));
	    chargePresetInfoWindow.setStyle("borderAlpha", 0.9);
		chargePresetInfoWindow.setChargeDefinition(this.charge);
		chargePresetInfoWindow.addEventListener(ChargePresetInfoEvent.CHARGEPRESETOK, handleChargePresetInfoOK);
		this.isDirty = true;
	}
	
	private function handleChargePresetInfoOK(evt:ChargePresetInfoEvent):void {
		if (evt.chargeDefinition != null) {
			charge = evt.chargeDefinition;
			
			if (charge != null) {
				chargeService.calculateChargeCostingRate(charge, null);
			}		
		} else {
			Alert.show("Charge Preset Info Window returned a null Charge - no changes saved", "Error");
		}
	}
	
    private function handleSelectWasteChart(evt:PriceListPickerSelectEvent):void {
		if (evt.priceList != null) {
			charge.wasteChart = evt.priceList as WasteChart;
			waste_chart_link.label = wasteChartLabel();
		} else {
			charge.wasteChart = null;
			Alert.show("Price List Picker returned a null price list", "Error");
		}  
    }
    
    private function handleClearWasteChart(evt:PriceListPickerSelectEvent):void {
		charge.wasteChart = null;
		waste_chart_link.label = wasteChartLabel();
    }
    
     private function handleClearPriceList(evt:PriceListPickerSelectEvent):void {
		charge.priceList = null;
		price_list_link.label = priceListLabel();
    }
    
    private function handleSelectPriceList(evt:PriceListPickerSelectEvent):void {
 		if (evt.priceList != null) {
			charge.priceList = evt.priceList as PriceList;
			price_list_link.label = priceListLabel();	
		} else {
			charge.priceList = null;
			Alert.show("Price List Picker returned a null price list", "Error");
		}     	
    }
    
    private function handlePriceListPickerCancel(evt:PriceListPickerSelectEvent):void {
    	
    }

	private function updateButtons():void {
		enableNewCommand = newCommandEnabled();
		enableNewCategory = newCategoryEnabled();
		enableNewCharge = newChargeEnabled();
		enableDuplicate = duplicateChargeEnabled();
		enableExport = exportEnabled();
		enableDelete = deleteEnabled();
		enableRevert = revertEnabled();
		enablePresetInfo = presetInfoEnabled();
		enableCosting = costingEnabled();
	}
	
	private function exportEnabled():Boolean {
		return false;
	}
	
	private function deleteEnabled():Boolean {
		if (charge == null && chargeCategory == null) {
			return false;
		}
		return true;
	}
	
	private function revertEnabled():Boolean {
		if (charge != null) {
			return true;
		}
		return false;
	}
	
	private function presetInfoEnabled():Boolean {
		if (charge != null) {
			return true;
		}		
		return false;
	}
	
	private function costingEnabled():Boolean {
		if (charge != null) {
			return true;
		}
		return false;
	}
	
	private function newCategoryEnabled():Boolean {
		var command:ChargeCommand = getSelectedTreeCommand(true);
		
		if (command != null) {
			return true;
		}
		return false;
	}  

	private function newCommandEnabled():Boolean {
		return true; 
	}
	
	private function newChargeEnabled():Boolean {
		var category:ChargeCategory = getSelectedTreeCategory(true);
		
		if (category != null) {
			return true;
		}
		return false;
	}
	
	private function duplicateChargeEnabled():Boolean { 
		if (charge != null) {
			return true;
		}
		return false;
	}
	
	private function priceListLabel():String {
		if (charge.priceList != null) {
			if (charge.priceList.name != null) {
				return charge.priceList.name;
			} else {
				return "No Name";
			}
		} else {
			return "None";
		}
	}
	
	private function wasteChartLabel():String {
		if (charge.wasteChart != null) {
			if (charge.wasteChart.name != null) {
				return charge.wasteChart.name;
			} else {
				return "No Name";
			}
		} else {
			return "None";
		}
	}
	
	private function doPiecePrice():void {
		if (setup_check.selected == true){
			material_check.selected = false;
			//material_edit.text lse;
			in_set_mat_check.selected = false;
			in_set_mat_check.enabled = false;
			//in_sets_mat_edit.text = "";
			in_sets_mat_edit.enabled = false;
		}
		this.isDirty = true;
	}
			
	private	function doPiecePrice2():void {
		if (material_check.selected == true){
			setup_check.selected = false;
			//setup_edit.text ="";
			setup_edit.enabled= false;
		}
		this.isDirty = true;
			
	}
	private function UpdateAdj():void{
	 	if (charge_method_combo.selectedItem.data != ChargeMethod.FlatRate &&
	 		charge_method_combo.selectedItem.data != ChargeMethod.Markup) {
		 	if (rate_check.selected) {
		 		adjustable_rate_check.enabled= true;
		 	} else {
		 		adjustable_rate_check.enabled = false;
		 	} 
		 	if (rate_check.enabled) {
		 		in_sets_check.enabled = true;
		 	}
	 	}
	}
	
	private function UpdateAdjset():void{
		
	 	if (ship_markup_check.selected ||cover_ink_check.selected || sheet_lift_check.selected || in_set_mat_check.selected || in_sets_check.selected)
	 		adjustable_sets_check.enabled= true;
	 	else
	 		adjustable_sets_check.enabled = false;
	 	if(in_sets_check.selected )
	 		in_sets_edit.text = charge.rateSetCount.toString();
	}
	
	private function UpdatePriceMethod(): void {
		if (charge != null && charge_method_combo.selectedItem.data == ChargeMethod.Markup) {
			cost_plus_radio.enabled = false;						
//			cost_plus_radio.selected = false;
//			piece_pricing_radio.selected = true;
			pricing_method.selectedValue = "PiecePrice";
		}
		
		if (charge != null && pricing_method.selectedValue == "CostPlus") {
			markup_edit.text = charge.markup.toString();
			sale_price_per_unit_edit.text = costPricingString;
			//rate_edit.text = "0.0";
			//material_edit.text= "0.0";
			//setup_edit.text= "0.0";
			rate_edit.enabled = false;
			material_edit.enabled = false;
			setup_edit.enabled = false;
			rate_check.selected = false;
			rate_check.enabled = false;
			adjustable_rate_check.enabled =false;
			setup_check.enabled= false
			setup_check.selected = false;
			material_check.enabled = false;
			material_check.selected = false;
			in_sets_check.enabled = true;
			sheet_lift_check.enabled= true;
			cover_ink_check.enabled= true;
			ship_markup_check.enabled= true;
			area_check.enabled= true;
			in_set_mat_check.enabled = true;
		
		}
		else
		{
			switch (charge_method_combo.selectedItem.data) {
				case ChargeMethod.FlatRate:
				case ChargeMethod.Markup:
					if (charge_method_combo.selectedItem.data == ChargeMethod.FlatRate) {
						cost_plus_radio.enabled = true;
					} else {
						cost_plus_radio.enabled = false;						
					}					
					rate_check.enabled = true;
					if( charge != null)
						rate_check.selected = charge.useRate;
					if (rate_check.selected)
						if( charge != null)
							rate_edit.text = charge.rate.toString();
					
					setup_check.enabled= false;
					setup_check.selected = false;
					
					in_sets_check.enabled = false;
					in_sets_check.selected = false;
					in_set_mat_check.enabled = false;
					in_set_mat_check.selected = false;
					
					material_check.enabled = false;
					material_check.selected = false;
					if (material_check.selected)
						if( charge != null)
							material_edit.text= charge.material.toString();
					break;
					
					
				case ChargeMethod.Ask: 
				case ChargeMethod.Cut:
				case ChargeMethod.Fold:
				case ChargeMethod.JobAware:
				case ChargeMethod.Linear:
				case ChargeMethod.Ink:
				case ChargeMethod.PriceList:
				case ChargeMethod.RateList:
				case ChargeMethod.Shipping:
				case ChargeMethod.SquareArea:
					cost_plus_radio.enabled =true;					
					rate_check.enabled = true;
					if( charge != null)
						rate_check.selected = charge.useRate;
					if (rate_check.selected)
						if( charge != null)
							rate_edit.text = charge.rate.toString();
					
					setup_check.enabled= true
					if( charge != null)
						setup_check.selected = charge.useSetup;
					
					material_check.enabled = true;
					if( charge != null)
						material_check.selected = charge.useMaterial;
					if (material_check.selected)
						if( charge != null)
							material_edit.text= charge.material.toString();
					in_sets_check.enabled = rate_check.selected;
					break;
				}
			}
	}
	
	private function getSearchBy():ArrayCollection {
		var sc:ArrayCollection = new ArrayCollection();
	
		var fp:FilterProperty = new FilterProperty(null, "name");
		var sc1:FilterSearchBy = new FilterSearchBy("", fp);
		sc.addItem(sc1);
		
		return sc;
	}
	
	private function updateChargeCosting(event:Event):void{
		charge.markup = parseCurrencyFloat(markup_edit.text);
		if (isNaN(charge.markup)) {
			charge.markup = 0.0;
		}
		chargeService.calculateChargeCostingRate(charge, null);
		handleFocusOut(event);
	}
	
	private function handleFocusOut(event:Event):void {
		if (event.currentTarget == fixed_spoilage_edit ||
			event.currentTarget == base_linear_quantity_edit ||
			event.currentTarget == minimum_time_edit ||
			event.currentTarget == area_edit ||
			event.currentTarget == in_sets_edit ||
			event.currentTarget == in_sets_mat_edit ||
			event.currentTarget == sheet_lift_edit ||
			event.currentTarget == cover_ink_edit ||
			event.currentTarget == ship_markup_edit) {			
			(event.currentTarget as TextInput).text = numberFormatter.format((event.currentTarget as TextInput).text);
		} else if (event.currentTarget == minimum_charge_edit) {
			(event.currentTarget as TextInput).text = Snowmass.getCurrencyFormatter(false, 2).format((event.currentTarget as TextInput).text);			
		} else if (event.currentTarget == setup_edit ||
				   event.currentTarget == rate_edit ||
				   event.currentTarget == material_edit) {
			(event.currentTarget as TextInput).text = Snowmass.getCurrencyFormatter(false, 2).format((event.currentTarget as TextInput).text);			
		}
	}
	
	private function setDocDirty():void {
		this.isDirty = true;
	}
	
	private function chargeTreeOpening(event:TreeEvent):void {
		var trigger:Event = event.triggerEvent;
		
		if (trigger is MouseEvent) {
			if ((trigger as MouseEvent).ctrlKey == true) {
				chargeTree.expandChildrenOf(event.item, event.opening);
			}
		}
	}
	
	private function doCostPlusClick(event:Event):void {
		if (cost_plus_radio.selected == true) {
			if (this.charge.chargeCost == null) {
				doCosting();
			}
		}
	}
    ]]>
                             
</mx:Script>
    <mx:Dissolve id="dissolveOut" duration="400" alphaFrom="1.0" alphaTo="0.0"/>
    <mx:Dissolve id="dissolveIn" duration="400" alphaFrom="0.0" alphaTo="1.0"/>
   	<mx:NumberValidator source="{fixed_spoilage_edit}" property="text" trigger="{fixed_spoilage_edit}" triggerEvent="focusOut" allowNegative="true"/>
   	<mx:NumberValidator source="{base_linear_quantity_edit}" property="text" trigger="{base_linear_quantity_edit}" triggerEvent="focusOut" allowNegative="true"/>
   	<mx:NumberValidator source="{minimum_time_edit}" precision="4" property="text" trigger="{minimum_time_edit}" triggerEvent="focusOut" allowNegative="true"/>
   	<mx:NumberValidator source="{markup_edit}" property="text" trigger="{markup_edit}" triggerEvent="focusOut" allowNegative="true"/>
   	<mx:NumberValidator source="{area_edit}" property="text" trigger="{area_edit}" triggerEvent="focusOut" allowNegative="false"/>
   	<mx:NumberValidator source="{in_sets_edit}" property="text" trigger="{in_sets_edit}" triggerEvent="focusOut" allowNegative="false"/>
   	<mx:NumberValidator source="{in_sets_mat_edit}" property="text" trigger="{in_sets_mat_edit}" triggerEvent="focusOut" allowNegative="false"/>
   	<mx:NumberValidator source="{sheet_lift_edit}" property="text" trigger="{sheet_lift_edit}" triggerEvent="focusOut" allowNegative="false"/>
   	<mx:CurrencyValidator source="{minimum_charge_edit}" precision="4" property="text" trigger="{minimum_charge_edit}" triggerEvent="focusOut" allowNegative="true"/>
   	<mx:CurrencyValidator source="{setup_edit}" property="text" trigger="{setup_edit}" triggerEvent="focusOut" allowNegative="true"/>
   	<mx:CurrencyValidator source="{rate_edit}" property="text" trigger="{rate_edit}" triggerEvent="focusOut" allowNegative="true"/>
   	<mx:CurrencyValidator source="{material_edit}" property="text" trigger="{material_edit}" triggerEvent="focusOut" allowNegative="true"/>
   	<mx:NumberFormatter id="numberFormatter" precision="4" useNegativeSign="true" useThousandsSeparator="true"/>
   	
<mx:VBox width="100%" height="100%">
    	<mx:Canvas width="100%" height="100%">
		<mx:RadioButtonGroup id="area_group" selectedValue="{selected_area_group}" change="area_group_change(event)"/>
		<mx:RadioButtonGroup id="pricing_method" selectedValue="{pricingMethodRadioValue}" change="UpdatePriceMethod();"/>

		<mx:HDividedBox x="0" y="0" width="100%" height="740" liveDragging="true">
			<mx:Canvas height="100%" width="227">
				<mx:Tree width="100%" render="renderFunction()" folderClosedIcon="{null}" folderOpenIcon="{null}" defaultLeafIcon="{null}" id="chargeTree" dataProvider="{chargeCommands}" itemOpening="chargeTreeOpening(event)" 
						iconFunction="tree_iconFunction" labelFunction="treeLabel" visible="true" enabled="true" click="tree_itemClick(event);" dataChange="treeSelectionChanged(event)" change="treeSelectionChanged(event);" bottom="100" top="0"></mx:Tree>
				<comp:SmallThrobber id="throbber" height="20" width="20" x="103.5" y="95"/>
				<mx:Button x="10" y="572" width="20" height="20" id="new_command_button" click="doNewCommand()" enabled="{enableNewCommand}" bottom="78">
					<mx:icon>@Embed(source='../../../../assets/new_small.png')</mx:icon>
				</mx:Button>
				<mx:Label x="38" y="574" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefFindCmd.Command')}" width="179" textAlign="left" bottom="80"/>
				<mx:Button x="10" width="20" height="20" id="new_category_button" click="doNewCategory()" enabled="{enableNewCategory}" bottom="54">
					<mx:icon>@Embed(source='../../../../assets/new_small.png')</mx:icon>
				</mx:Button>
				<mx:Label x="38" y="597" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefFindCmd.Category')}" width="179" textAlign="left" bottom="56"/>
				<mx:Button x="10" y="618" width="20" height="20" click="doNewCharge()" id="new_charge_button" enabled="{enableNewCharge}" bottom="30">
					<mx:icon>@Embed(source='../../../../assets/new_small.png')</mx:icon>
				</mx:Button>
				<mx:Label x="38" y="620" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Charges')}" width="179" textAlign="left" bottom="32"/>
				<common:TreePickerFilter searchClassName="com.efi.printsmith.data::ChargeDefinition" height="22" bottom="5" showExtendedSearch="true"  searchComponent="{chargeTree}"  listData="{chargeCommands}" searchCriteria="{getSearchBy()}"  right="0" width="100%">
				</common:TreePickerFilter>
			</mx:Canvas>
		<mx:VBox height="739" verticalScrollPolicy="off">

		<mx:Canvas x="80" y="10" width="491" height="58" horizontalScrollPolicy="off" verticalScrollPolicy="off">
			<mx:Button x="76" y="2" width="38" height="38" click="doSave();" enabled="{enableSave}" id="save_button">
				<mx:icon>@Embed(source='../../../../assets/file.png')</mx:icon>
			</mx:Button>
			<mx:Label x="76" y="38" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Save')}" width="38" textAlign="center"/>
			<mx:Button x="129" y="2" width="38" height="38" id="duplicate_button" click="doDuplicateCharge()" enabled="{enableDuplicate}">
				<mx:icon>@Embed(source='../../../../assets/file.png')</mx:icon>
			</mx:Button>
			<mx:Label x="115" y="38" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Duplicate')}" width="66" textAlign="center"/>
			<mx:Button x="20" y="2" width="38" height="38" id="btnExport" enabled="{enableExport}">
				<mx:icon>@Embed(source='../../../../assets/export.png')</mx:icon>
			</mx:Button>
			<mx:Label x="10" y="38" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Export')}" width="58" textAlign="center"/>
			<mx:Button x="185" y="2" width="38" height="38" click="doDelete()" id="delete_button" enabled="{enableDelete}">
				<mx:icon>@Embed(source='../../../../assets/delete.png')</mx:icon>
			</mx:Button>
			<mx:Label x="175" y="38" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Delete')}" width="58" textAlign="center"/>
			<mx:Button x="268" y="2" width="38" height="38" id="revert_button" click="doRevert()" enabled="{enableRevert}">
				<mx:icon>@Embed(source='../../../../assets/revert.png')</mx:icon>
			</mx:Button>
			<mx:Label x="258" y="38" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Revert')}" width="58" textAlign="center"/>
			<mx:Button x="366" y="3" width="38" height="38" id="preset_info_button" click="doPresetInfo()" enabled="{enablePresetInfo}">
				<mx:icon>@Embed(source='../../../../assets/presets.png')</mx:icon>
			</mx:Button>
			<mx:Label x="348" y="39" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.PresetInfo')}" width="68" textAlign="center"/>
			<mx:Button x="424" y="3" width="38" height="38" click="doCosting()" id="costing_button" enabled="{enableCosting}">
				<mx:icon>@Embed(source='../../../../assets/costing.png')</mx:icon>
			</mx:Button>
			<mx:Label x="412" y="39" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Costing')}" width="63" textAlign="center"/>
		</mx:Canvas>
			<mx:ViewStack id="charge_stack" width="100%" height="100%" minWidth="575" creationPolicy="all">
			<mx:Canvas label="charge_blank_canvas" width="100%" height="100%" id="charge_blank_canvas">
			</mx:Canvas> 
			<mx:Canvas label="charge_canvas" width="100%" height="100%" id="charge_canvas" verticalScrollPolicy="auto" horizontalScrollPolicy="off">
				<mx:Canvas x="0" y="0" width="100%" height="634" horizontalScrollPolicy="off" verticalScrollPolicy="auto" id="canvas4">
					<mx:TextInput x="132" y="32" width="430" id="charge_name_edit" text="{charge.title}" change="setDocDirty()"/>
					<mx:TextInput x="132" y="7" width="163" id="charge_command_text" text="{charge.parent.parent.name}" change="setDocDirty()" editable="false"/>
					<mx:TextInput x="399" y="7" width="163" id="charge_category_text" text="{charge.parent.name}" change="setDocDirty()" editable="false"/>
					<mx:Label x="303" y="9" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.Category')}" textAlign="right" width="88"/>
					<mx:Label x="36" y="9" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Command')}" textAlign="right" width="88"/>
					<comp:VariableWidthComboBoxComponent x="133" y="57" width="162" dataProvider="{locations}" id="location_combo" labelField="name" height="21" change="setDocDirty()"/>
					<comp:VariableWidthComboBoxComponent x="404" y="57" width="158" dataProvider="{costCenters}" id="cost_center_combo" labelField="name" height="21" change="setDocDirty()"/>
					<mx:Label x="17" y="249" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.BaseLinearQuantity')}" textAlign="right" id="label3" width="116"/>
					<mx:Label x="17" y="224" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.FixedSpoilage')}" textAlign="right" id="label4" width="82"/>
					<mx:Label x="320" y="59" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'scheduleTagEditCmd.CostCenter')}" textAlign="right" width="76"/>
					<mx:Label x="17" y="58.5" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'copierDefCmd.ProductionLocation')}" textAlign="right" id="label6" width="108"/>

					<mx:Label x="17" y="156" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.ProdCode')}" textAlign="right" id="label10" width="58"/>
					<mx:Label x="17" y="87" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Method')}" textAlign="right" id="label7" width="58"/>
					<mx:Label x="17" y="34" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Charge')}" textAlign="right" id="label5" width="107"/>
					<comp:VariableWidthComboBoxComponent x="83" y="85" width="132" id="charge_method_combo" change="changeChargeMethod(event);" dataProvider="{ChargeMethod.toArray()}" height="21"/>
					<mx:Label x="17" y="110" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Quantity')}" textAlign="right" id="label8" width="58"/>
					<comp:VariableWidthComboBoxComponent x="83" y="108" width="132" id="charge_quantity_combo" dataProvider="{qtyTypes}" height="21" change="setDocDirty()"/>
					<mx:Label x="17" y="133" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.SalesCat')}" textAlign="right" id="label9" width="58"/>
					<comp:VariableWidthComboBoxComponent x="83" y="131" width="132" id="charge_sales_category_combo" dataProvider="{salesCategories}" labelField="name" height="21" change="setDocDirty()"/>
					<comp:VariableWidthComboBoxComponent x="83" y="154" width="132" id="product_code_combo" dataProvider="{productCodes}" labelField="name" height="21" change="setDocDirty()"/>
					<mx:CheckBox x="238" y="84.5" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Nooverrides')}" id="no_overrides_check" selected="{charge.noOverrides}" change="setDocDirty()"/>
					<mx:CheckBox x="238" y="105" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Donotdiscount')}" id="do_not_discount_check" selected="{charge.doNotDiscount}" change="setDocDirty()"/>
					<mx:CheckBox x="382" y="84.5" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Hidepriceonly')}" id="hide_price_only_check" selected="{charge.hidePrice}" change="setDocDirty()"/>
					<mx:CheckBox x="382" y="105" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Hidechargeinprintout')}" id="hide_charge_in_printouts_check" selected="{charge.hideChargeInPrintouts}" change="setDocDirty()"/>
					<mx:CheckBox x="382" y="123" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.BinderyOperation')}" id="bindery_operation_check" selected="{charge.binderyCharge}" change="setDocDirty()"/>
					<mx:CheckBox x="238" y="123" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Excludedfromworkflow')}" id="excluded_from_workflow_check" selected="{charge.excludedFromWorkflow}" change="setDocDirty()"/>
					<mx:CheckBox x="238" y="144" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.TrackerPreProduction')}" id="tracker_pre_production_check" selected="{charge.preproduction}" change="setDocDirty()"/>
					<mx:CheckBox x="382" y="144" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Ignoreglobalpricecha')}" id="ignore_global_price_changes_check" selected="{charge.ignoreGlobalPriceChanges}" change="setDocDirty()"/>
					<mx:CheckBox  visible="false" x="231" y="145" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.IntegratedCTPDevice')}" id="integrated_ctp_device_check" selected="{charge.integratedCTP}" enabled="false" change="setDocDirty()"/>
					<mx:TextInput x="107" y="222" restrict="0-9\.\-\," width="90" id="fixed_spoilage_edit" text="{numberFormatter.format(charge.fixedWaste)}" textAlign="right" change="setDocDirty()"/>
					<mx:TextInput x="141" y="247" restrict="0-9\.\-\," width="56" id="base_linear_quantity_edit" text="{numberFormatter.format(charge.baseLinearNumber)}" textAlign="right" change="setDocDirty()"/>
					<mx:HRule x="10" y="206" width="710" height="8" id="hrule1"/>
					<mx:HRule x="10" y="276" width="710" height="8" id="hrule2"/>
					<mx:HRule x="10" y="396" width="710" height="8" id="hrule3"/>
					<mx:CheckBox x="216" y="222" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.MinimumCharge')}" id="minimum_charge_check" selected="{charge.useMinimumCharge}" change="setDocDirty()"/>
					<mx:TextInput x="349" y="222" restrict="0-9\.\-\," width="96" id="minimum_charge_edit" text="{Snowmass.getCurrencyFormatter(false, 2).format(charge.minimum)}" enabled="{minimum_charge_check.selected}" textAlign="right" focusOut="handleFocusOut(event)" change="setDocDirty()"/>
					<mx:CheckBox x="216" y="247" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.MinimumTime')}" id="minimum_time_check" selected="{charge.useMinimumTime}" change="setDocDirty()"/>
					<mx:TextInput x="349" y="247" restrict="0-9" width="96" id="minimum_time_edit" text="{numberFormatter.format(charge.minimumTime)}" enabled="{minimum_time_check.selected}" textAlign="right" focusOut="handleFocusOut(event)" change="setDocDirty()"/>
					
					<mx:RadioButton x="453" y="222" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.RunArea')}" groupName="area_group" id="run_area_radio" width="112" value="RunArea" change="setDocDirty()"/>
					<mx:CheckBox x="453" y="222" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.CutsarePrePress')}" id="cut_prepress_radio" width="112" change="setDocDirty()"/>
					
					<mx:RadioButton x="453" y="247" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.FinishedArea')}" groupName="area_group" id="finished_area_radio" width="112" value="FinishArea" change="setDocDirty()"/>
					<mx:CheckBox x="453" y="247" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Ignorecuts')}" id="Ignorecuts_radio" width="112" change="setDocDirty()"/>
					
					<mx:RadioButton x="11" y="292" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.CostPlus')}" click="doCostPlusClick(event)" groupName="pricing_method" id="cost_plus_radio" width="93" value="CostPlus"  change="setDocDirty()"/>
					<mx:RadioButton x="11" y="313" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.PiecePricing')}" groupName="pricing_method" id="piece_pricing_radio" width="93" value="PiecePrice"  change="setDocDirty()"/>
					<mx:TextInput x="189" y="292" restrict="0-9\.\-\," width="124" id="markup_edit" text="{charge.markup}" enabled="{cost_plus_radio.selected}" focusOut="updateChargeCosting(event);" textAlign="right" change="setDocDirty()"/>
					<mx:Text x="429" y="294" width="91" id="sale_price_per_unit_edit" text="{costPricingString}" height="17" textAlign="right"/>
					<mx:CheckBox x="112" y="315" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Setup')}" id="setup_check" selected="{charge.useSetup}" width="69" enabled="{piece_pricing_radio.selected}" change="doPiecePrice();"/>
					<mx:TextInput x="189" y="315" restrict="0-9\.\-\," width="124" id="setup_edit" enabled="{setup_check.selected}" text="{Snowmass.getCurrencyFormatter(false, 2).format(charge.setupPrice)}" textAlign="right" focusOut="handleFocusOut(event)" change="setDocDirty()"/>
					<mx:CheckBox x="112" y="338" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Rate')}" id="rate_check" selected="{charge.useRate}" width="69" enabled="{piece_pricing_radio.selected}" change="UpdateAdj();"/>
					<mx:TextInput x="189" y="338" restrict="0-9\.\-\," width="124" id="rate_edit" enabled="{rate_check.selected}" text="{Snowmass.getCurrencyFormatter(false, 2).format(charge.rate)}" textAlign="right" focusOut="handleFocusOut(event)" change="setDocDirty()"/>
					<mx:CheckBox x="112" y="361" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Material')}" id="material_check" selected="{charge.useMaterial}" width="69" enabled="{piece_pricing_radio.selected}" change="doPiecePrice2();"/>
					<mx:TextInput x="189" y="361" restrict="0-9\.\-\," width="124" id="material_edit" enabled="{material_check.selected}" text="{Snowmass.getCurrencyFormatter(false, 2).format(charge.material)}" textAlign="right" focusOut="handleFocusOut(event)" change="setDocDirty()"/>
					<mx:CheckBox x="327" y="338" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Area')}" id="area_check" selected="{charge.useArea}" width="118" enabled="{rate_check.selected}" change="UpdateAdjset()"/>
					<mx:TextInput x="453" y="338" restrict="0-9\.\-\," width="124" id="area_edit" enabled="{area_check.selected}" text="{charge.area}" textAlign="right" focusOut="handleFocusOut(event)" change="setDocDirty()"/>
					<mx:CheckBox x="327" y="338" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.InSets')}" id="in_sets_check" selected="{charge.useRateSets}" width="118" enabled="false" change="UpdateAdjset()"/>
					<mx:TextInput x="453" y="338" restrict="0-9\.\-\," width="124" id="in_sets_edit" enabled="{in_sets_check.selected}" text="{charge.rateSetCount}" textAlign="right" focusOut="handleFocusOut(event)" change="setDocDirty()"/>
					<mx:Label x="321" y="294" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.SalePriceperUnit')}" id="label1" textAlign="right"/>
					<mx:Label x="112" y="294" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Markup')}" id="label2" width="69" textAlign="right"/>
					<mx:ViewStack x="7" y="400" id="price_calc_stack" width="713" height="132" creationPolicy="all">
						<mx:Canvas width="100%" height="100%" id="job_aware_canvas" label="job_aware" showEffect="dissolveIn" hideEffect="dissolveOut">
							<mx:RadioButtonGroup id="charge_group_1"  change="charge_group_1_change(event)"/>
							<mx:RadioButtonGroup id="charge_group_2"  change="charge_group_2_change(event)"/>
							<mx:RadioButtonGroup id="charge_group_3"  change="charge_group_3_change(event)"/>
							<mx:RadioButtonGroup id="charge_group_4"  change="charge_group_4_change(event)"/>
							<mx:Canvas x="10" y="35" width="105" height="85" borderColor="#000000" borderStyle="solid" borderThickness="1">
							</mx:Canvas>
						</mx:Canvas>
						<mx:Canvas label="blank_canvas" width="100%" height="100%" id="blank_canvas" showEffect="dissolveIn" hideEffect="dissolveOut">
						</mx:Canvas>
						<mx:Canvas label="markup_canvas" width="100%" height="100%" id="markup_canvas" showEffect="dissolveIn" hideEffect="dissolveOut">
							<mx:RadioButtonGroup id="markup_type_group" selectedValue="{selected_markup_type_group}" change="markup_type_group_change(event)"/>
							<mx:RadioButton x="10" y="35" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.JobPrice')}" groupName="markup_type_group" width="138" value="JobPrice" change="setDocDirty()"/>
							<mx:RadioButton x="10" y="58" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Charges')}" groupName="markup_type_group" width="138" value="Charges" change="setDocDirty()"/>
							<mx:RadioButton x="156" y="35" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.EntireJob')}" groupName="markup_type_group" width="138" value="EntireJob" change="setDocDirty()"/>
							<mx:RadioButton x="156" y="58" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Invoice')}" groupName="markup_type_group" width="138" value="Invoice"  change="setDocDirty()"/>
							<mx:Text x="10" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Selectthetypeofmarku')}" width="291" height="17" fontWeight="bold"/>
						</mx:Canvas>
					</mx:ViewStack>
					<mx:Button x="17" y="541" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.PriceList')}" width="109" id="price_list_button" click="doPriceList()"/>
					<mx:Button x="17" y="571" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.WasteChart')}" id="waste_chart_button" click="doWasteChart()" width="109"/>
					<mx:LinkButton x="139" y="541" width="291" id="price_list_link" label="{priceListLabel()}" enabled="{charge.priceList != null}" click="doEditPriceList()"/>
					<mx:LinkButton x="139" y="572" width="291" id="waste_chart_link" label="{wasteChartLabel()}" enabled="{charge.wasteChart != null}" click="doEditWasteChart()"/>
					<mx:HRule x="0" y="531" width="710" height="8" id="hrule4"/>
					<mx:CheckBox x="327" y="361" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.InSets')}"  selected="{charge.useMaterialSets}" id="in_set_mat_check" enabled="{material_check.selected}" width="118" change="UpdateAdjset();"/>
					<mx:TextInput x="453" y="361" restrict="0-9\.\-\," width="124" enabled="{in_set_mat_check.selected}"  text="{charge.materialSetCount}" id="in_sets_mat_edit" textAlign="right" focusOut="handleFocusOut(event)"  change="setDocDirty()"/>
					<mx:CheckBox x="327" y="338" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rChargeLabel.SheetsLift')}" id="sheet_lift_check" selected="{charge.sheet_lift_check}" enabled="{rate_check.selected}" width="118" change="UpdateAdjset();"/>
					<mx:TextInput x="453" y="338" restrict="0-9\.\-\," id="sheet_lift_edit" text="{charge.sheetliftCut}" width="124"  enabled="{sheet_lift_check.selected}" textAlign="right" focusOut="handleFocusOut(event)" change="setDocDirty()"/>
					<mx:CheckBox x="327" y="338" label="{inkCoverageLabel}" id="cover_ink_check" selected="{charge.coverlb_check}" enabled="{rate_check.selected}" width="118" change="UpdateAdjset();"/>
					<mx:TextInput x="453" y="338"  restrict="0-9\." id="cover_ink_edit"  text="{charge.coverlbInk}" width="124" enabled="{cover_ink_check.selected}" textAlign="right" focusOut="handleFocusOut(event)" change="setDocDirty()"/>
					<mx:CheckBox x="327" y="338" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'pricePrefCmd.Markup')}" id="ship_markup_check" selected="{charge.ship_markup_check}" enabled="{rate_check.selected}" width="118" change="UpdateAdjset();"/>
					<mx:TextInput x="453" y="338" id="ship_markup_edit" restrict="0-9\." text="{charge.shipMarkup}" width="124" enabled="{ship_markup_check.selected}" textAlign="right" focusOut="handleFocusOut(event)"  change="setDocDirty()"/>
					<mx:CheckBox x="599" y="325" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Adjustablesets')}" id="adjustable_sets_check" selected="{charge.adjustableSets}" change="setDocDirty()"/>
					<mx:CheckBox x="599" y="343" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Adjustablerate')}" id="adjustable_rate_check" selected="{charge.adjustableRate}" change="setDocDirty()"/>
					<mx:CheckBox x="599" y="361" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Adjustablematerial')}" id="adjustable_material_check" selected="{charge.adjustableMaterial}" enabled="{material_check.selected}" change="setDocDirty()"/>
					<mx:Label x="17" y="184" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.FoldStyle')}" textAlign="right" id="fold_template_label" width="58" visible="false" />
					<comp:VariableWidthComboBoxComponent x="83" y="182" width="132" id="fold_template_combo" dataProvider="{foldTemplates}" labelField="name" height="21" visible="false"/>
					<mx:Text x="17" y="411" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Selectvaluesinjobtob')}" width="291" height="17" fontWeight="bold" id="text2"/>
					<mx:Text x="130" y="471" text="x" id="multiplier_1_txt"/>
					<mx:Text x="396" y="471" text="x" id="multiplier_2_txt"/>
					<mx:Text x="263" y="471" text="x" id="multiplier_3_txt"/>
					<mx:RadioButton x="25" y="441" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.NA')}" groupName="charge_group_1" id="na1_radio" width="85" value="None" change="setDocDirty()"/>
					<mx:RadioButton x="25" y="467" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Ordered')}" groupName="charge_group_1" id="ordered_radio" width="85" value="Ordered" change="setDocDirty()"/>
					<mx:RadioButton x="25" y="493" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Press')}" groupName="charge_group_1" id="press_radio" width="85" value="Press" change="setDocDirty()"/>
					<mx:Canvas x="150" y="436" width="105" height="85" borderColor="#000000" borderStyle="solid" borderThickness="1" id="canvas3">
						<mx:RadioButton x="10" y="5" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.NA')}" groupName="charge_group_2" id="na2_radio" width="83" value="NA" change="setDocDirty()"/>
						<mx:RadioButton x="10" y="31" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Colors')}" groupName="charge_group_2" id="colors_radio" width="83" value="Colors" change="setDocDirty()"/>
						<mx:RadioButton x="10" y="57" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Sides')}" groupName="charge_group_2" id="sides_radio" width="83" value = "Sides" change="setDocDirty()"/>
					</mx:Canvas>
					<mx:Canvas x="283" y="436" width="105" height="85" borderColor="#000000" borderStyle="solid" borderThickness="1" id="canvas2">
						<mx:RadioButton x="10" y="5" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.NA')}" groupName="charge_group_3" id="na3_radio" width="83" value="NA" change="setDocDirty()"/>
						<mx:RadioButton x="10" y="31" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Sheets')}" groupName="charge_group_3" id="sheets_radio" width="83" value="Sheets" change="setDocDirty()"/>
						<mx:RadioButton x="10" y="57" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Signatures')}" groupName="charge_group_3" id="signatures_radio" width="83" value="Signatures" change="setDocDirty()"/>
					</mx:Canvas>
					<mx:Canvas x="416" y="436" width="105" height="85" borderColor="#000000" borderStyle="solid" borderThickness="1" id="canvas1">
						<mx:RadioButton x="10" y="5" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.NA')}" groupName="charge_group_4" id="na4_radio" width="83" value="NA" change="setDocDirty()"/>
						<mx:RadioButton x="10" y="31" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.xUp')}" groupName="charge_group_4" id="x_up_radio" width="83" value="xUp" change="setDocDirty()"/>
						<mx:RadioButton x="10" y="57" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Up')}" groupName="charge_group_4" id="slash_up_radio" width="83" value="/Up" change="setDocDirty()"/>
					</mx:Canvas>
					<mx:CheckBox x="554" y="436" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.AdjustableUp')}" id="adjustable_up_check" selected="{charge.adjustUps}"  enabled="{slash_up_radio.selected ||x_up_radio.selected}"  change="setDocDirty()"/>
				</mx:Canvas>
			</mx:Canvas>
			<mx:Canvas label="charge_category_canvas" width="100%" height="100%" id="charge_category_canvas">
				<mx:TextInput x="126" y="7" width="163" id="category_command_text" text="{chargeCategory.parent.name}" change="setDocDirty()" editable="false"/>
				<mx:Label x="30" y="9" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Command')}" textAlign="right" width="88"/>
				<mx:TextInput x="126" y="34" width="430" id="charge_category_name_edit" text="{chargeCategory.name}"/>
				<mx:Label x="10" y="36" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.CategoryTitle')}" textAlign="right" width="108"/>
			</mx:Canvas>
			<mx:Canvas label="charge_command_canvas" width="100%" height="100%" id="charge_command_canvas">
				<mx:TextInput x="125" y="3" width="430" id="charge_command_name_edit" text="{chargeCommand.name}"/>
				<mx:Label x="13" y="5" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'chargeDefCmd.Command')}" textAlign="right" width="104"/>
			</mx:Canvas>
		</mx:ViewStack>
		</mx:VBox>
	</mx:HDividedBox>
<!--
		<mx:DataGrid x="17" y="72" width="259" height="622" id="charge_datagrid" dataProvider="{charges}" click="{selectCharge()}">
			<mx:columns>
				<mx:DataGridColumn headerText="Charges" dataField="title"/>
			</mx:columns>
		</mx:DataGrid>-->
	</mx:Canvas>
</mx:VBox>
</mx:Panel>