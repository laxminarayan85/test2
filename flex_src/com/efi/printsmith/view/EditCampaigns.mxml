<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:view="com.efi.printsmith.view.*" xmlns:vo="com.efi.printsmith.vo.*" xmlns:fc="http://www.adobe.com/2006/fc" xmlns:hc="com.hillelcoren.components.*"
width="548" height="100%" title="Campaign Editor"  close="PopUpManager.removePopUp(this);" showCloseButton="true"
creationComplete="init()" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.EditCampaigns')}" name="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.EditCampaigns')}" xmlns:ns1="com.efi.printsmith.components.*">

<mx:RemoteObject id="dataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadResult(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveResult(event)"/>
</mx:RemoteObject>

<mx:RemoteObject id="GradedataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadGradeResult(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveGradeResult(event)"/>
</mx:RemoteObject>



<mx:Script> 
                                  
<![CDATA[
	
	import com.efi.printsmith.data.Campaigns;
	import com.efi.printsmith.data.Grade
	import com.efi.printsmith.events.CampaignEditCompleteEvent;
	import mx.controls.Alert;                                         
	import mx.managers.PopUpManager;                                         
	import mx.containers.TitleWindow;                                         
	import mx.collections.ArrayCollection;                                         
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;                                         
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
    import mx.printing.FlexPrintJob;
    import mx.printing.PrintAdvancedDataGrid;
    import mx.printing.PrintDataGrid;
    import mx.core.Application;
    import mx.validators.Validator;
    import mx.events.ValidationResultEvent;    
    
    [Bindable]            
    private var campaignsarray:ArrayCollection = new ArrayCollection();
     [Bindable]            
    private var gradesarray:ArrayCollection = new ArrayCollection();
     [Bindable]            
    private var campaignGradearray:ArrayCollection = new ArrayCollection();
                 
	[Bindable]                                         
	private var campaign:Campaigns;
	
	[Bindable]	
	private var grade:Grade;
	[Bindable]	
	private var newCamp:Boolean;	
	    
   
	public function init():void {
		dataService.getAll("Campaigns"); 
		GradedataService.getAll("Grade"); 
		campaign = new Campaigns();
		grade = new Grade();
		campaignGradearray = new ArrayCollection();
	}      

	private function doNew():void {
		campaign_name.text = "";
		
		campaign = new Campaigns();
	
	}  
	private function doDelete():void {
	 
	 	
	}  
	private function doGet():void{
		
		
	   	    
	}    
		
	private function doSave():void {
		if (campaign !=null){
			campaign.name = campaign_name.text;
			campaign.applied = false;
			if (campaign.id == 0 || isNaN(campaign.id))
				newCamp =  true;
			dataService.addUpdate(campaign);
		}
	
		                                    		
	}   
	private function doSaveGrade():void{
		if (gradeList.selectedItem != null){
			grade = gradeList.selectedItem as Grade;
			grade.campaigns = campaignGradearray;
			GradedataService.addUpdate(grade);
		}
		else
		{
			if (gradeList.text.length > 0)
				grade.name = gradeList.text;
				grade.campaigns = campaignGradearray;
				GradedataService.addUpdate(grade);
		}
			
		
	
	}
	private function doNewGrade():void {
		gradeList.selectedIndex = 0;
		grade = new Grade();
		gradeList.text = "";
		gradeList.selectedIndex = -1;
		campaignGradearray = new ArrayCollection();
	
	}  
	
	 private function handleSaveResult(ev:ResultEvent):void {
		this.campaign = ev.result as Campaigns;
		if ( newCamp){
			campaignsarray.addItem(campaign);
			newCamp = false;
		}
		campaign= null;
	
	}

	
	private function handleLoadResult(ev:ResultEvent):void {
		campaignsarray = ev.result as ArrayCollection; 
		
	}
	
 private function handleSaveGradeResult(ev:ResultEvent):void {
		this.grade = ev.result as Grade;
		gradesarray.addItem(this.grade);
		
	//	var selectEvent:CampaignEditCompleteEvent = new CampaignEditCompleteEvent(CampaignEditCompleteEvent.SAVE, this.campaign );
	//	dispatchEvent(selectEvent);
	//	PopUpManager.removePopUp(this);
	
	}

	private function findItem(name:String, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (name == element.name) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function handleLoadGradeResult(ev:ResultEvent):void {
		gradesarray = ev.result as ArrayCollection; 
		
	}
	private function handleFault(ev:FaultEvent):void {  
		var message:String;
		              
		message = "Error: "                          
		+ ev.fault.faultCode + " - "                                  
		+ ev.fault.faultDetail + " - "                                  
		+ ev.fault.faultString;
		Alert.show(message, "Error", 0, null, null, null, 4);                                 
	}
	
	
	private function dataRefresh():void{
		campaign = dataGrid.selectedItem as Campaigns;
		
	}
	private function RemoveCampaign():void{
		var tempCamp:Campaigns;
	 	var tempIndex:int
		tempCamp =  GradeGrid.selectedItem as Campaigns;
		tempIndex = findItem(tempCamp.name, campaignGradearray);
		campaignGradearray.removeItemAt(tempIndex);
	}
	private function AddCampaign():void{
		var tempCamp:Campaigns;
	 	var tempIndex:int
		tempCamp =  dataGrid2.selectedItem as Campaigns;
		tempIndex = findItem(tempCamp.name, campaignGradearray);
		if (tempIndex == -1)
			campaignGradearray.addItem(tempCamp);
	}
	private function updateGrade():void{
		if (gradeList.selectedItem != null){
			this.grade = gradeList.selectedItem as Grade;
			grade_ID.text = this.grade.gradeId;
			campaignGradearray = this.grade.campaigns;
		}
		
	}
]]>	

                             
</mx:Script>

<mx:Canvas width="851" height="704">
		<mx:TabNavigator x="0" y="7" width="491" height="701" creationPolicy="all">
			<mx:Canvas label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Campaigns')}" width="100%" height="100%">
				<mx:TextInput x="87" y="105" id="campaign_name" text="{campaign.name}"/>
				<mx:Label x="44" y="107" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kTableConfigureCommand.Title')}" textAlign="right"/>
				<mx:DataGrid x="44" y="149" id="dataGrid" dataProvider="{campaignsarray}" itemClick="dataRefresh();" >
					<mx:columns>
						<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'campaignMgrCmd.Slot')}" dataField="campaignId" width="40"/>
						<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'campaignMgrCmd.Global')}" dataField="globalCampaign" width="50" textAlign="center"
							editorDataField="selected" 
								itemEditor="mx.controls.CheckBox">
					  		 <mx:itemRenderer>
					  		  <mx:Component>
					        	 <mx:CheckBox click="data.globalCampaign=!data.globalCampaign"  selected="{data.globalCampaign}"/>
					        </mx:Component>				
					   		</mx:itemRenderer>
					   		</mx:DataGridColumn>
						<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'campaignMgrCmd.Title')}" dataField="name"/>
					</mx:columns>
				</mx:DataGrid>
				<mx:Button x="44" y="10" width="38" height="38"  click="doSave();" id="campsave">
					<mx:icon>@Embed(source='../../../../assets/file.png')</mx:icon>
				</mx:Button>
				<mx:Button x="90" y="10" width="38" height="38" click="doNew();" id="campnew">
					<mx:icon>@Embed(source='../../../../assets/new.png')</mx:icon>
				</mx:Button>
				<mx:Label x="44" y="56" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Save')}" width="38" textAlign="center"/>
				<mx:Label x="90" y="56" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.New')}"  width="38" textAlign="center"/>
				
			</mx:Canvas>
			<mx:Canvas label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'campaignMgrCmd.Grades')}" width="100%" height="100%">
				<mx:Button x="44" y="10" width="38" height="38"  click="doSaveGrade();" id="gradesave">
					<mx:icon>@Embed(source='../../../../assets/file.png')</mx:icon>
				</mx:Button>
				<mx:Label x="32" y="100" width="31" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'campaignMgrCmd.ID')}" textAlign="right"/>
				<mx:TextInput x="71" y="98" width="81" id="grade_ID" text="{grade.gradeId}" editable="false"/>
				<mx:Text x="204" y="100" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kTablePropertiesCommand.Title')}" width="34" textAlign="right"/>
				
				<mx:DataGrid x="22" y="156" height="260" width="150" id="GradeGrid"  dataProvider="{campaignGradearray}" click="RemoveCampaign();" >
					<mx:columns>
						<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rStandardMenuText.CampaignsandGrades')}" dataField="name"/>
						
					</mx:columns>
				</mx:DataGrid>
				<mx:DataGrid x="246" y="156" height="260" width="150" id="dataGrid2" dataProvider="{campaignsarray}" click="AddCampaign();">
					<mx:columns>
						<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Campaigns')}" dataField="name"/>
					</mx:columns>
				</mx:DataGrid>
				<mx:Button x="90" y="10" label="Button" width="38" height="38" id="gradenew" icon="@Embed(source='../../../../assets/new.png')"  click="doNewGrade();"/>
				<mx:Label x="44" y="56" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Save')}" width="38" textAlign="center"/>
				<mx:Label x="90" y="56" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.New')}"  width="38" textAlign="center"/>
				<mx:ComboBox x="246" y="97.5" height="23" id="gradeList" dataProvider="{gradesarray}" labelField="name" width="160" change="updateGrade();" editable="true" enabled="true"></mx:ComboBox>
				
			</mx:Canvas>
		</mx:TabNavigator>
	</mx:Canvas>

</mx:TitleWindow>