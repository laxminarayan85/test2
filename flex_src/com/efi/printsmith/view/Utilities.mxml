<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:vo="com.efi.printsmith.vo.*" width="576" height="482" showCloseButton="false" creationComplete="init()"
    close="PopUpManager.removePopUp(this);"
    title="Utilities" xmlns:text="flash.text.*" borderThickness="3" borderStyle="solid" horizontalScrollPolicy="off" 
    label="Utilities" name="Utilities"
    verticalScrollPolicy="off">
<mx:Script>
                                   
<![CDATA[ 
	import com.efi.printsmith.data.Contact;           
    import com.efi.printsmith.data.Account;    
    import com.efi.printsmith.view.EditContact;
    import com.efi.printsmith.view.EditCustomer;    
    import com.efi.printsmith.view.PressDefinitions;
    import com.efi.printsmith.data.Charge;   
    import com.efi.printsmith.events.PriceListPickerSelectEvent
         
	import mx.managers.PopUpManager;     
	import com.efi.printsmith.data.SpeedTable;  
	import com.efi.printsmith.data.PriceList;
	import com.efi.printsmith.data.PriceListBase; 
	import com.efi.printsmith.data.WasteChart;                          
	import mx.controls.Alert;                          
	import mx.containers.Canvas;   
	import mx.core.Container;                      
	import mx.rpc.events.ResultEvent;                                 
	import mx.rpc.events.FaultEvent;                          
	import mx.events.ValidationResultEvent;                          
	import mx.validators.Validator;       
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
	import mx.core.Application;
	import mx.collections.ArrayCollection;
	import flash.net.FileReference;
	import mx.rpc.Responder;
	import com.efi.printsmith.events.commandEvents.EditForms.EditWebAdminEvent;
	import com.efi.printsmith.events.commandEvents.EditForms.TableEditorEvent;
		
	private var fileReference:FileReference;
	private var servletTarget:URLRequest = new URLRequest("http://localhost:8080/Snowmass/ImportServlet");
	private var loader:Loader;
	                                                       
	private function init():void {   
		this.import_charge_definitions.enabled = true;
		this.import_charge.enabled = false;
		this.import_tax_tables.enabled = true;
		this.import_price_lists.enabled = false;
		this.import_price_schedules.enabled = false;
		this.import_customers.enabled = false;
		this.import_contacts.enabled = false;
		this.import_stock_definitions.enabled = false;
		this.import_press_definitions.enabled = false;
		this.import_copier_definitions.enabled = false;
		this.import_jobs.enabled = false;
		this.import_invoices.enabled = false;
		this.import_customer_logs.enabled = false;
		this.import_stock_changes.enabled = false;
	}
	
	private function handleLoadFileComplete(event:Event):void {
	}
		
	private function handleIOError(event:IOErrorEvent):void {
		if (event.target != null) {
			
		}
	}
	
	private function handleSelectChargeDefinitionsFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("ChargeDefinitions");
	}
	
	private function handleSelectContactsFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("Contacts");
	}
	
	private function handleSelectCopierDefinitionsFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("CopierDefinitions");
	}

	private function handleSelectCustomerLogsFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("CustomerLogs");
	}
	
	private function handleSelectCustomerFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("Customers");
	}

	private function handleSelectInvoicesFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("Invoices");
	}
	
	private function handleSelectJobsFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("Jobs");
	}
	
	private function handleSelectPressDefinitionsFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("PressDefinitions");
	}

	private function handleSelectPriceListsFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("PriceLists");
	}

	private function handleSelectStockDefinitionsFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("StockDefinitions");
	}

	private function handleSelectTaxTablesFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("TaxTables");
	}
	
	private function handleSelectPriceSchedulesFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("PriceSchedules");
	}
	
	private function handleSelectChargeFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("Charge");
	}
	
	private function handleSelectStockChangesFile(evt:Event):void {
		fileReference.addEventListener(Event.COMPLETE, handleLoadFileComplete);
		fileReference.addEventListener(IOErrorEvent.IO_ERROR, handleIOError);
		uploadFile("StockChange");
	}

	private function uploadFile(fileType:String):void {
		var urlVariables:URLVariables = new URLVariables();
		urlVariables.importType = fileType;
		servletTarget.data = urlVariables;
		servletTarget.method = URLRequestMethod.POST;
		fileReference.upload(servletTarget);		
	}
	
	private function handleCancelFile(evt:Event):void {
		
	}
	
	private function doImport(listener:Function):void {
		fileReference = new FileReference();
		fileReference.addEventListener(Event.SELECT, listener);
		fileReference.addEventListener(Event.CANCEL, handleCancelFile);
		fileReference.browse();
	}
	private function doImportCustomers():void {
		doImport(handleSelectCustomerFile);
		this.import_customer_logs.enabled = true;
	}
	
	private function doImportChargeDefinitions():void {
		doImport(handleSelectChargeDefinitionsFile);
		this.import_charge.enabled = false;
		this.import_tax_tables.enabled = true;
		this.import_price_lists.enabled = true;
		this.import_price_schedules.enabled = false;
		this.import_customers.enabled = true;
		this.import_contacts.enabled = true;
		this.import_stock_definitions.enabled = false;
		this.import_press_definitions.enabled = false;
		this.import_copier_definitions.enabled = false;
		this.import_jobs.enabled = false;
		this.import_invoices.enabled = false;
		this.import_customer_logs.enabled = false;
	}

	private function doImportContacts():void {
		doImport(handleSelectContactsFile);
	}
	
	private function doImportCustomerLogs():void {
		doImport(handleSelectCustomerLogsFile);
	}
	
	private function doImportInvoices():void {
		doImport(handleSelectInvoicesFile);
		this.import_charge.enabled = true;
	} 

	private function doImportJobs():void {
		doImport(handleSelectJobsFile);
		this.import_charge.enabled = false;
		this.import_tax_tables.enabled = true;
		this.import_price_lists.enabled = true;
		this.import_price_schedules.enabled = true;
		this.import_customers.enabled = true;
		this.import_contacts.enabled = true;
		this.import_stock_definitions.enabled = true;
		this.import_press_definitions.enabled = true;
		this.import_copier_definitions.enabled = true;
		this.import_jobs.enabled = true;
		this.import_invoices.enabled = true; 
	}
	
	private function doImportPressDefinitions():void {  
		doImport(handleSelectPressDefinitionsFile);
		this.import_charge.enabled = false;
		this.import_tax_tables.enabled = true;
		this.import_price_lists.enabled = true;
		this.import_price_schedules.enabled = true;
		this.import_customers.enabled = true;
		this.import_contacts.enabled = true;
		this.import_stock_definitions.enabled = false;
		this.import_press_definitions.enabled = true;
		this.import_copier_definitions.enabled = true;
		this.import_jobs.enabled = false;
		this.import_invoices.enabled = false;
	}
	
	private function doImportPriceLists():void {
		doImport(handleSelectPriceListsFile);
		this.import_charge.enabled = false;
		this.import_tax_tables.enabled = true;
		this.import_price_lists.enabled = true;
		this.import_price_schedules.enabled = true;
		this.import_customers.enabled = true;
		this.import_contacts.enabled = true;
		this.import_stock_definitions.enabled = false;
		this.import_press_definitions.enabled = true;
		this.import_copier_definitions.enabled = false;
		this.import_jobs.enabled = false;
		this.import_invoices.enabled = false;
	}
	
	private function doImportCopierDefinitions():void {
		doImport(handleSelectCopierDefinitionsFile);
		this.import_charge.enabled = false;
		this.import_tax_tables.enabled = true;
		this.import_price_lists.enabled = true;
		this.import_price_schedules.enabled = true;
		this.import_customers.enabled = true;
		this.import_contacts.enabled = true;
		this.import_stock_definitions.enabled = true;
		this.import_press_definitions.enabled = true;
		this.import_copier_definitions.enabled = true;
		this.import_jobs.enabled = false;
		this.import_invoices.enabled = false;
	}

	private function doImportStockDefinitions():void {
		doImport(handleSelectStockDefinitionsFile);
		this.import_stock_changes.enabled = true;
		this.import_jobs.enabled = true;
	}
	
	private function doImportTaxTables():void {
		doImport(handleSelectTaxTablesFile);
	}
	
	private function doImportPriceSchedules():void {
		doImport(handleSelectPriceSchedulesFile);
		this.import_charge.enabled = false;
		this.import_tax_tables.enabled = true;
		this.import_price_lists.enabled = true;
		this.import_price_schedules.enabled = true;
		this.import_customers.enabled = true;
		this.import_contacts.enabled = true;
		this.import_stock_definitions.enabled = false;
		this.import_press_definitions.enabled = true;
		this.import_copier_definitions.enabled = false;
		this.import_jobs.enabled = false;
		this.import_invoices.enabled = false;
	}
	
	private function doImportCharge():void {
		doImport(handleSelectChargeFile);
	}
	
	private function doImportStockChanges():void {
		doImport(handleSelectStockChangesFile);
	}

	private function doWebAdministration():void {
		var event:EditWebAdminEvent = new EditWebAdminEvent(new mx.rpc.Responder(handleUIEvent, handleFault));
		event.dispatch();

	}
	private function doTableEditor():void {
		var event:TableEditorEvent = new TableEditorEvent(new mx.rpc.Responder(handleUIEvent, handleFault));
		event.dispatch();

	}
	

	private function handleFault(ev:FaultEvent):void {
		var errorDetail:String="";
		if (ev.fault!=null && ev.fault.faultCode=="InvalidSecurityAccess"){
			errorDetail = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, ev.fault.faultDetail);
		}else{
			errorDetail = ev.fault.faultDetail;
		}
		Alert.show(errorDetail,ev.fault.faultCode, Alert.OK, null, null, null, Alert.OK);
	}

	public function handleUIEvent(evt:ResultEvent):void {
		var child:DisplayObject = evt.result as DisplayObject;
		addUniqueTab(child);
	}		

	private function addUniqueTab(tab:DisplayObject):void {
			var tabFound:Boolean = false;
			
			for (var i:int = 0; i < Snowmass.getInstance().mainNavigator.numChildren; i++)
			{
				if (Snowmass.getInstance().mainNavigator.getChildAt(i).name == tab.name)
				{
					Snowmass.getInstance().mainNavigator.selectedIndex = i;
					tabFound = true;
					break;
				}
			}
			if (!tabFound) {
				Snowmass.getInstance().mainNavigator.addChild(tab);
				Snowmass.getInstance().mainNavigator.selectedIndex = Snowmass.getInstance().mainNavigator.numChildren-1;
			}
		}

]]>        
</mx:Script>
                             

                             
	<mx:Canvas width="100%" height="100%" verticalScrollPolicy="off" horizontalScrollPolicy="off">
		<mx:Button label="Import Customers &amp; Customer Contacts" id="import_customers" enabled="true" click="doImportCustomers();"  width="256" x="10" y="130"/>
		<mx:Button label="Import Charge Definitions" id="import_charge_definitions" enabled="true" click="doImportChargeDefinitions();"  width="256" x="10" y="10"/>
		<mx:Button label="Import Charges" id="import_charge" enabled="true" click="doImportCharge();"  width="256" x="276" y="160"/>
		<mx:Button label="Import Standalone Contacts" id="import_contacts" enabled="true" click="doImportContacts();"  width="256" x="10" y="160"/>
		<mx:Button label="Import Customer Logs" id="import_customer_logs" enabled="true" click="doImportCustomerLogs();"  width="256" x="274" y="190"/>
		<mx:Button label="Web Administration" id="printsmith_site_webadmin" enabled="true" click="doWebAdministration();"  width="256" x="10" y="275"/>
		<mx:Button label="Import Invoices" id="import_invoices" enabled="true" click="doImportInvoices();"  width="256" x="274" y="130"/>
		<mx:Button label="Import Jobs" id="import_jobs" enabled="true" click="doImportJobs();"  width="256" x="274" y="100"/>
		<mx:Button label="Import Press Definitions" id="import_press_definitions" enabled="true" click="doImportPressDefinitions();"  width="256" x="10" y="190"/>
		<mx:Button label="Import Stock Definitions" id="import_stock_definitions" enabled="true" click="doImportStockDefinitions();"  width="256" x="274" y="40"/>
		<mx:Button label="Import Price Lists" id="import_price_lists" enabled="true" click="doImportPriceLists();"  width="256" x="10" y="70"/>
		<mx:Button label="Import Price Schedules" id="import_price_schedules" enabled="true" click="doImportPriceSchedules();"  width="256" x="10" y="100"/>
		<mx:Button label="Import Copier Definitions" id="import_copier_definitions" enabled="true" click="doImportCopierDefinitions();"  width="256" x="274" y="10"/>
		<mx:Button label="Import Stock Changes" id="import_stock_changes" enabled="true" click="doImportStockChanges();"  width="256" x="276" y="70"/>
		<mx:Button label="Import Tax Tables" id="import_tax_tables" enabled="true" click="doImportTaxTables();"  width="256" x="10" y="40"/>
		<mx:Button x="274" y="275" label="TableEditor" width="258" click="doTableEditor();"/>
	</mx:Canvas>
<mx:Spacer height="10" />        

</mx:TitleWindow>