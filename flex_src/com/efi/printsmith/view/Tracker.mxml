<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="100%" height="100%" 
	title="Tracker Console" headerHeight="0"
	xmlns:view="com.efi.printsmith.view.*" xmlns:vo="com.efi.printsmith.vo.*" xmlns:ns1="com.hillelcoren.components.*"
	creationComplete="{initTrackerConsole()}" 
	label="Tracker Console" 
	name="Tracker Console" xmlns:components="com.efi.printsmith.common.components.*" xmlns:trackercomponent="com.efi.printsmith.components.tracker.*">
	
	<mx:RemoteObject id="dataService" destination="dataService" showBusyCursor="true">
		<mx:method name="getClockedInEmployee" fault="handleFault(event)" result="handleLoadEmployeeResult(event)"/>
		<mx:method name="getSingle" fault="handleFault(event)" result="handleLoadTrackerConsoleResult(event)"/>
		<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveTrackerConsoleResult(event)"/>
		<mx:method name="getJobsChargesForTrackerByEmployee" fault="handleFault(event)" result="handleLoadJobChargesResult(event)"/>
		<mx:method name="getActiveTrackerConsoleJobsBasedOnEmployeeAndTrackerConsole" fault="handleFault(event)" result="handleLoadTCJobsResult(event)"/>
		<mx:method name="getTrackerConsoleJobsById" fault="handleFault(event)" result="handleLoadTCJobByIdResult(event)"/>
		<!--<mx:method name="deleteItem" fault="handleFault(event)" result="handleDeleteResult(event)"/>-->
		<mx:method name="addUpdateDeleteList" fault="handleFault(event)" result="handleDeleteListResult(event)"/>
	</mx:RemoteObject>
	
	<mx:RemoteObject id="saveDataServiceJob" destination="dataService" showBusyCursor="true">
		<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveJobResult(event)"/>
	</mx:RemoteObject>
	
	<mx:RemoteObject id="updateDataServiceJob" destination="dataService" showBusyCursor="true">
		<mx:method name="addUpdate" fault="handleFault(event)" result="handleUpdateJobResult(event)"/>
	</mx:RemoteObject>
	
	<mx:RemoteObject id="cancelDataService" destination="dataService" showBusyCursor="true">
		<mx:method name="addUpdate" fault="handleFault(event)" result="handleCancelResult(event)"/>
	</mx:RemoteObject>
	
	<mx:RemoteObject id="dataServiceProductionLocation" destination="dataService" showBusyCursor="true">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadProductionLocationResult(event)"/>
	</mx:RemoteObject>
	
	<mx:RemoteObject id="dataServiceFacilty" destination="dataService" showBusyCursor="true">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadFaciltyResult(event)"/>
	</mx:RemoteObject>
	
	<mx:RemoteObject id="dataServiceStation" destination="dataService" showBusyCursor="true">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadStationResult(event)"/>
	</mx:RemoteObject>
	
	<mx:RemoteObject id="dataServiceException" destination="dataService" showBusyCursor="true">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadExceptionResult(event)"/>
	</mx:RemoteObject>
	
	<mx:RemoteObject id="dataServicePending" destination="dataService" showBusyCursor="true">
		<mx:method name="getTracker" fault="handleFault(event)" result="handleLoadPendingResult(event)"/>
	</mx:RemoteObject>
	
	<mx:RemoteObject id="invoiceService" destination="dataService" showBusyCursor="true">
		<mx:method name="getInvoice" fault="handleFault(event)" result="handleGetInvoiceResult(event)"/>
	</mx:RemoteObject>
	
	<mx:RemoteObject id="updateDataService" destination="dataService" showBusyCursor="true">
		<mx:method name="addUpdate" fault="handleFault(event)"/>
	</mx:RemoteObject>
	
	<mx:Script source="../common/scripts/ComponentHelper.as"/>
	
	<mx:Script source="../util/tracker/TrackerUtil.as"/>
	
	<mx:Script> 
	                                  
	<![CDATA[
		import com.efi.mdi.view.window.MDIWindow;
		import com.efi.printsmith.events.TrackerConsoleDetailsEvent;
		import mx.utils.StringUtil;
		import com.efi.printsmith.data.ProductionExceptions;
		import com.efi.printsmith.events.TrackerConsoleStopEvent;
		import com.efi.printsmith.pages.TrackerConsoleStopWindow;
		import com.efi.printsmith.data.Estimate;
		import mx.events.IndexChangedEvent;
		import com.efi.printsmith.data.TrackerConsolePasses;
		import com.efi.printsmith.pages.TrackerConsoleDetails;
		import com.efi.printsmith.data.TrackerConsoleJobs;
		import com.efi.printsmith.data.Charge;
		import mx.events.CloseEvent;
		import flash.net.registerClassAlias;
		import mx.utils.ObjectUtil;
		import com.efi.printsmith.data.ProductionLocations;
		import com.efi.printsmith.data.ProductionStations;
		import com.efi.printsmith.data.ProductionFacilities;
		import com.efi.printsmith.data.TrackerConsole;
		import mx.controls.dataGridClasses.DataGridColumn;
		import com.efi.printsmith.data.Job;
		import com.efi.printsmith.data.JobBase;
		import com.efi.printsmith.data.Invoice;
		import com.efi.printsmith.data.Employee;  
		import com.efi.printsmith.data.InvoiceBase;                        
		import mx.controls.Alert;                                         
		import mx.managers.PopUpManager;                                         
		import mx.containers.TitleWindow;                                         
		import mx.collections.ArrayCollection;                                         
		import mx.rpc.events.ResultEvent;                                         
		import mx.rpc.events.FaultEvent;         
		
		[Bindable] public var trackerConsole:TrackerConsole;    
		
		[Bindable] private var employee:Employee;
		
		[Bindable] private var employeesArray:ArrayCollection = new ArrayCollection();
		[Bindable] private var trackerList:ArrayCollection = new ArrayCollection();
		[Bindable] private var productionLocationArray:ArrayCollection = new ArrayCollection();
		 
		[Bindable] private var facilitiesArray:ArrayCollection = new ArrayCollection();
		[Bindable] private var stationsArray:ArrayCollection = new ArrayCollection();
		[Bindable] private var productionStations:ArrayCollection = new ArrayCollection();
		
		[Bindable] private var exceptionsArray:ArrayCollection = new ArrayCollection();
		
		[Bindable] private var onLoad:Boolean = true;
		
		[Bindable] private var selectedJob:Job;
		
		[Bindable] private var selectedCharge:Charge;
		
		[Bindable] private var trackerConsoleJobsList:ArrayCollection = new ArrayCollection();
		
		[Bindable] private var selectedTrackerConsoleJob:TrackerConsoleJobs;
		
		[Bindable] private var trackerStatus:String="";
		
		[Bindable] private var refreshList:Boolean = false;
		
		[Bindable] private var selectedDGIndex:int = -1; 
		
		[Bindable] private var closeEventTriggered:Boolean = false;
		
		[Bindable] private var trackerConsoleJobsAddUpdate:Boolean = false;
		
		[Bindable] private var itemSelect:Boolean = false;
		
		[Bindable] private var resetTrackerConsoleJobs:TrackerConsoleJobs;
		
		[Bindable] private var completedTracketConsoleJobsList:ArrayCollection = new ArrayCollection();
		
		[Bindable] private var updatedTrackerConsole:Boolean = false;
		
		[Bindable] private var fontSizeList:ArrayCollection = new ArrayCollection();
		
		[Bindable] private var refreshActiveList:Boolean = false;
		
		[Bindable] private var closeJob:Boolean = false;
		
		[Bindable] private var completedTrackerConsoleJob:TrackerConsoleJobs;
		 
		 
		public function initTrackerConsole():void {
			
			var mdiWin:MDIWindow = Snowmass.getInstance().containerManager.getWindowWithChild(this);
			mdiWin.title ="Tracker Console";
		
			var fontObj:Object = new Object();
			fontObj.key = "Small";
			fontObj.value = resourceManager.getString(Snowmass.RESOURCE_BUNDLE,"menu_321.Small");
			fontSizeList.addItem(fontObj);
			fontObj = new Object();
			fontObj.key = "Medium";
			fontObj.value = resourceManager.getString(Snowmass.RESOURCE_BUNDLE,"menu_321.Medium");
			fontSizeList.addItem(fontObj);
			fontObj = new Object();
			fontObj.key = "Large";
			fontObj.value = resourceManager.getString(Snowmass.RESOURCE_BUNDLE,"menu_321.Large");
			fontSizeList.addItem(fontObj);
			dataService.getSingle("TrackerConsole");
			dataServiceException.getAll("ProductionExceptions");
		}
		 
		private function handleFault(ev:FaultEvent):void {  
			var message:String;
			              
			message = "Error: "                          
			+ ev.fault.faultCode + " - "                                  
			+ ev.fault.faultDetail + " - "                                  
			+ ev.fault.faultString;
			Alert.show(message, "Error", 0, null, null, null, 4);                                 
		}
	
	
	// Data Load Handlers
	
		private function handleLoadTrackerConsoleResult(event:ResultEvent):void {
			trackerConsole = event.result as TrackerConsole;
			if(trackerConsole==null){
				trackerConsole = new TrackerConsole();
				trackerConsole.pendingListSize = "Medium";
				trackerConsole.activeListSize = "Medium";
				dataService.addUpdate(trackerConsole);
			} else if(trackerConsole!=null){
				if(trackerConsole.pendingListSize==null || trackerConsole.pendingListSize=="") {
					trackerConsole.pendingListSize = "Medium";
				}
				if(trackerConsole.activeListSize==null || trackerConsole.activeListSize=="") {
					trackerConsole.activeListSize = "Medium";
				}
				dataService.addUpdate(trackerConsole);
			}
			if(onLoad){
				dataService.getClockedInEmployee();	
				dataServiceFacilty.getAll("ProductionFacilities");
				dataServiceStation.getAll("ProductionStations");		
				dataServiceProductionLocation.getAll("ProductionLocations");
			}
		}
		
		private function handleLoadEmployeeResult(event:ResultEvent):void {
			var list:ArrayCollection = event.result as ArrayCollection;
			for each(var employeeObject:Employee in list){
				employeeObject.employeeName = employeeObject.lastName+", "+employeeObject.firstName;
			}
			var employeeObj:Employee = new Employee();
			employeeObj.employeeId = null;
			employeeObj.employeeName = "";
			list.addItemAt(employeeObj,0);
			employeesArray = list;
			if(trackerConsole.selectedEmployee!=null){
				var checkFlag:Boolean = false;
				for each(var employeeObject:Employee in employeesArray) {
					if(trackerConsole.selectedEmployee.employeeId==employeeObject.employeeId){
						checkFlag = true;
						trackerConsole.selectedEmployee = employeeObject;
						employee = trackerConsole.selectedEmployee;
						break;
					}
				}
				if(!checkFlag){
					trackerConsole.selectedEmployee = null;
					employee = null;
				}
			}
			
			trackerList = new ArrayCollection();
			trackerConsoleJobsList = new ArrayCollection();
			if(onLoad){
				onLoad = false;
				dataService.getActiveTrackerConsoleJobsBasedOnEmployeeAndTrackerConsole(null);
			}
			getEmployee();
		}
		private function handleLoadProductionLocationResult(event:ResultEvent):void {
			var list:ArrayCollection = event.result as ArrayCollection;
			var location:ProductionLocations = new ProductionLocations();
			location.id = 0;
			location.name = "";
			list.addItemAt(location,0);
			productionLocationArray = list;
		}
		
		private function handleLoadPendingResult(event:ResultEvent):void{
			trackerList = event.result as ArrayCollection;
		}
		
		private function handleLoadFaciltyResult(event:ResultEvent):void {
		    var list:ArrayCollection = event.result as ArrayCollection;
			var facility:ProductionFacilities = new ProductionFacilities();
			facility.id = 0;
			facility.name = "";
			list.addItemAt(facility,0);
			facilitiesArray = list;
		}
		
		private function handleLoadStationResult(event:ResultEvent):void {
			var list:ArrayCollection = event.result as ArrayCollection;
			for each(var stationObj:ProductionStations in list){
				productionStations.addItem(stationObj);
			}
			if(trackerConsole.selectedStations!=null && trackerConsole.selectedStations.length>0){
				for each(var stationObj:ProductionStations in productionStations){
					for each(var stationObject:ProductionStations in trackerConsole.selectedStations) {
						if(stationObject.id==stationObj.id){
							stationObj.isSelected = true;
						}
					}
				}
			}
			var station:ProductionStations = new ProductionStations();
			station.id = 0;
			station.name = "";
			list.addItemAt(station,0);
			stationsArray = list;
			if(trackerConsole.selectedStations!=null && trackerConsole.selectedStations.length>0) {
				for each(var selectedStation:ProductionStations in trackerConsole.selectedStations){
					for each(var station:ProductionStations in stationsArray){
						if(selectedStation.id == station.id){
							station.isSelected = true;
							break;
						}
					}
				}
			}
		}
		
		private function handleLoadExceptionResult(event:ResultEvent):void {
			var list:ArrayCollection = event.result as ArrayCollection;
			var exception:ProductionExceptions = new ProductionExceptions();
			exception.id = 0;
			exception.name = "";
			list.addItemAt(exception,0);
			exceptionsArray = list;
		}
		
		private function doName(item:Object):String{
			var temp:Employee =  item as Employee;
			var tempString:String;
			 tempString = temp.firstName as String;
			 tempString += " ";
			 tempString += temp.lastName as String;
			return tempString;
		}
		
		private function getEmployee(event:Event=null):void {
			if(trackerConsole.selectedEmployee!=null){
				if(trackerConsole.selectedEmployee.employeeId==null){
					employee = null;
					selectedJob = null;
					selectedCharge = null;
					trackerList = new ArrayCollection();
				} else {
					employee = trackerConsole.selectedEmployee;
				}
				if(employee!=null){
					trackerList = new ArrayCollection();
					selectedJob = null;
					selectedCharge = null;
					dataService.getJobsChargesForTrackerByEmployee(employee.id, new Date());
				}
				progressBarComponent.trackerConsoleJobs = null;
				closeEventTriggered = true;
				resetButtons();
				trackerConsoleJobsList = new ArrayCollection();
				dataService.getActiveTrackerConsoleJobsBasedOnEmployeeAndTrackerConsole(employee);
			} else {
				resetButtons();
				employee = null;
				selectedJob = null;
				selectedCharge = null;
				progressBarComponent.trackerConsoleJobs = null;
				closeEventTriggered = true;
				resetButtons();
				trackerList = new ArrayCollection();
				trackerConsoleJobsList = new ArrayCollection();
				dataService.getActiveTrackerConsoleJobsBasedOnEmployeeAndTrackerConsole(employee);
			}
		}
		
		private function doConsoleJobSelection(event:Event):void {
			if(event.currentTarget.selectedIndex>-1){
				var trackerConsoleJobObject:TrackerConsoleJobs = event.currentTarget.selectedItem as TrackerConsoleJobs;
				itemSelect = true;
				resetButtons();
				dataService.getTrackerConsoleJobsById(trackerConsoleJobObject.id);
			}
		}
		
		private function doSelectCompletedJob(event:Event):void {
			if(event.currentTarget.selectedIndex>-1){
				completedTrackerConsoleJob = event.currentTarget.selectedItem as TrackerConsoleJobs;
			} else {
				completedTrackerConsoleJob = null;
			}
		}
		
		private function openClockInOut():void {
			var clockInOut:ClockInOut = PopUpManager.createPopUp(this,ClockInOut,true) as ClockInOut;
			clockInOut.addEventListener(CloseEvent.CLOSE,function(event:Event):void{
				closeEventTriggered = true;
				selectedCharge = null;
				selectedJob = null;
				dataService.getClockedInEmployee();
			},false,0,true);
		}
		
		private function openEditEmployee():void {
			var editEmployee:EditEmployee = PopUpManager.createPopUp(this,EditEmployee,true) as EditEmployee;
			editEmployee.addEventListener(CloseEvent.CLOSE,function(event:Event):void{
				closeEventTriggered = true;
				selectedCharge = null;
				selectedJob = null;
				dataService.getClockedInEmployee();
			},false,0,true);
			if(employee!=null){
				registerClassAlias("com.efi.printsmith.data.Employee",Employee);
				editEmployee.employee = ObjectUtil.copy(employee) as Employee;
			}
		}
		
		private function handleLoadJobChargesResult(event:ResultEvent):void {
			trackerList = event.result as ArrayCollection;
		}
		
		private function handleLoadTCJobsResult(event:ResultEvent):void {
			trackerConsoleJobsList = event.result as ArrayCollection;
			if(trackerConsoleJobsAddUpdate){
				trackerConsoleJobsAddUpdate = false;
				if(selectedTrackerConsoleJob!=null){
					var counter:int=0;
					var checkFlag:Boolean = false;
					for each(var trackerConsoleJobsObj:TrackerConsoleJobs in trackerConsoleJobsList){
						if(trackerConsoleJobsObj.id == selectedTrackerConsoleJob.id){
							employee_jobs_grid.selectedIndex = counter;
							selectedTrackerConsoleJob = trackerConsoleJobsObj;
							registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
							progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
							if(employee!=null){
								enableRequiredBtns();	
							} else {
								defaultEnableButtons();
							}
							checkFlag = true;
							break;
						}
						counter++;
					}
					if(!checkFlag){
						resetButtons();
						selectedTrackerConsoleJob = null;
						progressBarComponent.trackerConsoleJobs = null;
					}
				}
			}
			else if(refreshList){
				refreshList = false;
				if(selectedDGIndex>-1){
					if(trackerConsoleJobsList!=null && trackerConsoleJobsList.length>0){
						if(trackerConsoleJobsList.length-1>=selectedDGIndex) {
							employee_jobs_grid.selectedIndex = selectedDGIndex;
							selectedTrackerConsoleJob = employee_jobs_grid.selectedItem as TrackerConsoleJobs;
							registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
							progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
							enableRequiredBtns();
						} else {
							employee_jobs_grid.selectedIndex = trackerConsoleJobsList.length-1;
							selectedTrackerConsoleJob = employee_jobs_grid.selectedItem as TrackerConsoleJobs;
							registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
							progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
							enableRequiredBtns();
						}
					} else {
						resetButtons();
						selectedTrackerConsoleJob = null;
						progressBarComponent.trackerConsoleJobs = null;
					}
					selectedDGIndex = -1;
				} else {
					resetButtons();
					selectedTrackerConsoleJob = null;
					progressBarComponent.trackerConsoleJobs = null;
				}
			}
			else if(closeEventTriggered){
				closeEventTriggered = false;
				if(selectedTrackerConsoleJob!=null){
					var counter:int=0;
					var checkFlag:Boolean = false;
					for each(var trackerConsoleJobsObj:TrackerConsoleJobs in trackerConsoleJobsList){
						if(trackerConsoleJobsObj.id == selectedTrackerConsoleJob.id){
							employee_jobs_grid.selectedIndex = counter;
							selectedTrackerConsoleJob = trackerConsoleJobsObj;
							registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
							progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
							if(employee!=null){
								enableRequiredBtns();	
							} else {
								defaultEnableButtons();
							}
							checkFlag = true;
							break;
						}
						counter++;
					}
					if(!checkFlag){
						resetButtons();
						selectedTrackerConsoleJob = null;
						progressBarComponent.trackerConsoleJobs = null;
					}
				}
			} else {
				resetButtons();
				selectedTrackerConsoleJob = null;
				progressBarComponent.trackerConsoleJobs = null;
			}
		}
		
		/* public function getInvoiceNumber(object:Object):String {
			if(object is TrackerConsoleJobs){
				if(object.job!=null){
					object = object.job;
				} else {
					object = object.charge;
				}
			} 
			if(object is Job){
				var job:Job = object as Job;
				return String(job.parentInvoice.invoiceNumber);	
			}
			if(object is Charge){
				var charge:Charge = object as Charge;
				if(charge.parentInvoice!=null){
					return String(charge.parentInvoice.invoiceNumber);
				}
				if(charge.parentJob!=null){
					return String(charge.parentJob.jobNumber)+" / "+charge.parentJob.parentInvoice.invoiceNumber;
				}
			}
			return "";
		} */
		
		public function getDeliveryDate(object:Object):String {
			if(object is Job){
				var job:Job = object as Job;
				if(job.parentInvoice.deliveryIntentDate!=null)
				return dateFormatter.format(job.parentInvoice.deliveryIntentDate);	
			}
			if(object is Charge){
				var charge:Charge = object as Charge;
				if(charge.parentInvoice!=null){
					if(charge.parentInvoice.deliveryIntentDate!=null)
					return dateFormatter.format(charge.parentInvoice.deliveryIntentDate);
				}
				if(charge.parentJob!=null){
					if(charge.parentJob.parentInvoice.deliveryIntentDate!=null)
					return dateFormatter.format(charge.parentJob.parentInvoice.deliveryIntentDate);
				}
			}
			return "";
		}
		
		public function getTotalTime(object:Object):String {
			var actualSetUpTime:Number = 0;
			var actualRunTime:Number = 0;
			var actualWashTime:Number = 0;
			if(object is Job){
				var job:Job = object as Job;
				if(!job.releasedToProduction){
					return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.Release');
				}
			}
			if(employee!=null){
				if(employee.hideEstimateTimeTracker){
					return "--";
				}
			}
			if(object is Job){
				var job:Job = object as Job;
				if(job.costingRecord!=null){
					if(!isNaN(job.costingRecord.actualSetupTime)){
						actualSetUpTime = (job.costingRecord.actualSetupTime*60*1000);
					}
				}
				if(job.costingRecord!=null){
					if(!isNaN(job.costingRecord.actualRunTime)){
						actualRunTime = (job.costingRecord.actualRunTime*60*1000);
					}
				}
				if(job.costingRecord!=null){
					if(!isNaN(job.costingRecord.actualWashupTime)){
						actualWashTime = (job.costingRecord.actualWashupTime*60*1000);
					}
				}
			} else if(object is Charge){
				var charge:Charge = object as Charge;
				if(charge.chargeCostingRecord!=null){
					if(!isNaN(charge.chargeCostingRecord.setupTime)){
						actualSetUpTime = (charge.chargeCostingRecord.setupTime*60*1000);
					}
				}
				if(charge.chargeCostingRecord!=null){
					if(!isNaN(charge.chargeCostingRecord.runTime)){
						actualRunTime = (charge.chargeCostingRecord.runTime*60*1000);
					}
				}
			}
			return convertMilliSecondsToString((actualSetUpTime+actualRunTime+actualWashTime),true);
		}
		
		public function getPriority(object:Object):String {
			if(object is Job){
				var job:Job = object as Job;
				if(!job.releasedToProduction){
					return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.Release');
				}
			}
			return "";
		}
		
		public function getProductionLoc(object:Object):String {
			if(object is Job){
				var job:Job = object as Job;
				return job.location.name;	
			}
			if(object is Charge){
				var charge:Charge = object as Charge;
				return charge.productionLocation.name;
			}
			return "";
		}
		
		public function getRunDate(object:Object):String {
			if(object is Job){
				var job:Job = object as Job;
				if(!job.releasedToProduction){
					return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.Release');
				}
			}
			return "";
		}
		
		public function getAccount(object:Object):String{
			if(object is Job){
				var job:Job = object as Job;
				return "#"+job.parentInvoice.account.id + " "+job.parentInvoice.account.title;	
			}
			if(object is Charge){
				var charge:Charge = object as Charge;
				if(charge.parentInvoice!=null){
					return "#"+charge.parentInvoice.account.id + " "+charge.parentInvoice.account.title;
				}
				if(charge.parentJob!=null){
					var jobBase:JobBase = charge.parentJob as JobBase;
					return "#"+jobBase.parentInvoice.account.id + " "+jobBase.parentInvoice.account.title;
				}
			}
			return "";
		}
		
		public function getJobDescription(object:Object):String {
			return object.description;
		}
		
		public function getTotalJobTime(object:Object):String {
			var qtyOrdered:String = "";
			var totalTime:String = "";
			var trackerConsoleJobsObj:TrackerConsoleJobs = object as TrackerConsoleJobs;
			if(trackerConsoleJobsObj.employee!=null){
				if(trackerConsoleJobsObj.employee.hideEstimateTimeTracker){
					totalTime = "--";
				} else {
					totalTime = convertMilliSecondsToString((object.actualSetUpTime+object.actualRunTime+object.actualWashTime),true);
				}
			}
			if(trackerConsoleJobsObj.job!=null){
				if(!isNaN(trackerConsoleJobsObj.job.qtyOrdered)) {
					qtyOrdered = String(trackerConsoleJobsObj.job.qtyOrdered);
				}
			} else if(trackerConsoleJobsObj.charge!=null){
				if(!isNaN(trackerConsoleJobsObj.charge.quantity)) {
					qtyOrdered = String(trackerConsoleJobsObj.charge.quantity);
				}
			}
			if(qtyOrdered=="" || qtyOrdered=="0"){
				return totalTime;
			}
			return totalTime+" / "+qtyOrdered;
		}
		
		public function getActualJobTime(object:Object,updateTimer:Boolean):String {
			var trackerConsoleJobsObj:TrackerConsoleJobs = object as TrackerConsoleJobs;
			var totalValue:Number = 0;
			var initialValue:Number = 0;
			for each(var passes:TrackerConsolePasses in trackerConsoleJobsObj.passesList){
				if(passes.passNo<trackerConsoleJobsObj.currentPass) {
					if(!(isNaN(passes.setUpTime)) && passes.setUpTime!=0) {
						totalValue = totalValue + passes.setUpTime;
					}
					if(!(isNaN(passes.runTime)) && passes.runTime!=0) {
						totalValue = totalValue + passes.runTime;
					}
					if(!(isNaN(passes.washUpTime)) && passes.washUpTime!=0) {
						totalValue = totalValue + passes.washUpTime;
					}
				}
			}
			for each(var passes:TrackerConsolePasses in trackerConsoleJobsObj.passesList){
				if(passes.passNo==trackerConsoleJobsObj.currentPass) {
					if(!trackerConsoleJobsObj.paused) {
						initialValue = passes.trackDate.time;
						if(!(isNaN(passes.trackTime)) && passes.trackTime!=0){
							initialValue = initialValue - passes.trackTime;
						}
						if(!(isNaN(passes.setUpTime)) && passes.setUpTime!=0){
							initialValue = initialValue - passes.setUpTime; 
						}
						if(!(isNaN(passes.runTime)) && passes.runTime!=0){
							initialValue = initialValue - passes.runTime; 
						}
						initialValue = new Date().time - initialValue;
					} else {
						if(!(isNaN(passes.trackTime)) && passes.trackTime!=0){
							initialValue = initialValue + passes.trackTime;
						}
						if(!(isNaN(passes.setUpTime)) && passes.setUpTime!=0){
							initialValue = initialValue + passes.setUpTime; 
						}
						if(!(isNaN(passes.runTime)) && passes.runTime!=0){
							initialValue = initialValue + passes.runTime; 
						}
					}
				}
			}
			return convertMilliSecondsToString((totalValue+initialValue),true);
		}
		
		public function updateTrackerConsole():void {
			updatedTrackerConsole = true;
			if(trackerConsole.productionFacilities!=null){
				if(trackerConsole.productionFacilities.id==0){
					trackerConsole.productionFacilities = null;
				}
			}
			if(trackerConsole.productionStations!=null){
				if(trackerConsole.productionStations.id==0){
					trackerConsole.productionStations = null;
				}
			}
			trackerConsole.selectedStations = new ArrayCollection();
			for each(var productionStation:ProductionStations in productionStations) {
				if(productionStation.isSelected) {
					trackerConsole.selectedStations.addItem(productionStation);
				}
			}
			dataService.addUpdate(trackerConsole);
		}
		
		public function updateTrackerConsoleWithRefresh():void {
			updatedTrackerConsole = true;
			refreshActiveList = true;
			if(trackerConsole.productionFacilities!=null){
				if(trackerConsole.productionFacilities.id==0){
					trackerConsole.productionFacilities = null;
				}
			}
			if(trackerConsole.productionStations!=null){
				if(trackerConsole.productionStations.id==0){
					trackerConsole.productionStations = null;
				}
			}
			trackerConsole.selectedStations = new ArrayCollection();
			for each(var productionStation:ProductionStations in productionStations) {
				if(productionStation.isSelected) {
					trackerConsole.selectedStations.addItem(productionStation);
				}
			}
			dataService.addUpdate(trackerConsole);
		}
		
		private function handleSaveTrackerConsoleResult(event:ResultEvent):void {
			if(isNaN(trackerConsole.id) || trackerConsole.id==0){
				dataService.getSingle("TrackerConsole");
			}	
		}
		
		private function doSelectJob(event:Event):void {
			selectedCharge = null;
			selectedJob = null;
			if(event.currentTarget.selectedItem is Job){
				selectedJob = event.currentTarget.selectedItem as Job;
			}
			if(event.currentTarget.selectedItem is Charge){
				selectedCharge = event.currentTarget.selectedItem as Charge;
			}
			resetButtons();
			startBtn.enabled = true;
			defaultEnableButtons();
		}
		
		private function resetButtons():void {
			startBtn.enabled = false;
			setUpBtn.enabled = false;
			washUpBtn.enabled = false;
			stopBtn.enabled = false;
			cancelBtn.enabled = false;
			pauseBtn.enabled = false;
			continueBtn.enabled = false;
			openBtn.enabled = false;
			jobTicketBtn.enabled = false;
			layoutBtn.enabled = false;
		}
		
		private function defaultEnableButtons():void {
			openBtn.enabled = true;
			jobTicketBtn.enabled = true;
			layoutBtn.enabled = true;
		}
		
		private function startJob():void {
			var passesList:ArrayCollection = new ArrayCollection();
			if((selectedJob!=null || selectedCharge!=null) && trackerConsole.productionFacilities!=null && trackerConsole.productionStations!=null && employee!=null){
				if(selectedJob!=null){
					if(!selectedJob.releasedToProduction){
						Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'scheduleMyWorkCenterCmd.Itemcouldnotbestarte'));
						return;
					}
				}
				if(selectedCharge!=null){
					if(selectedCharge.parentInvoice!=null && !selectedCharge.parentInvoice.releasedToProduction){
						Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'scheduleMyWorkCenterCmd.Itemcouldnotbestarte'));
						return;
					}
				}
				for each(var trackerConsoleJobsObj:TrackerConsoleJobs in trackerConsoleJobsList) {
					if(trackerConsoleJobsObj.job!=null && selectedJob!=null){
						if(trackerConsoleJobsObj.job.id == selectedJob.id && trackerConsoleJobsObj.productionFacilities.id==trackerConsole.productionFacilities.id
							&& trackerConsoleJobsObj.productionStations.id==trackerConsole.productionStations.id && trackerConsoleJobsObj.employee.id==employee.id){
							var checkFlag:Boolean = false;
							for each(var trackerConsolePasses:TrackerConsolePasses in trackerConsoleJobsObj.passesList) {
								if(trackerConsolePasses.passNo==trackerConsoleJobsObj.currentPass) {
									if(trackerConsolePasses.setUpCompleted || trackerConsolePasses.runCompleted || trackerConsolePasses.washUpCompleted){
										checkFlag = true;
										Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'msg_ThisitemalreadyhasaT'));
										break;
									}
								}
							}
							if(!checkFlag){
								Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'msg_Thisitemalreadyhasaa'), resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'changePriceCmd.Confirm'), Alert.YES | Alert.NO , this, function(event:CloseEvent):void {
									if (event.detail==Alert.YES) {
										trackerStatus = "start";
										trackerConsoleJobsObj.paused = false;
										for each(var trackerConsolePasses:TrackerConsolePasses in trackerConsoleJobsObj.passesList) {
											if(trackerConsolePasses.passNo==trackerConsoleJobsObj.currentPass) {
												trackerConsolePasses.trackDate = new Date();
												trackerConsolePasses.trackTime = 0;
												trackerConsolePasses.setUpDate = null;
												trackerConsolePasses.setUpTime = 0;
												trackerConsolePasses.setUpCompleted = false;
												trackerConsolePasses.runDate = null;
												trackerConsolePasses.runTime = 0;
												trackerConsolePasses.runCompleted = false;
												trackerConsolePasses.washUpDate = null;
												trackerConsolePasses.washUpTime = 0;
												trackerConsolePasses.washUpCompleted = false;
											}
										}
										updateDataServiceJob.addUpdate(trackerConsoleJobsObj);
									}
								});
							}
							return;
						}
					} else if(trackerConsoleJobsObj.charge!=null && selectedCharge!=null){
						if(trackerConsoleJobsObj.charge.id == selectedCharge.id && trackerConsoleJobsObj.productionFacilities.id==trackerConsole.productionFacilities.id
							&& trackerConsoleJobsObj.productionStations.id==trackerConsole.productionStations.id && trackerConsoleJobsObj.employee.id==employee.id){
							var checkFlag:Boolean = false;
							for each(var trackerConsolePasses:TrackerConsolePasses in trackerConsoleJobsObj.passesList) {
								if(trackerConsolePasses.passNo==trackerConsoleJobsObj.currentPass) {
									if(trackerConsolePasses.setUpCompleted || trackerConsolePasses.runCompleted || trackerConsolePasses.washUpCompleted){
										checkFlag = true;
										Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'msg_ThisitemalreadyhasaT'));
										break;
									}
								}
							}
							if(!checkFlag){
								Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'msg_Thisitemalreadyhasaa'), resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'changePriceCmd.Confirm'), Alert.YES | Alert.NO , this, function(event:CloseEvent):void {
									if (event.detail==Alert.YES) {
										trackerStatus = "start";
										trackerConsoleJobsObj.paused = false;
										for each(var trackerConsolePasses:TrackerConsolePasses in trackerConsoleJobsObj.passesList) {
											if(trackerConsolePasses.passNo==trackerConsoleJobsObj.currentPass) {
												trackerConsolePasses.trackDate = new Date();
												trackerConsolePasses.trackTime = 0;
												trackerConsolePasses.setUpDate = null;
												trackerConsolePasses.setUpTime = 0;
												trackerConsolePasses.setUpCompleted = false;
												trackerConsolePasses.runDate = null;
												trackerConsolePasses.runTime = 0;
												trackerConsolePasses.runCompleted = false;
												trackerConsolePasses.washUpDate = null;
												trackerConsolePasses.washUpTime = 0;
												trackerConsolePasses.washUpCompleted = false;
											}
										}
										updateDataServiceJob.addUpdate(trackerConsoleJobsObj);
									}
								});
							}
							return;
						}
					}
				}
				trackerStatus = "start";
				var trackerConsoleJobs:TrackerConsoleJobs = new TrackerConsoleJobs();
				trackerConsoleJobs.productionFacilities = trackerConsole.productionFacilities;
				trackerConsoleJobs.productionStations = trackerConsole.productionStations;
				if(selectedJob!=null){
					trackerConsoleJobs.productionLocations = selectedJob.location;
					trackerConsole.productionLocation = selectedJob.location;
					if(trackerConsole.productionLocation==null){
						trackerConsole.productionLocation = new ProductionLocations();
					}
					trackerconsole_location.customText = getCustomTextData(productionLocationArray,trackerConsole,trackerConsole.productionLocation);
				} else if(selectedCharge!=null){
					trackerConsoleJobs.productionLocations = selectedCharge.productionLocation;
					trackerConsole.productionLocation = selectedCharge.productionLocation;
					if(trackerConsole.productionLocation==null){
						trackerConsole.productionLocation = new ProductionLocations();
					}
					trackerconsole_location.customText = getCustomTextData(productionLocationArray,trackerConsole,trackerConsole.productionLocation);
				}
				trackerConsoleJobs.employee = employee;
				var actualSetUpTime:Number = 0;
				var actualRunTime:Number = 0;
				var actualWashTime:Number = 0;
				if(selectedJob!=null){
					trackerConsoleJobs.job = selectedJob;
					if(selectedJob.costingRecord!=null){
						if(!isNaN(selectedJob.costingRecord.actualSetupTime)){
							actualSetUpTime = (selectedJob.costingRecord.actualSetupTime*60*1000);
						}
					}
					trackerConsoleJobs.actualSetUpTime = actualSetUpTime;
					if(selectedJob.costingRecord!=null){
						if(!isNaN(selectedJob.costingRecord.actualRunTime)){
							actualRunTime = (selectedJob.costingRecord.actualRunTime*60*1000);
						}
					}
					trackerConsoleJobs.actualRunTime = actualRunTime;
					if(selectedJob.costingRecord!=null){
						if(!isNaN(selectedJob.costingRecord.actualWashupTime)){
							actualWashTime = (selectedJob.costingRecord.actualWashupTime*60*1000);
						}
					}
					trackerConsoleJobs.actualWashTime = actualWashTime;
					trackerConsoleJobs.noOfPasses = selectedJob.frontPasses+selectedJob.backPasses;
					if(isNaN(trackerConsoleJobs.noOfPasses) || trackerConsoleJobs.noOfPasses==0){
						trackerConsoleJobs.noOfPasses=1;
					}
				} else if(selectedCharge!=null){
					trackerConsoleJobs.charge = selectedCharge;
					if(selectedCharge.chargeCostingRecord!=null){
						if(!isNaN(selectedCharge.chargeCostingRecord.setupTime)){
							actualSetUpTime = (selectedCharge.chargeCostingRecord.setupTime*60*1000);
						}
					}
					trackerConsoleJobs.actualSetUpTime = actualSetUpTime;
					if(selectedCharge.chargeCostingRecord!=null){
						if(!isNaN(selectedCharge.chargeCostingRecord.runTime)){
							actualRunTime = (selectedCharge.chargeCostingRecord.runTime*60*1000);
						}
					}
					trackerConsoleJobs.actualRunTime = actualRunTime;
					trackerConsoleJobs.actualWashTime = actualWashTime;
					trackerConsoleJobs.noOfPasses = 1;
				}
				trackerConsoleJobs.currentPass = 1;
				trackerConsoleJobs.canceled = false;
				var trackerConsolePasses:TrackerConsolePasses = new TrackerConsolePasses();
				trackerConsolePasses.passNo = 1;
				trackerConsolePasses.trackDate = new Date();
				trackerConsolePasses.trackerConsoleJobs = trackerConsoleJobs;
				passesList.addItem(trackerConsolePasses);
				trackerConsoleJobs.passesList = passesList;
				trackerConsoleJobsAddUpdate = true;
				saveDataServiceJob.addUpdate(trackerConsoleJobs);
			}
		}
		
		private function handleDeleteListResult(event:ResultEvent):void {
			if(resetTrackerConsoleJobs!=null){
				var passesList:ArrayCollection = new ArrayCollection();
				trackerStatus = "start";
				resetTrackerConsoleJobs.currentPass = 1;
				resetTrackerConsoleJobs.paused = false;
				var trackerConsolePasses:TrackerConsolePasses = new TrackerConsolePasses();
				trackerConsolePasses.passNo = 1;
				trackerConsolePasses.trackDate = new Date();
				trackerConsolePasses.trackerConsoleJobs = resetTrackerConsoleJobs;
				passesList.addItem(trackerConsolePasses);
				resetTrackerConsoleJobs.passesList = passesList;
				updateDataServiceJob.addUpdate(resetTrackerConsoleJobs);
			}
		}
		
		private function handleCancelResult(event:ResultEvent):void {
			if(selectedDGIndex>-1){
				refreshList = true;
				progressBarComponent.trackerConsoleJobs = null;
				resetButtons();
				trackerConsoleJobsList = new ArrayCollection();
				dataService.getActiveTrackerConsoleJobsBasedOnEmployeeAndTrackerConsole(employee);
			} else {
				resetButtons();
				selectedTrackerConsoleJob = null;
				progressBarComponent.trackerConsoleJobs = null;
			}
		}
		
		private function handleSaveJobResult(event:ResultEvent):void {
			var trackerConsoleJobs:TrackerConsoleJobs = event.result as TrackerConsoleJobs;
			selectedTrackerConsoleJob = trackerConsoleJobs;
			closeEventTriggered = true;
			progressBarComponent.trackerConsoleJobs = null;
			resetButtons();
			trackerConsoleJobsList = new ArrayCollection();
			dataService.getActiveTrackerConsoleJobsBasedOnEmployeeAndTrackerConsole(employee);
		}
		
		private function setUpJob():void {
			if(selectedTrackerConsoleJob!=null){
				var nowDate:Date = new Date();
				var totalSetUpTime:Number = 0;
				trackerStatus = "setup";
				for each(var trackerConsolePasses:TrackerConsolePasses in selectedTrackerConsoleJob.passesList){
					if(trackerConsolePasses.passNo==selectedTrackerConsoleJob.currentPass){
						trackerConsolePasses.setUpCompleted = true;
						totalSetUpTime = (nowDate.time-trackerConsolePasses.trackDate.time);
						if(!(isNaN(trackerConsolePasses.trackTime)) && trackerConsolePasses.trackTime!=0){
							totalSetUpTime = totalSetUpTime + trackerConsolePasses.trackTime;
						}
						trackerConsolePasses.trackDate = nowDate;
						trackerConsolePasses.trackTime = 0;
						trackerConsolePasses.setUpDate = nowDate;
						trackerConsolePasses.setUpTime = totalSetUpTime;
						break;
					}
				}
				if(employee!=null){
					selectedTrackerConsoleJob.employee = employee;
				}
				updateDataServiceJob.addUpdate(selectedTrackerConsoleJob);
			}
		}
		
		private function washUpJob():void {
			if(selectedTrackerConsoleJob!=null){
				var nowDate:Date = new Date();
				var totalRunTime:Number = 0;
				trackerStatus = "washup";
				for each(var trackerConsolePasses:TrackerConsolePasses in selectedTrackerConsoleJob.passesList){
					if(trackerConsolePasses.passNo==selectedTrackerConsoleJob.currentPass){
						trackerConsolePasses.runCompleted = true;
						totalRunTime = (nowDate.time-trackerConsolePasses.trackDate.time);
						if(!(isNaN(trackerConsolePasses.trackTime)) && trackerConsolePasses.trackTime!=0){
							totalRunTime = totalRunTime + trackerConsolePasses.trackTime;
						}
						trackerConsolePasses.trackDate = nowDate;
						trackerConsolePasses.trackTime = 0;
						trackerConsolePasses.runDate = nowDate;
						trackerConsolePasses.runTime = totalRunTime;
						break;
					}
				}
				if(employee!=null){
					selectedTrackerConsoleJob.employee = employee;
				}
				updateDataServiceJob.addUpdate(selectedTrackerConsoleJob);
			}
		}
		
		private function stopJob():void {
			if(selectedTrackerConsoleJob!=null){
				var nowDate:Date = new Date();
				var totalWashTime:Number = 0;
				var totalTime:Number = 0;
				if(selectedTrackerConsoleJob.currentPass==selectedTrackerConsoleJob.noOfPasses){
					trackerStatus = "stop";
					for each(var trackerConsolePasses:TrackerConsolePasses in selectedTrackerConsoleJob.passesList){
						if(trackerConsolePasses.passNo==selectedTrackerConsoleJob.currentPass){
							if(!selectedTrackerConsoleJob.paused) {
								totalWashTime = (nowDate.time-trackerConsolePasses.trackDate.time);
							}
							if(!(isNaN(trackerConsolePasses.trackTime)) && trackerConsolePasses.trackTime!=0){
								totalWashTime = totalWashTime + trackerConsolePasses.trackTime;
							}
							trackerConsolePasses.trackDate = nowDate;
							trackerConsolePasses.trackTime = 0;
							if(!trackerConsolePasses.setUpCompleted || !trackerConsolePasses.runCompleted){
								trackerConsolePasses.runDate = nowDate;
								trackerConsolePasses.runTime = totalWashTime;
							} else {
								trackerConsolePasses.washUpDate = nowDate;
								trackerConsolePasses.washUpTime = totalWashTime;
								trackerConsolePasses.washUpCompleted = true;
							}
							break;
						}
					}
					for each(var trackerConsolePasses:TrackerConsolePasses in selectedTrackerConsoleJob.passesList){
						if(!(isNaN(trackerConsolePasses.setUpTime)) && trackerConsolePasses.setUpTime!=0){
							totalTime = totalTime + trackerConsolePasses.setUpTime;
						}
						if(!(isNaN(trackerConsolePasses.runTime)) && trackerConsolePasses.runTime!=0){
							totalTime = totalTime + trackerConsolePasses.runTime;
						}
						if(!(isNaN(trackerConsolePasses.setUpTime)) && trackerConsolePasses.setUpTime!=0){
							totalTime = totalTime + trackerConsolePasses.washUpTime;
						}
					}
					selectedTrackerConsoleJob.actualTotalTime = totalTime;
					selectedTrackerConsoleJob.paused = false; 
					selectedTrackerConsoleJob.completed = true;
					selectedTrackerConsoleJob.completedDate = nowDate;
					if(selectedTrackerConsoleJob.appendNotesToJobTicketNotes && selectedTrackerConsoleJob.notes!=null && StringUtil.trim(selectedTrackerConsoleJob.notes)!=""){
						if(selectedTrackerConsoleJob.job!=null){
							if(selectedTrackerConsoleJob.job.jobNotes==null){
								selectedTrackerConsoleJob.job.jobNotes="";
							}
							selectedTrackerConsoleJob.job.jobNotes = selectedTrackerConsoleJob.job.jobNotes+" "+selectedTrackerConsoleJob.notes;
							updateDataService.addUpdate(selectedTrackerConsoleJob.job);
						}
					}
					selectedDGIndex = employee_jobs_grid.selectedIndex;
					updateDataServiceJob.addUpdate(selectedTrackerConsoleJob);
				}
			}
		} 
		
		private function stopOrNextPassJob():void {
			if(selectedTrackerConsoleJob!=null){
				var nowDate:Date = new Date();
				var totalWashTime:Number = 0;
				if(selectedTrackerConsoleJob.currentPass==selectedTrackerConsoleJob.noOfPasses){
					if(!selectedTrackerConsoleJob.paused){
						closeJob = true;
						pauseJob();
					} else {
						var totalSetUpTime:Number = 0;
						var totalRunTime:Number = 0;
						var totalWashUpTime:Number = 0;
						var trackerConsoleStopWindow:TrackerConsoleStopWindow = PopUpManager.createPopUp(this,TrackerConsoleStopWindow,true) as TrackerConsoleStopWindow;
						registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
						var trackerConsoleJobsStopBean:TrackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
						for each(var trackerConsolePasses:TrackerConsolePasses in trackerConsoleJobsStopBean.passesList){
							if(trackerConsolePasses.passNo==trackerConsoleJobsStopBean.currentPass){
								if(!trackerConsoleJobsStopBean.paused) {
									totalWashTime = (nowDate.time-trackerConsolePasses.trackDate.time);
								}
								if(!(isNaN(trackerConsolePasses.trackTime)) && trackerConsolePasses.trackTime!=0){
									totalWashTime = totalWashTime + trackerConsolePasses.trackTime;
								}
								trackerConsolePasses.trackDate = nowDate;
								trackerConsolePasses.trackTime = 0;
								if(!trackerConsolePasses.setUpCompleted || !trackerConsolePasses.runCompleted){
									trackerConsolePasses.runDate = nowDate;
									trackerConsolePasses.runTime = totalWashTime;
								} else {
									trackerConsolePasses.washUpDate = nowDate;
									trackerConsolePasses.washUpTime = totalWashTime;
									trackerConsolePasses.washUpCompleted = true;
								}
								break;
							}
						}
						for each(var trackerConsolePassesObj:TrackerConsolePasses in trackerConsoleJobsStopBean.passesList){
							if(!(isNaN(trackerConsolePassesObj.setUpTime)) && trackerConsolePassesObj.setUpTime!=0){
								totalSetUpTime = totalSetUpTime + trackerConsolePassesObj.setUpTime;
							}
							if(!(isNaN(trackerConsolePassesObj.runTime)) && trackerConsolePassesObj.runTime!=0){
								totalRunTime = totalRunTime + trackerConsolePassesObj.runTime;
							}
							if(!(isNaN(trackerConsolePassesObj.washUpTime)) && trackerConsolePassesObj.washUpTime!=0){
								totalWashUpTime = totalWashUpTime + trackerConsolePassesObj.washUpTime;
							}
						}
						trackerConsoleJobsStopBean.totalSetUpTime = totalSetUpTime;
						trackerConsoleJobsStopBean.totalRunTime = totalRunTime;
						trackerConsoleJobsStopBean.totalWashUpTime = totalWashUpTime;
						trackerConsoleJobsStopBean.totalTime = totalSetUpTime+totalRunTime+totalWashUpTime;
						trackerConsoleJobsStopBean.impressions = getImpressions(trackerConsoleJobsStopBean);
						trackerConsoleJobsStopBean.initialImpressions = trackerConsoleJobsStopBean.impressions;
						trackerConsoleJobsStopBean.endSpoilage = trackerConsoleJobsStopBean.impressions;
						trackerConsoleJobsStopBean.spoilage = getSpoilage(trackerConsoleJobsStopBean);
						trackerConsoleJobsStopBean.initialSpoilageValue = trackerConsoleJobsStopBean.spoilage;
						trackerConsoleJobsStopBean.startSpoilage = trackerConsoleJobsStopBean.spoilage;
						trackerConsoleJobsStopBean.initialEndSpoilage = trackerConsoleJobsStopBean.endSpoilage;
						trackerConsoleJobsStopBean.initialStartSpoilage = trackerConsoleJobsStopBean.startSpoilage;
						trackerConsoleJobsStopBean.difference = trackerConsoleJobsStopBean.endSpoilage-trackerConsoleJobsStopBean.startSpoilage;
						trackerConsoleJobsStopBean.markStepComplete = true;
						if(employee!=null){
							trackerConsoleJobsStopBean.employee = employee;
						}
						trackerConsoleStopWindow.exceptionsArray = exceptionsArray;
						trackerConsoleStopWindow.productionLocations = productionLocationArray;
						trackerConsoleStopWindow.trackerConsoleJobs = trackerConsoleJobsStopBean;
						trackerConsoleStopWindow.addEventListener(TrackerConsoleStopEvent.STOP_JOB_EVENT,function(event:TrackerConsoleStopEvent):void {
							if(event.isStop){
								copyFromStopWindow(event.trackerConsoleJobs,selectedTrackerConsoleJob);
								stopJob();
							}
						});
					}
				} else {
					trackerStatus = "nextpass";
					for each(var trackerConsolePasses:TrackerConsolePasses in selectedTrackerConsoleJob.passesList){
						if(trackerConsolePasses.passNo==selectedTrackerConsoleJob.currentPass){
							if(!selectedTrackerConsoleJob.paused) {
								totalWashTime = (nowDate.time-trackerConsolePasses.trackDate.time);
							}
							if(!(isNaN(trackerConsolePasses.trackTime)) && trackerConsolePasses.trackTime!=0){
								totalWashTime = totalWashTime + trackerConsolePasses.trackTime;
							}
							trackerConsolePasses.trackDate = nowDate;
							trackerConsolePasses.trackTime = 0;
							if(!trackerConsolePasses.setUpCompleted || !trackerConsolePasses.runCompleted){
								trackerConsolePasses.runDate = nowDate;
								trackerConsolePasses.runTime = totalWashTime;
							} else {
								trackerConsolePasses.washUpDate = nowDate;
								trackerConsolePasses.washUpTime = totalWashTime;
								trackerConsolePasses.washUpCompleted = true;
							}
							break;
						}
					}
					selectedTrackerConsoleJob.currentPass = selectedTrackerConsoleJob.currentPass+1;
					if(selectedTrackerConsoleJob.noOfPasses==selectedTrackerConsoleJob.currentPass){
						stopBtn.label = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Stop');
					}
					selectedTrackerConsoleJob.paused = false;
					var trackerConsolePassesObj:TrackerConsolePasses = new TrackerConsolePasses();
					trackerConsolePassesObj.trackDate = new Date();
					trackerConsolePassesObj.passNo = selectedTrackerConsoleJob.currentPass;
					trackerConsolePassesObj.trackerConsoleJobs = selectedTrackerConsoleJob;
					selectedTrackerConsoleJob.passesList.addItem(trackerConsolePassesObj);
					selectedDGIndex = employee_jobs_grid.selectedIndex;
					if(employee!=null){
						selectedTrackerConsoleJob.employee = employee;
					}
					updateDataServiceJob.addUpdate(selectedTrackerConsoleJob);
				}
			}
		}
		
		private function cancelJob():void {
			if(selectedTrackerConsoleJob!=null){
				Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.Areyousureyouwanttoc'), resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'changePriceCmd.Confirm'), Alert.YES | Alert.NO , this, function(event:CloseEvent):void {
					if (event.detail==Alert.YES) {
						selectedDGIndex = employee_jobs_grid.selectedIndex;
						selectedTrackerConsoleJob.totalSetUpTime = 0;
						selectedTrackerConsoleJob.totalRunTime = 0;
						selectedTrackerConsoleJob.totalWashUpTime = 0;
						selectedTrackerConsoleJob.totalTime = 0;
						selectedTrackerConsoleJob.qtyOrdered = 0;
						selectedTrackerConsoleJob.impressions = 0;
						selectedTrackerConsoleJob.spoilage = 0;
						selectedTrackerConsoleJob.totalCost = 0;
						selectedTrackerConsoleJob.canceled = true;
						cancelDataService.addUpdate(selectedTrackerConsoleJob);
					}
				});	
			}
		}
		
		private function pauseJob():void {
			if(selectedTrackerConsoleJob!=null){
				trackerStatus = "pause";
				var nowDate:Date = new Date();
				for each(var trackerConsolePasses:TrackerConsolePasses in selectedTrackerConsoleJob.passesList){
					if(trackerConsolePasses.passNo==selectedTrackerConsoleJob.currentPass){
						trackerConsolePasses.trackTime = nowDate.time - trackerConsolePasses.trackDate.time+(isNaN(trackerConsolePasses.trackTime)?0:trackerConsolePasses.trackTime);
						trackerConsolePasses.trackDate = nowDate;
					}
				}
				selectedTrackerConsoleJob.paused = true;
				if(employee!=null){
					selectedTrackerConsoleJob.employee = employee;
				}
				updateDataServiceJob.addUpdate(selectedTrackerConsoleJob);
			}
		}
		
		private function continueJob():void {
			if(selectedTrackerConsoleJob!=null){
				trackerStatus = "continue";
				var nowDate:Date = new Date();
				for each(var trackerConsolePasses:TrackerConsolePasses in selectedTrackerConsoleJob.passesList){
					if(trackerConsolePasses.passNo==selectedTrackerConsoleJob.currentPass){
						trackerConsolePasses.trackDate = nowDate;
					}
				}
				if(employee!=null){
					selectedTrackerConsoleJob.employee = employee;
				}
				selectedTrackerConsoleJob.paused = false;
				updateDataServiceJob.addUpdate(selectedTrackerConsoleJob);
			}
		}
		
		private function handleUpdateJobResult(event:ResultEvent):void {
			var trackerConsoleJobsObject:TrackerConsoleJobs = event.result as TrackerConsoleJobs;
			dataService.getTrackerConsoleJobsById(trackerConsoleJobsObject.id);
		}
		
		private function handleLoadTCJobByIdResult(event:ResultEvent):void {
			var trackerConsoleJobsObject:TrackerConsoleJobs = event.result as TrackerConsoleJobs;
			if(itemSelect){
				itemSelect = false;
				var counter:int = 0;
				for each(var trackerConsoleJobsObj:TrackerConsoleJobs in trackerConsoleJobsList){
					if(trackerConsoleJobsObj.id == trackerConsoleJobsObject.id){
						trackerConsoleJobsObj.updateTimer = false;
						copyTrackerConsoleJobObject(trackerConsoleJobsObject,trackerConsoleJobsObj);
						trackerConsoleJobsObj.updateTimer = true;
						employee_jobs_grid.selectedIndex = counter;
						break;
					}
					counter++;
				}
				trackerConsoleJobsList.refresh();
				selectedTrackerConsoleJob = trackerConsoleJobsObject;
				trackerConsole.productionLocation = selectedTrackerConsoleJob.productionLocations;
				if(trackerConsole.productionLocation==null){
					trackerConsole.productionLocation = new ProductionLocations();
				}
				trackerconsole_location.customText = getCustomTextData(productionLocationArray,trackerConsole,trackerConsole.productionLocation);
				if(employee!=null){
					enableRequiredBtns();
				} else {
					defaultEnableButtons();
				}
				registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
				progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(trackerConsoleJobsObject) as TrackerConsoleJobs;
			}
			else {
				resetButtons();
				if(trackerStatus=="start"){
					if(trackerConsoleJobsObject!=null){
						setUpBtn.enabled = true;
						washUpBtn.enabled = true;
						stopBtn.enabled = true;
						cancelBtn.enabled = true;
						pauseBtn.enabled = true;
						defaultEnableButtons();
						var counter:int = 0;
						for each(var trackerConsoleJobsObj:TrackerConsoleJobs in trackerConsoleJobsList){
							if(trackerConsoleJobsObject.job!=null && trackerConsoleJobsObj.job!=null){
								if(trackerConsoleJobsObject.job.id==trackerConsoleJobsObj.job.id){
									selectedTrackerConsoleJob = trackerConsoleJobsObject;
									employee_jobs_grid.selectedIndex = counter;
									registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
									progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
									enableRequiredBtns();
									break;
								}
							} else if(trackerConsoleJobsObject.charge!=null && trackerConsoleJobsObj.charge!=null) {
								if(trackerConsoleJobsObject.charge.id==trackerConsoleJobsObj.charge.id){
									selectedTrackerConsoleJob = trackerConsoleJobsObject;
									employee_jobs_grid.selectedIndex = counter;
									registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
									progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
									enableRequiredBtns();
									break;
								}
							}
							counter++;
						}
					}
				} else if(trackerStatus=="setup"){
					if(selectedTrackerConsoleJob!=null){
						for each(var trackerConsoleJobsObj:TrackerConsoleJobs in trackerConsoleJobsList){
							if(trackerConsoleJobsObj.id == trackerConsoleJobsObject.id){
								copyTrackerConsoleJobObject(trackerConsoleJobsObject,trackerConsoleJobsObj);
								break;
							}
						}
						selectedTrackerConsoleJob = trackerConsoleJobsObject;
						trackerConsoleJobsList.refresh();
						washUpBtn.enabled = true;
						stopBtn.enabled = true;
						cancelBtn.enabled = true;
						pauseBtn.enabled = true;
						defaultEnableButtons();
						registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
						progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
					}
				} else if(trackerStatus=="washup"){
					if(selectedTrackerConsoleJob!=null){
						for each(var trackerConsoleJobsObj:TrackerConsoleJobs in trackerConsoleJobsList){
							if(trackerConsoleJobsObj.id == trackerConsoleJobsObject.id){
								copyTrackerConsoleJobObject(trackerConsoleJobsObject,trackerConsoleJobsObj);
								break;
							}
						}
						selectedTrackerConsoleJob = trackerConsoleJobsObject;
						trackerConsoleJobsList.refresh();
						stopBtn.enabled = true;
						cancelBtn.enabled = true;
						pauseBtn.enabled = true;
						defaultEnableButtons();
						registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
						progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
					}
				} else if(trackerStatus=="pause"){
					if(selectedTrackerConsoleJob!=null){
						for each(var trackerConsoleJobsObj:TrackerConsoleJobs in trackerConsoleJobsList){
							if(trackerConsoleJobsObj.id == trackerConsoleJobsObject.id){
								copyTrackerConsoleJobObject(trackerConsoleJobsObject,trackerConsoleJobsObj);
								break;
							}
						}
						selectedTrackerConsoleJob = trackerConsoleJobsObject;
						stopBtn.enabled = true;
						cancelBtn.enabled = true;
						continueBtn.enabled = true;
						defaultEnableButtons();
						registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
						progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
						if(closeJob){
							var totalSetUpTime:Number = 0;
							var totalRunTime:Number = 0;
							var totalWashUpTime:Number = 0;
							var nowDate:Date = new Date();
							var totalWashTime:Number = 0;
							closeJob = false;
							var trackerConsoleStopWindow:TrackerConsoleStopWindow = PopUpManager.createPopUp(this,TrackerConsoleStopWindow,true) as TrackerConsoleStopWindow;
							registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
							var trackerConsoleJobsStopBean:TrackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
							for each(var trackerConsolePasses:TrackerConsolePasses in trackerConsoleJobsStopBean.passesList){
								if(trackerConsolePasses.passNo==trackerConsoleJobsStopBean.currentPass){
									if(!trackerConsoleJobsStopBean.paused) {
										totalWashTime = (nowDate.time-trackerConsolePasses.trackDate.time);
									}
									if(!(isNaN(trackerConsolePasses.trackTime)) && trackerConsolePasses.trackTime!=0){
										totalWashTime = totalWashTime + trackerConsolePasses.trackTime;
									}
									trackerConsolePasses.trackDate = nowDate;
									trackerConsolePasses.trackTime = 0;
									if(!trackerConsolePasses.setUpCompleted || !trackerConsolePasses.runCompleted){
										trackerConsolePasses.runDate = nowDate;
										trackerConsolePasses.runTime = totalWashTime;
									} else {
										trackerConsolePasses.washUpDate = nowDate;
										trackerConsolePasses.washUpTime = totalWashTime;
										trackerConsolePasses.washUpCompleted = true;
									}
									break;
								}
							}
							for each(var trackerConsolePassesObj:TrackerConsolePasses in trackerConsoleJobsStopBean.passesList){
								if(!(isNaN(trackerConsolePassesObj.setUpTime)) && trackerConsolePassesObj.setUpTime!=0){
									totalSetUpTime = totalSetUpTime + trackerConsolePassesObj.setUpTime;
								}
								if(!(isNaN(trackerConsolePassesObj.runTime)) && trackerConsolePassesObj.runTime!=0){
									totalRunTime = totalRunTime + trackerConsolePassesObj.runTime;
								}
								if(!(isNaN(trackerConsolePassesObj.washUpTime)) && trackerConsolePassesObj.washUpTime!=0){
									totalWashUpTime = totalWashUpTime + trackerConsolePassesObj.washUpTime;
								}
							}
							trackerConsoleJobsStopBean.totalSetUpTime = totalSetUpTime;
							trackerConsoleJobsStopBean.totalRunTime = totalRunTime;
							trackerConsoleJobsStopBean.totalWashUpTime = totalWashUpTime;
							trackerConsoleJobsStopBean.totalTime = totalSetUpTime+totalRunTime+totalWashUpTime;
							trackerConsoleJobsStopBean.impressions = getImpressions(trackerConsoleJobsStopBean);
							trackerConsoleJobsStopBean.initialImpressions = trackerConsoleJobsStopBean.impressions;
							trackerConsoleJobsStopBean.endSpoilage = trackerConsoleJobsStopBean.impressions;
							trackerConsoleJobsStopBean.spoilage = getSpoilage(trackerConsoleJobsStopBean);
							trackerConsoleJobsStopBean.initialSpoilageValue = trackerConsoleJobsStopBean.spoilage;
							trackerConsoleJobsStopBean.startSpoilage = trackerConsoleJobsStopBean.spoilage;
							trackerConsoleJobsStopBean.initialEndSpoilage = trackerConsoleJobsStopBean.endSpoilage;
							trackerConsoleJobsStopBean.initialStartSpoilage = trackerConsoleJobsStopBean.startSpoilage;
							trackerConsoleJobsStopBean.difference = trackerConsoleJobsStopBean.endSpoilage-trackerConsoleJobsStopBean.startSpoilage;
							trackerConsoleJobsStopBean.markStepComplete = true;
							if(employee!=null){
								trackerConsoleJobsStopBean.employee = employee;
							}
							trackerConsoleStopWindow.exceptionsArray = exceptionsArray;
							trackerConsoleStopWindow.productionLocations = productionLocationArray;
							trackerConsoleStopWindow.trackerConsoleJobs = trackerConsoleJobsStopBean;
							trackerConsoleStopWindow.addEventListener(TrackerConsoleStopEvent.STOP_JOB_EVENT,function(event:TrackerConsoleStopEvent):void {
								if(event.isStop){
									copyFromStopWindow(event.trackerConsoleJobs,selectedTrackerConsoleJob);
									stopJob();
								} else {
									continueJob();
								}
							});
						}
					}
				} else if(trackerStatus=="continue"){
					if(selectedTrackerConsoleJob!=null){
						for each(var trackerConsoleJobsObj:TrackerConsoleJobs in trackerConsoleJobsList){
							if(trackerConsoleJobsObj.id == trackerConsoleJobsObject.id){
								copyTrackerConsoleJobObject(trackerConsoleJobsObject,trackerConsoleJobsObj);
								break;
							}
						}
						selectedTrackerConsoleJob = trackerConsoleJobsObject;
						enableRequiredBtns();
						registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
						progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
					}
				} else if(trackerStatus=="stop"){
					if(selectedTrackerConsoleJob!=null){
						completedTracketConsoleJobsList.addItem(selectedTrackerConsoleJob);
						if(selectedDGIndex>-1){
							refreshList = true;
							progressBarComponent.trackerConsoleJobs = null;
							resetButtons();
							trackerConsoleJobsList = new ArrayCollection();
							dataService.getActiveTrackerConsoleJobsBasedOnEmployeeAndTrackerConsole(employee);
						} else {
							resetButtons();
							selectedTrackerConsoleJob = null;
							progressBarComponent.trackerConsoleJobs = null;
						}
					}
				} else if(trackerStatus=="nextpass"){
					if(selectedTrackerConsoleJob!=null){
						for each(var trackerConsoleJobsObj:TrackerConsoleJobs in trackerConsoleJobsList){
							if(trackerConsoleJobsObj.id == trackerConsoleJobsObject.id){
								copyTrackerConsoleJobObject(trackerConsoleJobsObject,trackerConsoleJobsObj);
								break;
							}
						}
						selectedTrackerConsoleJob = trackerConsoleJobsObject;
						trackerConsoleJobsList.refresh();
						resetButtons();
						setUpBtn.enabled = true;
						stopBtn.enabled = true;
						cancelBtn.enabled = true;
						pauseBtn.enabled = true;
						defaultEnableButtons();
						registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
						progressBarComponent.trackerConsoleJobs = ObjectUtil.copy(selectedTrackerConsoleJob) as TrackerConsoleJobs;
					}
				}
			}	
		}
		
		private function copyFromDetailsWindow(source:TrackerConsoleJobs, destination:TrackerConsoleJobs):void {
			if(source.productionExceptions!=null){
				if(source.productionExceptions.id==0){
					source.productionExceptions = null;
				}
			}
			destination.productionExceptions = source.productionExceptions;
			destination.notes = source.notes;
		}
		
		private function copyFromStopWindow(source:TrackerConsoleJobs, destination:TrackerConsoleJobs):void {
			destination.employee = source.employee;
			destination.treatAsNonProdStep = source.treatAsNonProdStep;
			destination.markStepComplete = source.markStepComplete;
			destination.moveToNonProdStep = source.moveToNonProdStep;
			if(source.productionExceptions!=null){
				if(source.productionExceptions.id==0){
					source.productionExceptions = null;
				}
			}
			destination.productionExceptions = source.productionExceptions;
			if(source.nextProductionLocation!=null){
				if(source.nextProductionLocation.id==0){
					source.nextProductionLocation = null;
				}
			}
			destination.nextProductionLocation = source.nextProductionLocation;
			destination.notes = source.notes;
			destination.appendNotesToJobTicketNotes = source.appendNotesToJobTicketNotes;
			if(!isNaN(source.totalSetUpTime)){
				destination.totalSetUpTime = source.totalSetUpTime;
			} else {
				destination.totalSetUpTime = 0;
			}
			if(!isNaN(source.totalRunTime)){
				destination.totalRunTime = source.totalRunTime;
			} else {
				destination.totalRunTime = 0;
			}
			if(!isNaN(source.totalWashUpTime)){
				destination.totalWashUpTime = source.totalWashUpTime;
			} else {
				destination.totalWashUpTime = 0;
			}
			if(!isNaN(source.totalTime)){
				destination.totalTime = source.totalTime;
			} else {
				destination.totalTime = 0;
			}
			if(!isNaN(source.impressions)){
				destination.impressions = source.impressions;
			} else {
				destination.impressions = 0;
			}
			if(!isNaN(source.spoilage)){
				destination.spoilage = source.spoilage;
			} else {
				destination.spoilage = 0;
			}
			if(!isNaN(source.qtyOrdered)){
				destination.qtyOrdered = source.qtyOrdered;
			} else {
				destination.qtyOrdered = 0;
			}
			if(!isNaN(source.startSpoilage)){
				destination.startSpoilage = source.startSpoilage;
			} else {
				destination.startSpoilage = 0;
			}
			if(!isNaN(source.endSpoilage)){
				destination.endSpoilage = source.endSpoilage;
			} else {
				destination.endSpoilage = 0;
			}
			if(!isNaN(source.difference)){
				destination.difference = source.difference;
			} else {
				destination.difference = 0;
			}
			if(destination.treatAsNonProdStep){
				destination.totalTime = 0;
				destination.totalSetUpTime = 0;
				destination.totalRunTime = 0;
				destination.totalWashUpTime = 0;
				destination.qtyOrdered = 0;
				destination.impressions = 0;
				destination.spoilage = 0;
				destination.totalCost = 0;
				destination.startSpoilage = 0;
				destination.endSpoilage = 0;
				destination.difference = 0;
			}
		}
		
		private function copyTrackerConsoleJobObject(source:TrackerConsoleJobs, destination:TrackerConsoleJobs):void {
			destination.employee = source.employee;
			destination.paused = source.paused;
			destination.passesList = source.passesList;
			destination.clockBreak = source.clockBreak;
			destination.currentPass = source.currentPass;
			destination.notes = source.notes;
			destination.productionExceptions = source.productionExceptions;
		}
		
		private function enableRequiredBtns():void {
			if(selectedTrackerConsoleJob!=null){
				for each(var trackerConsolePasses:TrackerConsolePasses in selectedTrackerConsoleJob.passesList){
					if(trackerConsolePasses.passNo==selectedTrackerConsoleJob.currentPass){
						if(selectedTrackerConsoleJob.employee.clockBreak || selectedTrackerConsoleJob.employee.clockOut || !selectedTrackerConsoleJob.employee.active){
							resetButtons();
							defaultEnableButtons();
						} else if(trackerConsolePasses.setUpCompleted && trackerConsolePasses.runCompleted
							&& selectedTrackerConsoleJob.currentPass!=selectedTrackerConsoleJob.noOfPasses){
							resetButtons();
							if(!selectedTrackerConsoleJob.paused){
								pauseBtn.enabled = true;
							} else {
								continueBtn.enabled = true;
							}
							stopBtn.enabled = true;
							cancelBtn.enabled = true;
							defaultEnableButtons();
						} else if(trackerConsolePasses.setUpCompleted && selectedTrackerConsoleJob.currentPass!=selectedTrackerConsoleJob.noOfPasses){
							resetButtons();
							if(!selectedTrackerConsoleJob.paused){
								washUpBtn.enabled = true;
								pauseBtn.enabled = true;
							} else {
								continueBtn.enabled = true;
							}
							stopBtn.enabled = true;
							cancelBtn.enabled = true;
							defaultEnableButtons();
						} else if(trackerConsolePasses.runCompleted && selectedTrackerConsoleJob.currentPass!=selectedTrackerConsoleJob.noOfPasses){
							resetButtons();
							if(!selectedTrackerConsoleJob.paused){
								pauseBtn.enabled = true;
							} else {
								continueBtn.enabled = true;
							}
							stopBtn.enabled = true;
							cancelBtn.enabled = true;
							defaultEnableButtons();
						} else if(trackerConsolePasses.setUpCompleted && trackerConsolePasses.runCompleted
							&& selectedTrackerConsoleJob.currentPass==selectedTrackerConsoleJob.noOfPasses){
							resetButtons();
							if(!selectedTrackerConsoleJob.paused){
								pauseBtn.enabled = true;
							} else {
								continueBtn.enabled = true;
							}
							stopBtn.enabled = true;
							cancelBtn.enabled = true;
							defaultEnableButtons();
						} else if(trackerConsolePasses.setUpCompleted && selectedTrackerConsoleJob.currentPass==selectedTrackerConsoleJob.noOfPasses){
							resetButtons();
							if(!selectedTrackerConsoleJob.paused){
								washUpBtn.enabled = true;
								pauseBtn.enabled = true;
							} else {
								continueBtn.enabled = true;
							}
							stopBtn.enabled = true;
							cancelBtn.enabled = true;
							defaultEnableButtons();
						} else if(trackerConsolePasses.runCompleted && selectedTrackerConsoleJob.currentPass==selectedTrackerConsoleJob.noOfPasses){
							resetButtons();
							if(!selectedTrackerConsoleJob.paused){
								pauseBtn.enabled = true;
							} else {
								continueBtn.enabled = true;
							}
							stopBtn.enabled = true;
							cancelBtn.enabled = true;
							defaultEnableButtons();
						} else {
							resetButtons();
							stopBtn.enabled = true;
							cancelBtn.enabled = true;
							if(!selectedTrackerConsoleJob.paused){
								setUpBtn.enabled = true;
								pauseBtn.enabled = true;
							} else {
								continueBtn.enabled = true;
							}
							defaultEnableButtons();
						}
					}
				}
			} else {
				resetButtons();
			}
		}
		
		private function getStopNextPassLabel(tcJob:TrackerConsoleJobs):String {
			if(tcJob!=null){
				if(tcJob.noOfPasses>1 && tcJob.currentPass!=tcJob.noOfPasses){
					return resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.NextPass');
				}
			}
			return resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Stop');
		} 
		
		private function getWashUpLabel(tcJob:TrackerConsoleJobs):String {
			if(tcJob!=null){
				if(tcJob.charge!=null){
					return resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.FinishUp');
				} else if(tcJob.job!=null){
					return resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Washup');
				}
			}
			return resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Washup');
		}
		
		private function openJobDetails(trackerConsoleJobArg:TrackerConsoleJobs):void {
			if(trackerConsoleJobArg!=null){
				var trackerConsoleDetails:TrackerConsoleDetails = PopUpManager.createPopUp(this,TrackerConsoleDetails,true) as TrackerConsoleDetails;
				registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
				trackerConsoleDetails.trackerConsoleJobs = ObjectUtil.copy(trackerConsoleJobArg) as TrackerConsoleJobs;
				trackerConsoleDetails.exceptionsArray = exceptionsArray;
				trackerConsoleDetails.addEventListener(TrackerConsoleDetailsEvent.SAVE_JOBDETAILS_EVENT,function(event:TrackerConsoleDetailsEvent):void {
					if(event.isSave){
						if(trackerConsoleJobArg!=null){
							copyFromDetailsWindow(event.trackerConsoleJobs,trackerConsoleJobArg);
							for each(var trackerConsoleJobsObject:TrackerConsoleJobs in trackerConsoleJobsList){
								if(trackerConsoleJobsObject.id == trackerConsoleJobArg.id){
									copyFromDetailsWindow(trackerConsoleJobArg,trackerConsoleJobsObject);
									break;
								}
							}
							updateDataService.addUpdate(trackerConsoleJobArg);
						}
					}
				});
			}
		}
		
		private function refreshJobList(event:Event):void {
			if(event.currentTarget.selectedIndex==0){
				if(updatedTrackerConsole) {
					updatedTrackerConsole = false;
					if(employee!=null){
						selectedJob = null;
						selectedCharge = null;
						trackerList = new ArrayCollection();
						dataService.getJobsChargesForTrackerByEmployee(employee.id, new Date());
					}
					if(refreshActiveList){
						refreshActiveList = false;
						closeEventTriggered = true;
						progressBarComponent.trackerConsoleJobs = null;
						resetButtons();
						trackerConsoleJobsList = new ArrayCollection();
						dataService.getActiveTrackerConsoleJobsBasedOnEmployeeAndTrackerConsole(employee);
					}
				}
			}
		}
		
		public function getStrikeThroughValue(object:Object):Boolean {
			if(object is Job){
				var job:Job = object as Job;
				if(!job.releasedToProduction)
					return true;
				return false;
			} else if(object is Charge){
				var charge:Charge = object as Charge;
				if(charge.parentInvoice!=null && !charge.parentInvoice.releasedToProduction)
					return true;
				return false;
			}
			return false;
		}
		
		public function openInvoice():void {
			if(selectedTrackerConsoleJob!=null) {
				if (selectedTrackerConsoleJob.job!=null) {
					invoiceService.getInvoice(selectedTrackerConsoleJob.job.parentInvoice.id);
				} else if (selectedTrackerConsoleJob.charge!=null) {
					if(selectedTrackerConsoleJob.charge.parentInvoice!=null) {
						invoiceService.getInvoice(selectedTrackerConsoleJob.charge.parentInvoice.id);
					} else if(selectedTrackerConsoleJob.charge.parentJob!=null) {
						invoiceService.getInvoice(selectedTrackerConsoleJob.charge.parentJob.parentInvoice.id);
					}
				}
			} else if(selectedJob!=null || selectedCharge!=null){
				if (selectedJob!=null) {
					invoiceService.getInvoice(selectedJob.parentInvoice.id);
				} else if (selectedCharge!=null) {
					if(selectedCharge.parentInvoice!=null) {
						invoiceService.getInvoice(selectedCharge.parentInvoice.id);
					} else if(selectedCharge.parentJob!=null) {
						invoiceService.getInvoice(selectedCharge.parentJob.parentInvoice.id);
					}
				}
			}
		}
		
		private function handleGetInvoiceResult(event:ResultEvent):void {
			var invoiceBase:InvoiceBase = event.result as InvoiceBase;
			if (invoiceBase !=null) {
				if (invoiceBase is Invoice) {
					Snowmass.getInstance().doEditInvoice(invoiceBase);
				} else if (invoiceBase is Estimate) {
					Snowmass.getInstance().doEditEstimate(invoiceBase);
				}
			}
		}
		
		private function employeeTaskCheck(functionName:Function,object:TrackerConsoleJobs=null):void {
			var inputArray:Array = new Array();
			inputArray.push("");
			inputArray.push(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'rButtonLabel.Change'));
			if(object!=null || selectedTrackerConsoleJob!=null){
				if(object!=null){
					if(employee==null || object.employee.id!=employee.id){
						Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.ThisTrackeritemhasbe',inputArray), resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'changePriceCmd.Confirm'), Alert.YES | Alert.NO , this, function(event:CloseEvent):void {
							if (event.detail==Alert.YES) {
								openJobDetails(object);
							}
						});
						return;
					} else {
						openJobDetails(object);
					}	
				} else if(selectedTrackerConsoleJob!=null) {
					if(employee==null || selectedTrackerConsoleJob.employee.id!=employee.id){
						Alert.show(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.ThisTrackeritemhasbe',inputArray), resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'changePriceCmd.Confirm'), Alert.YES | Alert.NO , this, function(event:CloseEvent):void {
							if (event.detail==Alert.YES) {
								callLater(functionName);
							}
						});
						return;
					} else {
						callLater(functionName);
					}	
				}
			}
		}
		
		private function getImpressions(object:TrackerConsoleJobs):Number {
			var impressions:Number = 0;
			if(object.job!=null){
				if(!isNaN(object.job.totalImpressions)){
					impressions = object.job.totalImpressions;
				}
			} else if(object.charge!=null) {
				if(object.charge.chargeCostingRecord!=null){
					if(!isNaN(object.charge.chargeCostingRecord.totalImpressions)){
						impressions = object.charge.chargeCostingRecord.totalImpressions;
					}
				}
			}
			return impressions;
		}
		
		private function getSpoilage(object:TrackerConsoleJobs):Number {
			var spoilage:Number = 0;
			if(object.job!=null){
				if(object.job.costingRecord!=null){
					if(!isNaN(object.job.costingRecord.actualSpoilage)){
						spoilage = object.job.costingRecord.actualSpoilage;
					}
				}
			} else if(object.charge!=null) {
				if(object.charge.chargeCostingRecord!=null){
					if(!isNaN(object.charge.chargeCostingRecord.actualSpoilage)){
						spoilage = object.charge.chargeCostingRecord.actualSpoilage;
					}
				}
			}
			return spoilage;
		}
		
		public function getStatusImage(object:Object):Object {
			[Embed('../../../../assets/StatusRunning.png')]
			var statusRunningClass:Class;
			[Embed('../../../../assets/StatusPaused.png')]
			var statusPausedClass:Class;
			if(object.paused)
				return statusPausedClass;
			return statusRunningClass;
		}
		
		public function getStatusTooltip(object:Object):String {
			if(object.paused)
				return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.Paused');
			return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.Active');
		}
		
		public function getStatusNotesTooltip():String {
			return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.HasNotes');
		}
		
		public function getStatusExceptionTooltip():String {
			return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.HasExceptionCode');
		}
		
				
	]]>
	                        
	</mx:Script>	
	
	<mx:DateFormatter id="dateFormatter" formatString="MM/DD/YYYY L:NN A EEE"/>
	
	<mx:NumberFormatter id="numFormatter" precision="0" rounding="none"/>
	
	<mx:TabNavigator width="100%" height="100%" change="{refreshJobList(event)}">
		<mx:VBox label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.ActiveItems')}" 
			paddingLeft="20" paddingTop="20" width="100%" height="100%">
			
			<mx:HBox width="100%">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowStopCmd.Employee')}"/>
				<components:CustomComboBoxComponent width="20%" change="{getEmployee(event)}"
					masterList="{employeesArray}" updateObject="true" objectLabelFieldId="employeeId" labelFieldId="employeeId" labelFieldName="employeeName"
					dataHolder="{trackerConsole}" variableName="selectedEmployee" customText="{getCustomTextData(employeesArray,trackerConsole,trackerConsole.selectedEmployee)}"/>
				<mx:Image source="@Embed(source='../../../../assets/punchclock.png')" 
					click="{openClockInOut()}" buttonMode="true" useHandCursor="true"/>		
				<mx:Image source="@Embed(source='../../../../assets/EmployeeEdit.png')" 
					click="{openEditEmployee()}" buttonMode="true" useHandCursor="true"/>
			</mx:HBox>
			
			<mx:DataGrid width="90%" height="30%" id="invoiceGrid" dataProvider="{trackerList}" itemClick="{doSelectJob(event)}">
				<mx:columns>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Item')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="true"
									strikethrough="{outerDocument.getStrikeThroughValue(data)}" text="{outerDocument.getInvoiceNumber(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Description')}" dataField="description">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="true"
									strikethrough="{outerDocument.getStrikeThroughValue(data)}" text="{data.description}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.DeliveryDate')}">
					<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="true"
									strikethrough="{outerDocument.getStrikeThroughValue(data)}" text="{outerDocument.getDeliveryDate(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.ProductionLocation')}">
					<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="true"
									strikethrough="{outerDocument.getStrikeThroughValue(data)}" text="{outerDocument.getProductionLoc(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.RunDate')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="true"
									strikethrough="{outerDocument.getStrikeThroughValue(data)}" text="{outerDocument.getRunDate(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.ActiveLocation')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="true"
									strikethrough="{outerDocument.getStrikeThroughValue(data)}" text="{outerDocument.getProductionLoc(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Estimated')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="true"
									strikethrough="{outerDocument.getStrikeThroughValue(data)}" text="{outerDocument.getTotalTime(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Priority')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="true"
									strikethrough="{outerDocument.getStrikeThroughValue(data)}" text="{outerDocument.getPriority(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Machine')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="true"
									strikethrough="{outerDocument.getStrikeThroughValue(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Account')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="true"
									strikethrough="{outerDocument.getStrikeThroughValue(data)}" text="{outerDocument.getAccount(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
				</mx:columns>
			</mx:DataGrid>
			
			<mx:HBox width="100%" height="50%">
				<mx:VBox width="50%" height="100%">
					<mx:Panel width="100%" height="50%" paddingTop="10" paddingLeft="5" 
						layout="vertical" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.CurrentStation')}">
					
						<mx:HBox width="100%">
							<mx:Label width="15%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowStopCmd.Facility')}" textAlign="right"/>
							<components:CustomComboBoxComponent width="40%" enabled="false"
								masterList="{facilitiesArray}" updateObject="true" objectLabelFieldId="id" labelFieldId="id" labelFieldName="name"
								dataHolder="{trackerConsole}" variableName="productionFacilities" customText="{getCustomTextData(facilitiesArray,trackerConsole,trackerConsole.productionFacilities)}"/>
						</mx:HBox>
						
						<mx:HBox width="100%">
							<mx:Label width="15%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.StationName')}" textAlign="right"/>
							<components:CustomComboBoxComponent width="40%" enabled="false"
								masterList="{stationsArray}" updateObject="true" objectLabelFieldId="id" labelFieldId="id" labelFieldName="name"
								dataHolder="{trackerConsole}" variableName="productionStations" customText="{getCustomTextData(stationsArray,trackerConsole,trackerConsole.productionStations)}"/>
						</mx:HBox>
						
						<mx:HBox width="100%">
							<mx:Label width="15%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Location')}" textAlign="right"/>
							<components:CustomComboBoxComponent id="trackerconsole_location" width="40%"
								masterList="{productionLocationArray}" updateObject="true" objectLabelFieldId="id" labelFieldId="id" labelFieldName="name"
								dataHolder="{trackerConsole}" variableName="productionLocation" customText="{getCustomTextData(productionLocationArray,trackerConsole,trackerConsole.productionLocation)}"/>
						</mx:HBox>	
						
					</mx:Panel>
					<mx:Panel width="100%" height="50%" paddingTop="10" paddingLeft="5" 
						layout="vertical" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.BarcodeInput')}">
						<mx:HBox width="100%" height="100%">
							<mx:VBox width="40%" height="100%">
								<mx:HBox width="100%">
									<mx:Label width="40%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Doc')}" 
										textAlign="right"/>
									<mx:TextInput width="40%" id="doc_edit" enabled="false"/>	
								</mx:HBox>
								<mx:HBox width="100%">
									<mx:Label width="40%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Job')}"
										textAlign="right"/>
									<mx:TextInput width="40%" id="job_edit" enabled="false"/>
								</mx:HBox>
								<mx:HBox width="100%">
									<mx:Label width="40%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Charge')}"
										textAlign="right"/>
									<mx:TextInput width="40%" id="charge_edit" enabled="false"/>
								</mx:HBox>
							</mx:VBox>
							<mx:VBox width="60%" height="100%">
								<mx:HBox width="100%">
									<mx:Label width="35%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowStopCmd.Facility')}"
										textAlign="right"/>
									<mx:TextInput width="55%" id="barcode_facility_edit" enabled="false"/>
								</mx:HBox>
								<mx:HBox width="100%">
									<mx:Label width="35%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowStopCmd.Location')}"
										textAlign="right"/>
									<mx:TextInput width="55%" id="barcode_location_edit" enabled="false"/>
								</mx:HBox>
								<mx:HBox width="100%">
									<mx:Label width="35%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowStopCmd.Employee')}"
										textAlign="right"/>
									<mx:TextInput width="55%" id="barcode_employee_edit" enabled="false"/>
								</mx:HBox>
							</mx:VBox>
						</mx:HBox>
					</mx:Panel>	
				</mx:VBox>
				<mx:VBox width="40%" height="100%" verticalAlign="middle">
					<mx:HBox width="100%">
						<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowStopCmd.Start')}" 
							labelPlacement="bottom" width="20%" click="{startJob()}" id="startBtn" enabled="false">
							<mx:icon>@Embed(source='../../../../assets/TrackingStart.png')</mx:icon>
						</mx:Button>
						<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowStopCmd.Setup')}" 
							labelPlacement="bottom" width="20%" click="{employeeTaskCheck(setUpJob)}" id="setUpBtn" enabled="false">
							<mx:icon>@Embed(source='../../../../assets/TrackingSetupDone.png')</mx:icon>
						</mx:Button>
						<mx:Button label="{getWashUpLabel(selectedTrackerConsoleJob)}" 
							labelPlacement="bottom" width="20%" click="{employeeTaskCheck(washUpJob)}" id="washUpBtn" enabled="false">
							<mx:icon>@Embed(source='../../../../assets/TrackingWashupStart.png')</mx:icon>
						</mx:Button>
						<mx:Button label="{getStopNextPassLabel(selectedTrackerConsoleJob)}" 
							labelPlacement="bottom" width="20%" click="{employeeTaskCheck(stopOrNextPassJob)}" id="stopBtn" enabled="false">
							<mx:icon>@Embed(source='../../../../assets/TrackingStop.png')</mx:icon>
						</mx:Button> 
						<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Cancel')}" 
							labelPlacement="bottom" width="20%" click="{employeeTaskCheck(cancelJob)}" id="cancelBtn" enabled="false">
							<mx:icon>@Embed(source='../../../../assets/TrackingCancel.png')</mx:icon>
						</mx:Button>
					</mx:HBox>
					<mx:HBox width="100%">
						<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Pause')}" 
							labelPlacement="bottom" width="20%" click="{employeeTaskCheck(pauseJob)}" id="pauseBtn" enabled="false">
							<mx:icon>@Embed(source='../../../../assets/TrackingPause.png')</mx:icon>
						</mx:Button>
						<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Continue')}" 
							labelPlacement="bottom" width="20%" click="{employeeTaskCheck(continueJob)}" id="continueBtn" enabled="false">
							<mx:icon>@Embed(source='../../../../assets/TrackingContinue.png')</mx:icon>
						</mx:Button>
						<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Open')}" 
							labelPlacement="bottom" width="20%" click="{openInvoice()}" id="openBtn" enabled="false">
							<mx:icon>@Embed(source='../../../../assets/TrackingInvOpen.png')</mx:icon>
						</mx:Button>
						
						<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.JobTicket')}" 
							labelPlacement="bottom" width="20%" id="jobTicketBtn" enabled="false">
							<mx:icon>@Embed(source='../../../../assets/TrackingTickets.png')</mx:icon>
						</mx:Button>
						<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Layout')}" 
							labelPlacement="bottom" width="20%" id="layoutBtn" enabled="false">
							<mx:icon>@Embed(source='../../../../assets/TrackingCutouts.png')</mx:icon>
						</mx:Button>
					</mx:HBox>
				</mx:VBox>
			</mx:HBox>
			
			
			
			
			<mx:DataGrid width="90%" height="20%" id="employee_jobs_grid" dataProvider="{trackerConsoleJobsList}" itemClick="{doConsoleJobSelection(event)}">
				<mx:columns>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Item')}">
						<mx:itemRenderer>
							<mx:Component>
								<mx:HBox width="100%" verticalAlign="middle" horizontalGap="2">
									<mx:Image source="{outerDocument.getStatusImage(data)}" toolTip="{outerDocument.getStatusTooltip(data)}"/>
									<mx:Image source="@Embed(source='../../../../assets/StatusNotes.png')"
										toolTip="{outerDocument.getStatusNotesTooltip()}"
										visible="{data.notes!=null &amp;&amp; data.notes!=''}" includeInLayout="{data.notes!=null &amp;&amp; data.notes!=''}"/>
									<mx:Image source="@Embed(source='../../../../assets/StatusException.png')"
										toolTip="{outerDocument.getStatusExceptionTooltip()}"
										visible="{data.productionExceptions!=null}" includeInLayout="{data.productionExceptions!=null}"/>
									<trackercomponent:TrackerConsoleLabelComponent pendingList="false" text="{outerDocument.getInvoiceNumber(data)}"/>
								</mx:HBox>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Description')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="false" text="{outerDocument.getJobDescription((data.job==null?data.charge:data.job))}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.TimeQty')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="false" text="{outerDocument.getTotalJobTime(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Duration')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="false" text="{outerDocument.getActualJobTime(data,data.updateTimer)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Who')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="false" text="{data.employee.lastName}, {data.employee.firstName}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Facility')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="false" text="{data.productionFacilities.name}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Station')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="false" text="{data.productionStations.name}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Location')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="false" text="{data.productionLocations.name}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Machine')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="false" text=""/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'deliveryTicketMgrCmd.Account')}">
						<mx:itemRenderer>
							<mx:Component>
								<trackercomponent:TrackerConsoleLabelComponent pendingList="false" text="{outerDocument.getAccount((data.job==null?data.charge:data.job))}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
				</mx:columns>
			</mx:DataGrid>
			
			<mx:Spacer height="5%"/>
			
			<trackercomponent:TrackerProgressBarComponent id="progressBarComponent" width="98%" height="15%" 
				doubleClickEnabled="true" doubleClick="{employeeTaskCheck(openJobDetails,selectedTrackerConsoleJob)}"/>
			
		</mx:VBox>
		
		<mx:VBox label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Preference')}"
			paddingLeft="20" paddingTop="20" width="100%" height="100%">
			<mx:HBox width="80%" height="100%">
				<mx:VBox width="50%" height="100%">
						<mx:Panel width="100%" height="20%" layout="vertical" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Startnewitemshere')}"
							paddingLeft="20" paddingTop="20">
							<mx:HBox width="100%">
								<mx:Label width="25%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Facility')}"
									textAlign="right"/>
								<components:CustomComboBoxComponent width="75%"
									masterList="{facilitiesArray}" updateObject="true" objectLabelFieldId="id" labelFieldId="id" labelFieldName="name"
									dataHolder="{trackerConsole}" variableName="productionFacilities" customText="{getCustomTextData(facilitiesArray,trackerConsole,trackerConsole.productionFacilities)}"
									change="{updateTrackerConsoleWithRefresh()}"/>
							</mx:HBox>
							<mx:HBox width="100%">
								<mx:Label width="25%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.StationName')}"
									textAlign="right"/>
								<components:CustomComboBoxComponent width="75%"
									masterList="{stationsArray}" updateObject="true" objectLabelFieldId="id" labelFieldId="id" labelFieldName="name"
									dataHolder="{trackerConsole}" variableName="productionStations" customText="{getCustomTextData(stationsArray,trackerConsole,trackerConsole.productionStations)}"
									change="{updateTrackerConsoleWithRefresh()}"/>
							</mx:HBox>
						</mx:Panel>
						<mx:Panel width="100%" height="20%" layout="vertical" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.ShowThesePendingItem')}"
							paddingLeft="20" paddingTop="20">
							<components:CustomCheckBoxComponent label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.HideItemsNotReleased')}"
								dataHolder="{trackerConsole}" customText="{trackerConsole.hideItemsNotReleasedToProd}" variableName="hideItemsNotReleasedToProd"
								selectedValue="true" deSelectedValue="false" defaultValue="false" click="{updateTrackerConsole()}"/>
							<components:CustomCheckBoxComponent label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.OnlyShowEmployeesPro')}"
								dataHolder="{trackerConsole}" customText="{trackerConsole.showEmployeeProdParents}" variableName="showEmployeeProdParents"
								selectedValue="true" deSelectedValue="false" defaultValue="false" click="{updateTrackerConsole()}"/>
						</mx:Panel>
						<mx:Panel width="100%" height="80%" layout="vertical" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Showtheseactiveitems')}"
							paddingLeft="20" paddingTop="20">
							<components:CustomCheckBoxComponent label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Selectedemployeeonly')}"
									dataHolder="{trackerConsole}" customText="{trackerConsole.showSelectedEmployee}" variableName="showSelectedEmployee"
									selectedValue="true" deSelectedValue="false" defaultValue="false" click="{updateTrackerConsoleWithRefresh()}"/>
							<components:CustomCheckBoxComponent label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.ShowAllFacilities')}"
									dataHolder="{trackerConsole}" customText="{trackerConsole.showAllFacilities}" variableName="showAllFacilities"
									selectedValue="true" deSelectedValue="false" defaultValue="false" click="{updateTrackerConsoleWithRefresh()}"/>
							<components:CustomCheckBoxComponent label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.ShowAllStations')}"
									dataHolder="{trackerConsole}" customText="{trackerConsole.showAllStations}" variableName="showAllStations"
									selectedValue="true" deSelectedValue="false" defaultValue="false" click="{updateTrackerConsoleWithRefresh()}"/>
							<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowDetailsCmd.Station')}"/>
							<mx:DataGrid width="90%" id="stations" dataProvider="{productionStations}">
								<mx:columns>
									<mx:DataGridColumn id="checkAllCol" headerText=" "
										sortable="false" dataField="isSelected" width="200">
										<mx:headerRenderer>
											<mx:Component>
												<components:CheckBoxHeaderRenderer click="{outerDocument.updateTrackerConsoleWithRefresh()}" />
											</mx:Component>
										</mx:headerRenderer>
										<mx:itemRenderer>
											<mx:Component>
												<components:CustomCheckBoxComponent click="{outerDocument.updateTrackerConsoleWithRefresh()}" 
													datagridControl="true" variableName="isSelected" customText="{data.isSelected}"
													selectedValue="true" deSelectedValue="false" defaultValue="false"/>
											</mx:Component>
										</mx:itemRenderer>
									</mx:DataGridColumn>
									<mx:DataGridColumn dataField="name" headerText="Station Name" width="800"/>
								</mx:columns>
							</mx:DataGrid>
						</mx:Panel>
				</mx:VBox>
				<mx:VBox width="50%" height="100%">
					<mx:Panel width="100%" height="30%" layout="vertical" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.FontSettings')}"
							paddingLeft="20" paddingTop="20">
							
							<mx:HBox width="100%">
								<mx:Label width="20%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.PendingList')}" 
									textAlign="right"/>
								<components:CustomComboBoxComponent width="80%"
									masterList="{fontSizeList}" labelFieldId="key" labelFieldName="value"
									dataHolder="{trackerConsole}" variableName="pendingListSize" customText="{getCustomTextData(fontSizeList,trackerConsole,trackerConsole.pendingListSize)}"
									change="{updateTrackerConsole()}"/>
							</mx:HBox>
							<mx:HBox width="100%">
								<mx:Label width="20%" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.ActiveList')}" 
									textAlign="right"/>	
								<components:CustomComboBoxComponent width="80%"
									masterList="{fontSizeList}" labelFieldId="key" labelFieldName="value"
									dataHolder="{trackerConsole}" variableName="activeListSize" customText="{getCustomTextData(fontSizeList,trackerConsole,trackerConsole.activeListSize)}"
									change="{updateTrackerConsole()}"/>
							</mx:HBox>
							
					</mx:Panel>
				</mx:VBox>
			</mx:HBox>
		</mx:VBox>
		<mx:VBox label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.CompletedItems')}"
			paddingLeft="20" paddingTop="20" width="100%" height="85%">
			<mx:DataGrid dataProvider="{completedTracketConsoleJobsList}" width="90%" height="100%" id="completed_grid"
				itemClick="{doSelectCompletedJob(event)}" doubleClickEnabled="true" doubleClick="{openJobDetails(completedTrackerConsoleJob)}">
				<mx:columns>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.DateCompleted')}" dataField="completedDate">
						<mx:itemRenderer>
							<mx:Component>
								<mx:Label text="{outerDocument.dateFormatter.format(data.completedDate)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowStopCmd.Item')}">
						<mx:itemRenderer>
							<mx:Component>
								<mx:Label text="{outerDocument.getInvoiceNumber(data)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.Description')}">
						<mx:itemRenderer>
							<mx:Component>
								<mx:Label text="{outerDocument.getJobDescription((data.job==null?data.charge:data.job))}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'workflowCmd.TimeQty')}">
						<mx:itemRenderer>
							<mx:Component>
								<mx:Label text="{outerDocument.convertMilliSecondsToString((data.actualSetUpTime+data.actualRunTime+data.actualWashTime),true)}"/>
							</mx:Component>
						</mx:itemRenderer>
					</mx:DataGridColumn>
				</mx:columns>
			</mx:DataGrid>
		</mx:VBox>
	</mx:TabNavigator>
	
</mx:Panel>
