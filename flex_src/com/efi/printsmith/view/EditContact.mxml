<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:view="com.efi.printsmith.view.*" xmlns:vo="com.efi.printsmith.data.*" xmlns:fc="http://www.adobe.com/2006/fc" xmlns:hc="com.hillelcoren.components.*"
width="100%" height="100%" headerHeight="0" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Contacts')}"
creationComplete="init()" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Contacts')}" name="Contact Editor" xmlns:ns1="com.efi.printsmith.components.*"
implements="com.efi.mdi.IMDIWindowAware">

<mx:RemoteObject id="dataService2" destination="dataService">
	<mx:method name="getContactPicker" fault="handleFault(event)" result="handleLoadResult(event)"/>
	<mx:method name="getAccountPicker" fault="handleFault(event)" result="handleLoadAccountResult(event)"/>
	<mx:method name="deleteItem" fault="handleFault(event)" result="handleDeleteResult(event)"/>
	<mx:method name="getContact" fault="handleFault(event)" result="handleGetResult(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="dataServiceCreditCardPreferences" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadCreditCardPreferencesResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="salesRepDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadSalesReps(event)"/>
    <mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveSalesRepResult(event)"/>
</mx:RemoteObject>	

<!--<mx:RemoteObject id="cityDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadCity(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveCityResult(event)"/>
</mx:RemoteObject>

<mx:RemoteObject id="stateDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadState(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveStateResult(event)"/>
</mx:RemoteObject>

<mx:RemoteObject id="countryDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadCountry(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveCountryResult(event)"/>
</mx:RemoteObject>
-->
<mx:RemoteObject id="zipDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadZip(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveZipResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="campaignDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadCampaigns(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveCampaignResult(event)"/>
</mx:RemoteObject>

<mx:RemoteObject id="accountDataService" destination="dataService">
	<mx:method name="getById" fault="handleFault(event)" result="handleLoadAccountById(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="GradedataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadGradeResult(event)"/>
	
</mx:RemoteObject>

<mx:Producer id="producer" destination="contacts"/>
<mx:Consumer id="consumer" destination="salesreps"  message="messageHandler(event.message)"/>
<!--<mx:Consumer id="consumer" destination="citys" message="messageHandler(event.message)"/>
<mx:Consumer id="consumer" destination="countrys" message="messageHandler(event.message)"/>
<mx:Consumer id="consumer" destination="states" message="messageHandler(event.message)"/>
<mx:Consumer id="consumer" destination="zips" message="messageHandler(event.message)"/>-->
<mx:Consumer id="notification_consumer" destination="notifications" message="messageHandler(event.message)"/>


<!--<mx:StringValidator id="contactFirstValidator" source="{name_edit}"	property="text"	minLength="2" required="true"/>
<mx:StringValidator id="contactLastValidator" source="{last_name_edit}"	property="text"	minLength="2" required="true"/>
-->

<mx:Script source="../common/scripts/CommonUtils.as"/>

<mx:Script> 
                                  
<![CDATA[
	import com.efi.mdi.event.window.WindowConfirmStatusEvent;
	import com.efi.mdi.view.window.MDIConfirmComponent;
	import com.efi.mdi.event.window.WindowSaveSuccessEvent;
	import com.efi.printsmith.data.ModelBase;
	import flash.net.registerClassAlias;
	import mx.utils.ObjectUtil;
	import com.efi.mdi.view.window.MDIWindow;
	import com.efi.printsmith.common.components.CommonLoadComponent;
	import com.efi.printsmith.data.ComLink;
	import mx.collections.ArrayCollection;
	import mx.collections.ArrayCollection;
	import com.efi.printsmith.data.Contact;
	import com.efi.printsmith.data.Address;                        
	import com.efi.printsmith.data.Account; 
	import com.efi.printsmith.data.CreditCard;
	import com.efi.printsmith.data.Campaigns;
	import com.efi.printsmith.data.City;
	import com.efi.printsmith.data.Country;
	import com.efi.printsmith.data.State;
	import com.efi.printsmith.data.Zip;
	import com.efi.printsmith.data.Grade;
	import com.efi.printsmith.data.Marketing;
	import com.efi.printsmith.data.SalesRep;  
	import com.efi.printsmith.pages.GradePicker;
	import com.efi.printsmith.events.AccountPickerSelectEvent;
	import com.efi.printsmith.events.ContactPickerSelectEvent;
	import com.efi.printsmith.events.CampaignEditCompleteEvent;
	import com.efi.printsmith.events.GradeSelectEvent;
	import com.efi.printsmith.data.PreferencesCreditCard;
	import com.efi.printsmith.events.SaveAddressEvent;
	import com.efi.printsmith.components.AddressEditorPopup;
	import com.efi.printsmith.events.EncryptDataEvent;
	import mx.utils.StringUtil;
	import mx.collections.SortField;
	import mx.collections.Sort;
	import mx.rpc.Responder;
	import mx.controls.Alert;                                         
	import mx.managers.PopUpManager;                                         
	import mx.containers.TitleWindow;                                         
	import mx.collections.ArrayCollection;                                         
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;                                         
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
    import mx.printing.FlexPrintJob;
    import mx.printing.PrintAdvancedDataGrid;
    import mx.printing.PrintDataGrid;
    import mx.core.Application;
    import mx.validators.Validator;
    import mx.events.ValidationResultEvent;    
 	import mx.rpc.IResponder;
   	import com.efi.printsmith.events.commandEvents.Contacts.*;
   	import com.efi.printsmith.view.CreditCardDataEntry;
   	

    [Bindable]
    private var enableSave:Boolean = true;
    
    private var contacts:ArrayCollection = new ArrayCollection();
                 
	[Bindable]                                         
	private var contact:Contact;
	[Bindable] private var originalContact:Contact;
	[Bindable]
	private var defaultContact:Boolean = false;
	[Bindable]
	private var first:Boolean;	
	[Bindable]
	private var account:Account;
	[Bindable]                                         
    private var creditCardPreferences:PreferencesCreditCard;
	[Bindable]
	private var accounts:ArrayCollection = new ArrayCollection();               
	[Bindable]
    private var salesReps:ArrayCollection = new ArrayCollection(); 
    [Bindable]
    private var citys:ArrayCollection = new ArrayCollection();   
    [Bindable]
    private var states1:ArrayCollection = new ArrayCollection();   
    [Bindable]
    private var countrys:ArrayCollection = new ArrayCollection();  
    [Bindable]
    private var zips:ArrayCollection = new ArrayCollection();
    [Bindable]
    private var creditCardPreferencesArray:ArrayCollection = new ArrayCollection();
   [Bindable] private var loadComponent:CommonLoadComponent;

    [Bindable]
    private var compaigns:ArrayCollection = new ArrayCollection();
      [Bindable]            
    private var gradesarray:ArrayCollection = new ArrayCollection();
                    
    private var formIsValid:Boolean = false;
    
    private var focussedFormControl:DisplayObject;
    
   	private function openContactPicker():void	{
   		loadComponent = PopUpManager.createPopUp(this,CommonLoadComponent,true) as CommonLoadComponent;

   		dataService2.getContactPicker();  
   	}
	public function init():void {
		consumer.subscribe();
		notification_consumer.subscribe();  
		first = true;   
		account= new Account();
		dataServiceCreditCardPreferences.getAll("PreferencesCreditCard");
		this.enabled = false;
		openContactPicker();
		salesRepDataService.getAll("SalesRep");
		campaignDataService.getAll("Campaigns"); 
		GradedataService.getAll("Grade");  
		
		var mdiWin:MDIWindow = Snowmass.getInstance().containerManager.getWindowWithChild(this);
		mdiWin.title = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Contacts');
		
		var eventAddress:ContactsAddressPanelEvent = new ContactsAddressPanelEvent(canvasAddress, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventAddress.dispatch();

		var eventCampaigns:ContactsCampaignsPanelEvent = new ContactsCampaignsPanelEvent(canvasCampaigns, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventCampaigns.dispatch();

		var eventCreditInfo:ContactsCreditInfoPanelEvent = new ContactsCreditInfoPanelEvent(this.canvasCreditInfo, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventCreditInfo.dispatch();

		var eventMarketing:ContactsMarketingPanelEvent = new ContactsMarketingPanelEvent(canvasMarketing, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventMarketing.dispatch();

		var eventWeb:ContactsWebPanelEvent = new ContactsWebPanelEvent(canvasWeb, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventWeb.dispatch();
		    
	}      
	private function handleLoadGradeResult(ev:ResultEvent):void {
		gradesarray = ev.result as ArrayCollection; 
		
	}
	public function handleUIPanelEvent(evt:ResultEvent):void {
		evt.result.panel.enabled = evt.result.enabled;
	}		
	private function handleUIPanelFault(ev:FaultEvent):void {  
	}
	      
	private function doAccountPicker():void {
		loadComponent = PopUpManager.createPopUp(this,CommonLoadComponent,true) as CommonLoadComponent;

		dataService2.getAccountPicker();
			
	}           
	                                  	
	private function handleAccountPickerCancel(evt:AccountPickerSelectEvent):void {
		account = new Account();
		this.setAccount(account);
		
	}
	private function handleGradePickerCancel(evt:GradeSelectEvent):void {
		
	}
	private function handleGradePickerSelect(evt:GradeSelectEvent):void {
		var tempGrade:Grade;
		var index:int
		var tempCamp:Campaigns;
		var tempCamp2:Campaigns;
		tempGrade= 	evt.grade
		for( var t:int;t < compaigns.length; t++){
			tempCamp = compaigns.getItemAt(index) as Campaigns;
			tempCamp.applied = false;
			compaigns.setItemAt(tempCamp,index);
		}
		for (var i:int= 0; i< tempGrade.campaigns.length;i++){
			tempCamp2 = tempGrade.campaigns.getItemAt(i) as Campaigns;
			index = findItem(tempCamp2.name,compaigns)
			tempCamp = compaigns.getItemAt(index) as Campaigns;
			tempCamp.applied = true;
			compaigns.setItemAt(tempCamp,index);
		}
	}
	private function handleAccountPickerSelect(evt:AccountPickerSelectEvent):void {
		
		account = new Account();
		
		if (evt.account != null) {
			this.setAccount(evt.account);
			
		} else {
			this.setAccount(new Account());
			Alert.show("Account Picker returned a null account", "Error");
		}
	}
	
	private function handleAccountPickerNew(evt:AccountPickerSelectEvent):void {
		this.account = new Account();
	}

	private function send():void
	{
		var message:IMessage = new AsyncMessage();
		message.body.contacts = "*";
		//producer.send(message);
	}
		
	public function setContact(contact:Contact):void
	{
		if (contact != null){
			this.contact = contact;
			if (contact.address == null){
				contact.address = new Address(); 
				contact.address.city = "";
				contact.address.state = "";
				contact.address.zip = "";
				contact.address.country = "";
			} 
		/* 	if (contact.shipToAddress == null) {
				contact.shipToAddress = new Address();
				contact.shipToAddress = new Address(); 
				contact.shipToAddress.city = "";
				contact.shipToAddress.state = "";
				contact.shipToAddress.zip = "";
				contact.shipToAddress.country = "";
			} */
			
			if (contact.marketing == null) setMarketing();
			if( contact.creditCard == null) setCreditCard();
			mapFromContactData();
			setCampaigns();
			registerClassAlias("com.efi.printsmith.data.Contact",Contact);
			originalContact = ObjectUtil.copy(this.contact) as Contact;
		}
		//address_editor.setLabel(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.ShippingAddress'));
	 	ship_to_address_editor.setLabel(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.ShippingAddress'));
	}
					
	private function setAccount(account:Account):void
	{
		if (account != null){
			this.account = account;
			contact.parentAccount= this.account
			accountName.text = account.title;
		}

	}
	private function setMarketing():void{
 		
 		if ( contact.marketing == null){
 			contact.marketing = new Marketing();
 			contact.marketing.birthDate = new Date();
 			contact.marketing.followup = new Date();
 			contact.marketing.user3 = new Date();
 			contact.marketing.user4 = new Date();
 			contact.marketing.user5 = new Date();
 		}else{
 			if (contact.marketing.followup == null)
				contact.marketing.followup = new Date();
			if (contact.marketing.birthDate == null)
				contact.marketing.birthDate = new Date();
			if (contact.marketing.user3 == null)
				contact.marketing.user3 = new Date();
			if (contact.marketing.user4 == null)
				contact.marketing.user4 = new Date();
			if (contact.marketing.user5 == null)
				contact.marketing.user5 = new Date();
 					
 		}
 		
 	}
	private function setCreditCard():void{
 		
 		if ( contact.creditCard == null){
 			contact.creditCard = new CreditCard();
 		}else{
 			if (contact.creditCard.expiresDate == null)
 				contact.creditCard.expiresDate = new Date();
 			if ( contact.creditCard == null){
 				contact.creditCard.address1 = "";
 				contact.creditCard.zipCode = "";
 			}
 			cardtype.selectedIndex = findIteminCreditCard(contact.creditCard.type, creditCardPreferencesArray)	
 		}
 		
 	}
	private function messageHandler(message:IMessage):void
	{
	}
                                  
	private function deleteContact():void {              
	     dataService2.deleteItem("Contact",contact.id);                                     
	}
	
	 private function handleLoadCreditCardPreferencesResult(ev:ResultEvent):void {
		creditCardPreferencesArray = ev.result as ArrayCollection;
		
	}	                                                                    
	private function setDefaultContact():void{
		if (contact.parentAccount != null){
			if (contact.parentAccount.contact == contact){
				defaultContact = true;
				use_contact_check.enabled = false;
				AccountsPicker.enabled = false;
				default_contact_text.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.invoicecontact');
				if (contact.parentAccount.billToContact == contact.parentAccount.contact)
						default_contact_text.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.defaultcontact');
			
			}
			else{
				if (contact.parentAccount.billToContact == contact){
					defaultContact = true;
					default_contact_text.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.statementcontact');
					use_contact_check.enabled = false;
					AccountsPicker.enabled = false;
					if (contact.parentAccount.billToContact == contact.parentAccount.contact)
						default_contact_text.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.defaultcontact');
			
				}
				else{
					defaultContact = false;
					use_contact_check.enabled = true;
					AccountsPicker.enabled = true;
				}
			}
			
		}
		
	}	
	
	 	
	 	
	
	private function mapToContactData():void {
		var tempCredit:PreferencesCreditCard = new PreferencesCreditCard;
		var tempCom: ComLink;
		var index:int;
		var tmpContact: Contact;
		tmpContact = contact_editor.getContact();
		contact.firstName = tmpContact.firstName;
		contact.lastName =  tmpContact.lastName;
		contact.prefix = tmpContact.prefix;
		contact.salutation= tmpContact.salutation;
		contact.suffix = tmpContact.suffix;
		
		if (tmpContact.jobTitle == null ||tmpContact.jobTitle.name == "")
			contact.jobTitle = null;
		else
			contact.jobTitle= tmpContact.jobTitle;
		contact.comLinks = tmpContact.comLinks;
		contact.useContactAddress = use_contact_check.selected;
		contact.shipToAddress = ship_to_address_editor.getAddresses();
		contact.address = address_editor.getAddress();
		
			
		if (sales_rep_combo != null && sales_rep_combo.selectedItem != null) 
			if (sales_rep_combo.text == "")
				contact.defaultSalesRep = null
			else
				contact.defaultSalesRep= sales_rep_combo.selectedItem as SalesRep;
		
		
		contact.marketing.birthDate = birthDate.selectedDate;
		contact.marketing.followup= followUp.selectedDate;
		contact.marketing.commonInterst = commonInterest.text;
		contact.marketing.leadSource = leadSource.text;
		contact.marketing.leadSource2 = leadSource1.text;
		contact.marketing.mailerType = mailerType.text;
		contact.marketing.typeWork = typeofWork.text;
		contact.marketing.user3 =  userDate3.selectedDate;
		contact.marketing.user4 = userDate4.selectedDate;
		contact.marketing.user5 = userDate5.selectedDate;
		contact.marketing.user6 = user3Tag.text
		contact.marketing.user7 = user4Tag.text;
		contact.marketing.user8 = user8Tag.text;
		contact.marketing.user9 = user9Tag.text; 
		
		
		
		contact.creditCard.cardHolderName = cardholder.text;
		contact.creditCard.cardDisplayNumber = cardnumber.text;
		contact.creditCard.expiresDate = cardexpiresdate.selectedDate;
		
		contact.creditCard.address1 = cardstreet.text;
		if (cardzip != null && cardzip.selectedItem != null) {
			contact.creditCard.zipCode = cardzip.text;
		}
		
		contact.marketing.noMail = noMail.selected;
		contact.marketing.personalAcct = personalAccount.selected;
		contact.marketing.sportsInterst= sportsInterest.text;
		tempCredit = cardtype.selectedItem as PreferencesCreditCard;
		if (contact.creditCard != null && tempCredit != null)
			contact.creditCard.type = tempCredit.cardType
		if (contact.parentAccount != null)
			contact.parentAccount.accountId = accountID.text;
		saveCampaigns();
		
	/*  if (phone_edit.text.length >0){
	 	index = findCom("Phone", contact.comLinks);
	 	if (index != 1){
	 		tempCom = contact.comLinks.getItemAt(index) as ComLink;
	 		tempCom.value = phone_edit.text;
	 		contact.comLinks.setItemAt(tempCom, index);
	 	}
	 	else{
	 		tempCom.value = phone_edit.text;
	 		tempCom.type = "Phone"
	 		contact.comLinks.addItem(tempCom);
	 	}
	 	
	 }
	 if (mobile_edit.text.length >0){
	 	index = findCom("Cell", contact.comLinks);
	 	if ( index != -1){
	 		tempCom = contact.comLinks.getItemAt(index) as ComLink;
	 		tempCom.value = mobile_edit.text;
	 		contact.comLinks.setItemAt(tempCom, index);
	 	}
	 	else{
	 		tempCom.value = mobile_edit.text;
	 		tempCom.type = "Cell"
	 		contact.comLinks.addItem(tempCom);
	 		
	 	}
	 }
	 if (other_edit.text.length >0){
	 	index = findCom("Other", contact.comLinks);
	 	if ( index != -1){
	 		tempCom = contact.comLinks.getItemAt(index) as ComLink;
	 		tempCom.value = other_edit.text;
	 		contact.comLinks.setItemAt(tempCom, index);
	 	}
	 	else{
	 		tempCom.value = other_edit.text;
	 		tempCom.type = "Other"
	 		contact.comLinks.addItem(tempCom);
	 	}
	 }
	 if (email_edit.text.length >0){
	 	index = findCom("E-Mail", contact.comLinks);
	 	if ( index != -1){
	 		tempCom = contact.comLinks.getItemAt(index) as ComLink;
	 		tempCom.value = email_edit.text;
	 		contact.comLinks.setItemAt(tempCom, index);
	 	}
	 	else{
	 		tempCom.value = email_edit.text;
	 		tempCom.type = "E-Mail"
	 		contact.comLinks.addItem(tempCom);
	 		
	 	}
	 }
		 */
	}
	private function saveCampaigns():void{
		var i:int;
		for (i=0; i<compaigns.length; i++) {
			 var tmpcampaigns:Campaigns = compaigns.getItemAt(i) as Campaigns;
			 if (tmpcampaigns.applied)
			 	contact.campaigns.addItem(tmpcampaigns)
		}
	}
	private function setCampaigns():void{
		var i:int;
		var t:int;
		if (contact.campaigns != null){
			for (i=0; i<contact.campaigns.length; i++) {
				var tmpcampaigns:Campaigns = contact.campaigns.getItemAt(i) as Campaigns;
				for (t=0; t<compaigns.length; t++){
					var tmpcampaigns2:Campaigns = compaigns.getItemAt(t) as Campaigns;
					if (tmpcampaigns2.id == tmpcampaigns.id){
						tmpcampaigns2.applied = true;
						compaigns.setItemAt(tmpcampaigns2, t);
					}
				}
			}
		}
	}
	private function mapFromContactData():void{
		
	 /*   	ship_to_address_editor.setAddress(contact.shipToAddress); */
		ship_to_address_editor.cityDataProvider = citys;
		ship_to_address_editor.stateDataProvider = states1;
		ship_to_address_editor.zipDataProvider = zips;
		ship_to_address_editor.countryDataProvider = countrys;
		use_contact_check.selected = contact.useContactAddress;
		ship_to_address_editor.setAddresses(contact.shipToAddress)
 		address_editor.setAddress(contact.address);
		address_editor.cityDataProvider = citys;
		address_editor.stateDataProvider = states1;
		address_editor.zipDataProvider = zips;
		address_editor.countryDataProvider = countrys; 
		if (contact.parentAccount != null){
			accountName.text = contact.parentAccount.title;
			setDefaultContact();
			
		}
		
		cardzip.selectedIndex = findItem(contact.creditCard.zipCode, zips);

		if (contact.creditCard.expiresDate != null)
		 	cardexpiresdate.selectedDate =contact.creditCard.expiresDate;
		if (contact.marketing.followup != null)
			followUp.selectedDate =contact.marketing.followup;
		if (contact.marketing.birthDate != null)
			birthDate.selectedDate =contact.marketing.birthDate;
		if (contact.marketing.user3!= null)
			userDate3.selectedDate =contact.marketing.user3;
		if (contact.marketing.user4!= null)
			userDate4.selectedDate =contact.marketing.user4;
		if (contact.marketing.user5!= null)
			userDate5.selectedDate =contact.marketing.user5;
		if (contact.defaultSalesRep != null)
			sales_rep_combo.selectedIndex = findItem(contact.defaultSalesRep.name, salesReps);
		else
			sales_rep_combo.selectedIndex = -1;
	    
	/*     for (var i:int =0; i < contact.comLinks.length ; i++)
	    {	 var tempCom:ComLink;
	    	tempCom = contact.comLinks.getItemAt(i) as ComLink;
	    	switch (tempCom.type){
	    		case "Phone" :
	    			phone_edit.text = tempCom.value;
	    			break;
	    		case "Cell":
	    			mobile_edit.text = tempCom.value;
	    			break;
	    		case "Fax":
	    			fax_edit.text = tempCom.value;
	    			break;
	    		case "E-Mail":
	    			email_edit.text = tempCom.value;
	    			break;
	    		case "Other":
	    			other_edit.text = tempCom.value;
	    			break;
	    	}
	    } */
	    	
	}
	private function findIteminCreditCard(name:String, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (name == element.cardType) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function findItem(name:String, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (name == element.name) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function findCom(name:String, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (name == element.type) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function doNew():void {
		if (contact != null && contact.parentAccount != null){
			var tempParent:Account = contact.parentAccount;
			contact = new Contact();
			contact.parentAccount = tempParent;
		}
		else{
		    contact = new Contact();
	   		accountName.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.notassigned');
		 }
	    contact.creditCard = new CreditCard();
	    contact.shipToAddress = new ArrayCollection();
	    
	    contact_editor.setContact(contact);
	    
	    setMarketing();
	    setCreditCard();
	    setContact(contact);
	   
		setDefaultContact();
		use_contact_check.enabled = true;
	 	
	}  
	private function doDelete():void {
	    dataService2.deleteItem("Contact",contact.id);
	 	
	}  
	private function doGet():void{
		
		var contactPickerWindow:ContactPicker = ContactPicker(PopUpManager.createPopUp(this, ContactPicker, true));
	    contactPickerWindow.setStyle("borderAlpha", 0.9);
	    contactPickerWindow.formIsEmpty = true;
	    contactPickerWindow.setContactArray(contacts);
	    contactPickerWindow.addEventListener(ContactPickerSelectEvent.CANCELSELECTACCOUNT, handleContactPickerCancel);
	    contactPickerWindow.addEventListener(ContactPickerSelectEvent.SELECTACCOUNT, handleContactPickerSelect);
	    contactPickerWindow.addEventListener(ContactPickerSelectEvent.SELECTNEWACCOUNT, handleContactPickerNew);
		/* var titleWindow:ContactPicker = ContactPicker(PopUpManager.createPopUp(this, ContactPicker, true));
		titleWindow.setStyle("borderAlpha", 0.9);
		titleWindow.formIsEmpty = true; */
	   	    
	}    
	private function handleContactPickerCancel(evt:ContactPickerSelectEvent):void {
		
	/* 	contact = new Contact();
		 contact.creditCard = new CreditCard();
		setMarketing();
		setCreditCard();
		this.setContact(contact);   defect 875*/
		this.enabled = true;

	}
	private function handleGetResult(ev:ResultEvent):void {
		   this.setContact(ev.result as Contact);
		   contact_editor.setContact(contact);
			setMarketing();
			setCreditCard();
			registerClassAlias("com.efi.printsmith.data.Contact",Contact);
			originalContact = ObjectUtil.copy(contact) as Contact;
	     
	}
	private function handleContactPickerSelect(evt:ContactPickerSelectEvent):void {
		var temp:Contact = new Contact();
		temp= evt.contact as Contact;
		this.enabled = true;
		dataService2.getContact(temp.id );   
		
	}
	
	private function handleContactPickerNew(evt:ContactPickerSelectEvent):void {
		this.enabled = true;
		this.contact = new Contact();
		accountName.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.notassigned');
		 contact_editor.setContact(contact);
		contact.creditCard = new CreditCard();
		contact.shipToAddress = new ArrayCollection();
		setMarketing();
		setCreditCard();
		this.setContact(contact);
	}
	
	private function doNext():void {
		onClose();
		if(getOriginalObject()!=null && getUpdatedObject()!=null){
			if(!compareObject(getOriginalObject(),getUpdatedObject())){
				var mdiConfirmComponent:MDIConfirmComponent = PopUpManager.createPopUp(this,MDIConfirmComponent,true) as MDIConfirmComponent;
				mdiConfirmComponent.labelTxt = getConfirmationText();
				mdiConfirmComponent.addEventListener(WindowConfirmStatusEvent.WINDOW_CONFIRM_STATUS,function(event:WindowConfirmStatusEvent):void{
					if(event.windowConfirmStatus==1){
						onDontSave();
						doNextOperation();
					} else if(event.windowConfirmStatus==2) {
						onCancel();
					} else if(event.windowConfirmStatus==3) {
						addEventListener(WindowSaveSuccessEvent.WINDOW_SAVESUCCESS_STATUS,function(event:WindowSaveSuccessEvent):void {
							if(event.isSaved){
								doNextOperation();
							}	
						},false,0,true);
						onSave();
					}
				},false,0,true);
			} else {
				doNextOperation();
			}
		}  else {
			doNextOperation();
		}
		    
	}
	
	private function doNextOperation():void {  
		var itemp:int;
		var temp:Contact;
		//itemp = contacts.getItemIndex(account); 
		  itemp =	findItemID(contact.id, contacts);
		itemp++;
		if (itemp == contacts.length){
			itemp = contacts.length - 1;
		}
	    temp = contacts.getItemAt(itemp,0) as Contact;   
	   	dataService2.getContact(temp.id );                         
	}
	
	private function doPrev():void {
		onClose();
		if(getOriginalObject()!=null && getUpdatedObject()!=null){
			if(!compareObject(getOriginalObject(),getUpdatedObject())){
				var mdiConfirmComponent:MDIConfirmComponent = PopUpManager.createPopUp(this,MDIConfirmComponent,true) as MDIConfirmComponent;
				mdiConfirmComponent.labelTxt = getConfirmationText();
				mdiConfirmComponent.addEventListener(WindowConfirmStatusEvent.WINDOW_CONFIRM_STATUS,function(event:WindowConfirmStatusEvent):void{
					if(event.windowConfirmStatus==1){
						onDontSave();
						doPrevOperation();
					} else if(event.windowConfirmStatus==2) {
						onCancel();
					} else if(event.windowConfirmStatus==3) {
						addEventListener(WindowSaveSuccessEvent.WINDOW_SAVESUCCESS_STATUS,function(event:WindowSaveSuccessEvent):void {
							if(event.isSaved){
								doPrevOperation();
							}	
						},false,0,true);
						onSave();
					}
				},false,0,true);
			} else {
				doPrevOperation();
			}
		}  else {
			doPrevOperation();
		}
		    
	}
	
	private function doPrevOperation():void {              
	    var itemp:int;
	    var temp:Contact;
	    itemp =	findItemID(contact.id, contacts);
		//itemp = contacts.getItemIndex(contact); 
		itemp--;
		if (itemp < 0){
			itemp = 0; 
		}
		temp = contacts.getItemAt(itemp,0) as Contact;   
	   	dataService2.getContact(temp.id );  
	   
	                                             
	}                                           
	private function findItemID(id:int, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (id == element.id) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function doSave():void {
		mapToContactData();
		dataService2.addUpdate(contact);
		                                    		
	}   

	private function doZipCredit(): void{                             
		var zip:Zip;
		var result:Boolean;
		
		if (cardzip.typedText != null && cardzip.typedText != "" && cardzip.selectedIndex == -1) {
			var item:int = findItem(cardzip.typedText, zips);
			if (item == -1) {
				zip = new Zip();
				zip.name = cardzip.text;
				zipDataService.addUpdate(zip);
				contact.creditCard.zipCode = zip.name;
			}
			else {
				cardzip.selectedItem = item;
			}
		}
	}
	
	private function doSaleRep(): void{                             
		var sales:SalesRep;
		var result:Boolean;
		
		if (sales_rep_combo.text != null && sales_rep_combo.text != "" && sales_rep_combo.selectedIndex == -1) {
			var item:int = findItem(sales_rep_combo.text, salesReps);
			if (item == -1) {
				sales = new SalesRep();
				sales.name = sales_rep_combo.text;
				salesRepDataService.addUpdate(sales);
				contact.defaultSalesRep = sales
			}
			else {
				sales_rep_combo.selectedItem = item;
			}
		}
	}
	
	private function handleSaveResult(ev:ResultEvent):void {
		this.setContact(ev.result as Contact);
	    contact_editor.setContact(contact);
		setMarketing();
		setCreditCard();
		registerClassAlias("com.efi.printsmith.data.Contact",Contact);
		originalContact = ObjectUtil.copy(contact) as Contact;
		//openContactPicker();
		var windowSaveSuccessEvent:WindowSaveSuccessEvent = new WindowSaveSuccessEvent(WindowSaveSuccessEvent.WINDOW_SAVESUCCESS_STATUS,true);
		dispatchEvent(windowSaveSuccessEvent);
	} 

	private function handleLoadAccountResult(ev:ResultEvent):void{
		accounts = ev.result as ArrayCollection;
		var accountPickerWindow:AccountPicker = AccountPicker(PopUpManager.createPopUp(this, AccountPicker, true));
	    accountPickerWindow.setStyle("borderAlpha", 0.9);
	    accountPickerWindow.formIsEmpty = true;
	    accountPickerWindow.prospect_boolean = true;
	    accountPickerWindow.contact_boolean = false;
	    accountPickerWindow.setAccounts(accounts);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.CANCELSELECTACCOUNT, handleAccountPickerCancel);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.SELECTACCOUNT, handleAccountPickerSelect);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.SELECTNEWACCOUNT, handleAccountPickerNew);
	    
		if(loadComponent) {
			loadComponent.close();
		}    
	}
	private function handleLoadResult(ev:ResultEvent):void {
		contacts = ev.result as ArrayCollection;
		if (first){
			first = false;
			this.doGet();
		
		}
		if(loadComponent) {
			loadComponent.close();
		} 
	}
	private function handleLoadCampaigns(ev:ResultEvent):void {
		compaigns = ev.result as ArrayCollection;
	}
	private function containsBlank(ac:ArrayCollection, field:String):Boolean	{
	 	for (var i:int = 0; i<ac.length; i++)	{
	 		if (StringUtil.trim(ac.getItemAt(i)[field] as String) == "")	{
	 			return true;
	 		}
	 	}
	 	return false;
	 } 	
	private function handleLoadSalesReps(ev:ResultEvent):void {
		var selectedItem:Object = sales_rep_combo.selectedItem;
		var sort:Sort = new Sort();
		salesReps = ev.result as ArrayCollection;
		sort.fields = [new SortField("name",true)];
	 	salesReps.sort = sort;
	 	salesReps.refresh();
		if (!containsBlank(salesReps,"name"))	{
			var salesRep:SalesRep = new SalesRep();
			salesRep.name = "";
			salesReps.addItemAt(salesRep, 0);
		}
		sales_rep_combo.selectedItem = selectedItem;
	}
	private function handleLoadCity(ev:ResultEvent):void {
	 	citys = ev.result as ArrayCollection;
		
	}   
	 private function handleLoadState(ev:ResultEvent):void {
		states1 = ev.result as ArrayCollection;
		
	}   
	 private function handleLoadCountry(ev:ResultEvent):void {
		
		countrys = ev.result as ArrayCollection;
		
	}   
	 private function handleLoadZip(ev:ResultEvent):void {
		
	 	var selectedItem2:Object = cardzip.selectedItem;
		zips = ev.result as ArrayCollection;
		
		cardzip.selectedItem = selectedItem2;
	}                                 


	 private function handleLoadAccountById(ev:ResultEvent):void {
		account = ev.result as Account;
	}                              

	private function handleDeleteResult(ev:ResultEvent):void {
		openContactPicker();
		doNew();
	}
	
	private function handleFault(ev:FaultEvent):void {  
		var message:String;
		              
		message = "Error: "                          
		+ ev.fault.faultCode + " - "                                  
		+ ev.fault.faultDetail + " - "                                  
		+ ev.fault.faultString;
		Alert.show(message, "Error");      
		
		if(loadComponent) {
			loadComponent.close();
		}                           
	}
	private function handleSaveCityResult(ev:ResultEvent):void {
		
	//	cityDataService.getAll("City");
		
		
	}      
	private function handleSaveStateResult(ev:ResultEvent):void {
	//stateDataService.getAll("State");
	}   
	private function handleSaveCampaignResult(ev:ResultEvent):void {
		campaignDataService.getAll("Campaigns");
	}       

	private function handleSaveCountryResult(ev:ResultEvent):void {
	//countryDataService.getAll("Country");
	}      

	private function handleSaveZipResult(ev:ResultEvent):void {
		zipDataService.getAll("Zip");
	}
	private function handleSaveSalesRepResult(ev:ResultEvent):void {
		salesRepDataService.getAll("SalesRep");
	}   
	    
	private function validateForm(event:Event):void{                    
        focussedFormControl = event.target as DisplayObject;    
        formIsValid = true;            
     /*    validate(contactFirstValidator);
        validate(contactLastValidator);   */      
    }
    private function validate(validator:Validator):Boolean
	{                
        var validatorSource:DisplayObject = validator.source as DisplayObject;
     	var suppressEvents:Boolean = (validatorSource != focussedFormControl);
        var event:ValidationResultEvent = validator.validate(null, suppressEvents); 
        var currentControlIsValid:Boolean = (event.type == ValidationResultEvent.VALID);
		formIsValid = formIsValid && currentControlIsValid;
        return currentControlIsValid;
	}
	private function editCampaigns():void{
		var editCampaignWindow:EditCampaigns = EditCampaigns(PopUpManager.createPopUp(this, EditCampaigns, true));
	    editCampaignWindow.setStyle("borderAlpha", 0.9);
		editCampaignWindow.addEventListener(CampaignEditCompleteEvent.CANCEL, handleCampaignEditCancel);
		editCampaignWindow.addEventListener(CampaignEditCompleteEvent.SAVE, handleCampaignSave);
		
	    
	}
	private function handleCampaignEditCancel(evt:CampaignEditCompleteEvent):void {
    	
    }
    private function handleCampaignSave(ev:CampaignEditCompleteEvent):void {
		campaignDataService.getAll("Campaigns");
	
	}     
	private function setApplied():void{
		var i:int;
		var tmpcampaigns:Campaigns
		
			tmpcampaigns = dataGrid.selectedItem as Campaigns
			i = findItem(tmpcampaigns.name, compaigns)
			
			if (tmpcampaigns.applied)
				tmpcampaigns.applied = false;
			else
				tmpcampaigns.applied = true;
			
			compaigns.setItemAt(tmpcampaigns,i);
		
			
	}
	public function getCreditName(item:Object):String{
		var tmpCredit:PreferencesCreditCard = item as PreferencesCreditCard
		
		if (tmpCredit != null && tmpCredit.cardType != null && tmpCredit.cardType != "") {
			return tmpCredit.cardType;
		} else {
			return "None";
		}
	}
	private function dorevert():void{
		dataService2.getContact(contact.id);   
	}
	
	private function doShipAddress(item:Object):String{
		var temp:Address = new Address();
		temp = item as Address;
		if ( temp != null){
		 	return(temp.name+" "+temp.city);
		}
		else{
			return("None");
		}
		
	} 

	private function handleEncryptionResult(event:ResultEvent):void {
		if (event.result != null && contact.creditCard != null) {
			contact.creditCard.cardNumber = event.result as String;
			contact.creditCard.encryption = "2";
		}
	}

	private function formatCreditCardNumber(str:String):String {
		var localString:String = new String;
		var xPattern:int;
		
		if (str != "") {
			xPattern = str.indexOf("X");
			
			if (xPattern < 0) {
				var callbacks:IResponder = new mx.rpc.Responder(handleEncryptionResult, handleFault);	
				var encryptCCEvent:EncryptDataEvent = new EncryptDataEvent(EncryptDataEvent.ENCRYPTDATA, str, "AES256WITHSERIALNUMBER", callbacks);
				var i:Number;
				
				contact.creditCard.cardNumber = "";
				
				encryptCCEvent.dispatch();
				
				for (i = 0; i < str.length; ++i) {
					if (i > 0 && i < (str.length-4)) {
						localString = localString.concat("X");
					}
					else {
						localString = localString.concat(str.charAt(i).toString());
					}
				}
				
				return(localString);
			}
		} else {
			contact.creditCard.cardNumber = "";
			contact.creditCard.cardHolderName = "";
			contact.creditCard.encryption = "";
		}
		
		return(str);
	}
	
	private function doReadCardNumber():void{
	//	var valid:Boolean;
	//	var returnVal:Array = new Array;
		
		cardnumber.text = StringUtil.trim(cardnumber.text);
		if (CreditCardDataEntry.IsCardNumberModeTen(cardnumber.text) == false) {
			cardnumber.text = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardManAppvCmd.NotValidNumber');
		} else {
			contact.creditCard.cardNumber = cardnumber.text;
			cardnumber.text = formatCreditCardNumber(cardnumber.text);
			contact.creditCard.cardDisplayNumber = cardnumber.text;
		}
	}

	private function doGrade():void{
	var GradePickerWindow:GradePicker = GradePicker(PopUpManager.createPopUp(this, GradePicker, true));
	    GradePickerWindow.setStyle("borderAlpha", 0.9);
	    GradePickerWindow.setGrades(gradesarray);
	    GradePickerWindow.addEventListener(GradeSelectEvent.CANCELSELECTGRADE, handleGradePickerCancel);
	    GradePickerWindow.addEventListener(GradeSelectEvent.SELECTGRADE, handleGradePickerSelect);
	    	
	}
	
	public function getOriginalObject():ArrayCollection {
		var originalList:ArrayCollection = new ArrayCollection();
		if(originalContact!=null){
			if(originalContact.marketing!=null && originalContact.marketing.birthDate!=null){
				originalContact.marketing.birthDate = scrubTimeValue(originalContact.marketing.birthDate);
			}
			if(originalContact.marketing!=null && originalContact.marketing.followup!=null){
				originalContact.marketing.followup = scrubTimeValue(originalContact.marketing.followup);
			}
			if(originalContact.marketing!=null && originalContact.marketing.user3!=null){
				originalContact.marketing.user3 = scrubTimeValue(originalContact.marketing.user3);
			}
			if(originalContact.marketing!=null && originalContact.marketing.user4!=null){
				originalContact.marketing.user4 = scrubTimeValue(originalContact.marketing.user4);
			}
			if(originalContact.marketing!=null && originalContact.marketing.user5!=null){
				originalContact.marketing.user5 = scrubTimeValue(originalContact.marketing.user5);
			}
			if(originalContact.creditCard!=null && originalContact.creditCard.expiresDate!=null){
				originalContact.creditCard.expiresDate = scrubTimeValue(originalContact.creditCard.expiresDate);
			}
		}
		originalList.addItem(originalContact);
		return originalList;
	}
	
	public function getUpdatedObject():ArrayCollection {
		var updatedList:ArrayCollection = new ArrayCollection();
		updatedList.addItem(contact);
		return updatedList;
	}
	
	public function getConfirmationText():String {
		var confirmationText:String = "";
		confirmationText = "\n"+resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'jobCmd.Contact')+":";
		if(originalContact!=null && originalContact.parentAccount!=null){
			confirmationText = confirmationText+" "+originalContact.parentAccount.title;
		}
		return confirmationText;
	}
	
	public function onClose():void {
		if(contact!=null){
			mapToContactData();
		}
	}
	
	public function onSave():void {
		doSave();
	}
		
	public function onDontSave():void {
		
	}
	
	public function onCancel():void {
		
	}
	
]]>	

                             
</mx:Script>

<mx:VBox width="100%" height="100%">
	<mx:Canvas width="100%" height="100%">
		<mx:TabNavigator x="0" y="70" width="100%" height="100%" creationPolicy="all">
			<mx:Canvas id="canvasAddress" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Address')}" width="100%" height="100%">
				<mx:Text x="80" y="90" width="232" id="accountName" text="{account.title}"/>
				<ns1:ContactInfoEditor x="338" y="10" height="211" width="342" id="contact_editor" contactLabel="Contact"/>
				<mx:Label x="10" y="12" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.ID')}" textAlign="right" width="62"/>
				<mx:Label x="22" y="40" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Acct')}" textAlign="right" width="50"/>
				<mx:Label x="-21" y="90" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Account')}" textAlign="right" width="93"/>
				<mx:Button x="10" y="168" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.ChangeAccount')}" id="AccountsPicker" click="doAccountPicker()"/>
				<mx:ComboBox id="sales_rep_combo" x="498" y="241" width="160" dataProvider="{salesReps}"  labelField="name" focusOut="doSaleRep();" />
				<ns1:AddressEditor x="10" y="269" id="address_editor" height="157" width="325" enabled="{use_contact_check.selected}"/>
				<mx:Text x="80" y="40" width="100" id="accountID" text="{contact.parentAccount.accountId}"/>
				<mx:Text x="80" y="12" text="{contact.contactId}" id="contactID"/>
				<mx:Label x="391" y="243" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.SalesRep')}" textAlign="right" width="83"/>
				<mx:Label x="397" y="218" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Created')}" textAlign="right" width="93"/>
				<mx:Text x="498" y="218" width="160" id="createdDate" text="{contact.created.toDateString()}" height="20"/>
				<ns1:AddressListEditor x="363" y="269" id="ship_to_address_editor" height="215" width="357"/>
				<mx:CheckBox x="10" y="216" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.UseContactAddress')}" id="use_contact_check" />
				<mx:Text x="172" visible="{defaultContact}" y="201"  width="163"  id="default_contact_text"/>
				
			</mx:Canvas>
			<mx:Canvas id="canvasMarketing" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Marketing')}" width="100%" height="100%">
				<mx:RadioButtonGroup id="cust_prospect_radio_group"/>
				<mx:CheckBox x="123" y="10" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.PersonalAccount')}" id="personalAccount" selected="{contact.marketing.personalAcct}" textAlign="right"/>
				<mx:CheckBox x="123" y="36" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Donotmail')}" id="noMail" selected="{contact.marketing.noMail}"/>
				<mx:Panel x="364" y="10" width="305" height="190" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.MarketingDates')}" dropShadowEnabled="false">
					<mx:Label x="12" y="10" text="Follow Up:" textAlign="right"/>
					<mx:Label x="10" y="38" text="Birthdate:" textAlign="right"/>
					<mx:Label x="21" y="66" text="User 3:" textAlign="right"/>
					<mx:Label x="21" y="94" text="User 4:" textAlign="right"/>
					<mx:Label x="21" y="122" text="User 5:" textAlign="right"/>
					<mx:DateField x="119" y="10" id="followUp" text="{contact.marketing.followup}" showToday="false" width="143" enabled="true" editable="true"/>
					<mx:DateField x="119" y="36" id="birthDate" selectedDate="{contact.marketing.birthDate}" showToday="false" width="143" editable="true"/>
					<mx:DateField x="119" y="64" id="userDate3" selectedDate="{contact.marketing.user3}" showToday="false" width="143" editable="true"/>
					<mx:DateField x="119" y="92" id="userDate4" selectedDate="{contact.marketing.user4}" showToday="false" width="143" editable="true"/>
					<mx:DateField x="119" y="118" id="userDate5" selectedDate= "{contact.marketing.user5}" showToday="false" width="143" editable="true"/>
				</mx:Panel>
				<mx:Panel x="10" y="208" width="659" height="195" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.MarketingTags')}" dropShadowEnabled="false">
					<mx:Label x="28" y="10" text="Lead Source:" textAlign="right"/>
					<mx:Label x="-3" y="38" text="Common Interest:" textAlign="right"/>
					<mx:TextInput x="114" y="36" width="175" id="commonInterest" text="{contact.marketing.commonInterst}"/>
					<mx:TextInput x="114" y="64" width="175" id="user3Tag" text="{contact.marketing.user6}"/>
					<mx:Label x="60" y="66" text="User 3:" textAlign="right"/>
					<mx:TextInput x="114" y="92" width="175" id="user4Tag" text="{contact.marketing.user7}"/>
					<mx:Label x="60" y="94" text="User 4:" textAlign="right"/>
					<mx:TextInput x="114" y="118" width="175" id="typeofWork" text="{contact.marketing.typeWork}"/>
					<mx:Label x="21" y="122" text="Type of Work:" textAlign="right"/>
					<mx:TextInput x="114" y="8" width="175" id="leadSource" text="{contact.marketing.leadSource}"/>
					<mx:TextInput x="454" y="38" width="175" id="sportsInterest" text= "{contact.marketing.sportsInterst}"/>
					<mx:TextInput x="454" y="66" width="175" id="user8Tag" text="{contact.marketing.user8}"/>
					<mx:TextInput x="454" y="94" width="175" id="user9Tag" text="{contact.marketing.user9}"/>
					<mx:TextInput x="454" y="120" width="175" id="mailerType" text="{contact.marketing.mailerType}"/>
					<mx:TextInput x="454" y="10" width="175" id="leadSource1" text="{contact.marketing.leadSource}"/>
					<mx:Label x="368" y="12" text="Lead Source:" textAlign="right"/>
					<mx:Label x="359" y="40" text="Sport Interest:" textAlign="right"/>
					<mx:Label x="400" y="68" text="User 8:" textAlign="right"/>
					<mx:Label x="400" y="96" text="User 9:" textAlign="right"/>
					<mx:Label x="372" y="127" text="Mailer Type:" textAlign="right"/>
				</mx:Panel>
			</mx:Canvas>
			<mx:Canvas id="canvasCampaigns" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Campaigns')}" width="100%" height="100%">
				<mx:Button x="384" y="63" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.EditCampaigns')}" id="camp_edit" click="editCampaigns();"/>
				<mx:Button x="384" y="117"  click="doGrade()" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.ApplyGrade')}" id="grade_select" width="113"/>
				<mx:TextArea x="384" y="171" height="90" width="225">  
					<mx:text>{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Thecampaignfeatureal')}</mx:text>
				</mx:TextArea>
				<mx:DataGrid y="10" id="dataGrid" dataProvider="{compaigns}" height="353"  showHeaders="true" headerSeparatorSkin="mx.skins.ProgrammaticSkin" verticalGridLines="false" left="10" right="401" change="setApplied();">
				<mx:columns>
					<mx:DataGridColumn id="checkbox1" width="50" sortable="false" textAlign="center" headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Apply')}" dataField="applied" editorDataField="selected" rendererIsEditor="false" itemRenderer="com.efi.printsmith.components.GenericCheckboxRenderer"/>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Campaigns')}" dataField="name"/>
				</mx:columns>
				</mx:DataGrid>
			</mx:Canvas>
			<mx:Canvas id="canvasCreditInfo" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rStandardMenuText.CreditInfo')}" width="100%" height="100%">
				<mx:Label x="135" y="32" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardTransMgrCmd.CardHolder')}" textAlign="right" width="99"/>
				<mx:Label x="135" y="58" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardTransMgrCmd.CardNumber')}" textAlign="right" width="99"/>
				<mx:Label x="126" y="84" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardTransMgrCmd.Type')}" textAlign="right" width="109"/>
				<mx:Label x="148" y="110" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardTransMgrCmd.Expiration')}" textAlign="right" width="87"/>
				<mx:Label x="135" y="159" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardManAppvCmd.Street')}" textAlign="right" width="100"/>
				<mx:Label x="160" y="185" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardManAppvCmd.Zip')}" textAlign="right" width="75"/>
				<mx:TextInput x="243" y="30" id="cardholder" text="{contact.creditCard.cardHolderName}"/>
				<mx:TextInput x="243" y="56" id="cardnumber" text="{contact.creditCard.cardDisplayNumber}" focusOut="doReadCardNumber()"/>
				<mx:DateField x="243" y="108" id="cardexpiresdate" text="{contact.creditCard.expiresDate}" showToday="true" width="160" editable="true"/>
				<mx:TextInput x="243" y="157" id="cardstreet" text="{contact.creditCard.address1}"/>
				<!--<mx:TextInput x="243" y="183" width="80" id="cardzip" text="{contact.creditCard.address.zip}"/>-->
				<fc:AutoComplete id="cardzip" x="243" y="183" width="80"  dataProvider="{zips}"  labelField="name" focusOut="doZipCredit()" lookAhead="true"/>
					
				<mx:ComboBox x="243" y="82" id="cardtype" dataProvider="{creditCardPreferencesArray}" labelFunction="getCreditName" width="112"></mx:ComboBox>
			</mx:Canvas>
			<mx:Canvas id="canvasWeb" label="Web" width="100%" height="100%">
			</mx:Canvas>
		</mx:TabNavigator>
		<mx:Button x="20" y="10" width="50" height="38" click="doPrev();">
			<mx:icon>@Embed(source='../../../../assets/previous_page.png')</mx:icon>
		</mx:Button>
		<mx:Button x="76" y="10" width="50" height="38" click="doNext();">
			<mx:icon>@Embed(source='../../../../assets/next_page.png')</mx:icon>
		</mx:Button>
		<mx:Label x="20" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'invoiceDeliveryTicketCmd.Previous')}" width="58" textAlign="center"/>
		<mx:Label x="76" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Next')}" width="50" textAlign="center"/>
		<mx:Button x="171" y="10" width="38" height="38" click="doSave();" enabled="{enableSave}">
			<mx:icon>@Embed(source='../../../../assets/file.png')</mx:icon>
		</mx:Button>
		<mx:Label x="171" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Save')}" width="38" textAlign="center"/>
		<mx:Button x="217" y="10" width="38" height="38" click="doGet();">
			<mx:icon>@Embed(source='../../../../assets/get.png')</mx:icon>
		</mx:Button>
		<mx:Label x="217" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Get')}" width="38" textAlign="center"/>
		<mx:Button x="263" y="10" width="38" height="38" click="doNew();">
			<mx:icon>@Embed(source='../../../../assets/new.png')</mx:icon>
		</mx:Button>
		<mx:Button x="370" y="10" width="38" height="38" click="doDelete();">
			<mx:icon>@Embed(source='../../../../assets/delete.png')</mx:icon>
		</mx:Button>
	    <mx:Label x="360" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Delete')}" width="58" textAlign="center"/>
		<mx:Button x="493" y="10" width="38" height="38" click="dorevert();">
			<mx:icon>@Embed(source='../../../../assets/cancel.png')</mx:icon>
		</mx:Button>
		<mx:Label x="483" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Revert')}" width="58" textAlign="center"/>
		<mx:Label x="263" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.New')}" width="38" textAlign="center"/>
	</mx:Canvas>
</mx:VBox>
</mx:Panel>