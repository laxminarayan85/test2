<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:view="com.efi.printsmith.view.*" xmlns:vo="com.efi.printsmith.data.*" xmlns:fc="http://www.adobe.com/2006/fc" xmlns:hc="com.hillelcoren.components.*"
width="100%" height="620" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Contacts')}"
creationComplete="init()" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Contacts')}" name="Contact Editor" xmlns:ns1="com.efi.printsmith.components.*">

<mx:RemoteObject id="dataService2" destination="dataService">
	<mx:method name="getContactPicker" fault="handleFault(event)" result="handleLoadResult(event)"/>
	<mx:method name="deleteItem" fault="handleFault(event)" result="handleDeleteResult(event)"/>
	<mx:method name="getById" fault="handleFault(event)" result="handleGetResult(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="dataServiceCreditCardPreferences" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadCreditCardPreferencesResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="salesRepDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadSalesReps(event)"/>
    <mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveSalesRepResult(event)"/>
</mx:RemoteObject>	

<!--<mx:RemoteObject id="cityDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadCity(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveCityResult(event)"/>
</mx:RemoteObject>

<mx:RemoteObject id="stateDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadState(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveStateResult(event)"/>
</mx:RemoteObject>

<mx:RemoteObject id="countryDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadCountry(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveCountryResult(event)"/>
</mx:RemoteObject>
-->
<mx:RemoteObject id="zipDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadZip(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveZipResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="campaignDataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadCampaigns(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveCampaignResult(event)"/>
</mx:RemoteObject>

<mx:RemoteObject id="accountDataService" destination="dataService">
	<mx:method name="getById" fault="handleFault(event)" result="handleLoadAccountById(event)"/>
</mx:RemoteObject>

<mx:Producer id="producer" destination="contacts"/>
<mx:Consumer id="consumer" destination="salesreps"  message="messageHandler(event.message)"/>
<!--<mx:Consumer id="consumer" destination="citys" message="messageHandler(event.message)"/>
<mx:Consumer id="consumer" destination="countrys" message="messageHandler(event.message)"/>
<mx:Consumer id="consumer" destination="states" message="messageHandler(event.message)"/>
<mx:Consumer id="consumer" destination="zips" message="messageHandler(event.message)"/>-->
<mx:Consumer id="notification_consumer" destination="notifications" message="messageHandler(event.message)"/>


<mx:StringValidator id="contactFirstValidator" source="{name_edit}"	property="text"	minLength="2" required="true"/>
<mx:StringValidator id="contactLastValidator" source="{last_name_edit}"	property="text"	minLength="2" required="true"/>


<mx:Script> 
                                  
<![CDATA[
	import mx.collections.ArrayCollection;
	import mx.collections.ArrayCollection;
	import com.efi.printsmith.data.Contact;
	import com.efi.printsmith.data.Address;                        
	import com.efi.printsmith.data.Account; 
	import com.efi.printsmith.data.CreditCard;
	import com.efi.printsmith.data.Campaigns;
	import com.efi.printsmith.data.City;
	import com.efi.printsmith.data.Country;
	import com.efi.printsmith.data.State;
	import com.efi.printsmith.data.Zip;
	import com.efi.printsmith.data.Grade;
	import com.efi.printsmith.data.Marketing;
	import com.efi.printsmith.data.SalesRep;  
	import com.efi.printsmith.events.AccountPickerSelectEvent;
	import com.efi.printsmith.events.ContactPickerSelectEvent;
	import com.efi.printsmith.events.CampaignEditCompleteEvent;
	import com.efi.printsmith.data.PreferencesCreditCard;

	import mx.rpc.Responder;
	import mx.controls.Alert;                                         
	import mx.managers.PopUpManager;                                         
	import mx.containers.TitleWindow;                                         
	import mx.collections.ArrayCollection;                                         
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;                                         
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
    import mx.printing.FlexPrintJob;
    import mx.printing.PrintAdvancedDataGrid;
    import mx.printing.PrintDataGrid;
    import mx.core.Application;
    import mx.validators.Validator;
    import mx.events.ValidationResultEvent;    
   	import com.efi.printsmith.events.commandEvents.Contacts.*;

    [Bindable]
    private var enableSave:Boolean = true;
    
    private var contacts:ArrayCollection = new ArrayCollection();
                 
	[Bindable]                                         
	private var contact:Contact;
	[Bindable]
	private var first:Boolean;	
	[Bindable]
	private var account:Account;
	[Bindable]                                         
    private var creditCardPreferences:PreferencesCreditCard;
	               
	[Bindable]
    private var salesReps:ArrayCollection = new ArrayCollection(); 
    [Bindable]
    private var citys:ArrayCollection = new ArrayCollection();   
    [Bindable]
    private var states1:ArrayCollection = new ArrayCollection();   
    [Bindable]
    private var countrys:ArrayCollection = new ArrayCollection();  
    [Bindable]
    private var zips:ArrayCollection = new ArrayCollection();
    [Bindable]
    private var creditCardPreferencesArray:ArrayCollection = new ArrayCollection();
    
    
    [Bindable]
    private var compaigns:ArrayCollection = new ArrayCollection();
                     
    private var formIsValid:Boolean = false;
    
    private var focussedFormControl:DisplayObject;
    
   
	public function init():void {
		consumer.subscribe();
		notification_consumer.subscribe();  
		first = true;   
		account= new Account();
		dataServiceCreditCardPreferences.getAll("PreferencesCreditCard");
		dataService2.getContactPicker("Contact");  
		salesRepDataService.getAll("SalesRep");
		//cityDataService.getAll("City");
		//stateDataService.getAll("State");
		//countryDataService.getAll("Country");
	//	zipDataService.getAll("Zip"); 
		campaignDataService.getAll("Campaigns");  
		
		
		var eventAddress:ContactsAddressPanelEvent = new ContactsAddressPanelEvent(canvasAddress, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventAddress.dispatch();

		var eventCampaigns:ContactsCampaignsPanelEvent = new ContactsCampaignsPanelEvent(canvasCampaigns, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventCampaigns.dispatch();

		var eventCreditInfo:ContactsCreditInfoPanelEvent = new ContactsCreditInfoPanelEvent(this.canvasCreditInfo, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventCreditInfo.dispatch();

		var eventMarketing:ContactsMarketingPanelEvent = new ContactsMarketingPanelEvent(canvasMarketing, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventMarketing.dispatch();

		var eventWeb:ContactsWebPanelEvent = new ContactsWebPanelEvent(canvasWeb, new mx.rpc.Responder(handleUIPanelEvent, handleUIPanelFault));
		eventWeb.dispatch();
		    
	}      

	public function handleUIPanelEvent(evt:ResultEvent):void {
		evt.result.panel.enabled = evt.result.enabled;
	}		
	private function handleUIPanelFault(ev:FaultEvent):void {  
	}
	      
	private function doAccountPicker():void {
		var accountPickerWindow:AccountPicker = AccountPicker(PopUpManager.createPopUp(this, AccountPicker, true));
	    accountPickerWindow.setStyle("borderAlpha", 0.9);
	    accountPickerWindow.formIsEmpty = true;
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.CANCELSELECTACCOUNT, handleAccountPickerCancel);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.SELECTACCOUNT, handleAccountPickerSelect);
	    accountPickerWindow.addEventListener(AccountPickerSelectEvent.SELECTNEWACCOUNT, handleAccountPickerNew);		
	}           
	                                  	
	private function handleAccountPickerCancel(evt:AccountPickerSelectEvent):void {
		account = new Account();
		this.setAccount(account);
	}
	
	private function handleAccountPickerSelect(evt:AccountPickerSelectEvent):void {
		if (evt.account != null) {
			this.setAccount(evt.account);
			
		} else {
			this.setAccount(new Account());
			Alert.show("Account Picker returned a null account", "Error");
		}
	}
	
	private function handleAccountPickerNew(evt:AccountPickerSelectEvent):void {
		this.account = new Account();
	}

	private function send():void
	{
		var message:IMessage = new AsyncMessage();
		message.body.contacts = "*";
		//producer.send(message);
	}
		
	public function setContact(contact:Contact):void
	{
		if (contact != null){
			this.contact = contact;
			if (contact.address == null){
				contact.address = new Address(); 
				contact.address.city = "";
				contact.address.state = "";
				contact.address.zip = "";
				contact.address.country = "";
			} 
			if (contact.shipToAddress == null) {
				contact.shipToAddress = new Address();
				contact.shipToAddress = new Address(); 
				contact.shipToAddress.city = "";
				contact.shipToAddress.state = "";
				contact.shipToAddress.zip = "";
				contact.shipToAddress.country = "";
			}
			
			if (contact.marketing == null) setMarketing();
			if( contact.creditCard == null) setCreditCard();
			mapFromContactData();
			setCampaigns()
		}
		ship_to_address_editor.setLabel(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.ShippingAddress'));
	}
					
	private function setAccount(account:Account):void
	{
		if (account != null){
			this.account = account;
			contact.parentAccount= this.account
			accountName.text = account.title;
		}

	}
	private function setMarketing():void{
 		
 		if ( contact.marketing == null){
 			contact.marketing = new Marketing();
 			contact.marketing.birthDate = new Date();
 			contact.marketing.followup = new Date();
 			contact.marketing.user3 = new Date();
 			contact.marketing.user4 = new Date();
 			contact.marketing.user5 = new Date();
 		}else{
 			if (contact.marketing.followup == null)
				contact.marketing.followup = new Date();
			if (contact.marketing.birthDate == null)
				contact.marketing.birthDate = new Date();
			if (contact.marketing.user3 == null)
				contact.marketing.user3 = new Date();
			if (contact.marketing.user4 == null)
				contact.marketing.user4 = new Date();
			if (contact.marketing.user5 == null)
				contact.marketing.user5 = new Date();
 					
 		}
 		
 	}
	private function setCreditCard():void{
 		
 		if ( contact.creditCard == null){
 			contact.creditCard = new CreditCard();
 		}else{
 			if (contact.creditCard.expiresDate == null)
 				contact.creditCard.expiresDate = new Date();
 			if ( contact.creditCard.address == null){
 				contact.creditCard.address = new Address();
 				contact.creditCard.address.zip = "";
 			}
 			cardtype.selectedIndex = findIteminCreditCard(contact.creditCard.type, creditCardPreferencesArray)	
 		}
 		
 	}
	private function messageHandler(message:IMessage):void
	{
	}
                                  
	private function deleteContact():void {              
	     dataService2.deleteItem("Contact",contact.id);                                     
	}
	
	 private function handleLoadCreditCardPreferencesResult(ev:ResultEvent):void {
		creditCardPreferencesArray = ev.result as ArrayCollection;
		
	}	                                                                    
		
	private function mapToContactData():void {
		var tempCredit:PreferencesCreditCard = new PreferencesCreditCard;
		contact.firstName = name_edit.text;
		contact.lastName =  last_name_edit.text;
		contact.prefix = contact_prefix_edit.text;
		contact.salutation= contact_salutation_edit.text;
		contact.suffix = contact_suffix_edit.text;
		contact.jobTitle= contact_job_title_edit.text;
		 
		contact.shipToAddress = ship_to_address_editor.getAddress();
		contact.address = address_editor.getAddress();
		
			
		if (sales_rep_combo != null && sales_rep_combo.selectedItem != null) 
			contact.defaultSalesRep= sales_rep_combo.selectedItem as SalesRep;
			
			
		contact.marketing.birthDate = birthDate.selectedDate;
		contact.marketing.followup= followUp.selectedDate;
		contact.marketing.commonInterst = commonInterest.text;
		contact.marketing.leadSource = leadSource.text;
		contact.marketing.leadSource2 = leadSource1.text;
		contact.marketing.mailerType = mailerType.text;
		contact.marketing.typeWork = typeofWork.text;
		contact.marketing.user3 =  userDate3.selectedDate;
		contact.marketing.user4 = userDate4.selectedDate;
		contact.marketing.user5 = userDate5.selectedDate;
		contact.marketing.user6 = user3Tag.text
		contact.marketing.user7 = user4Tag.text;
		contact.marketing.user8 = user8Tag.text;
		contact.marketing.user9 = user9Tag.text; 
		
		contact.creditCard.cardHolderName = cardholder.text;
		contact.creditCard.cardNumber = cardnumber.text;
		contact.creditCard.expiresDate = cardexpiresdate.selectedDate;
		if (contact.creditCard.address != null){
			contact.creditCard.address.street1 = cardstreet.text;
			if (cardzip != null && cardzip.selectedItem != null) 
				contact.creditCard.address.zip = cardzip.text;
		}
		
		contact.marketing.noMail = noMail.selected;
		contact.marketing.personalAcct = personalAccount.selected;
		contact.marketing.sportsInterst= sportsInterest.text;
		tempCredit = cardtype.selectedItem as PreferencesCreditCard;
		if (contact.creditCard != null && tempCredit != null)
			contact.creditCard.type = tempCredit.cardType
		if (contact.parentAccount != null)
			contact.parentAccount.accountId = accountID.text;
		saveCampaigns();
		
	}
	private function saveCampaigns():void{
		var i:int;
		for (i=0; i<compaigns.length; i++) {
			 var tmpcampaigns:Campaigns = compaigns.getItemAt(i) as Campaigns;
			 if (tmpcampaigns.applied)
			 	contact.campaigns.addItem(tmpcampaigns)
		}
	}
	private function setCampaigns():void{
		var i:int;
		var t:int;
		if (contact.campaigns != null){
			for (i=0; i<contact.campaigns.length; i++) {
				var tmpcampaigns:Campaigns = contact.campaigns.getItemAt(i) as Campaigns;
				for (t=0; t<compaigns.length; t++){
					var tmpcampaigns2:Campaigns = compaigns.getItemAt(t) as Campaigns;
					if (tmpcampaigns2.id == tmpcampaigns.id){
						tmpcampaigns2.applied = true;
						compaigns.setItemAt(tmpcampaigns2, t);
					}
				}
			}
		}
	}
	private function mapFromContactData():void{
		
	 	ship_to_address_editor.setAddress(contact.shipToAddress);
		ship_to_address_editor.cityDataProvider = citys;
		ship_to_address_editor.stateDataProvider = states1;
		ship_to_address_editor.zipDataProvider = zips;
		ship_to_address_editor.countryDataProvider = countrys;
		
		address_editor.setAddress(contact.address);
		address_editor.cityDataProvider = citys;
		address_editor.stateDataProvider = states1;
		address_editor.zipDataProvider = zips;
		address_editor.countryDataProvider = countrys;
		if (contact.parentAccount != null)
			accountName.text = contact.parentAccount.title;
	 	if (contact.creditCard.address != null)
			cardzip.selectedIndex = findItem(contact.creditCard.address.zip, zips);
		if (contact.creditCard.expiresDate != null)
		 	cardexpiresdate.selectedDate =contact.creditCard.expiresDate;
		if (contact.marketing.followup != null)
			followUp.selectedDate =contact.marketing.followup;
		if (contact.marketing.birthDate != null)
			birthDate.selectedDate =contact.marketing.birthDate;
		if (contact.marketing.user3!= null)
			userDate3.selectedDate =contact.marketing.user3;
		if (contact.marketing.user4!= null)
			userDate4.selectedDate =contact.marketing.user4;
		if (contact.marketing.user5!= null)
			userDate5.selectedDate =contact.marketing.user5;
		if (contact.defaultSalesRep != null)
			sales_rep_combo.selectedIndex = findItem(contact.defaultSalesRep.name, salesReps);
	    
	   
		
	}
	private function findIteminCreditCard(name:String, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (name == element.cardType) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function findItem(name:String, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (name == element.name) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function doNew():void {
	    contact = new Contact();
	    contact.creditCard = new CreditCard();
	    
	    setMarketing();
	    setCreditCard();
	    setContact(contact);
	    account = new Account();
		this.setAccount(account);
	 	
	}  
	private function doDelete():void {
	    dataService2.deleteItem("Contact",contact.id);
	 	
	}  
	private function doGet():void{
		
		var contactPickerWindow:ContactPicker = ContactPicker(PopUpManager.createPopUp(this, ContactPicker, true));
	    contactPickerWindow.setStyle("borderAlpha", 0.9);
	    contactPickerWindow.formIsEmpty = true;
	    contactPickerWindow.setContactArray(contacts);
	    contactPickerWindow.addEventListener(ContactPickerSelectEvent.CANCELSELECTACCOUNT, handleContactPickerCancel);
	    contactPickerWindow.addEventListener(ContactPickerSelectEvent.SELECTACCOUNT, handleContactPickerSelect);
	    contactPickerWindow.addEventListener(ContactPickerSelectEvent.SELECTNEWACCOUNT, handleContactPickerNew);
		/* var titleWindow:ContactPicker = ContactPicker(PopUpManager.createPopUp(this, ContactPicker, true));
		titleWindow.setStyle("borderAlpha", 0.9);
		titleWindow.formIsEmpty = true; */
	   	    
	}    
	private function handleContactPickerCancel(evt:ContactPickerSelectEvent):void {
		
		contact = new Contact();
		 contact.creditCard = new CreditCard();
		setMarketing();
		setCreditCard();
		this.setContact(contact);

	}
	private function handleGetResult(ev:ResultEvent):void {
		   this.setContact(ev.result as Contact);
			setMarketing();
			setCreditCard();
	     
	}
	private function handleContactPickerSelect(evt:ContactPickerSelectEvent):void {
		var temp:Contact = new Contact();
		temp= evt.contact as Contact;
		dataService2.getById("Contact", temp.id );   
		
	}
	
	private function handleContactPickerNew(evt:ContactPickerSelectEvent):void {
		this.contact = new Contact();
		contact.creditCard = new CreditCard();
		setMarketing();
		setCreditCard();
		this.setContact(contact);
	}
	
	private function doNext():void {  
		var itemp:int;
		var temp:Contact;
		//itemp = contacts.getItemIndex(account); 
		  itemp =	findItemID(contact.id, contacts);
		itemp++;
		if (itemp == contacts.length){
			itemp = contacts.length - 1;
		}
	    temp = contacts.getItemAt(itemp,0) as Contact;   
	   	dataService2.getById("Contact", temp.id );                       
	}
	private function doPrev():void {              
	    var itemp:int;
	    var temp:Contact;
	    itemp =	findItemID(contact.id, contacts);
		//itemp = contacts.getItemIndex(contact); 
		itemp--;
		if (itemp < 0){
			itemp = 0; 
		}
		temp = contacts.getItemAt(itemp,0) as Contact;   
	   	dataService2.getById("Contact", temp.id );
	   
	                                             
	}                                           
	private function findItemID(id:int, array:ArrayCollection):int {
		for each(var element:Object in array) {
			if (id == element.id) {
				return array.getItemIndex(element);
			}
		}
		return -1;
	}
	private function doSave():void {
		mapToContactData();
		dataService2.addUpdate(contact);
		                                    		
	}   

	private function doZipCredit(): void{                             
		var zip:Zip;
		var result:Boolean;
		
		if (cardzip.typedText != null && cardzip.typedText != "" && cardzip.selectedIndex == -1) {
			var item:int = findItem(cardzip.typedText, zips);
			if (item == -1) {
				zip = new Zip();
				zip.name = cardzip.text;
				zipDataService.addUpdate(zip);
				contact.creditCard.address.zip = zip.name;
			}
			else {
				cardzip.selectedItem = item;
			}
		}
	}
	
	private function doSaleRep(): void{                             
		var sales:SalesRep;
		var result:Boolean;
		
		if (sales_rep_combo.typedText != null && sales_rep_combo.typedText != "" && sales_rep_combo.selectedIndex == -1) {
			var item:int = findItem(sales_rep_combo.typedText, salesReps);
			if (item == -1) {
				sales = new SalesRep();
				sales.name = sales_rep_combo.text;
				salesRepDataService.addUpdate(sales);
				contact.defaultSalesRep = sales
			}
			else {
				sales_rep_combo.selectedItem = item;
			}
		}
	}
	
	private function handleSaveResult(ev:ResultEvent):void {
		this.contact = ev.result as Contact;
		setContact(this.contact);
		dataService2.getContactPicker("Contact");
	}

	
	private function handleLoadResult(ev:ResultEvent):void {
		contacts = ev.result as ArrayCollection;
		if (first){
			first = false;
			this.doGet();
		
		}
	}
	private function handleLoadCampaigns(ev:ResultEvent):void {
		compaigns = ev.result as ArrayCollection;
	}
	private function handleLoadSalesReps(ev:ResultEvent):void {
		var selectedItem:Object = sales_rep_combo.selectedItem;
		salesReps = ev.result as ArrayCollection;
		sales_rep_combo.selectedItem = selectedItem;
	}
	private function handleLoadCity(ev:ResultEvent):void {
	 	citys = ev.result as ArrayCollection;
		
	}   
	 private function handleLoadState(ev:ResultEvent):void {
		states1 = ev.result as ArrayCollection;
		
	}   
	 private function handleLoadCountry(ev:ResultEvent):void {
		
		countrys = ev.result as ArrayCollection;
		
	}   
	 private function handleLoadZip(ev:ResultEvent):void {
		
	 	var selectedItem2:Object = cardzip.selectedItem;
		zips = ev.result as ArrayCollection;
		
		cardzip.selectedItem = selectedItem2;
	}                                 


	 private function handleLoadAccountById(ev:ResultEvent):void {
		account = ev.result as Account;
	}                              

	private function handleDeleteResult(ev:ResultEvent):void {
		dataService2.getContactPicker("Contact");
		doNew();
	}
	
	private function handleFault(ev:FaultEvent):void {  
		var message:String;
		              
		message = "Error: "                          
		+ ev.fault.faultCode + " - "                                  
		+ ev.fault.faultDetail + " - "                                  
		+ ev.fault.faultString;
		Alert.show(message, "Error");                                 
	}
	private function handleSaveCityResult(ev:ResultEvent):void {
		
	//	cityDataService.getAll("City");
		
		
	}      
	private function handleSaveStateResult(ev:ResultEvent):void {
	//stateDataService.getAll("State");
	}   
	private function handleSaveCampaignResult(ev:ResultEvent):void {
		campaignDataService.getAll("Campaigns");
	}       

	private function handleSaveCountryResult(ev:ResultEvent):void {
	//countryDataService.getAll("Country");
	}      

	private function handleSaveZipResult(ev:ResultEvent):void {
		zipDataService.getAll("Zip");
	}
	private function handleSaveSalesRepResult(ev:ResultEvent):void {
		salesRepDataService.getAll("SalesRep");
	}   
	    
	private function validateForm(event:Event):void{                    
        focussedFormControl = event.target as DisplayObject;    
        formIsValid = true;            
        validate(contactFirstValidator);
        validate(contactLastValidator);        
    }
    private function validate(validator:Validator):Boolean
	{                
        var validatorSource:DisplayObject = validator.source as DisplayObject;
     	var suppressEvents:Boolean = (validatorSource != focussedFormControl);
        var event:ValidationResultEvent = validator.validate(null, suppressEvents); 
        var currentControlIsValid:Boolean = (event.type == ValidationResultEvent.VALID);
		formIsValid = formIsValid && currentControlIsValid;
        return currentControlIsValid;
	}
	private function editCampaigns():void{
		var editCampaignWindow:EditCampaigns = EditCampaigns(PopUpManager.createPopUp(this, EditCampaigns, true));
	    editCampaignWindow.setStyle("borderAlpha", 0.9);
		editCampaignWindow.addEventListener(CampaignEditCompleteEvent.CANCEL, handleCampaignEditCancel);
		editCampaignWindow.addEventListener(CampaignEditCompleteEvent.SAVE, handleCampaignSave);
		
	    
	}
	private function handleCampaignEditCancel(evt:CampaignEditCompleteEvent):void {
    	
    }
    private function handleCampaignSave(ev:CampaignEditCompleteEvent):void {
		campaignDataService.getAll("Campaigns");
	}     
	private function setApplied():void{
		var i:int;
		for (i=0; i<contact.campaigns.length; i++) {
			checkbox1.dataField
			dataGrid.selectedItem
			var tmpcampaigns:Campaigns = contact.campaigns.getItemAt(i) as Campaigns;
		}
			
	}
	public function getCreditName(item:Object):String{
		var tmpCredit:PreferencesCreditCard = item as PreferencesCreditCard
		
		if (tmpCredit != null && tmpCredit.cardType != null && tmpCredit.cardType != "") {
			return tmpCredit.cardType;
		} else {
			return "None";
		}
	}
	
]]>	

                             
</mx:Script>

<mx:VBox width="100%" height="100%">
	<mx:Canvas width="851" height="704">
		<mx:TabNavigator x="0" y="70" width="681" height="635" creationPolicy="all">
			<mx:Canvas id="canvasAddress" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'KAddressEditorCommand.EditAddress')}" width="100%" height="100%">
				<mx:TextInput x="315" y="8" id="name_edit" width="193" text="{contact.firstName}" />
				<ns1:AddressEditor x="10" y="215" id="address_editor" height="157" width="325"/>
				<mx:Text x="80" y="40" width="100" id="accountID" text="{contact.parentAccount.accountId}"/>
				<mx:Text x="80" y="12" text="{contact.contactId}" id="contactID"/>
				<mx:Label x="224" y="170" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.SalesRep')}" textAlign="right" width="83"/>
				<mx:Label x="214" y="144" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Created')}" textAlign="right" width="93"/>
				<mx:Text x="315" y="144" width="160" id="createdDate" text="{contact.created.toString()}" height="27"/>
				<ns1:AddressEditor x="344" y="215" id="ship_to_address_editor" height="157" width="325"/>
				<fc:AutoComplete id="sales_rep_combo" x="315" y="168" width="160" dataProvider="{salesReps}"  labelField="name" focusOut="doSaleRep();" lookAhead="true" />
				<mx:Text x="90" y="90" width="121" id="accountName" text="{account.title}"/>
				<mx:Button x="10" y="168" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rStandardMenuText.Accounts')}" id="AccountsPicker" click="doAccountPicker()"/>
				<mx:Label x="224" y="10" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'KAddressEditorCommand.First')}" width="83" textAlign="right"/>
				<mx:Label x="224" y="38" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'KAddressEditorCommand.Last')}" width="83" textAlign="right"/>
				<mx:Label x="240" y="66" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'KAddressEditorCommand.Prefix')}" width="67" textAlign="right"/>
				<mx:Label x="240" y="94" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'KAddressEditorCommand.JobTitle')}" width="67" textAlign="right"/>
				<mx:Label x="407" y="68" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'KAddressEditorCommand.Suffix')}" width="48" textAlign="right"/>
				<mx:Label x="240" y="122" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'KAddressEditorCommand.Salutation')}" width="67" textAlign="right"/>
				<mx:TextInput x="315" y="40" width="194" id="last_name_edit" text="{contact.lastName}" change="validateForm(event);"/>
				<mx:TextInput x="316.5" y="64" width="46" id="contact_prefix_edit" text="{contact.prefix}"/>
				<mx:TextInput x="463" y="66" width="46" id="contact_suffix_edit" text="{contact.suffix}"/>
				<mx:TextInput x="315" y="92" width="194" id="contact_job_title_edit" text="{contact.jobTitle}"/>
				<mx:TextInput x="315" y="120" id="contact_salutation_edit" text="{contact.salutation}"/>
				<mx:Label x="10" y="12" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kTablePropertiesCommand.ID')}" textAlign="right" width="62"/>
				<mx:Label x="22" y="40" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Acct')}" textAlign="right" width="50"/>
				<mx:Label x="0" y="90" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rCustSort.AccountName')}" textAlign="right" width="82"/>
			</mx:Canvas>
			<mx:Canvas id="canvasMarketing" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Marketing')}" width="100%" height="100%">
				<mx:RadioButtonGroup id="cust_prospect_radio_group"/>
				<mx:CheckBox x="123" y="10" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.PersonalAccount')}" id="personalAccount" selected="{contact.marketing.personalAcct}" textAlign="right"/>
				<mx:CheckBox x="123" y="36" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'custCmd.Donotmail')}" id="noMail" selected="{contact.marketing.noMail}"/>
				<mx:Panel x="377" y="10" width="292" height="190" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.MarketingDates')}" dropShadowEnabled="false">
					<mx:Label x="12" y="10" text="Follow Up:" textAlign="right"/>
					<mx:Label x="10" y="38" text="Birthdate:" textAlign="right"/>
					<mx:Label x="21" y="66" text="User 3:" textAlign="right"/>
					<mx:Label x="21" y="94" text="User 4:" textAlign="right"/>
					<mx:Label x="21" y="122" text="User 5:" textAlign="right"/>
					<mx:DateField x="119" y="10" id="followUp" text="{contact.marketing.followup}" showToday="false" width="143"/>
					<mx:DateField x="119" y="36" id="birthDate" text= "{contact.marketing.birthDate}" showToday="false" width="143"/>
					<mx:DateField x="119" y="64" id="userDate3" text="{contact.marketing.user3}" showToday="false" width="143"/>
					<mx:DateField x="119" y="92" id="userDate4" text="{contact.marketing.user4}" showToday="false" width="143"/>
					<mx:DateField x="119" y="118" id="userDate5" text= "{contact.marketing.user5}" showToday="false" width="143"/>
				</mx:Panel>
				<mx:Panel x="10" y="208" width="659" height="195" layout="absolute" title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.MarketingTags')}" dropShadowEnabled="false">
					<mx:Label x="28" y="10" text="Lead Source:" textAlign="right"/>
					<mx:Label x="-3" y="38" text="Common Interest:" textAlign="right"/>
					<mx:TextInput x="114" y="36" width="175" id="commonInterest" text="{contact.marketing.commonInterst}"/>
					<mx:TextInput x="114" y="64" width="175" id="user3Tag" text="{contact.marketing.user6}"/>
					<mx:Label x="60" y="66" text="User 3:" textAlign="right"/>
					<mx:TextInput x="114" y="92" width="175" id="user4Tag" text="{contact.marketing.user7}"/>
					<mx:Label x="60" y="94" text="User 4:" textAlign="right"/>
					<mx:TextInput x="114" y="118" width="175" id="typeofWork" text="{contact.marketing.typeWork}"/>
					<mx:Label x="21" y="122" text="Type of Work:" textAlign="right"/>
					<mx:TextInput x="114" y="8" width="175" id="leadSource" text="{contact.marketing.leadSource}"/>
					<mx:TextInput x="454" y="38" width="175" id="sportsInterest" text= "{contact.marketing.sportsInterst}"/>
					<mx:TextInput x="454" y="66" width="175" id="user8Tag" text="{contact.marketing.user8}"/>
					<mx:TextInput x="454" y="94" width="175" id="user9Tag" text="{contact.marketing.user9}"/>
					<mx:TextInput x="454" y="120" width="175" id="mailerType" text="{contact.marketing.mailerType}"/>
					<mx:TextInput x="454" y="10" width="175" id="leadSource1" text="{contact.marketing.leadSource}"/>
					<mx:Label x="368" y="12" text="Lead Source:" textAlign="right"/>
					<mx:Label x="359" y="40" text="Sport Interest:" textAlign="right"/>
					<mx:Label x="400" y="68" text="User 8:" textAlign="right"/>
					<mx:Label x="400" y="96" text="User 9:" textAlign="right"/>
					<mx:Label x="372" y="127" text="Mailer Type:" textAlign="right"/>
				</mx:Panel>
			</mx:Canvas>
			<mx:Canvas id="canvasCampaigns" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Campaigns')}" width="100%" height="100%">
				<mx:Button x="384" y="63" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.EditCampaigns')}" id="camp_edit" click="editCampaigns();"/>
				<mx:Button x="384" y="117" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.ApplyGrade')}" id="grade_select" width="113"/>
				<mx:TextArea x="384" y="171" height="90" width="225">  
					<mx:text>{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Thecampaignfeatureal')}</mx:text>
				</mx:TextArea>
				<mx:DataGrid y="10" id="dataGrid" dataProvider="{compaigns}" height="353"  showHeaders="true" headerSeparatorSkin="mx.skins.ProgrammaticSkin" verticalGridLines="false" left="10" right="320" change="setApplied();">
				<mx:columns>
					<mx:DataGridColumn  id="checkbox1" width="50" sortable="false" textAlign="center" headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Apply')}" dataField="applied" editorDataField="selected" rendererIsEditor="false" itemRenderer="com.efi.printsmith.components.GenericCheckboxRenderer"/>
					<mx:DataGridColumn headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'kContactManagerCommand.Campaigns')}" dataField="name"/>
				</mx:columns>
				</mx:DataGrid>
			</mx:Canvas>
			<mx:Canvas id="canvasCreditInfo" label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rStandardMenuText.CreditInfo')}" width="100%" height="100%">
				<mx:Label x="135" y="32" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardTransMgrCmd.CardHolder')}" textAlign="right" width="99"/>
				<mx:Label x="135" y="58" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardTransMgrCmd.CardNumber')}" textAlign="right" width="99"/>
				<mx:Label x="126" y="84" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardTransMgrCmd.Type')}" textAlign="right" width="109"/>
				<mx:Label x="148" y="110" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardTransMgrCmd.Expiration')}" textAlign="right" width="87"/>
				<mx:Label x="135" y="159" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardManAppvCmd.Street')}" textAlign="right" width="100"/>
				<mx:Label x="160" y="185" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'creditCardManAppvCmd.Zip')}" textAlign="right" width="75"/>
				<mx:TextInput x="243" y="30" id="cardholder" text="{contact.creditCard.cardHolderName}"/>
				<mx:TextInput x="243" y="56" id="cardnumber" text="{contact.creditCard.cardNumber}"/>
				<mx:DateField x="243" y="108" id="cardexpiresdate" text="{contact.creditCard.expiresDate}" showToday="true" width="160"/>
				<mx:TextInput x="243" y="157" id="cardstreet" text="{contact.creditCard.address.street1}"/>
				<!--<mx:TextInput x="243" y="183" width="80" id="cardzip" text="{contact.creditCard.address.zip}"/>-->
				<fc:AutoComplete id="cardzip" x="243" y="183" width="80"  dataProvider="{zips}"  labelField="name" focusOut="doZipCredit()" lookAhead="true"/>
					
				<mx:ComboBox x="243" y="82" id="cardtype" dataProvider="{creditCardPreferencesArray}" labelFunction="getCreditName"></mx:ComboBox>
			</mx:Canvas>
			<mx:Canvas id="canvasWeb" label="Web" width="100%" height="100%">
			</mx:Canvas>
		</mx:TabNavigator>
		<mx:Button x="20" y="10" width="50" height="38" click="doPrev();">
			<mx:icon>@Embed(source='../../../../assets/previous_page.png')</mx:icon>
		</mx:Button>
		<mx:Button x="76" y="10" width="50" height="38" click="doNext();">
			<mx:icon>@Embed(source='../../../../assets/next_page.png')</mx:icon>
		</mx:Button>
		<mx:Label x="20" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'invoiceDeliveryTicketCmd.Previous')}" width="58" textAlign="center"/>
		<mx:Label x="76" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Next')}" width="50" textAlign="center"/>
		<mx:Button x="171" y="10" width="38" height="38" click="doSave();" enabled="{enableSave}">
			<mx:icon>@Embed(source='../../../../assets/file.png')</mx:icon>
		</mx:Button>
		<mx:Label x="171" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Save')}" width="38" textAlign="center"/>
		<mx:Button x="217" y="10" width="38" height="38" click="doGet();">
			<mx:icon>@Embed(source='../../../../assets/get.png')</mx:icon>
		</mx:Button>
		<mx:Label x="217" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Get')}" width="38" textAlign="center"/>
		<mx:Button x="263" y="10" width="38" height="38" click="doNew();">
			<mx:icon>@Embed(source='../../../../assets/new.png')</mx:icon>
		</mx:Button>
		<mx:Button x="370" y="10" width="38" height="38" click="doDelete();">
			<mx:icon>@Embed(source='../../../../assets/delete.png')</mx:icon>
		</mx:Button>
	    <mx:Label x="360" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Delete')}" width="58" textAlign="center"/>
		<mx:Button x="493" y="10" width="38" height="38">
			<mx:icon>@Embed(source='../../../../assets/cancel.png')</mx:icon>
		</mx:Button>
		<mx:Label x="483" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Revert')}" width="58" textAlign="center"/>
		<mx:Label x="263" y="46" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.New')}" width="38" textAlign="center"/>
	</mx:Canvas>
</mx:VBox>
</mx:Panel>