<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:vo="com.efi.printsmith.vo.*" width="654" height="612" defaultButton="{select_button}" showCloseButton="true" creationComplete="init()"
    close="PopUpManager.removePopUp(this);" xmlns:common="com.efi.printsmith.common.components.filter.*" 
    title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.ContactPicker')}" xmlns:text="flash.text.*" borderThickness="3" borderStyle="solid">

<!--<mx:RemoteObject id="dataService" destination="dataService">
	<mx:method name="getContactPicker" fault="handleFault(event)" result="handleLoadResult(event)"/>
	<mx:method name="getById" fault="handleFault(event)" result="handleGetResult(event)"/>
</mx:RemoteObject>-->

<mx:Producer id="producer" destination="contact"/>
<mx:Consumer id="consumer" destination="contact" message="messageHandler(event.message)"/>
<mx:Consumer id="notification_consumer" destination="notifications" message="messageHandler(event.message)"/>


<mx:Script>
                                   
<![CDATA[
	import com.efi.printsmith.common.components.filter.FilterProperty;
	import com.efi.printsmith.common.components.filter.FilterSearchBy;
	import mx.collections.ArrayCollection;
	import com.efi.printsmith.events.ContactPickerSelectEvent;
	import com.efi.printsmith.data.Contact;           
    import com.efi.printsmith.view.EditContact;
    import com.efi.printsmith.view.EditCustomer; 
    import com.efi.printsmith.view.StockDefinitions;           
	import mx.managers.PopUpManager;                                 
	import mx.controls.Alert;                          
	import mx.containers.Canvas;   
	import mx.core.Container;                      
	import mx.rpc.events.ResultEvent;                                 
	import mx.rpc.events.FaultEvent;                          
	import mx.events.ValidationResultEvent;                          
	import mx.validators.Validator;       
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
	import mx.core.Application;
	                             
	[Bindable]                             
	private var message:String;                                   
	[Bindable]                             
	private var formIsValid:Boolean = false;                               
	[Bindable]                                     
	public var formIsEmpty:Boolean; 
	                                  
	[Bindable]                                
	private var contacts:ArrayCollection = new ArrayCollection();
                                                                         
	[Bindable]                               
	private var contactRecords:int = 0;
	         
	// Holds a reference to the currently focussed control on the form.
 	private var focusedFormControl:DisplayObject;                           
           
	                    
	private function handleLoadResult(event:ResultEvent):void {
		contacts = event.result as ArrayCollection;
	}
	
	private function handleFault(ev:FaultEvent):void {                               
		message = "Error: " + ev.fault.faultCode + " \n "                                            
		+ "Detail: " + ev.fault.faultDetail + " \n "                              
		+ "Message: " + ev.fault.faultString;                                    
	}

	private function messageHandler(message:IMessage):void
	{
		
	}
	public function setContactArray(temp:ArrayCollection):void{
		contacts = temp;
	}                                                      
	private function init():void {   
	//	consumer.subscribe();
	//	notification_consumer.subscribe();     

	    PopUpManager.centerPopUp(this);
	    resetFocus();                                     
	//	dataService.getContactPicker("Contact");
		var editPage:Container = Snowmass.getInstance().mainNavigator.selectedChild;
		if (editPage.className != "EditContact") {
			new_button.visible = false;
		}
	}
	                                
	private function resetFocus():void {                           
	     //focusManager.setFocus(filter_field);                                    
	}    
	
	private function editContact():void {
		
	}   
	
	private function selectContact():void {	
		
		var temp:Contact;
		temp = dataGrid.selectedItem as Contact;
		var selectEvent:ContactPickerSelectEvent = new ContactPickerSelectEvent(ContactPickerSelectEvent.SELECTACCOUNT, temp);
		dispatchEvent(selectEvent);
		PopUpManager.removePopUp(this);
		
		
		
		
	}     
	private function handleGetResult(ev:ResultEvent):void {
		
	     
	}
	private function newContact():void {
		var newEvent:ContactPickerSelectEvent = new ContactPickerSelectEvent(ContactPickerSelectEvent.SELECTNEWACCOUNT, new Contact());
		dispatchEvent(newEvent);
		PopUpManager.removePopUp(this);
	}
	
	private function cancelPicker():void {
		var cancelEvent:ContactPickerSelectEvent = new ContactPickerSelectEvent(ContactPickerSelectEvent.CANCELSELECTACCOUNT, null);
		dispatchEvent(cancelEvent);
		PopUpManager.removePopUp(this);
	}
	
	private function updateDataGrid():void {
		//dataService.getContactsByPartialName(filter_field.text);
	}
	 
	private function getSearchBy():ArrayCollection {
		var sc:ArrayCollection = new ArrayCollection();
	
		var fp:FilterProperty = new FilterProperty(null, "firstName");
		var sc1:FilterSearchBy = new FilterSearchBy(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'employeeTimeExportsCmd.FirstName'), fp);
		sc.addItem(sc1);

		fp = new FilterProperty(null, "lastName");
		sc1 = new FilterSearchBy(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'employeeTimeExportsCmd.LastName'), fp);
		sc.addItem(sc1);

		fp = new FilterProperty(new FilterProperty(null, "externalAcctId"), "parentAccount");
		sc1 = new FilterSearchBy(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Acct'), fp);
		sc.addItem(sc1);
		
		fp = new FilterProperty(new FilterProperty(null, "externalRef"), "parentAccount");
		sc1 = new FilterSearchBy(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Ref'), fp);
		sc.addItem(sc1);
		
		// MS: need to add phone here...
		
		fp = new FilterProperty(new FilterProperty(null, "masterAcct"), "parentAccount");
		sc1 = new FilterSearchBy(resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.MasterBilling'), fp);
		sc.addItem(sc1);
		
		return sc;

	}
]]>        
</mx:Script>
                             
 
                             
	<mx:Canvas width="604" height="557"> 
		<mx:DataGrid id="dataGrid" width="457" height="485" dataProvider="{contacts}"
		doubleClickEnabled="true" doubleClick="selectContact()"  showHeaders="true"  borderStyle="solid" borderThickness="3">               
		<mx:columns>
		     <mx:DataGridColumn dataField="firstName" headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'employeeTimeExportsCmd.FirstName')}" />  
		     <mx:DataGridColumn dataField="lastName" headerText="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'employeeTimeExportsCmd.LastName')}" />                          
		 
		</mx:columns>
		</mx:DataGrid>
		<common:PickerFilter x="10" y="495" width="417" height="26" searchComponent="{dataGrid}" listData="{contacts}" searchCriteria="{getSearchBy()}" />
		<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Select')}" id="select_button" enabled="{(dataGrid.selectedItem != null)}" click="selectContact();"  width="108" x="465" y="10"/>
		<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rStandardMenuText.New')}" enabled="true" click="newContact();" id="new_button" width="108" x="465" y="40"/>
		<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'rButtonLabel.Cancel')}" click="cancelPicker();" id="cancel_button" width="108" x="465" y="93"/>
		<!--<mx:TextInput x="247" y="493" id="filter_field" width="210" keyUp="updateDataGrid()"/>
		<mx:ComboBox x="55" y="493" id="filter_combobox" width="184">
			<mx:ArrayCollection>
				<mx:String>{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Name')}</mx:String>
				<mx:String>{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Contacts')}</mx:String>
				<mx:String>{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Ref')}</mx:String>
				<mx:String>{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.Phone')}</mx:String>
				<mx:String>{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'listerCmd.MasterBilling')}</mx:String>
			</mx:ArrayCollection>
		</mx:ComboBox>
		<mx:Label x="10" y="495" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'labelCmd.Filter')}"/>-->
	</mx:Canvas>     

</mx:TitleWindow>