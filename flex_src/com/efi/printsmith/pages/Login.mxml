<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:event="com.efi.event.*" layout="absolute" width="522" height="427" borderColor="#FFFFFF" themeColor="#FFFFFF" alpha="1.0">
	<mx:Canvas x="0" y="0" width="522" height="426" backgroundAlpha="1.0" cornerRadius="0" backgroundColor="#FFFFFF" defaultButton="{login_btn}">
	<mx:Image x="0" y="0" width="521" height="400" id="Splash" source="assets/splash.png" scaleContent="false" autoLoad="true"/>
	<mx:TextInput x="352" y="332" id="username"/>
	<mx:TextInput x="352" y="362" id="password" displayAsPassword="true"/>
	<mx:Label x="255" y="334" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'usecCmd.UserName')}" width="89" textAlign="right"/>
	<mx:Label x="255" y="364" text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE, 'signonCmd.Password')}" width="89" textAlign="right"/>
	<mx:Button id="login_btn" click="doLogin()" x="437" y="392" label="Login" width="75"/>
	<mx:Label x="99" y="374" width="124" id="version"/>
	</mx:Canvas>

	<mx:Script>
		<![CDATA[
			import mx.rpc.IResponder;
			import mx.rpc.Responder;
			import com.efi.printsmith.events.LoginEvent;
			import mx.controls.Label;
			import com.efi.printsmith.data.Users;
			import mx.resources.Locale;
			import mx.resources.ResourceBundle;
			import mx.utils.URLUtil;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.Fault;
			import mx.core.Application;
			import mx.utils.StringUtil;
			import mx.controls.Text;
			import mx.controls.Alert;
			import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.remoting.mxml.RemoteObject;
			import mx.rpc.remoting.mxml.Operation;			
			
			private function init():void	{
			} 
			
			
			private function handleLoginResult(event:ResultEvent):void	{
				var res:Users = event.result as Users;
				if (res) {
					var application:Snowmass = Snowmass.getInstance();
					PopUpManager.removePopUp(this);
					application.mainContainer.visible = true;
					application.currentUser = res;
				} else {
					Alert.show("Invalid login", null, Alert.OK, null, null, null, Alert.OK);
				}
			}
			private function handleFault(ev:FaultEvent):void {                
				Alert.show(ev.fault.faultCode,ev.fault.faultDetail, Alert.OK, null, null, null, Alert.OK);
			}

			private function doLogin():void	{
				var callbacks:IResponder = new mx.rpc.Responder(handleLoginResult, handleFault);
				
				var loginEvent:LoginEvent = new LoginEvent(username.text, password.text, callbacks);
				loginEvent.dispatch();
			}
		]]>
	</mx:Script>
</mx:Application>
