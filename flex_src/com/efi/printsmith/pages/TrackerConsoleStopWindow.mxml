<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical" width="725" height="750"
	title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.StopTrackerStep')}"
	creationComplete="{initDetailsWindow()}" showCloseButton="true" close="{cancel()}" xmlns:components="com.efi.printsmith.common.components.*" xmlns:tracker="com.efi.printsmith.components.tracker.*" xmlns:components1="com.efi.printsmith.components.*">
	
	<mx:RemoteObject id="dataService" destination="dataService" showBusyCursor="true">
		<mx:method name="getJob" fault="handleFault(event)" result="handleLoadJobResult(event)"/>
	</mx:RemoteObject>
	
	<mx:Script source="../common/scripts/ComponentHelper.as"/>
	
	<mx:Script source="../util/tracker/TrackerUtil.as"/>
	
	<mx:Script>
		<![CDATA[
			import com.efi.printsmith.util.ChargeCostingUtil;
			import com.efi.printsmith.data.enums.ChargeMethod;
			import com.efi.printsmith.data.enums.ChargeQtyType;
			import com.efi.printsmith.data.ChargeDefinition;
			import com.efi.printsmith.data.enums.RunMethod;
			import com.efi.printsmith.Constants;
			import flash.net.registerClassAlias;
			import mx.utils.ObjectUtil;
			import mx.controls.Alert;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.events.FaultEvent;
			import com.efi.printsmith.events.PriceJobEvent;
			import mx.collections.ArrayCollection;
			import com.efi.printsmith.events.TrackerConsoleStopEvent;
			import com.efi.printsmith.data.TrackerConsolePasses;
			import mx.managers.PopUpManager;
			import com.efi.printsmith.data.JobBase;
			import com.efi.printsmith.data.Charge;
			import com.efi.printsmith.data.Job;
			import com.efi.printsmith.data.TrackerConsoleJobs;
			import mx.rpc.Responder;
			
			[Bindable] private var trackerConsoleJobs:TrackerConsoleJobs;
			
			[Bindable] public var nowDate:Date = new Date();
			
			[Bindable] public var exceptionsArray:ArrayCollection = new ArrayCollection();
			
			[Bindable] public var productionLocations:ArrayCollection = new ArrayCollection();
			
			[Bindable] public var job:Job;
			
			[Bindable] public var localJob:Job;
			
			[Bindable] public var charge:Charge;
			
			[Bindable] public var localCharge:Charge;
			
			[Bindable] private var okBtnEnabled:Boolean = false;
			
			private function initDetailsWindow():void {
				PopUpManager.centerPopUp(this);
			}
			
			public function setTrackerConsoleJobs(trackerConsoleJobsObj:TrackerConsoleJobs):void {
				registerClassAlias("com.efi.printsmith.data.TrackerConsoleJobs",TrackerConsoleJobs);
				trackerConsoleJobs = ObjectUtil.copy(trackerConsoleJobsObj) as TrackerConsoleJobs;
				if(trackerConsoleJobs.job!=null) {
					dataService.getJob(trackerConsoleJobs.job.id);
				}
			}
			
			private function updateCosting():void {
				okBtnEnabled = false;
				refresh_price_btn.visible = false;
				pricing_throbber.visible = true;
				pricing_throbber.play();
				if(trackerConsoleJobs!=null && job!=null) {
					registerClassAlias("com.efi.printsmith.data.Job",Job);
					localJob = ObjectUtil.copy(job) as Job;
					mapTrackerActualsToJob();
					updatePrice();
				} else if(trackerConsoleJobs!=null && charge!=null) {
					registerClassAlias("com.efi.printsmith.data.Charge",Charge);
					localCharge = ObjectUtil.copy(charge) as Charge;
					mapTrackerActualsToCharge();
				}
			}
			
			private function mapTrackerActualsToJob():void {
				var impressionsCount:Number = 0;
				if (!(isNaN(localJob.inSetsOf)) && localJob.inSetsOf > 0) {               
					impressionsCount = ((((trackerConsoleJobs.impressions / localJob.impressionsPerRun) - (localJob.estWaste + localJob.binderyWaste)) * (localJob.numUp / localJob.numOn)) / localJob.inSetsOf);     
			        changeJobQuantity(localJob, impressionsCount);
				}
				else {                    
					impressionsCount = (((trackerConsoleJobs.impressions / localJob.impressionsPerRun) - (localJob.estWaste + localJob.binderyWaste)) * (localJob.numUp / localJob.numOn));
			        changeJobQuantity(localJob, impressionsCount);
				}

				if (trackerConsoleJobs.spoilage > 0) {		
					localJob.orWaste = true;
					localJob.estWasteOverride = true;
					localJob.estWaste = localJob.estWaste + trackerConsoleJobs.spoilage;
				}
				
				if ((trackerConsoleJobs.totalSetUpTime/(60*1000)) != localJob.setupTime) {		// compare in MINUTES
					localJob.orSetupTime = true;
					localJob.setupTime = trackerConsoleJobs.totalSetUpTime/(60*1000);
				}
				
				if ((trackerConsoleJobs.totalRunTime/(60*1000)) != localJob.runTime) {		// compare in MINUTES
					localJob.orRuntime = true;
					localJob.runTime = trackerConsoleJobs.totalRunTime/(60*1000);
				}
						
				if ((trackerConsoleJobs.totalWashUpTime/(60*1000)) != localJob.washupTime) {		// compare in MINUTES
					localJob.orWashupTime = true;
					localJob.washupTime = trackerConsoleJobs.totalWashUpTime/(60*1000);
				}
			}
			
			private function changeJobQuantity(job:Job, impressionsCount:Number):void {
				job.qtyOrdered = impressionsCount;
				calcSignatures(job);
			}
			
			private function calcSignatures(job:Job):void {
				var runs:Number = 0;
				var iup, ion, iorigs, ordered, press, xpress, xorig, xup:Number= 0;
				var iruns, divisor:Number = 0;
				
				if (job.numUp < 1) {
					job.numUp = 1;
				}
				if (job.sheets < 1) {
					job.sheets = 1;
				}
				if (job.numOn < 1) {
					job.numOn = 1;
				}
				if (job.numOn > job.sheets) {
					job.numOn = job.sheets;
				}
				if (job.numOn > job.numUp) {
					job.numOn = job.numUp;
				}
				
				if (job.runMethod == RunMethod.WorkAndTumble ||
						job.runMethod == RunMethod.WorkAndTurn) {
					if ((job.numOn * 2) <= job.numUp) {
						if (job.numUp < (job.sheets/2)) {
							job.numOn = job.numUp;
						} else {
							job.numOn = (job.sheets/2);
						}
						if (job.numOn < 1) {
							job.numOn = 1;
						}
					}
				}
				
				ion = job.numOn;
				iup = job.numUp;
				iorigs = job.sheets;
				
				iruns = iorigs/ion;
				if (iruns < 1) iruns = 1;
				
				divisor = iup/ion;
				ordered = job.qtyOrdered * job.inSetsOf;
				
				if (iorigs%ion != 0) {
					xorig = iorigs - (iruns * ion);
					press = ordered/divisor;
					if ((press*divisor) < ordered) press++;
					xup = iup/xorig;
					xpress = ordered/xup;
					if ((xpress*xup) < ordered) press++; 
				
					if (press != 0) 
						runs = iruns + (xpress/press);
					else 
						runs = iruns;
					iruns++;
				} else {
					press = ordered/divisor;
					if ((press * divisor) < ordered) press++;
					runs = iruns;
				}
				
				if (job.runMethod == RunMethod.WorkAndTumble) {
					press += press;
				}
				
				//job.setAdditionalRunCount(runs - floor(runs));
				
				//job.setRunSize((runs * job.getFrontPasses() + job.getBackPasses());
				
				job.signatures = iruns;
				
				job.pressQty = press;
			}
			
			private function mapTrackerActualsToCharge():void {
				if(localCharge!=null && localCharge.chargeDefinition!=null) {
					var chargeDefinition:ChargeDefinition = localCharge.chargeDefinition;
					var savedMinFlag:Boolean = false;
					savedMinFlag = chargeDefinition.useMinimumTime;
					chargeDefinition.useMinimumTime = false;
					
					
					if (chargeDefinition.quantityType == ChargeQtyType.Time)
						changeChargeQuantity((trackerConsoleJobs.totalRunTime/(60*1000)),true);
					else
						changeChargeQuantity(charge.quantity,true);
					
					localCharge.actualCostingSetupTime = ((trackerConsoleJobs.totalSetUpTime / (60*1000)) / 60);		// put into hours
					localCharge.actualCostingRunTime = (((trackerConsoleJobs.totalRunTime + trackerConsoleJobs.totalWashUpTime) / (60*1000)) / 60);
					
					//
					// recalcualte the new actual cost based on the given qty "time" or "count"
					//
					localCharge.chargeCostingRecord.totalCost = new ChargeCostingUtil().getChargeEstCost(localCharge);
															
					//
					// Find the estimated cost based on the time and qty
					//
					if (chargeDefinition.quantityType == ChargeQtyType.Time)
						changeChargeQuantity((trackerConsoleJobs.actualRunTime / (60 * 1000)),true);
					else
						changeChargeQuantity(localCharge.quantity,true);
					
					
					chargeDefinition.useMinimumTime = savedMinFlag;
					localCharge.actualCostingSetupTime = trackerConsoleJobs.actualSetUpTime;
					localCharge.actualCostingRunTime = 0;
				}
			}
			
			private function changeChargeQuantity(editQuantity:Number, overrideVal:Boolean):void
			{
				if(localCharge.chargeDefinition!=null) {
					var chargeDefinition:ChargeDefinition = localCharge.chargeDefinition;
					switch (chargeDefinition.method)
					{
						case ChargeMethod.JobAware:
						case ChargeMethod.Shipping:
						case ChargeMethod.Linear:
						case ChargeMethod.Fold:
						{
							if (chargeDefinition.quantityType == ChargeQtyType.Quantity)
							{
								localCharge.overrideQuantity = overrideVal;
								chargeDefinition.overrideRateQuantity = overrideVal;
							}
							break;
						}
					}
					
					switch (chargeDefinition.quantityType)
					{
						case ChargeQtyType.Sets:
						case ChargeQtyType.SetupSets:
						{
							chargeDefinition.groupQty = editQuantity;
							switch (chargeDefinition.method)
							{
								case ChargeMethod.Cut:
								{
									chargeDefinition.overrideNumberOfCuts = overrideVal;
									break;
								}
							}
							break;
						}
						case ChargeQtyType.Quantity:
						{	// quantity
							switch (chargeDefinition.method)
							{
								case ChargeMethod.Ink:
								{	// ink charge
									chargeDefinition.materialSetCount = editQuantity;
									localCharge.overrideMaterialQuantity = true;
									chargeDefinition.overrideMaterialQty = true;
									break;
								}
								case ChargeMethod.SquareArea:
								{	// 
									chargeDefinition.materialSetCount = editQuantity;
									localCharge.overrideMaterialQuantity = true;
									chargeDefinition.overrideMaterialQty = true;
									break;
								}
								default:
								{
									chargeDefinition.rateQty = editQuantity;
									break;
								}
							}
							break;
						}
						case ChargeQtyType.Time:
						{
							var timeStart:Number = (localCharge.startHours*60)+localCharge.startMinutes;
							var timeEnd:Number = (localCharge.endHours*60)+localCharge.endMinutes;	
							if (timeEnd != 0)
							{
								timeEnd = timeStart + editQuantity;
							}
							else
							{
								timeStart = editQuantity;
							}
							calcChargeTimeQuantity(chargeDefinition,timeStart,timeEnd);
							break;
						}
						case ChargeQtyType.None:
						{
							break;
						}
					}
					
					if (!chargePriceLocked())
					{
						localCharge.price = calcCharge(chargeDefinition);
					}
					else
					{
						calcCharge(chargeDefinition);	// don't change the price
					}
				}
			}
			
			private function calcChargeTimeQuantity(chargeDefinition:ChargeDefinition,timeStart:Number,timeEnd:Number):void {
				if (timeStart == 0 && timeEnd != 0) {
					if (chargeDefinition.useMinimumTime && timeEnd < chargeDefinition.minimumTime && chargeDefinition.minimumTime != 0)
						timeEnd = chargeDefinition.minimumTime;
			
					chargeDefinition.rateQty = timeEnd;
				}
				else if (timeEnd == 0 && timeStart != 0) {
					if (chargeDefinition.useMinimumTime && timeStart < chargeDefinition.minimumTime && chargeDefinition.minimumTime != 0)
						timeStart = chargeDefinition.minimumTime;
			
					chargeDefinition.rateQty = timeStart;
				}
				else if (timeStart > timeEnd)
				{	// assume stop is PM and start is AM
					if ((timeEnd + (12 * 60)) > timeStart)
					{	// and add 12 hours to stop time
						chargeDefinition.rateQty = (timeEnd + (12 * 60)) - timeStart;
					}
					else
					{
						chargeDefinition.rateQty = timeStart - timeEnd;
					}
				}
				else
				{	// normal start and stop time 
			
					//
					// 8.0.4 - enforce the minimum time from the charge def
					//
					if (chargeDefinition.useMinimumTime && (timeEnd - timeStart) < chargeDefinition.minimumTime && chargeDefinition.minimumTime != 0)
						timeEnd = (timeEnd + (chargeDefinition.minimumTime - (timeEnd - timeStart)));
			
					chargeDefinition.rateQty = timeEnd - timeStart;
				}
						
				//
				// convert to decimal hours 
				//
				chargeDefinition.rateQty = chargeDefinition.rateQty / 60.0;	// actual  quantity is "hidden" here 
				chargeDefinition.materialQty = chargeDefinition.rateQty;
				
			}
			
			private function chargePriceLocked():Boolean {
				if(localCharge!=null) {
					if(localCharge.parentInvoice!=null) 
						return localCharge.parentInvoice.priceLocked;
				}
				return false;
			}
			
			private function calcCharge(chargeDefinition:ChargeDefinition):Number {
				return 0;
			}	
						
			private function handleLoadJobResult(event:ResultEvent):void {
				this.job = event.result as Job;
				updateCosting();
			}
			
			private function handleFault(ev:FaultEvent):void
			{
				var message:String;
				message="Error: " + ev.fault.faultCode + " - " + ev.fault.faultDetail + " - " + ev.fault.faultString;
				Alert.show(message, "Error", 0, null);
			}

			
			private function updatePrice():void
			{	
				var priceJobEvent:PriceJobEvent = new PriceJobEvent(this.localJob, new mx.rpc.Responder(handlePriceJobComplete, handlePriceJobFault));
				priceJobEvent.dispatch();
			}
			
			private function handlePriceJobComplete(event:ResultEvent):void {
				var tmpJob:Job = event.result as Job;
				if(tmpJob.pricingRecord!=null) {
					var laborCost:Number = (isNaN(tmpJob.pricingRecord.laborCost))?0:tmpJob.pricingRecord.laborCost;
					var stockCost:Number = (isNaN(tmpJob.pricingRecord.stockCost))?0:tmpJob.pricingRecord.stockCost;
					trackerConsoleJobs.totalCost = laborCost + stockCost;
				}
				refresh_price_btn.visible = true;
				pricing_throbber.stop();
				pricing_throbber.visible = false;
				okBtnEnabled = true;
			}
			
			private function handlePriceJobFault(event:FaultEvent):void {
				if (event != null && event.fault != null && event.fault.faultString != null) {				
					Alert.show(event.fault.faultString, "Error in Pricing", 0, null);
				} else {
					Alert.show("Unknown error when pricing job", "Error in Pricing", 0, null);
				}
			}
			
			private function cancel():void {
				cancelStopJob();
			}
			
			private function closeWindow():void {
				PopUpManager.removePopUp(this);
			}
			
			/* private function getInvoiceNumber(object:Object):String {
				if(object is TrackerConsoleJobs){
					if(object.job!=null){
						object = object.job;
					} else {
						object = object.charge;
					}
				} 
				if(object is Job){
					var job:Job = object as Job;
					return String(job.parentInvoice.invoiceNumber);	
				}
				if(object is Charge){
					var charge:Charge = object as Charge;
					if(charge.parentInvoice!=null){
						return String(charge.parentInvoice.invoiceNumber);
					}
					if(charge.parentJob!=null){
						return String(charge.parentJob.jobNumber)+" / "+charge.parentJob.parentInvoice.invoiceNumber;
					}
				}
				return "";
			} */
			
			private function getAccount(object:Object):String{
				if(object is TrackerConsoleJobs){
					if(object.job!=null){
						object = object.job;
					} else {
						object = object.charge;
					}
				} 
				if(object is Job){
					var job:Job = object as Job;
					return "#"+job.parentInvoice.account.id + " "+job.parentInvoice.account.title;	
				}
				if(object is Charge){
					var charge:Charge = object as Charge;
					if(charge.parentInvoice!=null){
						return "#"+charge.parentInvoice.account.id + " "+charge.parentInvoice.account.title;
					}
					if(charge.parentJob!=null){
						var jobBase:JobBase = charge.parentJob as JobBase;
						return "#"+jobBase.parentInvoice.account.id + " "+jobBase.parentInvoice.account.title;
					}
				}
				return "";
			}
			
			private function getDescription(object:Object):String{
				if(object is TrackerConsoleJobs){
					if(object.job!=null){
						object = object.job;
					} else {
						object = object.charge;
					}
				} 
				if(object is Job){
					var job:Job = object as Job;
					return job.description;	
				}
				if(object is Charge){
					var charge:Charge = object as Charge;
					return charge.description;
				}
				return "";
			}
			
			private function getStatus(object:TrackerConsoleJobs):String{
				if(object!=null){
					if(object.paused){
						return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.Paused');	
					} 
					return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.Active');
				}
				return "";
			}
			
			private function getEstimatedTotalTime(object:TrackerConsoleJobs,treatAsNonProdStep:Boolean):String {
				if(treatAsNonProdStep){
					return "--";
				}
				if(!object.completed) {
					if(object.employee!=null){
						if(object.employee.hideEstimateTimeTracker){
							return "--";
						}
					}
				}
				return convertMilliSecondsToString((object.actualSetUpTime+object.actualRunTime+object.actualWashTime),true);
			}
			
			private function getEstimatedSetUpTime(object:TrackerConsoleJobs,treatAsNonProdStep:Boolean):String {
				if(treatAsNonProdStep){
					return "--";
				}
				if(!object.completed) {
					if(object.employee!=null){
						if(object.employee.hideEstimateTimeTracker){
							return "--";
						}
					}
				}
				return convertMilliSecondsToString(object.actualSetUpTime,true);
			}
			
			private function getEstimatedRunTime(object:TrackerConsoleJobs,treatAsNonProdStep:Boolean):String {
				if(treatAsNonProdStep){
					return "--";
				}
				if(!object.completed) {
					if(object.employee!=null){
						if(object.employee.hideEstimateTimeTracker){
							return "--";
						}
					}
				}
				return convertMilliSecondsToString(object.actualRunTime,true);
			}
			
			private function getEstimatedWashUpTime(object:TrackerConsoleJobs,treatAsNonProdStep:Boolean):String {
				if(treatAsNonProdStep){
					return "--";
				}
				if(!object.completed) {
					if(object.employee!=null){
						if(object.employee.hideEstimateTimeTracker){
							return "--";
						}
					}
				}
				return convertMilliSecondsToString(object.actualWashTime,true);
			}
			
			private function getTotalTime(treatAsNonProdStep:Boolean,totalTime:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return totalTime;
			}
			
			private function updateTotalTime():void {
				if(trackerConsoleJobs!=null){
					trackerConsoleJobs.totalTime = trackerConsoleJobs.totalSetUpTime+trackerConsoleJobs.totalRunTime+trackerConsoleJobs.totalWashUpTime;
				}
			}
			
			private function getTotalSetUpTime(treatAsNonProdStep:Boolean,setUpTime:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return setUpTime;
			}
			
			private function getTotalRunTime(treatAsNonProdStep:Boolean,runTime:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return runTime;
			}
			
			private function getTotalWashUpTime(treatAsNonProdStep:Boolean,washUpTime:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return washUpTime;
			}
			
			private function getOrderedQty(object:TrackerConsoleJobs,treatAsNonProdStep:Boolean):Object {
				var ordered:Number = 0;
				if(treatAsNonProdStep){
					return "--";
				}
				if(object.job!=null){
					if(isNaN(object.job.qtyOrdered)){
						ordered = 0;
					} 
					ordered = object.job.qtyOrdered;
				} else if(object.charge!=null){
					if(isNaN(object.charge.quantity)){
						ordered = 0;
					} 
					ordered = object.charge.quantity;
				}
				return ordered;
			}
			
			private function getJobQty(treatAsNonProdStep:Boolean,quantity:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return quantity;
			}
			
			private function getImpressions(object:TrackerConsoleJobs, flag:int,treatAsNonProdStep:Boolean):Object {
				var impressions:Number = 0;
				if(treatAsNonProdStep){
					return "--";
				}
				if(flag==0){
					if(object.job!=null){
						if(!isNaN(object.job.totalImpressions)){
							impressions = object.job.totalImpressions;
						}
					} else if(object.charge!=null) {
						if(object.charge.chargeCostingRecord!=null){
							if(!isNaN(object.charge.chargeCostingRecord.totalImpressions)){
								impressions = object.charge.chargeCostingRecord.totalImpressions;
							}
						}
					}
				} else if(flag==1){
					if(!isNaN(trackerConsoleJobs.impressions)){
						impressions = trackerConsoleJobs.impressions;
					}
				}
				return impressions;
			}
			
			private function getJobImpressions(treatAsNonProdStep:Boolean,impressions:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return impressions;
			}
			
			private function getSpoilage(object:TrackerConsoleJobs, flag:int,treatAsNonProdStep:Boolean):Object {
				var spoilage:Number = 0;
				if(treatAsNonProdStep){
					return "--";
				}
				if(flag==0){
					if(object.job!=null){
						if(!isNaN(object.job.estWaste)){
							spoilage = object.job.estWaste;
						}
					} else if(object.charge!=null) {
						if(object.charge.chargeCostingRecord!=null){
							if(!isNaN(object.charge.chargeCostingRecord.actualSpoilage)){
								spoilage = object.charge.chargeCostingRecord.actualSpoilage;
							}
						}
					}
				} else if(flag==1){
					if(!isNaN(trackerConsoleJobs.spoilage)){
						spoilage = trackerConsoleJobs.spoilage;
					}
				}
				return spoilage;
			}
			
			private function getJobSpoilage(treatAsNonProdStep:Boolean,spoilage:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return spoilage;
			}
			
			private function getBinderyWaste(object:TrackerConsoleJobs,treatAsNonProdStep:Boolean):Object {
				var binderyWaste:Number = 0;
				if(treatAsNonProdStep){
					return "--";
				}
				if(object.job!=null){
					if(!isNaN(object.job.binderyWaste)) {
						binderyWaste = object.job.binderyWaste;
					}
				} else if(object.charge!=null) {
					
				}
				return binderyWaste;
			}
			
			private function getStockCost(object:TrackerConsoleJobs,treatAsNonProdStep:Boolean):Object {
				var stockCost:Number = 0;
				if(treatAsNonProdStep){
					return "--";
				}
				if(object.employee!=null){
					if(object.employee.costingAmounts){
						return "--";
					} else {
						if(object.job!=null){
							if(object.job.pricingRecord!=null){
								if(!isNaN(object.job.pricingRecord.stockCost)){
									stockCost = object.job.pricingRecord.stockCost;
								}
							}
						} else if(object.charge!=null) {
							
						}
					}
				}
				return stockCost;
			}
			
			private function getLaborCost(object:TrackerConsoleJobs,treatAsNonProdStep:Boolean):Object {
				var laborCost:Number = 0;
				if(treatAsNonProdStep){
					return "--";
				}
				if(object.employee!=null){
					if(object.employee.costingAmounts){
						return "--";
					} else {
						if(object.job!=null){
							if(object.job.pricingRecord!=null){
								if(!isNaN(object.job.pricingRecord.laborCost)){
									laborCost = object.job.pricingRecord.laborCost;
								}
							}
						} else if(object.charge!=null) {
							if(object.charge.chargeCostingRecord!=null){
								if(!isNaN(object.charge.chargeCostingRecord.laborCost)){
									laborCost = object.charge.chargeCostingRecord.laborCost;
								}
							}
						}
					}
				}
				return laborCost;
			}
			
			private function getTotalCost(object:TrackerConsoleJobs, totalCostValue:Number, flag:int,treatAsNonProdStep:Boolean):Object {
				var totalCost:Number = 0;
				if(treatAsNonProdStep){
					return "--";
				}
				if(flag==0){
					totalCost = Number(getStockCost(object,treatAsNonProdStep))+Number(getLaborCost(object,treatAsNonProdStep));
				} else if(flag==1){
					if(!isNaN(totalCostValue)) {
						totalCost = totalCostValue;
					}
				}
				if(object.employee!=null){
					if(object.employee.costingAmounts){
						return "--";
					}
				}
				return totalCost;
			}
			
			private function getCurrentPassString(object:TrackerConsoleJobs):String {
				if(object!=null){
					if(object.noOfPasses>1){
						return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.CurrentPass');
					}
				}
				return resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Actuals');
			}
			
			private function stopJob():void {
				var trackerConsoleStopEvent:TrackerConsoleStopEvent = new TrackerConsoleStopEvent(TrackerConsoleStopEvent.STOP_JOB_EVENT,true,trackerConsoleJobs);
				dispatchEvent(trackerConsoleStopEvent);
				callLater(closeWindow);
			}
			
			private function cancelStopJob():void {
				var trackerConsoleStopEvent:TrackerConsoleStopEvent = new TrackerConsoleStopEvent(TrackerConsoleStopEvent.STOP_JOB_EVENT,false,trackerConsoleJobs);
				dispatchEvent(trackerConsoleStopEvent);
				callLater(closeWindow);
			}
			
			private function resetCalcValues():void {
				if(trackerConsoleJobs!=null){
					if(trackerConsoleJobs.initialSpoilageValue!=trackerConsoleJobs.spoilage){
						trackerConsoleJobs.startSpoilage = 0;
						trackerConsoleJobs.endSpoilage = 0;
						trackerConsoleJobs.initialStartSpoilage = 0;
						trackerConsoleJobs.initialEndSpoilage = 0;
						trackerConsoleJobs.endSpoilage = 0;
						trackerConsoleJobs.difference = 0;
						updateCosting();
					}
				}
			}
			
			private function setImpressionsValue():void {
				if(trackerConsoleJobs.impressions!=trackerConsoleJobs.initialImpressions) {
					trackerConsoleJobs.initialImpressions = trackerConsoleJobs.impressions;
					if(trackerConsoleJobs.difference>trackerConsoleJobs.impressions){
						trackerConsoleJobs.spoilage = trackerConsoleJobs.difference-trackerConsoleJobs.impressions;
						trackerConsoleJobs.initialSpoilageValue = trackerConsoleJobs.spoilage;
					} else {
						trackerConsoleJobs.spoilage = 0;
						trackerConsoleJobs.initialSpoilageValue = 0;
					}
					updateCosting();
				}
			}
			
			private function setSpoilageValue(stateValue:String=null):void {
				if(stateValue=="start"){
					trackerConsoleJobs.endSpoilage = trackerConsoleJobs.difference+trackerConsoleJobs.startSpoilage;
				} else if(stateValue=="end"){
					trackerConsoleJobs.difference = trackerConsoleJobs.endSpoilage-trackerConsoleJobs.startSpoilage;
				}
				if(trackerConsoleJobs.startSpoilage!=trackerConsoleJobs.initialStartSpoilage ||
				trackerConsoleJobs.endSpoilage!=trackerConsoleJobs.initialEndSpoilage){
					if(trackerConsoleJobs.difference>trackerConsoleJobs.impressions){
						trackerConsoleJobs.spoilage = trackerConsoleJobs.difference-trackerConsoleJobs.impressions;
					} else {
						trackerConsoleJobs.spoilage = 0;
					}
					trackerConsoleJobs.initialSpoilageValue = trackerConsoleJobs.spoilage;
					updateCosting();
				}
				trackerConsoleJobs.initialStartSpoilage = trackerConsoleJobs.startSpoilage;
				trackerConsoleJobs.initialEndSpoilage = trackerConsoleJobs.endSpoilage;
			}
			
			private function getStartSpoilage(treatAsNonProdStep:Boolean,startSpoilage:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return startSpoilage;
			}
			
			private function getEndSpoilage(treatAsNonProdStep:Boolean,endSpoilage:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return endSpoilage;
			}
			
			private function getDifference(treatAsNonProdStep:Boolean,difference:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return difference;
			}
			
			private function getDiffSpoilage(treatAsNonProdStep:Boolean,spoilage:Number):Object {
				if(treatAsNonProdStep){
					return "--";
				}
				return spoilage;
			}
			
			private function copyTime():void {
				if(trackerConsoleJobs!=null && trackerConsoleJobs.employee!=null){
					if(!trackerConsoleJobs.treatAsNonProdStep && trackerConsoleJobs.employee.allowOverrideCost){
						trackerConsoleJobs.totalSetUpTime = 0;
						trackerConsoleJobs.totalWashUpTime = 0;
						trackerConsoleJobs.totalRunTime = trackerConsoleJobs.actualRunTime;
						trackerConsoleJobs.totalTime = (trackerConsoleJobs.totalSetUpTime+trackerConsoleJobs.totalRunTime+trackerConsoleJobs.totalWashUpTime);
					}
				}
			}
		]]>
	</mx:Script>
	
	<mx:NumberFormatter id="numFormatter" precision="0" rounding="none"/>
	
	<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Item')}:"
			width="17%" textAlign="right"/>
		<mx:TextInput text="{getInvoiceNumber(trackerConsoleJobs)}" width="80%" enabled="false" disabledColor="#000000"/>
	</mx:HBox>
	<!--<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowCmd.Account')}"
			width="25%" textAlign="right"/>
		<mx:TextInput text="{getAccount(trackerConsoleJobs)}" width="72%" enabled="false"/>
	</mx:HBox>-->
	<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Description')}:"
			width="17%" textAlign="right"/>
		<mx:TextInput text="{getDescription(trackerConsoleJobs)}" width="80%" enabled="false" disabledColor="#000000"/>
	</mx:HBox>
	<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Facility')}:"
			width="17%" textAlign="right"/>
		<mx:TextInput text="{trackerConsoleJobs.productionFacilities.name}" width="80%" enabled="false" disabledColor="#000000"/>
	</mx:HBox>
	<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Station')}:"
			width="17%" textAlign="right"/>
		<mx:TextInput text="{trackerConsoleJobs.productionStations.name}" width="80%" enabled="false" disabledColor="#000000"/>
	</mx:HBox>
	<!--<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Status')}"
			width="25%" textAlign="right"/>
		<mx:TextInput text="{getStatus(trackerConsoleJobs)}" width="72%" enabled="false"/>
	</mx:HBox>-->
	
	<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Employee')}:"
			width="17%" textAlign="right"/>
		<mx:TextInput text="{trackerConsoleJobs.employee.lastName}, {trackerConsoleJobs.employee.firstName}" width="80%" enabled="false"
			disabledColor="#000000"/>
	</mx:HBox>
	<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Location')}:"
			width="17%" textAlign="right"/>
		<mx:TextInput text="{trackerConsoleJobs.productionLocations.name}" width="36%" enabled="false" disabledColor="#000000"/>
		<components:CustomCheckBoxComponent width="44%" disabledColor="#000000"
			label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.Markstepcompleteinro')}"
			dataHolder="{trackerConsoleJobs}" variableName="markStepComplete" customText="{trackerConsoleJobs.markStepComplete}"
			selectedValue="true" deSelectedValue="false" defaultValue="false"/>
	</mx:HBox>
	<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.NextLocation')}:"
			width="17%" textAlign="right"/>
		<components:CustomComboBoxComponent width="36%" enabled="false" disabledColor="#000000"
			masterList="{productionLocations}" updateObject="true" objectLabelFieldId="id" labelFieldId="id" labelFieldName="name"
			dataHolder="{trackerConsoleJobs}" variableName="nextProductionLocation" customText="{getCustomTextData(productionLocations,trackerConsoleJobs,trackerConsoleJobs.nextProductionLocation)}"/>
		<components:CustomCheckBoxComponent width="44%" 
			label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.MovetothisNonProduct')}"
			dataHolder="{trackerConsoleJobs}" variableName="moveToNonProdStep" customText="{trackerConsoleJobs.moveToNonProdStep}"
			selectedValue="true" deSelectedValue="false" defaultValue="false"/>
	</mx:HBox>
	<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Exceptioncode')}:"
			width="17%" textAlign="right"/>
		<components:CustomComboBoxComponent width="36%"
			masterList="{exceptionsArray}" updateObject="true" objectLabelFieldId="id" labelFieldId="id" labelFieldName="name"
			dataHolder="{trackerConsoleJobs}" variableName="productionExceptions" customText="{getCustomTextData(exceptionsArray,trackerConsoleJobs,trackerConsoleJobs.productionExceptions)}"/>
	</mx:HBox>
	
	<components:CustomCheckBoxComponent label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowMgrCmd.TreatasNonProduction')}"
		dataHolder="{trackerConsoleJobs}" variableName="treatAsNonProdStep" customText="{trackerConsoleJobs.treatAsNonProdStep}"
		selectedValue="true" deSelectedValue="false" defaultValue="false"/>
		
	<mx:HBox width="100%">
		
		<mx:VBox width="60%">
		
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Spacer width="30%"/>
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Estimated')}" 
					fontWeight="bold" width="30%" textAlign="center"/>
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Actuals')}" fontWeight="bold" width="30%" textAlign="center"/>
			</mx:HBox>
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Totaltime')}:"
					width="30%" textAlign="right"/>
				<mx:TextInput text="{getEstimatedTotalTime(trackerConsoleJobs,trackerConsoleJobs.treatAsNonProdStep)}" 
					width="30%" enabled="false" disabledColor="#000000"/>
				<mx:Button width="10%" enabled="{trackerConsoleJobs.employee.allowOverrideCost}" click="{copyTime()}">
					<mx:icon>@Embed(source='../../../../assets/timecopy.png')</mx:icon>
				</mx:Button>
				<tracker:TrackerTimeEntryComponent 
					dataHolder="{trackerConsoleJobs}" variableName="totalTime" customText="{getTotalTime(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.totalTime)}"
					width="30%" enabled="false" disabledColor="#000000"/>
			</mx:HBox>
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Setup')}:"
					width="30%" textAlign="right"/>
				<mx:TextInput text="{getEstimatedSetUpTime(trackerConsoleJobs,trackerConsoleJobs.treatAsNonProdStep)}" 
					width="30%" enabled="false" disabledColor="#000000"/>
				<mx:Spacer width="10%"/>
				<tracker:TrackerTimeEntryComponent 
					dataHolder="{trackerConsoleJobs}" variableName="totalSetUpTime" customText="{getTotalSetUpTime(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.totalSetUpTime)}"
					width="30%" enabled="{trackerConsoleJobs.employee.allowOverrideCost &amp;&amp; !trackerConsoleJobs.treatAsNonProdStep}" disabledColor="#000000"
					focusOut="{updateTotalTime()}"/>
			</mx:HBox>
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Runtime')}:"
					width="30%" textAlign="right"/>
				<mx:TextInput text="{getEstimatedRunTime(trackerConsoleJobs,trackerConsoleJobs.treatAsNonProdStep)}" 
					width="30%" enabled="false" disabledColor="#000000"/>
				<mx:Spacer width="10%"/>
				<tracker:TrackerTimeEntryComponent 
					dataHolder="{trackerConsoleJobs}" variableName="totalRunTime" customText="{getTotalRunTime(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.totalRunTime)}"
					width="30%" enabled="{trackerConsoleJobs.employee.allowOverrideCost &amp;&amp; !trackerConsoleJobs.treatAsNonProdStep}" disabledColor="#000000"
					focusOut="{updateTotalTime()}"/>
			</mx:HBox>
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Washup')}:"
					width="30%" textAlign="right"/>
				<mx:TextInput text="{getEstimatedWashUpTime(trackerConsoleJobs,trackerConsoleJobs.treatAsNonProdStep)}" 
					width="30%" enabled="false" disabledColor="#000000"/>
				<mx:Spacer width="10%"/>
				<tracker:TrackerTimeEntryComponent 
					dataHolder="{trackerConsoleJobs}" variableName="totalWashUpTime" customText="{getTotalWashUpTime(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.totalWashUpTime)}"
					width="30%" enabled="{trackerConsoleJobs.employee.allowOverrideCost &amp;&amp; !trackerConsoleJobs.treatAsNonProdStep}" disabledColor="#000000"
					focusOut="{updateTotalTime()}"/>
			</mx:HBox>
			
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.Ordered')}:"
					width="30%" textAlign="right"/>
				<components:CustomNumericTextInputComponent
					customText="{getOrderedQty(trackerConsoleJobs,trackerConsoleJobs.treatAsNonProdStep)}" textAlignStyle="left"
					precision="0" rounding="nearest" isInteger="true" width="30%" enabled="false" disabledColor="#000000"/>
				<!--<mx:TextInput text="{getOrderedQty(trackerConsoleJobs,trackerConsoleJobs.treatAsNonProdStep)}" width="30%" enabled="false" disabledColor="#000000"/>-->
				<mx:Spacer width="10%"/>
				<components:CustomNumericTextInputComponent width="30%"
					appendZeroes="false" dataHolder="{trackerConsoleJobs}" variableName="qtyOrdered" customText="{getJobQty(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.qtyOrdered)}" 
					enabled="{trackerConsoleJobs.charge!=null &amp;&amp; !trackerConsoleJobs.treatAsNonProdStep}" disabledColor="#000000"
					allowNegative="false" precision="4" rounding="nearest" textAlignStyle="left"/>
			</mx:HBox>
			
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Impressions')}:"
					width="30%" textAlign="right"/>
				<components:CustomNumericTextInputComponent 
					customText="{getImpressions(trackerConsoleJobs,0,trackerConsoleJobs.treatAsNonProdStep)}" textAlignStyle="left"
					allowNegative="true" precision="0" rounding="nearest" isInteger="true" width="30%" enabled="false" disabledColor="#000000"/>
				<mx:Spacer width="10%"/>
				<components:CustomNumericTextInputComponent width="30%"
					dataHolder="{trackerConsoleJobs}" variableName="impressions" customText="{getJobImpressions(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.impressions)}" 
					enabled="{job!=null &amp;&amp; !trackerConsoleJobs.treatAsNonProdStep}" disabledColor="#000000"
					allowNegative="true" precision="0" rounding="nearest" isInteger="true" textAlignStyle="left"
					focusOut="{setImpressionsValue()}"/>
			</mx:HBox>
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Spoilage')}:"
					width="30%" textAlign="right"/>
				<components:CustomNumericTextInputComponent
					customText="{getSpoilage(trackerConsoleJobs,0,trackerConsoleJobs.treatAsNonProdStep)}" textAlignStyle="left"
					precision="0" rounding="nearest" isInteger="true" width="30%" enabled="false" disabledColor="#000000"/>
				<mx:Spacer width="10%"/>
				<components:CustomNumericTextInputComponent width="30%"
					dataHolder="{trackerConsoleJobs}" variableName="spoilage" customText="{getJobSpoilage(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.spoilage)}" 
					enabled="{job!=null &amp;&amp; !trackerConsoleJobs.treatAsNonProdStep}" disabledColor="#000000"
					allowNegative="false" precision="0" rounding="nearest" isInteger="true" textAlignStyle="left" focusIn="{trackerConsoleJobs.initialSpoilageValue=trackerConsoleJobs.spoilage}"
					focusOut="{resetCalcValues();}"/>
			</mx:HBox>
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.BinderyWaste')}:"
					width="30%" textAlign="right"/>
				<components:CustomNumericTextInputComponent 
					customText="{getBinderyWaste(trackerConsoleJobs,trackerConsoleJobs.treatAsNonProdStep)}" textAlignStyle="left"
					precision="0" rounding="nearest" isInteger="true" width="30%" enabled="false" disabledColor="#000000"/>
				<mx:Spacer width="40%"/>
			</mx:HBox>
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.StockCost')}:"
					width="30%" textAlign="right"/>
				<components:CustomNumericTextInputComponent
					customText="{getStockCost(trackerConsoleJobs,trackerConsoleJobs.treatAsNonProdStep)}" textAlignStyle="left"
					precision="2" rounding="nearest" width="30%" enabled="false" disabledColor="#000000"/>
				<mx:Spacer width="40%"/>
			</mx:HBox>
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.LaborCost')}:"
					width="30%" textAlign="right"/>
				<components:CustomNumericTextInputComponent 
					customText="{getLaborCost(trackerConsoleJobs,trackerConsoleJobs.treatAsNonProdStep)}" textAlignStyle="left"
					precision="2" rounding="nearest" width="30%" enabled="false" disabledColor="#000000"/>
				<mx:Spacer width="40%"/>
			</mx:HBox>
			<mx:HBox width="100%" horizontalGap="2">
				<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowDetailsCmd.Cost')}:"
					width="30%" textAlign="right"/>
				<components:CustomNumericTextInputComponent 
					customText="{getTotalCost(trackerConsoleJobs,trackerConsoleJobs.totalCost,0,trackerConsoleJobs.treatAsNonProdStep)}" textAlignStyle="left"
					precision="2" rounding="nearest" width="30%" enabled="false" disabledColor="#000000"/>
				<mx:Spacer width="10%"/>
				<components:CustomNumericTextInputComponent 
					customText="{getTotalCost(trackerConsoleJobs,trackerConsoleJobs.totalCost,1,trackerConsoleJobs.treatAsNonProdStep)}" textAlignStyle="left"
					precision="2" rounding="nearest" width="23%" enabled="false" disabledColor="#000000"/>
				<mx:Canvas height="20" width="7%">
					<mx:LinkButton width="100%" height="100%" id="refresh_price_btn" click="{updateCosting()}">
						<mx:icon>@Embed(source='../../../../assets/refresh_small.png')</mx:icon>
					</mx:LinkButton>	
					<components1:SmallThrobber width="100%" height="100%" id="pricing_throbber" visible="false"/>
				</mx:Canvas>
				
			</mx:HBox>
			
		</mx:VBox>
		
		<mx:VBox width="40%" height="100%">
		
			<mx:Panel layout="vertical" paddingBottom="10" paddingLeft="10" paddingRight="10" paddingTop="10" width="100%"
				title="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.SpoilageCalculator')}">
				
				<mx:HBox width="100%">
				
					<mx:Label 
						text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.Start')}:" width="50%" textAlign="right"/>
					<components:CustomNumericTextInputComponent width="50%"
						dataHolder="{trackerConsoleJobs}" variableName="startSpoilage" customText="{getStartSpoilage(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.startSpoilage)}"
						precision="0" rounding="nearest" allowNegative="true" textAlignStyle="right"
						enabled="{job!=null &amp;&amp; !trackerConsoleJobs.treatAsNonProdStep}" disabledColor="#000000"
						focusOut="{setSpoilageValue('start')}"/>
					
				</mx:HBox>
				
				<mx:HBox width="100%">
				
					<mx:Label 
						text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.End')}:" width="50%" textAlign="right"/>
					<components:CustomNumericTextInputComponent width="50%"
						dataHolder="{trackerConsoleJobs}" variableName="endSpoilage" customText="{getEndSpoilage(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.endSpoilage)}"
						precision="0" rounding="nearest" allowNegative="true" textAlignStyle="right"
						enabled="{job!=null &amp;&amp; !trackerConsoleJobs.treatAsNonProdStep}" disabledColor="#000000"
						focusOut="{setSpoilageValue('end')}"/>
					
				</mx:HBox>
				
				<mx:HBox width="100%">
				
					<mx:Label 
						text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.Difference')}:" width="50%" textAlign="right"/>
					<components:CustomNumericTextInputComponent width="50%"
						dataHolder="{trackerConsoleJobs}" variableName="difference" customText="{getDifference(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.difference)}"
						precision="0" rounding="nearest" allowNegative="true" textAlignStyle="right" enabled="false" disabledColor="#000000"/>
					
				</mx:HBox>
				
				<mx:HBox width="100%">
				
					<mx:Label 
						text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.Spoilage')}:" width="50%" textAlign="right"/>
					<components:CustomNumericTextInputComponent width="50%"
						dataHolder="{trackerConsoleJobs}" variableName="spoilage" customText="{getDiffSpoilage(trackerConsoleJobs.treatAsNonProdStep,trackerConsoleJobs.spoilage)}"
						precision="0" rounding="nearest" allowNegative="true" textAlignStyle="right" enabled="false" disabledColor="#000000"/>
					
				</mx:HBox>
				
			</mx:Panel>
			
			<mx:Spacer height="5%"/>
			
			<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.additionalspoilage')}"/>
		
		</mx:VBox>
		
	</mx:HBox>
	
	<mx:HRule width="100%"/>
	
	<mx:Label text="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.Notes')}"/>
	
	<components:CustomTextAreaComponent width="100%" height="25%"
		dataHolder="{trackerConsoleJobs}" customText="{trackerConsoleJobs.notes}" variableName="notes"/>
		
	<components:CustomCheckBoxComponent label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'workflowStopCmd.Appendnotestojobtick')}"
		dataHolder="{trackerConsoleJobs}" variableName="appendNotesToJobTicketNotes" customText="{trackerConsoleJobs.appendNotesToJobTicketNotes}"
		selectedValue="true" deSelectedValue="false" defaultValue="false"/>
	
	<mx:HBox width="100%" horizontalAlign="center">
		<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'rButtonLabel.OK')}" click="{stopJob()}" enabled="{okBtnEnabled}"/>
		<mx:Button label="{resourceManager.getString(Snowmass.RESOURCE_BUNDLE,'rButtonLabel.Cancel')}" click="{cancelStopJob()}"/>
	</mx:HBox>
</mx:TitleWindow>
