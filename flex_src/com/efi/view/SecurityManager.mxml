<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="782" height="608"  title="Security Manager" label="Security Manager" xmlns:ns1="com.adobe.flex.extras.controls.*"
	 creationComplete="init()" xmlns:ns2="flexlib.controls.*">
	 
<mx:RemoteObject id="dataService" destination="dataService">
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveResult(event)"/>
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="SecuritydataService" destination="dataService">
	<mx:method name="getByAccessGroup" fault="handleFault(event)" result="handleLoadSecurityResult(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveSecurityResult(event)"/>
</mx:RemoteObject>




<mx:Script>  	
<![CDATA[
	import mx.containers.Panel;
	import mx.managers.PopUpManager;
	import flash.net.navigateToURL;
 	import com.efi.vo.AccessGroup;
 	import mx.collections.ArrayCollection;   
	import mx.containers.TitleWindow; 
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;  
	import com.efi.vo.SecuritySetup;                                 
 	
 	
 	[Bindable]
    	private var accessGroupLists:ArrayCollection = new ArrayCollection();
    [Bindable]
    	private var securitySetupLists:ArrayCollection = new ArrayCollection();
    	
	[Bindable]                             
		private var accessGroup:AccessGroup;   
	[Bindable]                             
		private var security:SecuritySetup;     
	
	public function init():void {
		//consumer.subscribe();
	//	notification_consumer.subscribe();  
	//	PopUpManager.centerPopUp(this);
	              
		dataService.getAll("AccessGroup"); 
	
		//SecuritydataService.getByAccessGroup("SecuritySetup", accessGroup.id); 
		
	}                

	private function handleFault(ev:FaultEvent):void {      
		var message:String;                         
		message = "Error: " + ev.fault.faultCode + " \n "                                            
		+ "Detail: " + ev.fault.faultDetail + " \n "                              
		+ "Message: " + ev.fault.faultString;                                    
	}
	private function handleLoadResult(ev:ResultEvent):void {
		accessGroupLists = ev.result as ArrayCollection;
	}
	private function handleSaveResult(ev:ResultEvent):void {
		dataService.getAll("AccessGroup")
	}	
	private function handleSaveSecurityResult(ev:ResultEvent):void {
		//dataService.getByAccessGroup("SecurityGroup")
	}	
	
	private function handleLoadSecurityResult(ev:ResultEvent):void {
		securitySetupLists = ev.result as ArrayCollection;
	}	
	
	private function mapToSecurityData():void{
		var i:int;
	for (i= 0 ; i < securitySetupLists.length ; i++)
	{
		 security = securitySetupLists.getItemAt(i,0) as SecuritySetup;
		 //security = DataGrid.getChildAt(i) as SecuritySetup;
		 
		 
		 security.accessGroup = accessGroup;
//		 security = DataGrid.getChildAt(0);
		 SecuritydataService.addUpdate(security);
		 
	}
		
	}   
	private function mapToAccessGroup():void{
		accessGroup.name = name_edit.text;
		dataService.addUpdate(accessGroup);
	}
	public function doSave():void {                                    
		
		mapToAccessGroup();
		mapToSecurityData();
		dataService.addUpdate(accessGroup);   
		SecuritydataService.addUpdate(security);                                    
	}   
	public function doNew():void {                                    
		accessGroup = new AccessGroup();                                  
	}   
	private function doNext():void {
	 
	  
		
		                                        		
	}       
	private function doPrev():void {
	  
	 	
		                        		
	}   
	private function doUserGridClick():void {
		accessGroup = DataGrid.selectedItem as AccessGroup;
	}
	private function doAccessGroup():void{
		accessGroup = accessGroupList.selectedItem as AccessGroup
		SecuritydataService.getByAccessGroup("SecuritySetup",accessGroup); 
		name_edit.text = accessGroup.name;
	}

]]>
</mx:Script>
	<mx:Label x="26" y="89" text="Access Group:"/>
	<mx:List x="121" y="86" height="21" dataProvider="{accessGroupLists}"  labelField="name" click="doAccessGroup();" id="accessGroupList"></mx:List>
	<mx:Label x="61" y="136" text="Name:"/>
	<mx:TextInput x="121" y="134" id="name_edit" text="{accessGroup.name}" width="162" focusOut="mapToAccessGroup();"/>
	<mx:DataGrid x="26" y="181" width="698" height="325" id="DataGrid" dataProvider="{securitySetupLists}">
		<mx:columns>
			<mx:DataGridColumn headerText="Enable" dataField="enable" editable="true"/>
			<mx:DataGridColumn headerText="Menu" dataField="menu" />
			<mx:DataGridColumn headerText="Command Name" dataField="commandName"/>
		</mx:columns>
	</mx:DataGrid>
		<mx:Button x="26" y="10" width="38" height="38" click="doSave();" >
			<mx:icon>@Embed(source='../../../assets/file.png')</mx:icon>
		</mx:Button>
		<mx:Label x="26" y="46" text="Save" width="38" textAlign="center"/>
		<mx:Button x="75" y="10" width="38" height="38"  click="doNew()">
			<mx:icon>@Embed(source='../../../assets/new.png')</mx:icon>
		</mx:Button>
		<mx:Button x="121" y="10" width="38" height="38">
			<mx:icon>@Embed(source='../../../assets/delete.png')</mx:icon>
		</mx:Button>
		<mx:Label x="121" y="46" text="Delete" width="47" textAlign="center"/>
		<mx:Label x="75" y="46" text="New" width="38" textAlign="center"/>
		
</mx:TitleWindow>