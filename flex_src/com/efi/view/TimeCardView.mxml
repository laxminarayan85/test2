<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="638" height="538" title="Time Card" label="Time Card" 
	creationComplete="init()" xmlns:components="com.efi.components.*" xmlns:vo="com.efi.vo.*" showCloseButton="true" close="PopUpManager.removePopUp(this) ">
 
 	<mx:RemoteObject id="dataService" destination="dataService">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadResult(event)"/>
		<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveResult(event)"/>
	</mx:RemoteObject>
	<mx:RemoteObject id="dataServiceTimeCard" destination="dataService">
		<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveTimeCardResult(event)"/>
		<mx:method name="getByClockInOut" fault="handleFault(event)" result="handleLoadTimeCardResult(event)"/>
		<mx:method name="getByClockInOutBreak" fault="handleFault(event)" result="handleLoadTimeCardBreakResult(event)"/>
		<mx:method name="getByTimeCardByEmployee" fault="handleFault(event)" result="handleLoadTimeCardEmployeeResult(event)"/>
	</mx:RemoteObject>

	<mx:Producer id="producer" destination="cashregister"/>
	<mx:Consumer id="consumer" destination="cashregister" message="messageHandler(event.message)"/>
	<mx:Consumer id="notification_consumer" destination="notifications" message="messageHandler(event.message)"/>
<mx:Script>
<![CDATA[
	import mx.controls.Text;

	import mx.controls.Alert;                                         
	import mx.managers.PopUpManager;                                         
	import mx.containers.TitleWindow;                                         
	import mx.collections.ArrayCollection;                                         
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;                                         
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
	import mx.collections.XMLListCollection;
	import com.efi.vo.TimeCard;
	import com.efi.vo.Employee;

	[Bindable]
	private var enableSave:Boolean = true;

//Data field arrays
	[Bindable]
	private var employeesArray:ArrayCollection = new ArrayCollection();

	[Bindable]
	private var timecardArray:ArrayCollection = new ArrayCollection();
	[Bindable]
	private var timecardBreakArray:ArrayCollection = new ArrayCollection();
	[Bindable]
	private var timecardEmployeeArray:ArrayCollection = new ArrayCollection();

	[Bindable] 
	private var employee:Employee;

	[Bindable] 
	private var timecard:TimeCard;

//Data view variables
//	[Bindable]
//	private var preferencesSystem:PreferencesSystem;

	public function init():void {
		consumer.subscribe();
		notification_consumer.subscribe();

		setup();
		
	}
	
	private function setup():void{
		dataService.getAll("Employee");
	}
	
	private function messageHandler(message:IMessage):void{
	}
     
	private function handleFault(ev:FaultEvent):void {  
		var message:String;
		              
		message = "Error: "                          
		+ ev.fault.faultCode + " - "                                  
		+ ev.fault.faultDetail + " - "                                  
		+ ev.fault.faultString;
		Alert.show(message, "Error", 0, null, null, null, 4);                                 
	}


// Data Load Handlers
	private function handleLoadResult(ev:ResultEvent):void {
		employeesArray = ev.result as ArrayCollection;
	}
	private function handleLoadTimeCardResult(ev:ResultEvent):void {
		timecardArray = ev.result as ArrayCollection;
	}
	private function handleLoadTimeCardBreakResult(ev:ResultEvent):void {
		timecardBreakArray = ev.result as ArrayCollection;
	}
	private function handleLoadTimeCardEmployeeResult(ev:ResultEvent):void {
		timecardEmployeeArray = ev.result as ArrayCollection;
	}


// Data Save Handlers
	private function handleSaveResult(ev:ResultEvent):void {
    	//dataService.getAll("PreferencesSystem");
	}
	private function handleSaveTimeCardResult(ev:ResultEvent):void {
	}


	private function doSave():void{
	}
	
	private function doRevert():void{
	}

	private function doGrid(): void{ 
		employee = employeeGrid.selectedItem as Employee;
		dataServiceTimeCard.getByTimeCardByEmployee("TimeCard",employee);
		
	}  
	private function doTimeCardGrid(): void{
		timecard = timecardGrid.selectedItem as TimeCard;
		
	}

]]>
                             
</mx:Script>	

	<mx:Button x="228" y="6" width="38" height="38" click="doSave();" enabled="{enableSave}" id="btnSave">
		<mx:icon>@Embed(source='../../../assets/file.png')</mx:icon>
	</mx:Button>
	<mx:Button x="274" y="6" width="38" height="38" click="doRevert();" enabled="{enableSave}" id="btnRevert">
		<mx:icon>@Embed(source='../../../assets/cancel.png')</mx:icon>
	</mx:Button>

		<mx:DataGrid x="10" y="10" width="178" id="employeeGrid" dataProvider="{employeesArray}" height="478"
			itemClick="doGrid()">
			<mx:columns>
				<mx:DataGridColumn width="50" headerText="ID" dataField="id" />
				<mx:DataGridColumn width="100" headerText="First Name" dataField="firstName" />
				<mx:DataGridColumn width="100" headerText="Last Name" dataField="lastName"/>
			</mx:columns>
		</mx:DataGrid>
	
		<mx:DataGrid x="194" y="49" width="418" id="timecardGrid" dataProvider="{timecardEmployeeArray}" height="376"
			itemClick="doTimeCardGrid()">
			<mx:columns>
				<mx:DataGridColumn headerText="Period" dataField="period" />
				<mx:DataGridColumn headerText="In" dataField="startDateTime" />
				<mx:DataGridColumn headerText="Out" dataField="endDateTime"/>
				<mx:DataGridColumn headerText="Break" dataField="breakTime" />
				<mx:DataGridColumn headerText="On Clock" dataField="onClock" />
				<mx:DataGridColumn headerText="Billable" dataField="billable"/>
			</mx:columns>
		</mx:DataGrid>
</mx:TitleWindow>

