<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="638" height="538" title="Time Tracking" label="Time Tracking" 
	creationComplete="init()">
<mx:RemoteObject id="dataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadResult(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveResult(event)"/>
	<mx:method name="deleteItem" fault="handleFault(event)" result="handleDeleteResult(event)"/>
</mx:RemoteObject>
	
	<mx:Producer id="producer" destination="employees"/>
	<mx:Consumer id="consumer" destination="employees" message="messageHandler(event.message)"/>
	<mx:Consumer id="notification_consumer" destination="notifications" message="messageHandler(event.message)"/>
	
	
	
	
	
<mx:Script>  	
<![CDATA[
	import mx.controls.Alert;                                         
	import mx.managers.PopUpManager;                                         
	import mx.containers.TitleWindow;                                         
	import mx.collections.ArrayCollection;                                         
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;                                         
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
	import mx.printing.PrintAdvancedDataGrid;
    import mx.printing.PrintDataGrid;
    import mx.core.Application;
	import com.efi.vo.Employee;
    import com.efi.vo.City;
	import com.efi.vo.Country;
	import com.efi.vo.State;
	import com.efi.vo.Zip;

	[Bindable]                                
	private var employeesArray:ArrayCollection = new ArrayCollection();
	
	[Bindable] 
	private var employee:Employee;

	
	
	public function init():void {
		var application:Snowmass = Snowmass.getInstance();
		consumer.subscribe();
		notification_consumer.subscribe();     
		dataService.getAll("Employee");
		//user = application.currentUser;
		
	    
	} 
	private function messageHandler(message:IMessage):void
	{
		var messageBody:String = message.body as String;
  		dataService.getAll("Employee");
	}
	private function handleLoadResult(ev:ResultEvent):void {
		employeesArray = ev.result as ArrayCollection;
	}
	private function handleSaveResult(ev:ResultEvent):void {
		dataService.getAll("Employee")
	}
	private function handleDeleteResult(ev:ResultEvent):void {
		dataService.getAll("Employee")
		
	}  
	private function setEmployee():void
	{	
		dataService.addUpdate(employee);
	}
	private function doClockIn(): void{  
		 employee.clockIn= true;
		 employee.clockOut = false;
		 employee.clockBreak= false;
		 setEmployee();
		
	}  
	private function doClockOut(): void{ 
		employee.clockIn= false;
		employee.clockOut = true;
		employee.clockBreak= false; 
		setEmployee();
		
	}
	private function doClockBreak(): void{ 
		employee.clockIn= false;
		employee.clockOut = false;
		employee.clockBreak= true;
		setEmployee();
		
		
	}  
	private function handleFault(ev:FaultEvent):void {  
		var message:String;
		              
		message = "Error: "                          
		+ ev.fault.faultCode + " - "                                  
		+ ev.fault.faultDetail + " - "                                  
		+ ev.fault.faultString;
		Alert.show(message, "Error", 0, null, null, null,null);                                 
	}
	
              
]]>
                             
</mx:Script>

	<mx:Button x="62" y="37" label="Clock In" width="132" height="107" icon="@Embed(source='../../../assets/ClockIn.png')" id="clockIn" click="doClockIn();"/>
	<mx:Button x="62" y="165" label="Clock Out" width="132" height="107" icon="@Embed(source='../../../assets/ClockOut.png')" id="clockOut" click="doClockOut();"/>
	<mx:Button x="62" y="310" label="On Break" width="132" height="107" id="clockBreak" icon="@Embed(source='../../../assets/ClockOnBreak.png')" click="doClockBreak();"/>
	<mx:DataGrid x="212" y="37" height="380" width="387" dataProvider="{employeesArray}">
		<mx:columns>
			<mx:DataGridColumn headerText="Employee" dataField="name"/>
			<mx:DataGridColumn headerText="Out"  dataField="clockOut"/>
			<mx:DataGridColumn headerText="In" dataField="clockIn"/>
			<mx:DataGridColumn headerText="Break" dataField="clockBreak"/>
		</mx:columns>
	</mx:DataGrid>
	<mx:Button x="534" y="448" label="Return" click="PopUpManager.removePopUp(this)"/>
	
</mx:Panel>
