<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" creationComplete="init()" xmlns:components="com.efi.components.*" xmlns:vo="com.efi.vo.*"
width="912" height="722" title="Press Definitions"
 label="Press Definitions" name="Press Definitions" fontSize="9">
<mx:RemoteObject id="dataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadResult(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveResult(event)"/>
	<mx:method name="deleteItem" fault="handleFault(event)" result="handleDeleteResult(event)"/>
</mx:RemoteObject>

	<mx:Producer id="producer" destination="pressdefinitions"/>
	<mx:Consumer id="consumer" destination="pressdefinitions" message="messageHandler(event.message)"/>
	<mx:Consumer id="notification_consumer" destination="notifications" message="messageHandler(event.message)"/>
<mx:Script>                                   
<![CDATA[
	import com.efi.vo.PressDefinition;
	import com.efi.vo.PriceListBase;
	import com.efi.vo.PriceList;
	import com.efi.vo.WasteChart;
	import com.efi.pages.DefaultPressPicker;
	
	import mx.controls.Alert;                                         
	import mx.managers.PopUpManager;                                         
	import mx.containers.TitleWindow;                                         
	import mx.collections.ArrayCollection;                                         
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;                                         
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
                   
	[Bindable]
    private var enableSave:Boolean = true;
    [Bindable]
    private var press:Boolean = false;
    [Bindable]
    private var stock:Boolean = false; 
    [Bindable]
	private var waste:Boolean = false;
	
	[Bindable]                                         
     private var pressDefinition:PressDefinition;
    
	[Bindable]                                         
     private var priceList:PriceList;  
    [Bindable]                                         
    private var wasteChart:WasteChart;  
                                                                               	
	[Bindable]                                
	private var pressDefinitionArray:ArrayCollection = new ArrayCollection();
                                                                         
	public function init():void {
		consumer.subscribe();
		notification_consumer.subscribe();     
		dataService.getAll("PressDefinition");
	    pressDefinition = new PressDefinition();
	
	}      
	                                                   	
	public function loadPressDefinitions():void {   
		dataService.getAll("PressDefinition");
	}
					
	private function messageHandler(message:IMessage):void
	{
		var messageBody:Object = message.body;// as com.efi.messaging.MessageBody;
		
		var messageType:String = messageBody.messageType;
		if (messageType == "ADDUPDATE" || messageType == "DELETE") {
			var payloadType:String = messageBody.payloadType as String; // What kind of item was added/deleted
			var payload:Number = messageBody.payload as Number; // ID if item added or deleted
			if (payloadType == "PressDefinition") {
				loadPressDefinitions()
			}
		}
	}
                                  
		          
	private function doDelete():void {
	    dataService.deleteItem("PressDefinition",pressDefinition.id);
	 	
	}  
	private function doGet():void{
	 	var titleWindow:ContactPicker = ContactPicker(PopUpManager.createPopUp(this, ContactPicker, true));
		titleWindow.setStyle("borderAlpha", 0.9);
		titleWindow.formIsEmpty = true; 
	   	    
	}    
	private function doPressPriceList():void {
		var titleWindow:PriceListPicker = PriceListPicker(PopUpManager.createPopUp(this, PriceListPicker, true));
	    titleWindow.setStyle("borderAlpha", 0.9);
	    titleWindow.parentContainer = this;
	    titleWindow.itemType = "PriceList";
	    press =  true;
	   	}
	private function doStockPriceList():void {
		var titleWindow:PriceListPicker = PriceListPicker(PopUpManager.createPopUp(this, PriceListPicker, true));
	    titleWindow.setStyle("borderAlpha", 0.9);
	    titleWindow.parentContainer = this;
	    titleWindow.itemType = "PriceList";
	    stock = true;
	}

	private function doWasteChart():void {
		var titleWindow:PriceListPicker = PriceListPicker(PopUpManager.createPopUp(this, PriceListPicker, true));
	    titleWindow.setStyle("borderAlpha", 0.9);
	    titleWindow.parentContainer = this;
	    titleWindow.itemType = "WasteChart";
	    waste = true;
	}
	public function setPressDef(pressdef:PressDefinition):void
	{
		this.pressDefinition = pressdef;
		
	}		                                       
	
	private function doPaperStyle(): void {              
	   if (pressDefinition.sheetFed ) {
	   		pressDefinition.sheetFedPaper = true;
			pressDefinition.rollFedPaper = false;
	   }
	   else {
	   		pressDefinition.sheetFedPaper = false;
	        pressDefinition.rollFedPaper = true;
	   }
	}


	private function doPressGridClick():void {
		pressDefinition = dataGrid.selectedItem as PressDefinition;
	}
	private function mapAccountData():void {
	 //pressDefinition.pressDefID = PressDefID;
	 pressDefinition.name = Name.text;
	 pressDefinition.machineName = MachineName.text;
	 pressDefinition.outputDescrip = OutPutDescription.text;
	 pressDefinition.productionLocation = ProductionLocation.text;
	 pressDefinition.costCenter = CostCenter.text;
	 pressDefinition.oEMDeviceID = OEMDeviceID.text;
	 pressDefinition.machineID = parseInt(MachineId.text) 
	 pressDefinition.costingPress = CostingPress.selected;
	// pressDefinition.sheetFed = SheetFed.selected;
	// pressDefinition.rolltoRoll = RollFed.selected;
	 pressDefinition.integratedDevice = IntegratedDevice.selected;
	 pressDefinition.maxPaperSize = MaxPaperSize.text;
	 pressDefinition.minPaperSize = MinPaperSize.text;
	 pressDefinition.laborRate = parseInt(LaborRate.text);
	 pressDefinition.laborMarkup = parseInt(laborMarkup.text);
	 pressDefinition.fixedWaste = parseInt(FixedWaste.text);
	 pressDefinition.minLabor = parseInt(MinLabor.text);
	 pressDefinition.setupMin = parseInt(SetupMin.text);
	 pressDefinition.setupAddSig= parseInt(SetupAddSig.text);
	 pressDefinition.workTurnSetup= parseInt(WorkTurn.text);
	 pressDefinition.setupAddHead = parseInt(setupAddHead.text);
	 pressDefinition.washupFee = parseInt(WashupFee.text);
	 pressDefinition.addSigAddHead= parseInt(AddSigAddHead.text);
	 pressDefinition.washupMin = parseInt(WashupMin.text);
	 pressDefinition.washupPerFountain = parseInt(WashupTimeFountain.text);
	 pressDefinition.gripEdge = parseInt(GripEdge.text);
	 pressDefinition.perfector = Perfector.selected;
	 pressDefinition.avgImpressPerHour = parseInt(AvgImpressPerhour.text);
	 pressDefinition.setupAddRun = parseInt(SetupAddRun.text);
	 pressDefinition.numberHeads= parseInt(NumberHeads.text);
	// pressDefinition.defaultRoll= DefaultRoll.selected;
	// pressDefinition.defaultSheet = DefaultSheet.selected;
//	 pressDefinition.paperStyle =  doPaperStyle();
	}
	private function doSave():void {
	 
		mapAccountData()
		dataService.addUpdate(pressDefinition);
	}       
	private function doNext():void {
	 
	  
		doSave();  
		dataGrid.selectedIndex = dataGrid.selectedIndex+1;
		dataGrid.setFocus();
		doPressGridClick();
		                                        		
	}       
	private function doPrev():void {
	  
	 	doSave();  
		dataGrid.selectedIndex = dataGrid.selectedIndex-1;
		dataGrid.setFocus();
		doPressGridClick();                          		
	}       
	private function doNew():void {
	    pressDefinition = new PressDefinition();
	 	
	}       
	private function handleSaveResult(ev:ResultEvent):void {
    	loadPressDefinitions();
	}

	private function handleLoadResult(ev:ResultEvent):void {
	     pressDefinitionArray = ev.result as ArrayCollection;
	}
	                                 
	private function handleDeleteResult(ev:ResultEvent):void {
		loadPressDefinitions();
		doNew();
	}
	public function setPriceList(price:PriceListBase): void {
	 	if (press){
	 		pressDefinition.pressPriceList = price as PriceList;
	 		press = false;
	 	}
	 	if (stock){
	 		pressDefinition.stockPriceList = price as PriceList;
	 		stock= false;
	 	}
	 	if (waste){
	 		pressDefinition.wasteChart = price as WasteChart;
	 		waste= false;
	 	}
	}
	
	private function doDefaultPresses():void {
		var defaultPressWindow:DefaultPressPicker = DefaultPressPicker(PopUpManager.createPopUp(this, DefaultPressPicker, true));
		defaultPressWindow.setStyle("borderAlpha", 0.9);
	}

	private function handleFault(ev:FaultEvent):void {  
		var message:String;
		              
		message = "Error: "                          
		+ ev.fault.faultCode + " - "                                  
		+ ev.fault.faultDetail + " - "                                  
		+ ev.fault.faultString;
		Alert.show(message, "Error", 0, null, null, null, 4);                                 
	}
                                   
]]>
                             
</mx:Script>	
	<mx:Label x="78" y="197" text="Name:" width="45" textAlign="right"/>
	<mx:Label x="40" y="219" text="Machine Name:" textAlign="right"/>
	<mx:DataGrid x="10" y="71" width="712" id="dataGrid" dataProvider="{pressDefinitionArray}" height="116" showHeaders="true" headerSeparatorSkin="mx.skins.ProgrammaticSkin" itemClick="doPressGridClick()" verticalGridLines="false" left="0" right="0">
		<mx:columns>
			<mx:DataGridColumn width="25" sortable="false" textAlign="center" headerText=" " dataField="sheetFedPaper" itemRenderer="com.efi.itemRenderers.DataGridIconRenderer"/>
			<mx:DataGridColumn width="25" sortable="false" textAlign="center" headerText=" " dataField="rollFedPaper" itemRenderer="com.efi.itemRenderers.DataGridIconRenderer"/>
			<mx:DataGridColumn headerText="Name" dataField="name"/>
			<mx:DataGridColumn headerText="Machine" dataField="machineName"/>
			<mx:DataGridColumn headerText="Device ID" dataField="oEMDeviceID" width="100"/>
		</mx:columns>
	</mx:DataGrid>

	<mx:Label x="18" y="241" text="Output Description:" textAlign="right"/>
	<mx:Label x="14" y="263" text="Production Location:" textAlign="right"/>
	<mx:Label x="51" y="285" text="Cost Center:" textAlign="right"/>
	<mx:Label x="35" y="307" text="OEM Device ID:" textAlign="right"/>	
	<mx:TextInput x="131" y="195" width="263" id="Name" text="{pressDefinition.name}" height="20"/>
	<mx:TextInput x="131" y="217" width="263" id="MachineName" text="{pressDefinition.machineName}" height="20"/>
	<mx:TextInput x="131" y="239" width="263" id="OutPutDescription" text="{pressDefinition.outputDescrip}" height="20"/>
	<mx:TextInput x="131" y="261" id="ProductionLocation" width="263" text="{pressDefinition.productionLocation}"  height="20"/>
	<mx:TextInput x="131" y="283" id="CostCenter" width="263" text="{pressDefinition.costCenter}" height="20"/>
	<mx:TextInput x="131" y="305" id="OEMDeviceID" width="263" text="{pressDefinition.oEMDeviceID}" height="20"/>
	<mx:Label x="402" y="197" text="Machine ID:"/>
	<mx:TextInput x="477" y="195" width="102" id="MachineId" text="{pressDefinition.machineID}" editable="true"/>
	<mx:CheckBox x="424" y="267" label="Costing Press" id="CostingPress" selected="{pressDefinition.costingPress}"/>
	<mx:CheckBox x="424" y="244" label="Integrated Device" id="IntegratedDevice" selected="{pressDefinition.integratedDevice}"/>
	<mx:RadioButtonGroup id="PaperStyle"/>
	<mx:HRule x="10" y="326" width="732" height="16" left="5" right="5"/>
	<mx:Label x="37" y="344" text="Max Paper Size:"/>
	<mx:Label x="40" y="366" text="Min Paper Size:"/>
	<mx:Label x="60" y="388" text="Labor Rate:"/>
	<mx:Label x="41" y="410" text="Minimum labor:"/>
	<mx:Label x="34" y="432" text="Setup (Minutes):"/>
	<mx:Label x="34" y="454" text="Setup Add'l Run:"/>
	<mx:Label x="55" y="476" text="Setup Add'l Signatures:"/>
	<mx:Label x="19" y="498" text="Work and Turn 2nd Side Setup:"/>
	<mx:TextInput x="131" y="342" id="MaxPaperSize" text="{pressDefinition.maxPaperSize}" height="20"/>
	<mx:TextInput x="131" y="364" id="MinPaperSize" text="{pressDefinition.minPaperSize}" height="20"/>
	<mx:TextInput x="131" y="386" width="76" id="LaborRate" text="{pressDefinition.laborRate}" height="20"/>
	<mx:TextInput x="131" y="408" width="92" id="MinLabor" text="{pressDefinition.minLabor}" height="20"/>
	<mx:TextInput x="131" y="430" width="92" id="SetupMin" text="{pressDefinition.setupMin}" height="20"/>
	<mx:TextInput x="131" y="452" width="92" id="SetupAddRun" text="{pressDefinition.setupAddRun}" height="20"/>
	<mx:TextInput x="187" y="474" id="SetupAddSig" text="{pressDefinition.setupAddSig}" height="20" width="82"/>
	<mx:TextInput x="187" y="496" id="WorkTurn" text="{pressDefinition.workTurnSetup}" height="20" width="82"/>
	<mx:Label x="231" y="410" text="(Minutes)"/>
	<mx:Label x="231" y="432" text="# Heads:"/>
	<mx:TextInput x="290" y="430" width="37" id="NumberHeads" text="{pressDefinition.numberHeads}" height="20"/>
	<mx:TextInput x="493" y="342" width="106" id="AvgImpressPerhour" text="{pressDefinition.avgImpressPerHour}" height="20"/>
	<mx:TextInput x="493" y="364" width="106" id="laborMarkup" text="{pressDefinition.laborMarkup}" height="20"/>
	<mx:TextInput x="493" y="386" width="79" id="FixedWaste" text="{pressDefinition.fixedWaste}" height="20"/>
	<mx:TextInput x="493" y="408" width="79" id="setupAddHead" text="{pressDefinition.setupAddHead}" height="20"/>
	<mx:TextInput x="493" y="430" width="106" id="WashupFee" text="{pressDefinition.washupFee}" height="20"/>
	<mx:TextInput x="493" y="452" width="106" id="AddSigAddHead" text="{pressDefinition.addSigAddHead}" height="20"/>
	<mx:Label x="610" y="476" text="(per wash)"/>
	<mx:TextInput x="493" y="496" width="106" id="WashupTimeFountain" text="{pressDefinition.washupPerFountain}" height="20"/>
	<mx:TextInput x="493" y="474" width="106" id="WashupMin" text="{pressDefinition.washupMin}" height="20"/>
	<mx:Label x="347" y="345" text="Avg. Impression per Hour:"/>
	<mx:Label x="408" y="367" text="Labor Markup:"/>
	<mx:Label x="415" y="389" text="Fixed Waste:"/>
	<mx:Label x="389" y="411" text="Setup Add'l Head:"/>
	<mx:Label x="416" y="433" text="Washup Fee:"/>
	<mx:Label x="335" y="455" text="Add'l Signatures Add'l Head:"/>
	<mx:Label x="394" y="477" text="Washup Minutes:"/>
	<mx:Label x="347" y="498" text="Washup Time per fountain:" textAlign="right"/>
	<mx:HRule x="10" y="523" width="732" height="6" left="5" right="5"/>
	<mx:HRule x="10" y="622" width="732" height="6" left="5" right="5"/>
	<mx:Button x="11" y="537" label="Speed Table " width="97"/>
	<mx:Button x="380" y="537" label="Stock Price List" click="doStockPriceList();"/>
	<mx:Button x="380" y="565" label="Press Price List" click="doPressPriceList();"/>
	<mx:Button x="11" y="565" label="Waste Chart" click="doWasteChart();"/>
	<mx:Button x="10" y="595" label="Add Charges"/>
	<mx:CheckBox x="424" y="222" label="Perfector" id="Perfector" selected="{pressDefinition.perfector}"/>
	<mx:Button x="10" y="10" width="38" height="38" click="doPrev();">
			<mx:icon>@Embed(source='../../../assets/previous_page.png')</mx:icon>
		</mx:Button>
		<mx:Button x="56" y="10" width="38" height="38" click="doNext();">
			<mx:icon>@Embed(source='../../../assets/next_page.png')</mx:icon>
		</mx:Button>
		<mx:Label x="10" y="46" text="Prev" width="38" textAlign="center" />
		<mx:Label x="56" y="46" text="Next" width="38" textAlign="center"/>
		<mx:Button x="183" y="10" width="38" height="38" click="doSave();" enabled="{enableSave}">
			<mx:icon>@Embed(source='../../../assets/file.png')</mx:icon>
		</mx:Button>
		<mx:Label x="171" y="46" text="Save" width="38" textAlign="center"/>
		<mx:Button x="263" y="10" width="38" height="38" click="doNew();">
			<mx:icon>@Embed(source='../../../assets/new.png')</mx:icon>
		</mx:Button>
		<mx:Button x="370" y="10" width="38" height="38" click="doDelete();">
			<mx:icon>@Embed(source='../../../assets/delete.png')</mx:icon>
		</mx:Button>
		<mx:Label x="360" y="46" text="Delete" width="58" textAlign="center"/>
		<mx:Button x="493" y="10" width="38" height="38">
			<mx:icon>@Embed(source='../../../assets/cancel.png')</mx:icon>
		</mx:Button>
		<mx:Label x="483" y="46" text="Revert" width="58" textAlign="center"/>
		<mx:Label x="263" y="46" text="New" width="38" textAlign="center"/>
		<mx:Label x="133" y="594" text="Grip Edge/Gap:"/>
		<mx:TextInput x="223" y="592" id="GripEdge" text="{pressDefinition.gripEdge}" height="20" width="82"/>
		<mx:TextInput x="132" y="537"/>
		<mx:Text x="132" y="567" id="selectedWasteChart" text ="{pressDefinition.wasteChart.name}"/>
		<mx:Text x="501" y="539" id="selectedStockPriceList" text = "{pressDefinition.stockPriceList.name}"/>
		<mx:Text x="502" y="567" id="selectedPressPriceList" text="{pressDefinition.pressPriceList.name}"/>
		<mx:Button x="171" y="636" label="Default Presses" click="doDefaultPresses()" width="107"/>
		<mx:Button x="568" y="636" label="Save" click="doSave()" width="67"/>
		<mx:Button x="493" y="636" label="New" click="doNew()" width="67"/>
		<mx:Button x="418" y="636" label="Delete" click="doDelete()" width="67"/>
</mx:Panel>
