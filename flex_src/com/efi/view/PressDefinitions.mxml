<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" creationComplete="init()" xmlns:components="com.efi.components.*" xmlns:vo="com.efi.vo.*"
width="772" height="827" title="Press Definitions"
 label="Press Definitions" name="Press Definitions">
<mx:RemoteObject id="dataService" destination="dataService">
	<mx:method name="getAll" fault="handleFault(event)" result="handleLoadResult(event)"/>
	<mx:method name="addUpdate" fault="handleFault(event)" result="handleSaveResult(event)"/>
	<mx:method name="deleteItem" fault="handleFault(event)" result="handleDeleteResult(event)"/>
</mx:RemoteObject>

	<mx:Producer id="producer" destination="pressdefinitions"/>
	<mx:Consumer id="consumer" destination="pressdefinitions" message="messageHandler(event.message)"/>
	<mx:Consumer id="notification_consumer" destination="notifications" message="messageHandler(event.message)"/>
<mx:Script>                                   
<![CDATA[
	import com.efi.vo.PressDefinition;
	import com.efi.vo.PriceListBase;
	import com.efi.vo.PriceList;
	import com.efi.vo.WasteChart;
	
	import mx.controls.Alert;                                         
	import mx.managers.PopUpManager;                                         
	import mx.containers.TitleWindow;                                         
	import mx.collections.ArrayCollection;                                         
	import mx.rpc.events.ResultEvent;                                         
	import mx.rpc.events.FaultEvent;                                         
	import mx.messaging.messages.AsyncMessage;
	import mx.messaging.messages.IMessage;
                   
	[Bindable]
    private var enableSave:Boolean = true;
    [Bindable]
    private var press:Boolean = false;
     [Bindable]
    private var stock:Boolean = false; 
                        
	[Bindable]                                         
     private var pressDefinition:PressDefinition;
    
	[Bindable]                                         
     private var priceList:PriceList;  
    [Bindable]                                         
    private var wasteChart:WasteChart;  
                                                                               	
	[Bindable]                                
	private var pressDefinitionArray:ArrayCollection = new ArrayCollection();
                                                                         
	public function init():void {
		consumer.subscribe();
		notification_consumer.subscribe();     
		dataService.getAll("PressDefinition");
	    pressDefinition = new PressDefinition();
	
	}      
	                                                   	
	public function loadPressDefinitions():void {   
		dataService.getAll("PressDefinition");
	}
					
	private function messageHandler(message:IMessage):void
	{
	}
                                  
		          
	private function doDelete():void {
	    dataService.deleteItem("PressDefinition",pressDefinition.id);
	 	
	}  
	private function doGet():void{
	 	var titleWindow:ContactPicker = ContactPicker(PopUpManager.createPopUp(this, ContactPicker, true));
		titleWindow.setStyle("borderAlpha", 0.9);
		titleWindow.formIsEmpty = true; 
	   	    
	}    
	private function doPressPriceList():void {
		var titleWindow:PriceListPicker = PriceListPicker(PopUpManager.createPopUp(this, PriceListPicker, true));
	    titleWindow.setStyle("borderAlpha", 0.9);
	    titleWindow.parentContainer = this;
	    titleWindow.itemType = "PriceList";
	    press =  true;
	    pressDefinition.pressPriceList = this.priceList;
	    
	}
	private function doStockPriceList():void {
		var titleWindow:PriceListPicker = PriceListPicker(PopUpManager.createPopUp(this, PriceListPicker, true));
	    titleWindow.setStyle("borderAlpha", 0.9);
	    titleWindow.parentContainer = this;
	    titleWindow.itemType = "PriceList";
	    stock = true;
	    
	}

	private function doWasteChart():void {
		var titleWindow:PriceListPicker = PriceListPicker(PopUpManager.createPopUp(this, PriceListPicker, true));
	    titleWindow.setStyle("borderAlpha", 0.9);
	    titleWindow.parentContainer = this;
	    titleWindow.itemType = "WasteChart";		
	}
	public function setPressDef(pressdef:PressDefinition):void
	{
		this.pressDefinition = pressdef;
		
	}		                                       
	
	private function doPaperStyle(): void {              
	   if (pressDefinition.sheetFed ) {
	   		pressDefinition.sheetFedPaper = true;
			pressDefinition.rollFedPaper = false;
	   }
	   else {
	   		pressDefinition.sheetFedPaper = false;
	        pressDefinition.rollFedPaper = true;
	   }
	}


	private function doPressGridClick():void {
		pressDefinition = dataGrid.selectedItem as PressDefinition;
	}
	private function mapAccountData():void {
	 //pressDefinition.pressDefID = PressDefID;
	 pressDefinition.name = Name.text;
	 pressDefinition.machineName = MachineName.text;
	 pressDefinition.outputDescrip = OutPutDescription.text;
	 pressDefinition.productionLocation = ProductionLocation.text;
	 pressDefinition.costCenter = CostCenter.text;
	 pressDefinition.oEMDeviceID = OEMDeviceID.text;
	 pressDefinition.machineID = parseInt(MachineId.text) 
	 pressDefinition.costingPress = CostingPress.selected;
	// pressDefinition.sheetFed = SheetFed.selected;
	// pressDefinition.rolltoRoll = RollFed.selected;
	 pressDefinition.integratedDevice = IntegratedDevice.selected;
	 pressDefinition.maxPaperSize = MaxPaperSize.text;
	 pressDefinition.minPaperSize = MinPaperSize.text;
	 pressDefinition.laborRate = parseInt(LaborRate.text);
	 pressDefinition.laborMarkup = parseInt(laborMarkup.text);
	 pressDefinition.fixedWaste = parseInt(FixedWaste.text);
	 pressDefinition.minLabor = parseInt(MinLabor.text);
	 pressDefinition.setupMin = parseInt(SetupMin.text);
	 pressDefinition.setupAddSig= parseInt(SetupAddSig.text);
	 pressDefinition.workTurnSetup= parseInt(WorkTurn.text);
	 pressDefinition.setupAddHead = parseInt(setupAddHead.text);
	 pressDefinition.washupFee = parseInt(WashupFee.text);
	 pressDefinition.addSigAddHead= parseInt(AddSigAddHead.text);
	 pressDefinition.washupMin = parseInt(WashupMin.text);
	 pressDefinition.washupPerFountain = parseInt(WashupTimeFountain.text);
	 pressDefinition.gripEdge = parseInt(GripEdge.text);
	 pressDefinition.perfector = Perfector.selected;
	 pressDefinition.avgImpressPerHour = parseInt(AvgImpressPerhour.text);
	 pressDefinition.setupAddRun = parseInt(SetupAddRun.text);
	 pressDefinition.numberHeads= parseInt(NumberHeads.text);
	// pressDefinition.defaultRoll= DefaultRoll.selected;
	// pressDefinition.defaultSheet = DefaultSheet.selected;
//	 pressDefinition.paperStyle =  doPaperStyle();
	}
	private function doSave():void {
	 
		mapAccountData()
		dataService.addUpdate(pressDefinition);
	}       
	private function doNext():void {
	 
	  
		doSave();  
		dataGrid.selectedIndex = dataGrid.selectedIndex+1;
		dataGrid.setFocus();
		doPressGridClick();
		                                        		
	}       
	private function doPrev():void {
	  
	 	doSave();  
		dataGrid.selectedIndex = dataGrid.selectedIndex-1;
		dataGrid.setFocus();
		doPressGridClick();                          		
	}       
	private function doNew():void {
	    pressDefinition = new PressDefinition();
	 	
	}       
	private function handleSaveResult(ev:ResultEvent):void {
    	loadPressDefinitions();
	}

	private function handleLoadResult(ev:ResultEvent):void {
	     pressDefinitionArray = ev.result as ArrayCollection;
	}
	                                 
	private function handleDeleteResult(ev:ResultEvent):void {
		loadPressDefinitions();
		doNew();
	}
	public function setPriceList(price:PriceList): void {
	 	this.priceList = price as PriceList;	
	 	if (press){
	 		pressDefinition.pressPriceList = price as PriceList;
	 		press = false;
	 	}
	 	if (stock){
	 		pressDefinition.stockPriceList = price as PriceList;
	 		stock= false;
	 	}
	}     
	private function handleFault(ev:FaultEvent):void {  
		var message:String;
		              
		message = "Error: "                          
		+ ev.fault.faultCode + " - "                                  
		+ ev.fault.faultDetail + " - "                                  
		+ ev.fault.faultString;
		Alert.show(message, "Error", 0, null, null, null, 4);                                 
	}
                                   
]]>
                             
</mx:Script>	
	<mx:Label x="78" y="197" text="Name:" width="45" textAlign="right"/>
	<mx:Label x="32" y="223" text="Machine Name:" textAlign="right"/>
	<mx:AdvancedDataGrid x="10" y="71" width="712" id="dataGrid" dataProvider="{pressDefinitionArray}" height="116" sortExpertMode="true"
		itemClick="doPressGridClick()">
		<mx:groupedColumns>
			<mx:AdvancedDataGridColumnGroup id="default_column" headerText="Default" sortable="false">
				<mx:AdvancedDataGridColumn width="50" headerText="Sheet" sortable="false" textAlign="center" dataField="defaultSheet" itemRenderer="com.efi.components.GenericCheckboxRenderer" rendererIsEditor="true" editorDataField="selected"/>
				<mx:AdvancedDataGridColumn width="50" headerText="Roll" sortable="false" textAlign="center" dataField="defaultRoll" itemRenderer="com.efi.components.GenericCheckboxRenderer" rendererIsEditor="true" editorDataField="selected"/>
			</mx:AdvancedDataGridColumnGroup>
			<mx:AdvancedDataGridColumn headerText="Name" dataField="name"/>
			<mx:AdvancedDataGridColumnGroup id="paper_style_column" headerText="Paper Style" sortable="false">
				<mx:AdvancedDataGridColumn width="50" headerText="Sheet" sortable="false" textAlign="center" dataField="sheetFedPaper" itemRenderer="com.efi.components.GenericCheckboxRenderer" rendererIsEditor="true" editorDataField="selected"/>
				<mx:AdvancedDataGridColumn width="50" headerText="Roll" sortable="false" textAlign="center"  dataField="rollFedPaper" itemRenderer="com.efi.components.GenericCheckboxRenderer" rendererIsEditor="true" editorDataField="selected"/>
			</mx:AdvancedDataGridColumnGroup>
		</mx:groupedColumns>
	</mx:AdvancedDataGrid>

	<mx:Label x="10" y="249" text="Output Description:" textAlign="right"/>
	<mx:Label x="5" y="275" text="Production Location:" textAlign="right"/>
	<mx:Label x="47" y="301" text="Cost Center:" textAlign="right"/>
	<mx:Label x="32" y="329" text="OEM Device ID:" textAlign="right"/>	
	<mx:TextInput x="131" y="195" width="263" id="Name" text="{pressDefinition.name}"/>
	<mx:TextInput x="131" y="221" width="263" id="MachineName" text="{pressDefinition.machineName}"/>
	<mx:TextInput x="131" y="247" width="263" id="OutPutDescription" text="{pressDefinition.outputDescrip}"/>
	<mx:TextInput x="131" y="273" id="ProductionLocation" width="263" text="{pressDefinition.productionLocation}" />
	<mx:TextInput x="131" y="299" id="CostCenter" width="263" text="{pressDefinition.costCenter}"/>
	<mx:TextInput x="131" y="324" id="OEMDeviceID" width="263" text="{pressDefinition.oEMDeviceID}"/>
	<mx:Label x="402" y="195" text="Machine ID:"/>
	<mx:TextInput x="479" y="195" width="102" id="MachineId" text="{pressDefinition.machineID}" editable="true"/>
	<mx:CheckBox x="445" y="324" label="Costing Press" id="CostingPress" selected="{pressDefinition.costingPress}"/>
	<mx:CheckBox x="445" y="299" label="Integrated Device" id="IntegratedDevice" selected="{pressDefinition.integratedDevice}"/>
	<mx:RadioButtonGroup id="PaperStyle"/>
	<mx:HRule x="10" y="354" width="732" height="16"/>
	<mx:Label x="27" y="380" text="Max Paper Size:"/>
	<mx:Label x="30" y="406" text="Min Paper Size:"/>
	<mx:Label x="51" y="432" text="Labor Rate:"/>
	<mx:Label x="29" y="458" text="Minimum labor:"/>
	<mx:Label x="23" y="484" text="Setup (Minutes):"/>
	<mx:Label x="23" y="510" text="Setup Add'l Run:"/>
	<mx:Label x="57" y="536" text="Setup Add'l Signatures:"/>
	<mx:Label x="11" y="561" text="Work and Turn 2nd Side Setup:"/>
	<mx:TextInput x="131" y="378" id="MaxPaperSize" text="{pressDefinition.maxPaperSize}"/>
	<mx:TextInput x="130" y="404" id="MinPaperSize" text="{pressDefinition.minPaperSize}"/>
	<mx:TextInput x="130" y="430" width="76" id="LaborRate" text="{pressDefinition.laborRate}"/>
	<mx:TextInput x="130" y="456" width="92" id="MinLabor" text="{pressDefinition.minLabor}"/>
	<mx:TextInput x="130" y="482" width="92" id="SetupMin" text="{pressDefinition.setupMin}"/>
	<mx:TextInput x="130" y="508" width="92" id="SetupAddRun" text="{pressDefinition.setupAddRun}"/>
	<mx:TextInput x="201" y="534" id="SetupAddSig" text="{pressDefinition.setupAddSig}"/>
	<mx:TextInput x="201" y="559" id="WorkTurn" text="{pressDefinition.workTurnSetup}"/>
	<mx:Label x="230" y="458" text="(Minutes)"/>
	<mx:Label x="230" y="484" text="# Heads:"/>
	<mx:TextInput x="295" y="482" width="37" id="NumberHeads" text="{pressDefinition.numberHeads}"/>
	<mx:TextInput x="606" y="378" width="106" id="AvgImpressPerhour" text="{pressDefinition.avgImpressPerHour}"/>
	<mx:TextInput x="606" y="404" width="106" id="laborMarkup" text="{pressDefinition.laborMarkup}"/>
	<mx:TextInput x="606" y="430" width="79" id="FixedWaste" text="{pressDefinition.fixedWaste}"/>
	<mx:TextInput x="606" y="456" width="79" id="setupAddHead" text="{pressDefinition.setupAddHead}"/>
	<mx:TextInput x="606" y="482" width="106" id="WashupFee" text="{pressDefinition.washupFee}"/>
	<mx:TextInput x="606" y="508" width="106" id="AddSigAddHead" text="{pressDefinition.addSigAddHead}"/>
	<mx:Label x="648" y="536" text="(per wash)"/>
	<mx:TextInput x="606" y="559" width="106" id="WashupTimeFountain" text="{pressDefinition.washupPerFountain}"/>
	<mx:TextInput x="534" y="534" width="106" id="WashupMin" text="{pressDefinition.washupMin}"/>
	<mx:Label x="450" y="380" text="Avg. Impression per Hour:"/>
	<mx:Label x="512" y="406" text="Labor Markup:"/>
	<mx:Label x="519" y="432" text="Fixed Waste:"/>
	<mx:Label x="493" y="458" text="Setup Add'l Head:"/>
	<mx:Label x="519" y="484" text="Washup Fee:"/>
	<mx:Label x="439" y="510" text="Add'l Signatures Add'l Head:"/>
	<mx:Label x="424" y="536" text="Washup Minutes:"/>
	<mx:Label x="439" y="561" text="Washup Time per fountain:" textAlign="right"/>
	<mx:HRule x="10" y="613" width="732" height="6"/>
	<mx:HRule x="10" y="715" width="732" height="2"/>
	<mx:Button x="11" y="627" label="Speed Table " width="97"/>
	<mx:Button x="10" y="725" label="Stock Price List" click="doStockPriceList();"/>
	<mx:Button x="10" y="755" label="Press Price List" click="doPressPriceList();"/>
	<mx:Button x="11" y="655" label="Waste Chart" click="doWasteChart();"/>
	<mx:Button x="10" y="685" label="Add Charges"/>
	<mx:CheckBox x="445" y="273" label="Perfector" id="Perfector" selected="{pressDefinition.perfector}"/>
	<mx:Button x="10" y="10" width="38" height="38" click="doPrev();">
			<mx:icon>@Embed(source='../../../assets/previous_page.png')</mx:icon>
		</mx:Button>
		<mx:Button x="56" y="10" width="38" height="38" click="doNext();">
			<mx:icon>@Embed(source='../../../assets/next_page.png')</mx:icon>
		</mx:Button>
		<mx:Label x="10" y="46" text="Prev" width="38" textAlign="center" />
		<mx:Label x="56" y="46" text="Next" width="38" textAlign="center"/>
		<mx:Button x="171" y="10" width="38" height="38" click="doSave();" enabled="{enableSave}">
			<mx:icon>@Embed(source='../../../assets/file.png')</mx:icon>
		</mx:Button>
		<mx:Label x="171" y="46" text="Save" width="38" textAlign="center"/>
		<mx:Button x="263" y="10" width="38" height="38" click="doNew();">
			<mx:icon>@Embed(source='../../../assets/new.png')</mx:icon>
		</mx:Button>
		<mx:Button x="370" y="10" width="38" height="38" click="doDelete();">
			<mx:icon>@Embed(source='../../../assets/delete.png')</mx:icon>
		</mx:Button>
		<mx:Label x="360" y="46" text="Delete" width="58" textAlign="center"/>
		<mx:Button x="493" y="10" width="38" height="38">
			<mx:icon>@Embed(source='../../../assets/cancel.png')</mx:icon>
		</mx:Button>
		<mx:Label x="483" y="46" text="Revert" width="58" textAlign="center"/>
		<mx:Label x="263" y="46" text="New" width="38" textAlign="center"/>
		<mx:Label x="103" y="586" text="Grip Edge/Gap:"/>
		<mx:TextInput x="201" y="584" id="GripEdge" text="{pressDefinition.gripEdge}"/>
		<mx:TextInput x="132" y="627"/>
		<mx:Text x="132" y="657" id="selectedWasteChart" text ="{pressDefinition.wasteChart.name}"/>
		<mx:Text x="132" y="729" id="selectedStockPriceList" text = "{pressDefinition.stockPriceList.name}"/>
		<mx:Text x="132" y="759" id="selectedPressPriceList" text="{pressDefinition.pressPriceList.name}"/>
</mx:Panel>
