<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute"  
		width="100%" height="100%" pageTitle="Snowmass" 
 		xmlns:local="*" creationComplete="init()"  xmlns:ns1="com.efi.printsmith.view.*" 
 		applicationComplete="initAppFunctions()"
 		xmlns:ns2="flexlib.controls.*" 
 		xmlns:mdi="com.efi.mdi.view.container.*" 
 		xmlns:flexlib="flexlib.containers.*"
 		xmlns:business="com.efi.printsmith.business.*"
 		xmlns:control="com.efi.printsmith.control.*" backgroundColor="#003893" xmlns:components="com.efi.printsmith.components.*">
 		<mx:Metadata>
 			[ResourceBundle("psResources")]
 		</mx:Metadata> 
 		 
	 <!--   <mx:Move 
	        id="moveLogo" target="{logo}" 
	        easingFunction="mx.effects.easing.Quadratic.easeIn" effectEnd="endMoveLogo()" duration="2000" xTo="480"
	    />
	    <mx:Fade
	    	id="efiLogoFade" target="{efi_logo}" 
	    	alphaFrom="0" alphaTo="1" duration="2000"
	    />
	    <mx:Fade
	    	id="poweredByFade" target="{powered_by}"
	    	alphaFrom="0" alphaTo="1" duration="2000"
	    /> -->
	<!--<mx:Style source="styles/darkroom.css"/>-->
	
    <!--mx:TraceTarget/-->
 	<mx:TraceTarget fieldSeparator="->" level="6"  includeCategory="true" includeLevel="true" includeTime="true" />
 	
    
	<!--<mx:MenuBar id="menubar" width="100%" height="39" dataProvider="{_menuItems}" itemClick="onMenuClick(event);"/>-->
   
	<mdi:MDIContainer id="container"  
		menuData="{_menuItems}" windowMenuLabel="Window" maxMenuLabel="Maximize" minMenuLabel="Minimize"
		height="100%" width="100%" />

<mx:RemoteObject id="loginService" destination="loginService"
	result="handleLoginResult(event)"  fault="handleFault(event)"
	showBusyCursor="true" />
<mx:RemoteObject id="logoutService" destination="loginService"
	showBusyCursor="false" />
<mx:RemoteObject id="versionService" destination="versionService">
	<mx:method name="getServerVersion" fault="handleFault(event)" result="handleVersionResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="dataService" destination="dataService">
		<mx:method name="addUpdate" fault="handleFault(event)" result="handleLoadResult(event)"/>
		<mx:method name="getStampSchedule" fault="handleFault(event)" result="handleGetStampScheduleResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="dimensionDataService" destination="dataService">
		<mx:method name="getAll" fault="handleFault(event)" result="handleLoadDimensionResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="jobService" destination="jobService">
	<mx:method name="createJob" fault="handleFault(event)" result="handleCreateJobResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="preferencesSystemService" destination="dataService">
	<mx:method name="getSingle" fault="handleFault(event)" result="handleLoadSystemResult(event)"/>
</mx:RemoteObject>
<mx:RemoteObject id="matrixService" destination="matrixService">
	<mx:method name="newStampSchedule" fault="handleFault(event)" result="handleCreateStampSchedule(event)"/>
</mx:RemoteObject>
<mx:Script>
	<![CDATA[
		import com.efi.printsmith.data.StampSchedule;
		import com.efi.printsmith.events.PendingListUpdateEvent;
		import com.efi.printsmith.pages.PendingChangeDueDate;
		import com.efi.printsmith.pages.PendingStatus;
		import com.efi.printsmith.data.PreferencesSystem;
		import com.efi.printsmith.data.Estimate;
		import com.efi.printsmith.data.Invoice;
		import com.efi.printsmith.events.ReviewDocUpdateEvent;
		import com.efi.printsmith.events.CopyToNewEstimateEvent;
		import com.efi.printsmith.events.CopyToNewInvoiceEvent;
		import com.efi.printsmith.events.ConvertToInvoiceEvent;
		import com.efi.mdi.event.window.WindowResizeEvent;
		import com.efi.mdi.event.window.WindowRestoreEvent;
		import com.efi.mdi.view.taskbar.MinimizedWindow;
		import com.efi.mdi.vo.menu.WindowApplicationMenuItem;
		import com.efi.printsmith.events.commandEvents.Help.AboutEvent;
		import mx.events.ListEvent;
		import com.efi.mdi.view.header.ApplicationHeader;
		import mx.controls.ComboBox;
		import mx.controls.Button;
		import com.efi.printsmith.data.Dimension;
		import com.efi.printsmith.pages.TrackerStatusView;
		import com.efi.printsmith.data.SecurityCommands;
		import com.efi.printsmith.data.JobBase;
		import com.efi.printsmith.data.Job;
	//	import com.efi.printsmith.data.PaperCalculator;
		import com.efi.mdi.view.window.MDIWindow;
		import mx.core.Container;
		import com.efi.printsmith.data.UserEvent;
		import com.efi.printsmith.pages.QuickAccessPanel;
		import com.efi.mdi.ContainerManager;
		import com.efi.mdi.event.menu.AppMenuItemClickedEvent;
		import com.gorillalogic.security.ChimpAction;
		import com.gorillalogic.security.Chimp;
	
		import com.efi.printsmith.data.SecuritySetup;
		import mx.events.MenuEvent;
		import com.efi.printsmith.data.PSMenuItem;
		import mx.collections.ArrayCollection;
		import mx.managers.IFocusManagerComponent;
		import mx.managers.FocusManager;
		import mx.core.ComponentDescriptor;
		import mx.formatters.DateFormatter;
		import mx.formatters.CurrencyFormatter;
		import mx.validators.CurrencyValidator;
		import com.efi.printsmith.events.commandEvents.EditForms.*;
		import com.efi.printsmith.events.ShowCreditCardMgrEvent;
		
		import com.efi.printsmith.view.*;

		import com.efi.printsmith.data.Users;
		import com.efi.printsmith.data.CreditCardTrackRead;
		import mx.effects.easing.Quadratic;
		import com.efi.printsmith.pages.Debug;
		import com.efi.printsmith.data.InvoiceBase;
		
		import com.efi.printsmith.security.PSSecurity;
		
		import mx.formatters.NumberFormatter; 
		import mx.controls.DateField;
		import flash.utils.setTimeout;
		import flash.net.navigateToURL;
		import mx.resources.ResourceBundle;
		import mx.rpc.remoting.mxml.RemoteObject;
		import mx.rpc.events.FaultEvent;
		import mx.events.ResourceEvent;
		import mx.controls.Alert;
		import mx.rpc.events.ResultEvent;
		import mx.effects.Zoom;
		import mx.containers.Panel;
		import mx.managers.PopUpManager;
		import mx.rpc.IResponder;
        import mx.managers.BrowserManager;
        import mx.managers.IBrowserManager;
        import mx.events.BrowserChangeEvent;
        import mx.utils.StringUtil;
         
		import com.efi.printsmith.pages.Login;
		import mx.managers.ToolTipManager;
		import flash.events.EventDispatcher;
		import flash.events.TimerEvent;
		import flash.external.ExternalInterface;
		import flash.utils.Timer;
		import com.efi.printsmith.view.EditCustomer;
		import com.efi.printsmith.view.ListUsers;
		import flexlib.controls.SuperTabBar;
		import flexlib.events.TabReorderEvent;
		import flexlib.controls.tabBarClasses.SuperTab;
		import com.efi.printsmith.components.MultiLineLabelButton;
		import com.efi.printsmith.events.CreditCardTrackReadEvent;
		import com.efi.printsmith.Constants;
		import com.efi.printsmith.data.Dimension;
		
		public var timer : Timer;
		public var nf:NumberFormatter;
		private var gUILastInteractiveTimeStamp:Date = new Date();
		private var idleTimer:Timer = null;
		
		private var keyListener:Object;

		private var remoteObject:RemoteObject;
		
		public static const RESOURCE_BUNDLE:String = "psResources";
		public static const millisecondsPerMinute:int = 1000 * 60;
		public static const millisecondsPerHour:int = 1000 * 60 * 60;
		public static const millisecondsPerDay:int = 1000 * 60 * 60 * 24;
		
		public var userName:String;
		public var userPass:String;
		
		private var debug_button:LinkButton;
		private var languageComboBox:ComboBox;
				
		private var gCardDataBuffer:String;
		private var gQuestionMarkCount:int = 0;
		private var gCardDataCharCount:int = 0;
		private var gCaptureCardData:Boolean = false;
		private var gComponent:IFocusManagerComponent = null;
		private var gTimer:Timer = null;

		[Bindable] private var _menuItems:ArrayCollection;
		
		public var security:com.efi.printsmith.security.PSSecurity;
		
        private var bm:IBrowserManager;
        
        [Bindable] public var autoClockOutDetectortList:ArrayCollection = new ArrayCollection();
        		
		[Bindable]
		public var currentUser:Users;
		[Bindable]
		private var dimensions:ArrayCollection=new ArrayCollection();
		
		[Bindable]
		public var serverVersion:String;
		public var containerManager:ContainerManager;
        private static var thisInstance:Snowmass = null;  
		
		private var _permissions:ArrayCollection;
		
		private var preferencesSystem:PreferencesSystem;
		
		private var autoLogOutTimer:Timer;
		
		private var pendingListPicker:PendingListPicker;
				
		[Bindable]
		private var locales:Array = ["de_DE", "en_AU", "en_GB", "en_US", "es_CL", "es_CO", "es_ES", "es_MX", "fr_CA", "fr_FR", "ja_JP", "lv_LV", "nl_NL", "pt_PT", "ru_RU"];
		public static function getInstance() : Snowmass {
			return thisInstance;
		}		
			
    	private function showLoginPage() : void
		{
		}
		
		private function onPreferences():void	{
			var event:Event = new Event("addPreferencesTab");
			dispatchEvent(event);
		}
		
		public function hideContainer():void	{
			this.container.visible = false; 
			this.logout_button.visible = false;//.mainContainer.visible=false;
			this.languageComboBox.visible = false;
			this.debug_button.visible = false;				
		}
		public function showContainer():void	{
			this.container.visible = true; 
			this.logout_button.visible = true;//.mainContainer.visible=false;
			this.languageComboBox.visible = true;
			this.debug_button.visible = true;				
		}
		
		public function openQAP():void	{
			containerManager.openNewMDIWindow("Quick Access Panel", new QuickAccessPanel(),40,20,530,880);				
		}
		
		private function showLogin():void	{
			var loginPopup : Login = Login(PopUpManager.createPopUp(this, Login, true));
			hideContainer();	
			PopUpManager.centerPopUp(loginPopup);
		}
		
		private function showHelp():void {
		
		}
		
		private function onLogout():void {
			
		}
		
		private function onMenuItemClicked(event:AppMenuItemClickedEvent):void	{
			if (event.menuItem is PSMenuItem)	{
				var item:PSMenuItem = event.menuItem as PSMenuItem;
				var ss:SecurityCommands = item.ss;
				
				if ((ss.menu == "rStandardMenuText.Help")
					&& (ss.commandName.indexOf("usecCmd.QuickAccessPanel") > -1 )) 	{
						doQuickAccessPanel();	
					}
				if ((ss.menu == "rStandardMenuText.Help")
					&& (ss.commandName.indexOf("rStandardMenuText.AboutPrintSmith") > -1)) {
						doAboutPrintSmith();
					}
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.CreateInvoice") > -1 ))	{
						doCreateInvoice();					
		 			}
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.CreateEstimate") > -1 ))	{
						doCreateEstimate();					
					}		
				if ((ss.menu == "rStandardMenuText.Reports")
					&& (ss.commandName.indexOf("rStandardMenuText.AccountHistory") > -1 ))	{
						doAccountHistory();					
					}
				if ((ss.menu == "rStandardMenuText.Reports")
					&& (ss.commandName.indexOf("rStandardMenuText.StockOrder") > -1 ))	{
						doStockOrder();					
					}	
				if ((ss.menu == "rStandardMenuText.AR")
					&& (ss.commandName.indexOf("rStandardMenuText.Accounts") > -1 ))	{
						doAccounts();					
					}	
				if ((ss.menu == "rStandardMenuText.AR")
					&& (ss.commandName.indexOf("rStandardMenuText.JournalEntry") > -1 ))	{
						doJournal();					
					}
				if ((ss.menu == "rStandardMenuText.AR")
					&& (ss.commandName.indexOf("rStandardMenuText.DailyCloseout") > -1 ))	{
						doCloseout();					
					}
					
				if ((ss.menu == "rStandardMenuText.AR")
					&& (ss.commandName.indexOf("rStandardMenuText.MonthlyCloseout") > -1 ))	{
						doMonthlyCloseout();					
					}
					
				if ((ss.menu == "rStandardMenuText.AR")
					&& (ss.commandName.indexOf("rStandardMenuText.GenerateStatements") > -1 ))	{
						doGenerateStatemnent();					
					}		
					
				if ((ss.menu == "rStandardMenuText.AR")
					&& (ss.commandName.indexOf("rStandardMenuText.VerifyReceivableBala") > -1 ))	{
						doVerifyRecievedBalance();					
					}								
				if ((ss.menu == "rStandardMenuText.AR")
					&& (ss.commandName.indexOf("rStandardMenuText.VerifyCustomerBalanc") > -1 ))	{
						doVerifyCustomerBalance();					
					}								
				if ((ss.menu == "rStandardMenuText.AR")
					&& (ss.commandName.indexOf("rStandardMenuText.VerifyAllBalances") > -1 ))	{
						doVerifyBalance();					
					}								
					
					
											
				if ((ss.menu == "rStandardMenuText.POS")
					&& (ss.commandName.indexOf("rStandardMenuText.OpenCashRegister") > -1 ))	{
						doCashRegister();					
					}				
				if ((ss.menu == "rStandardMenuText.Pricing")
					&& (ss.commandName.indexOf("rStandardMenuText.ChargeDefinitions") > -1 ))	{
						doChargeDefinitions();					
					}
	//			if ((ss.menu == "rStandardMenuText.Admin")
	//				&& (ss.commandName.indexOf("rStandardMenuText.ClockInOut") > -1 ))	{
	//					doClockInOut()					
	//				}	
				if ((ss.menu == "rStandardMenuText.AR")
					&& (ss.commandName.indexOf("rStandardMenuText.Contacts") > -1 ))	{
						doContacts();		
					}
				if ((ss.menu == "rStandardMenuText.Pricing")
					&& (ss.commandName.indexOf("rStandardMenuText.CopierDigitalDefinit") > -1 ))	{
						doCopyDefinitions();					
					}		
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.CreditCardManager") > -1 ))	{
						doCreditCardManager();					
					}	
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.DeliveryTicketManage") > -1 ))	{
						doDeliveryTicket();
					}
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.EmployeeManager") > -1 ))	{
						doEmployee();					
					}	
				if ((ss.menu == "rStandardMenuText.Reports")
					&& (ss.commandName.indexOf("rStandardMenuText.EstimateHistory") > -1 ))	{
						doEstimateHistory();					
					}	
				if ((ss.menu == "rStandardMenuText.AR")
					&& (ss.commandName.indexOf("rStandardMenuText.PostPayments") > -1 ))	{
						doPayments();					
					}	
				if ((ss.menu == "rStandardMenuText.POS")
					&& (ss.commandName.indexOf("rStandardMenuText.PendingDocumentWindo") > -1 ))	{
						doPendingList();					
					}
				if ((ss.menu == "rStandardMenuText.POS")
					&& (ss.commandName.indexOf("rStandardMenuText.StatusWindow") > -1 ))	{
						doStatusWindow();			
					}	
				if ((ss.menu == "rStandardMenuText.POS")
					&& (ss.commandName.indexOf("rStandardMenuText.CashDrawerStatus") > -1 ))	{
						doCashDrawerStatus();					
					}	
				if ((ss.menu == "rStandardMenuText.POS")
					&& (ss.commandName.indexOf("rStandardMenuText.ChangeDueDate") > -1 ))	{
						doChangeDueDate();			
					}	
					
				if ((ss.menu == "rStandardMenuText.Pricing")
					&& (ss.commandName.indexOf("rStandardMenuText.PressDefinitions") > -1 ))	{
						doPressDefinitions();					
					}	
	//			if ((ss.menu == "rStandardMenuText.Admin")
	//				&& (ss.commandName.indexOf("genericPrefCmd.PricingMethod") > -1 ))	{
	//					doPricing();					
	//				}	
	//			if ((ss.menu == "rStandardMenuText.POS")
	//				&& (ss.commandName.indexOf("posPendCmd.Schedule") > -1 ))	{
	//					doSchedule();					
	//				}	
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.SecuritySetup") > -1 ))	{
						doSecurity();					
					}	
				if ((ss.menu == "rStandardMenuText.Pricing")
					&& (ss.commandName.indexOf("rStandardMenuText.StockDefinitions") > -1 ))	{
						doStockDefinitions();					
					}	
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.Preferences") > -1 ))	{
						doSystemPreferences();					
					}	
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.UserDefinitions") > -1 ))	{
						doUsers();					
					}	
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.ChangePassword") > -1 ))	{
						doChangePassword();					
					}
				if((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.UserLogIn") > -1 ))	{
						doLogout();
					}
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.TrackerConsole") > -1 ))	{
						doTracker();					
					}
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.TrackerManager") > -1 ))	{
						doTrackerManager();					
					}
				if ((ss.menu == "rStandardMenuText.Pricing")
					&& (ss.commandName.indexOf("rStandardMenuText.SalesTax") > -1 ))	{
						doSalesTax();					
					}
				if ((ss.menu == "rStandardMenuText.Pricing")
					&& (ss.commandName.indexOf("rStandardMenuText.WasteChart") > -1 ))	{
						doWasteChart();					
					}
				if ((ss.menu == "rStandardMenuText.Pricing")
					&& (ss.commandName.indexOf("rStandardMenuText.ListPriceSchedules") > -1 ))	{
						doPricing();					
				}	
				if ((ss.menu == "rStandardMenuText.Pricing")
					&& (ss.commandName.indexOf("rStandardMenuText.StampSchedule") > -1 ))	{
						doStampPricing();					
				}
				
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.ClearEstimates") > -1 ))	{
						doClearEstimates();					
					}	
					
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.PaperCalculator") > -1 ))	{
						doPaperCal();					
					}	
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.OrderStock") > -1 ))	{
						doOrderStock();					
					}	
				if ((ss.menu == "rStandardMenuText.Admin")
					&& (ss.commandName.indexOf("rStandardMenuText.TableEditor") > -1 ))	{
						doTableEditor();					
					}			
				//Menu for Invoice Tracker Status
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.TrackerStatus") > -1 ))	{
						doTrackerStatus();				
					}
						
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.GenerateDeliveryTick") > -1 ))	{
						doGenerateDeliveryTicket();				
				}	
				
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.OpenEstimatorCheckli") > -1 ))	{
						doOpenEstimatorCheckList();	
				}	
					
				if ((ss.menu == "rStandardMenuText.Window")
					&& (ss.commandName.indexOf("rStandardMenuText.Maximize") > -1 ))	{
						doMaximize();				
					}	
				if ((ss.menu == "rStandardMenuText.Window")
					&& (ss.commandName.indexOf("rStandardMenuText.Minimize") > -1 ))	{
						doMinimize();				
					}
					
				//Menu for Copy to New Invoice
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rAltMenuText.CopytonewInvoice") > -1 ))	{
						doCopyToNewInvoice();				
					}
					
				//Menu for Review Doc
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.UpdatePendingDocumen") > -1 ))	{
						doUpdatePendingDocument();				
					}			
					
				//Menu for Review Doc
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.ReviewAnyDocument") > -1 ))	{
						doReviewDoc();				
					}			
					
				//Menu for Copy to New Estimate
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rAltMenuText.CopytonewEstimate") > -1 ))	{
						doCopyToNewEstimate();				
					}	
					
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.AccountInfo") > -1 ))	{
						doAccountInfo();				
					}
					
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rAltMenuText.ChangeAccount") > -1 ))	{
						doChangeAccount();				
					}
					
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.Jobs") > -1 ))	{
						doOpenJobs();				
					}
					
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.Charges") > -1 ))	{
						doOpenCharges();				
					}
					
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.DepositEntry") > -1 ))	{
						doOpenDepositEntry();				
					}
					
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.DocumentTotals") > -1 ))	{
						doOpenDocumentTotals();				
					}
					
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.NotePad") > -1 ))	{
						doOpenNotePad();				
					}	
				
				//Menu for Convert to Invoice
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.ConverttoInvoice") > -1 ))	{
						doConvertInvoice();				
					}
					
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.FileDocument") > -1 ))	{
						doFileInvoice();				
					}	
				
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.CancelDocument") > -1 ))	{
						doCancelDocument();				
					}	
				
				
				
				//Menu for Register Tape
				if ((ss.menu == "rStandardMenuText.POS")
					&& (ss.commandName.indexOf("rStandardMenuText.OpenTape") > -1 ))	{
						doOpenTape();				
					}		
				
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.CreateCustomerfmDocu") > -1 ))	{
						var mdi:MDIWindow = containerManager.getActiveWindow()	;
						if (mdi.content is EditInvoice)	{
							(mdi.content as EditInvoice).createCustFromDoc();		
						}			
					}
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.DepositEntry") > -1 ))	{
						var mdi:MDIWindow = containerManager.getActiveWindow()	;
						if (mdi.content is EditInvoice)	{
							(mdi.content as EditInvoice).openDepositEntry();	
						}			
					}	
				if ((ss.menu == "rStandardMenuText.Invoice")
					&& (ss.commandName.indexOf("rStandardMenuText.DocumentTotals") > -1 ))	{
						var mdi:MDIWindow = containerManager.getActiveWindow()	;
						if (mdi.content is EditInvoice)	{
							(mdi.content as EditInvoice).openDocTotals();
						}			
					}	
			}
			if (event.menuItem is WindowApplicationMenuItem)	{
				var winItem:WindowApplicationMenuItem = event.menuItem as WindowApplicationMenuItem;
				if (winItem.mdiWindow.state == MDIWindow.OPEN)
					winItem.mdiWindow.bringWindowToFront();
				if (winItem.mdiWindow.state == MDIWindow.MINIMIZED)	{
					var min:MinimizedWindow = containerManager.getMinimized(winItem.mdiWindow);
					min.dispatchEvent(new WindowRestoreEvent(WindowRestoreEvent.WINDOW_RESTORE, min));
				}
				
			}			
		}
		
		private function doUpdatePendingDocument():void {
			if(pendingListPicker==null || !pendingListPicker.isPopUp) {
				pendingListPicker = PopUpManager.createPopUp(this,PendingListPicker,false) as PendingListPicker;
				pendingListPicker.showEstimates = true;
				pendingListPicker.openInvoice = true;
			}
		}
		
		private function doReviewDoc():void {
			var reviewDocWindow:ReviewDocumentView = PopUpManager.createPopUp(this,ReviewDocumentView,false) as ReviewDocumentView;
			reviewDocWindow.addEventListener(ReviewDocUpdateEvent.REVIEW_DOC_UPDATE,handleReviewDocument,false,0,true);
		}
		
		private function doOpenTape():void {
			var event:EditTapeEvent = new EditTapeEvent(new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}		
		
		private function doCashDrawerStatus():void {
			var event:TapeCashDrawerStatusEvent = new TapeCashDrawerStatusEvent(new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}		
		
		private function handleReviewDocument(event:ReviewDocUpdateEvent):void {
			if(event.invoice!=null){
				if(event.invoice is Invoice){
					doEditInvoice(event.invoice);
				} else if(event.invoice is Estimate){
					doEditEstimate(event.invoice);
				}
			}
		}
		
		private function doMinimize():void	{
			containerManager.minimizeWindow(containerManager.getActiveWindow());
		}
		
		private function doMaximize():void	{
			containerManager.maximizeWindow(containerManager.getActiveWindow());
		}
		
		public function doTrackerStatus():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.openTrackerStatus();
				}
			}
		}
		
		public function doGenerateDeliveryTicket():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.openDeliveryTicket();
				}
			}
		}
		
		public function doOpenEstimatorCheckList():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.openEstimatorCheckList();
				} else if(win.content is EditJob) {
					var editJob:EditJob = win.content as EditJob;
					editJob.openEstimatorCheckList();
				}
			}
		}
		
		public function doCopyToNewInvoice():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.copyToNewInvoice();
				}
			}
		}
		
		private function doAccountInfo():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.doAccountPicker();
				}
			}
		}
		
		private function doChangeAccount():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.doAccountPicker();
				}
			}
		}
		
		private function doOpenJobs():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.doNewJob();
				}
			}
		}
		
		private function doOpenCharges():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.doNewCharge();
				}
			}
		}
		
		private function doOpenDepositEntry():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.openDepositEntry();
				}
			}
		}
		
		private function doOpenDocumentTotals():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.openDocTotals();
				}
			}
		}
		
		private function doOpenNotePad():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.doNotepad();
				}
			}
		}
		
		private function doFileInvoice():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					if(editInvoice.invoice!=null && editInvoice.invoice.onPendingList) {
						editInvoice.doSave();
					}
				}
			}
		}
		
		public function doCopyToNewEstimate():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.copyToNewEstimate();
				}
			}
		}
		
		public function doConvertInvoice():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					editInvoice.convertToInvoice();
				}
			}
		}
		
		private function doCancelDocument():void {
			var win:MDIWindow = containerManager.getActiveWindow();
			if(win!=null){
				if(win.content is EditInvoice){
					var editInvoice:EditInvoice = win.content as EditInvoice;
					var invoiceBase:InvoiceBase = editInvoice.invoice;
					if(invoiceBase!=null && (invoiceBase.onPendingList || invoiceBase.voided)) {
						editInvoice.cancelDocument();
					}
				}
			}
		}
		 
		private function handleLoadDimensionResult(ev:ResultEvent):void {
			dimensions = new ArrayCollection();
			dimensions=ev.result as ArrayCollection;
			launchPaperCal()
		
		}
		private function launchPaperCal():void{
			jobService.createJob(null, null);
		}
		private function handleCreateJobResult(ev:ResultEvent):void 
		{	
			var job:Job = new Job();
			job = ev.result as Job;		
						
		//	var paperCalWindow:PaperCalculator = PaperCalculator(PopUpManager.createPopUp(this, PaperCalculator, true));
			
			var paperCalWindow:PaperCalculator = new PaperCalculator();
			Snowmass.getInstance().containerManager.openNewMDIWindow(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,"genericPrefCmd.PaperCalculator"), paperCalWindow);
	    		
			paperCalWindow.setStyle("borderAlpha", 0.9);
			paperCalWindow.setdimension(dimensions)
			job.runSize = new Dimension();
			job.foldedSize = new Dimension();
			job.parentSize = new Dimension();
			job.finishSize = new Dimension();
		 	paperCalWindow.setJob(job);
		}
		
		public static function getWidthFromSizeString(size:Dimension):Number {
			var lengthString:String = "0";
	
			var i:int = size.name.indexOf("x");
			if (i > -1) {
				lengthString = size.name.substring(0, i - 1);
				if (lengthString == "")
					lengthString = "0";
			}
	
			return parseFloat(lengthString);
		}
	
		public static function getLengthFromSizeString(size:Dimension):Number {
			var widthString:String = "0";
	
			var i:int = size.name.indexOf("x");
			if (i > -1) {
				widthString = size.name.substring(i + 2);
				if (widthString == "")
					widthString = "0";
			}
	
			return parseFloat(widthString);
		}
		
		private function doClearEstimates():void {
			var clearEstimates:ClearEstimates = PopUpManager.createPopUp(this,ClearEstimates,true) as ClearEstimates;
		}
		
		public function doPaperCal():void{
			if (dimensions.length == 0)
				dimensionDataService.getAll("Dimension");
			else
				launchPaperCal();
		}
		
		public function handleUIEvent(evt:ResultEvent):void {
			var child:Panel = evt.result as Panel;
			//addUniqueTab(child);
			var win:MDIWindow = containerManager.getWindowWithChild(child);
			if (win == null)	{
				containerManager.openNewMDIWindow(child.title,child);
			}
			else {
				win.bringWindowToFront();	
			}
		}		

		public function handleNonUniqueUIEvent(evt:ResultEvent):void {
			var child:Panel = evt.result as Panel;
			//addUniqueTab(child);
			var win:MDIWindow = containerManager.getWindowWithChild(child,true);
			if (win == null)	{
				if(child is EditInvoice){
					child.addEventListener(ConvertToInvoiceEvent.CONVERT_TO_INVOICE_EVENT,handleConvertInvoiceResult,false,0,true);
					child.addEventListener(CopyToNewInvoiceEvent.COPY_TO_NEWINVOICE_EVENT,handleCopyToNewInvoiceResult,false,0,true);
					child.addEventListener(CopyToNewEstimateEvent.COPY_TO_NEWESTIMATE_EVENT,handleCopyToNewEstimateResult,false,0,true);
				}
				containerManager.openNewMDIWindow(child.title,child);
			}
			else {
				win.bringWindowToFront();	
			}
		}
		
		private function handleConvertInvoiceResult(event:ConvertToInvoiceEvent):void {
			if(event.invoice!=null){
				var child:EditInvoice = new EditInvoice();
				child.convertedEstimatedId = event.convertedEstimatedId;
				child.invoice = event.invoice; 
				containerManager.openNewMDIWindow(child.title,child);
			}
		}
		
		private function handleCopyToNewInvoiceResult(event:CopyToNewInvoiceEvent):void {
			if(event.invoice!=null){
				var child:EditInvoice = new EditInvoice();
				child.invoice = event.invoice;
				containerManager.openNewMDIWindow(child.title,child);
			}
		}
		
		private function handleCopyToNewEstimateResult(event:CopyToNewEstimateEvent):void {
			if(event.estimate!=null){
				var child:EditInvoice = new EditInvoice();
				child.invoice = event.estimate;
				containerManager.openNewMDIWindow(child.title,child);
			}
		}		
		
		private function getLocalizedMenuLabel(val:String):String	{
			var retVal:String = "";
			if (val.indexOf('\t') > -1)	{
				var i:int = val.indexOf('\t');
				val = val.substr(i+1);
				//retVal = '\t';
			}
			return retVal + resourceManager.getString(RESOURCE_BUNDLE, val);
		}
		
		public function doStatusWindow():void {
			var pendingStatus:PendingStatus = PendingStatus(PopUpManager.createPopUp(this, PendingStatus, false));
			pendingStatus.setStyle("borderAlpha", 0.9);
			var mdiWindowObj:MDIWindow = containerManager.getActiveWindow();
			if(mdiWindowObj!=null){
				if(mdiWindowObj.content is PendingList) {
					var pendingListWindow:PendingList = mdiWindowObj.content as PendingList;
					if(pendingListWindow.dgView.selectedIndex>-1 && pendingListWindow.dgView.selectedItem!=null) { 
						pendingStatus.invoiceBase = pendingListWindow.dgView.selectedItem as InvoiceBase;
					} else {
						pendingStatus.mainBox.visible = false;
					}
					return;
				}
			}
			pendingStatus.mainBox.visible = false;
		}
		
		public function doChangeDueDate():void {
			var mdiWindowObj:MDIWindow = containerManager.getActiveWindow();
			if(mdiWindowObj!=null){
				if(mdiWindowObj.content is PendingList) {
					var pendingListWindow:PendingList = mdiWindowObj.content as PendingList;
					if(pendingListWindow.dgView.selectedIndex>-1 && pendingListWindow.dgView.selectedItem!=null) { 
						pendingListWindow.handleUIDueDateEvent(null);
					}
				}
			}
		}
		
		public function doTrackerManager():void {
			var child:Panel = new TrackerManagerView() as Panel;
			
			containerManager.openNewMDIWindow(child.className,child);//addUniqueTab(child);
		}
		
		private function doQuickAccessPanel():void	{
			var child:Container = new QuickAccessPanel();
			var mdiwin:MDIWindow = containerManager.getWindowWithChild(child);
			if (mdiwin == null)
				containerManager.openNewMDIWindow("Quick Access Panel",child,40,20,530,880);//addUniqueTab(child);
			else
				mdiwin.bringWindowToFront();
		}
		public function doAccounts():void {
			var event:EditCustomerEvent = new EditCustomerEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}

		public function doUsers():void {
			var event:EditUserEvent = new EditUserEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		private function doJournal():void{
			var event:JournalEvent = new JournalEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
				
		private function doCloseout():void{
			var event:CloseoutEvent = new CloseoutEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		
		private function doMonthlyCloseout():void{
			var event:MonthlyCloseoutEvent = new MonthlyCloseoutEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		
		private function doGenerateStatemnent():void{
			var event:GenerateStatmentEvent = new GenerateStatmentEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		
		private function doVerifyRecievedBalance():void{
			var event:VerifyRecievedBalanceEvent = new VerifyRecievedBalanceEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		private function doVerifyCustomerBalance():void{
			var event:VerifyCustomerBalanceEvent = new VerifyCustomerBalanceEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		private function doVerifyBalance():void{
			var event:VerifyBalanceEvent = new VerifyBalanceEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		
		
		
		
		
		
		
		public function doChangePassword():void {
			var event:ChangePasswordEvent = new ChangePasswordEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doTableEditor():void{
			var event:TableEditorEvent = new TableEditorEvent(new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doOrderStock():void {
			var event:OrderStockEvent = new OrderStockEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doStockOrder():void {
			var event:StockOrderEvent = new StockOrderEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doSalesTax():void {
			var event:SalesTaxEvent = new SalesTaxEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doWasteChart():void {
			var event:WasteChartEvent = new WasteChartEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doContacts():void {
			var event:EditContactEvent = new EditContactEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doPayments():void {
			var event:EditPaymentEvent = new EditPaymentEvent(new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doPressDefinitions():void {
			var event:EditPressDefinitionEvent = new EditPressDefinitionEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doCopyDefinitions():void {
			var event:EditCopierDefinitionEvent = new EditCopierDefinitionEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doWorkInProgress():void{
			var event:EditWorkInProgressEvent = new EditWorkInProgressEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
			
		}
		
		public function doChargeDefinitions():void {
			var event:EditChargeDefinitionEvent = new EditChargeDefinitionEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		
		public function doCreditCardManager():void {
			var event:ShowCreditCardMgrEvent = new ShowCreditCardMgrEvent(new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}

		public function doAccountHistory():void {
			var event:EditAccountHistoryEvent = new EditAccountHistoryEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doEstimateHistory():void {
			var event:EditEstimateHistoryEvent = new EditEstimateHistoryEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		
		public function doStockDefinitions():void {
			var event:EditStockDefinitionEvent = new EditStockDefinitionEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		
		public function doSystemPreferences():void {
			var event:EditSystemPreferencesEvent = new EditSystemPreferencesEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doCashRegister():void {
			var event:EditCashRegisterEvent = new EditCashRegisterEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}

		public function doPendingList():void {
			var event:EditPendingListEvent = new EditPendingListEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doEmployee():void {
			var event:EditEmployeeEvent = new EditEmployeeEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doSchedule():void {
			var event:EditScheduleEvent = new EditScheduleEvent(new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doSecurity():void {
			var event:EditSecurityEvent = new EditSecurityEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doTracker():void {
			var event:EditTrackerEvent = new EditTrackerEvent(new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doPricing():void {
			var event:EditPricingEvent = new EditPricingEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		public function doStampPricing():void {
			dataService.getStampSchedule();
		}
		
		public function handleGetStampScheduleResult(event:ResultEvent):void {
			var stampSchedule:StampSchedule = event.result as com.efi.printsmith.data.StampSchedule;
			if (stampSchedule == null) {
				matrixService.newStampSchedule();
			} else {
				var editPage:Container = this;
				var titleWindow:MatrixEditor = new MatrixEditor();
				containerManager.openNewMDIWindow("Rubber Stamps", titleWindow);
			    titleWindow.setStyle("borderAlpha", 0.9);
			    titleWindow.setStampSchedule(stampSchedule);
			    titleWindow.width = 800;
			}
		}
		
		public function handleCreateStampSchedule(event:ResultEvent):void {
			var stampSchedule:StampSchedule = event.result as com.efi.printsmith.data.StampSchedule;
			var editPage:Container = this;
			var titleWindow:MatrixEditor = MatrixEditor(PopUpManager.createPopUp(editPage, MatrixEditor, true));
		    titleWindow.setStyle("borderAlpha", 0.9);
		    titleWindow.setStampSchedule(stampSchedule);
		}
		public function doUtilities():void {
			var child:Utilities = new Utilities();
			if (child.checkSecurityAccess())
				containerManager.openNewMDIWindow("Utilities", child);
		}

		public function doClockInOut():void {
//			var event:EditClockInOutEvent = new EditClockInOutEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
//			event.dispatch();
		}
		public function doCreateEstimate():void {
			var event:EditCreateEstimateEvent = new EditCreateEstimateEvent(null, new mx.rpc.Responder(handleNonUniqueUIEvent, handleFault));
			event.dispatch();
		}
		public function doCreateInvoice():void {
			var event:EditCreateInvoiceEvent = new EditCreateInvoiceEvent(null, new mx.rpc.Responder(handleNonUniqueUIEvent, handleFault));
			event.dispatch();
		}
		
		public function doEditInvoice(inv:InvoiceBase):void	{
			if (security.commandEnabled(EditEditInvoiceEvent.COMMANDID)) {
				var child:EditInvoice = new EditInvoice();
				child.setInvoice(inv);
				child.name = "EditInvoice"+inv.invoiceNumber;
				child.addEventListener(CopyToNewInvoiceEvent.COPY_TO_NEWINVOICE_EVENT,handleCopyToNewInvoiceResult,false,0,true);
				child.addEventListener(CopyToNewEstimateEvent.COPY_TO_NEWESTIMATE_EVENT,handleCopyToNewEstimateResult,false,0,true);
				var win:MDIWindow = containerManager.getWindowWithChild(child,false);
				if(win == null) {
					containerManager.openNewMDIWindow(child.title, child);
				} else {
					win.bringWindowToFront();
				}
			}
		}
		
		public function doEditEstimate(inv:InvoiceBase):void	{
			if (security.commandEnabled(EditEditEstimateEvent.COMMANDID)) {
				var child:EditInvoice = new EditInvoice();
				child.setInvoice(inv);
				child.name = "EditEstimate"+inv.invoiceNumber;
				child.addEventListener(ConvertToInvoiceEvent.CONVERT_TO_INVOICE_EVENT,handleConvertInvoiceResult,false,0,true);
				child.addEventListener(CopyToNewInvoiceEvent.COPY_TO_NEWINVOICE_EVENT,handleCopyToNewInvoiceResult,false,0,true);
				child.addEventListener(CopyToNewEstimateEvent.COPY_TO_NEWESTIMATE_EVENT,handleCopyToNewEstimateResult,false,0,true);
				var win:MDIWindow = containerManager.getWindowWithChild(child,false);
				if(win == null) {
					containerManager.openNewMDIWindow(child.title, child);
				} else {
					win.bringWindowToFront();
				}
			}
		}

		public function doAboutPrintSmith():void {
			var event:AboutEvent = new AboutEvent(null, new mx.rpc.Responder(handleUIEvent, handleFault));
			event.dispatch();
		}
		
		public function doLogout():void {
//			for (var i:int = 1; i < mainNavigator.numChildren; i++) {
//				mainNavigator.removeChildAt(i);
//			}
			//Alert.show("This should first close all windows");
			containerManager.cleanupWindows();
			this.currentUser = null;
			logoutService.logoutUser();
			navigateToURL(new URLRequest("Snowmass.html"), "_self");

//			this.showLogin();
//			this.updateTitle();
       	}
       	
       	private function handleLoadSystemResult(event:ResultEvent):void {
       		preferencesSystem = event.result as PreferencesSystem;
       		if(preferencesSystem!=null){
       			if(preferencesSystem.enableAutoLogOut && preferencesSystem.secondsOfInactivity){
       				if(preferencesSystem.autoLogOutSeconds!=0) {
       					doAutoLogout(preferencesSystem.autoLogOutSeconds);
       				} else if(preferencesSystem.autoLogOutSeconds==0) {
       					stopAutoLogoutTimer();
       				}
       			} else {
       				stopAutoLogoutTimer();
       			}
       		}
       	}
       	
       	public function doAutoLogout(secondsValue:Number):void {
       		stopAutoLogoutTimer();
       		autoLogOutTimer = new Timer(secondsValue*1000);
       		autoLogOutTimer.addEventListener(TimerEvent.TIMER,function(event:TimerEvent):void {
       			stopAutoLogoutTimer();
       			doLogout();
       		},false,0,true);
			autoLogOutTimer.start();
       	}
       	
       	public function stopAutoLogoutTimer():void {
       		if(autoLogOutTimer!=null && autoLogOutTimer.running){
   				autoLogOutTimer.reset();
				autoLogOutTimer.stop();
   			}
       	}
       	
       	private function mouseMoveHandlerFunction(event:MouseEvent):void {
       		if(autoLogOutTimer!=null && autoLogOutTimer.running){
       			autoLogOutTimer.reset();
       			autoLogOutTimer.stop();
       			autoLogOutTimer.addEventListener(TimerEvent.TIMER,function(event:TimerEvent):void {
	       			stopAutoLogoutTimer();
	       			doLogout();
	       		},false,0,true);
       			autoLogOutTimer.start();
       		}
       	}
       	
//		private function addUniqueTab(tab:Panel):void {
//			var tabFound:Boolean = false;
//			
//			for (var i:int = 0; i < mainNavigator.numChildren; i++)
//			{
//				if (mainNavigator.getChildAt(i).name == tab.name)
//				{
//					mainNavigator.selectedIndex = i;
//					tabFound = true;
//					break;
//				}
//			}
//			if (!tabFound) {
//				var tmpPanel:Panel = mainNavigator.addChild(tab) as Panel;
//				mainNavigator.selectedIndex = mainNavigator.numChildren-1;
//			}
//		}
		//
		//
 		private function idleTimerCallBack(evt:TimerEvent):void {
            var tmr:Timer = evt.currentTarget as Timer;
           var localTime:Date = new Date();
           var maxAllowIdleTime:int = (millisecondsPerMinute * 10);
           
           //
           // Handle automatic login for robust password users
           //
           if (currentUser != null && currentUser.robustPassword == true) {
				if ((localTime.getTime() - maxAllowIdleTime) > gUILastInteractiveTimeStamp.getTime()) {
					showLogin();
				}
			}
        }

		private function startSlowIdleTimer():void {
			if (idleTimer == null) {
	             idleTimer = new Timer((1000 * 10),0);		// ten seconds, run for ever
	             idleTimer.addEventListener(TimerEvent.TIMER, idleTimerCallBack);
	             idleTimer.start();
	 		 } else {
	 		 	idleTimer.reset();
	 		 	idleTimer.start();
	 		 }
        }

		private function initAppFunctions() : void {
			stage.addEventListener(KeyboardEvent.KEY_UP, myKeyUpHandler);
			stage.addEventListener(KeyboardEvent.KEY_UP, shortCutKeyPressHandler, false, 0, true);
			stage.addEventListener(MouseEvent.MOUSE_MOVE,globalMouseMove);
			startSlowIdleTimer();
		}

		private function doKeepAliveCurrentUser():void 
		{
			gUILastInteractiveTimeStamp = new Date();
		}

		private function globalMouseMove(event:MouseEvent):void
		{
		    doKeepAliveCurrentUser();
		}
		
		
		private function init() : void {
			thisInstance = this;
//			mainNavigator.setClosePolicyForTab(0, SuperTab.CLOSE_NEVER);
			var eventDispatcher:IEventDispatcher = resourceManager.loadResourceModule("Resources_en_US.swf");
            eventDispatcher.addEventListener(ResourceEvent.COMPLETE, completeHandler);
            eventDispatcher.addEventListener(ResourceEvent.ERROR, resourceFaultHandler);
            resourceManager.localeChain = [ "en_US" ];
    		this.languageComboBox.selectedItem = "en_US";
			userName = Application.application.parameters.userName;
			userPass = Application.application.parameters.userPass;
			container.addEventListener(AppMenuItemClickedEvent.APP_MENU_ITEM_CLICKED, onMenuItemClicked);
			containerManager = ContainerManager.getInstance(container);
				
			if (userName == null && userPass == null) { 
				showLogin();
			} else {
				loginService.validateLogin(userName, userPass);
			}
//			moveLogo.play();
			
			this.addEventListener(KeyboardEvent.KEY_DOWN, keyHandler);
			
			versionService.getServerVersion();
            bm = BrowserManager.getInstance();
            bm.init("", "Welcome to Snowmass");
			
			container.addToHeader(ApplicationHeader.LEFT, languageComboBox);
			container.addToHeader(ApplicationHeader.CENTER, debug_button);
			container.addToHeader(ApplicationHeader.RIGHT, logout_button);
			this.addEventListener(MouseEvent.MOUSE_MOVE,mouseMoveHandlerFunction,false,0,true);
		}
		
		override protected function createChildren():void	{
			super.createChildren();
			
			debug_button = new LinkButton();
			debug_button.label = "Debug";
			debug_button.visible = showDebugButton();
			debug_button.addEventListener(MouseEvent.CLICK, doDebug);
			
						            
            languageComboBox = new ComboBox();
            languageComboBox.dataProvider = locales;
            languageComboBox.labelFunction = languageComboBoxLabelFunction;
            languageComboBox.addEventListener(ListEvent.CHANGE,languageComboBox_changeHandler); 
		
		}
		private function handleVersionResult(evt:ResultEvent):void {
			serverVersion = evt.result as String;
		}
		
		public function set menuItems(val:ArrayCollection):void	{ 
			
			for (var i:int=0; i < val.length; i++)	{
				var parent:PSMenuItem = val.getItemAt(i) as PSMenuItem;
				parent.label = getLocalizedMenuLabel(parent.label);
				for (var j:int=0; j < parent.children.length; j++)	{
					var child:PSMenuItem = parent.children.getItemAt(j) as PSMenuItem;
					child.label = getLocalizedMenuLabel(child.label);					
					if (child.children != null)	{
						for (var k:int=0; k < child.children.length; k++)	{
							var child2:PSMenuItem = child.children.getItemAt(k) as PSMenuItem;
							child2.label = getLocalizedMenuLabel(child2.label);
						}
					}
				}				
			}	
			_menuItems = val;
		}
		
		private function keyHandler(event:KeyboardEvent):void {

		var bAltPressed:Boolean = event.altKey;
		var bCtrlPressed:Boolean = event.ctrlKey;
		var curKeyCode:int = event.keyCode;

		if( bAltPressed && bCtrlPressed){
			if(curKeyCode==83){

				//CTRL + S pressed; saveCall()

			}
			if(curKeyCode==78 ){

				//CTRL + N pressed; NewEntryCall()

			}

			if(curKeyCode == 68){

				//CTRL + D pressed; DeleteEntryCall()

			}

			if(curKeyCode == 67){

				//CTRL + C pressed; CopyCall()

			}

			if(curKeyCode == 70){

				//CTRL + F pressed; SearchCall()

			}
			if(curKeyCode == 73){

				//alt + I 
			doCreateInvoice();
			}
			}
		}
		
		//
		// timer to allow for failed credit card brick reading, this will switch back to normal
		//	operations when no REAL card data can be found.
		//
 		private function timerCallBack(evt:TimerEvent):void {
            var tmr:Timer = evt.currentTarget as Timer;
            if (tmr.currentCount >= 2) {
            	// give up on more data coming in from card reader
				gCaptureCardData = false;
				// restore the focus
				if (gComponent != null) {
					focusManager.setFocus(gComponent);
					gComponent = null;
				}
				tmr.stop();
				
				if (gCardDataBuffer.length > 15) {
					parseCreditCardRawTrackData();
				}
            }
        }
        
		private function startWaitTimer():void {idleTimer
			if (gTimer == null) {
	             gTimer = new Timer(1000,2);
	             gTimer.addEventListener(TimerEvent.TIMER, timerCallBack);
	             gTimer.start();
	 		 } else {
	 		 	gTimer.reset();
	 		 	gTimer.start();
	 		 }
        }
		
		//
		// The main level key UP event processing, handles ALL key strokes from the user,
		//	which is also where the card brick data comes from.
		// *** BE VERY CAREFUL MAKING CHANGES HERE, EFFECTS GLOBAL STATES AND TIMERS ***
		//
		// Sample raw card data:  Track one and Track two
		// %B3000 100000 50000^RODGERS/D                 ^1109061188864?
		// ;3000150000052007=110906119999?
		//
		private function myKeyUpHandler(event:KeyboardEvent):void {
		
			var curKeyCode:int;
			
			// ONLY WHEN NO ALT OR CONTROL KEYS ARE DOWN
			//
			if( event.altKey == false && event.ctrlKey == false){
				curKeyCode = event.keyCode;
				
				// all bricks are programmed to preceed data with a "F6" key stroke.
				if(curKeyCode==Keyboard.F6 && gCaptureCardData == false) {
					gCardDataBuffer = "";
					gQuestionMarkCount = 0;
					gCardDataCharCount = 0;
					gCaptureCardData = true;
					// save off the current focus and set the current focus to null, keep text fields from seeing the card data
					gComponent = focusManager.getFocus();
					this.stage.focus = null;
					
					// kick off a timer to know when all data should have come in.
					//  give up after a few seconds.
					startWaitTimer();
				} 
				//
				// if the card data is being captured, grab one character at a time into the buffer
				//
				else if (gCaptureCardData && event.charCode != 0) {
					
					gCardDataBuffer = gCardDataBuffer.concat(String.fromCharCode(event.charCode));
					
					++gCardDataCharCount;
					
					if (event.charCode == 63) {		// "?"
						gQuestionMarkCount += 1;
					}
					
					//
					// this is a known good format for credit card data, track one and two
					//
					if (gCardDataBuffer.length > 40 && gQuestionMarkCount > 1 && event.charCode == 13) {
						// tell the timer we are complete, it can shut down now
						if (gTimer != null) {
							gTimer.stop();
						}
						// no more data will be captured into the card buffer
						gCaptureCardData = false;
						// restore the focus
						if (gComponent != null) {
							focusManager.setFocus(gComponent);
							gComponent = null;
						}
						
						parseCreditCardRawTrackData();
					}
				} else {
					doKeepAliveCurrentUser();
				}
			}
		}
		
		private function shortCutKeyPressHandler(event:KeyboardEvent):void {
			if(event.ctrlKey && event.keyCode==85) {
				doUpdatePendingDocument();
			}
		}
		
		private function parseCreditCardRawTrackData():void {
			var localCard:CreditCardTrackRead = new CreditCardTrackRead;
			var selectEvent:CreditCardTrackReadEvent;
			var startSentinal:String;
			var formatCode:String;
			var expirationYY:String;
			var expirationMM:String;
			var expirationStr:String;
			var cr:String = String.fromCharCode(13);
			var k:int;
			var len:int;
			var i:int;
			var cardType:Number;
			var myRegExp:RegExp;
			
			startSentinal = gCardDataBuffer.charAt(0);
			formatCode = gCardDataBuffer.charAt(1);
			
			// good starting code and track data markers for a credit card
			if (startSentinal == "%" && formatCode == "B") {
				len = gCardDataBuffer.length;
				k = 0;
				while (gCardDataBuffer.charAt(k) != "^" && k < len)
				{
					++k;
				}
				localCard.parsedCard.cardNumber = gCardDataBuffer.substring(2,k);
				
				myRegExp = new RegExp(" ","g");		// find a SPACE character, all of them
				localCard.parsedCard.cardNumber = localCard.parsedCard.cardNumber.replace(myRegExp,"");	// replace the SPACE with <empty>
				
				k += 1;  // skip the "^" symbol
						
				len = gCardDataBuffer.length;
				i = k;	// the starting point, first letter in name section
				while (gCardDataBuffer.charAt(k) != "^" && k < len)
				{
					++k;
				}

				localCard.parsedCard.cardHolderName = gCardDataBuffer.substring(i,k);
				localCard.parsedCard.cardHolderName = StringUtil.trim(localCard.parsedCard.cardHolderName);
				
				// read the YYMM expiration date
				k += 1;
				i=k;
				expirationYY = gCardDataBuffer.substring(i,i+2);
				i += 2;
				expirationMM = gCardDataBuffer.substring(i,i+2);
				
				// find the track one and track two seperator
				k = i+1;
				while (gCardDataBuffer.charAt(k) != cr && k < len)
				{
					++k;
				}
			
				// capture the raw track data and compute the credit card type number from first digit
				cardType = (localCard.parsedCard.cardNumber.charCodeAt(0) - 48);
				
				localCard.trackOne = gCardDataBuffer.substring(0,k);
				localCard.trackTwo = gCardDataBuffer.substring(k+1,len);
				
				// remove white space at the end, ie.. CR, LF, SPACE
				localCard.trackOne = StringUtil.trim(localCard.trackOne);
				localCard.trackTwo = StringUtil.trim(localCard.trackTwo);

				localCard.parsedCard.expiresDate = new Date((2000+parseInt(expirationYY)), parseInt(expirationMM), 0);

				selectEvent = new CreditCardTrackReadEvent(CreditCardTrackReadEvent.BRICKREAD, localCard);
				dispatchEvent(selectEvent);
			} else {
				//
				// use the tack data as a raw input, like a badge read.
				//
				localCard.trackOne = gCardDataBuffer.substring(0,gCardDataBuffer.length);
				
				// remove white space at the end, ie.. CR, LF, SPACE
				localCard.trackOne = StringUtil.trim(localCard.trackOne);				
				
				selectEvent = new CreditCardTrackReadEvent(CreditCardTrackReadEvent.BRICKREAD, localCard);
				dispatchEvent(selectEvent);
			}
		}
		
		
//		private function endMoveLogo() : void {
//			efiLogoFade.play();
//			poweredByFade.play();			
//		}
		
		public function updateTitle() : void {
			if (currentUser != null) {
			   	bm.setTitle("Welcome to Snowmass " + currentUser.name);
			} else {
				bm.setTitle("Welcome to Snowmass");
			}
		}
		private function handleLoginResult(event:ResultEvent):void	{
					
			var res:Users = event.result as Users;
			if (res != null) {
				if (res.disableUser) {
					Alert.show("Disabled User Name", null, Alert.OK, null, null, null, Alert.OK);
					showLogin();
					logUserEvent(Constants.USER_EVENT_FAILED_LOGIN, null, res.name);
				} else {
					
					currentUser = res;
					security = new PSSecurity(currentUser);
					showContainer();					
					logUserEvent(Constants.USER_EVENT_LOGIN, null, null);
				}
 			} else {
 				Alert.show("Invalid login", null, Alert.OK, null, null, null, Alert.OK);
				showLogin();
				logUserEvent(Constants.USER_EVENT_FAILED_LOGIN, null, null);
			}
		}
		
		public function set permissions(val:ArrayCollection):void	{
			_permissions = val;			
		}
		
		public function get permissions():ArrayCollection	{
			return _permissions;			
		}
		
		public function loadPermissions():void	{
			Chimp.unload();
			Chimp.load(_permissions);
			
		}
		private function handleFault(ev:FaultEvent):void {
			var errorDetail:String="";
			if (ev.fault!=null && ev.fault.faultCode=="InvalidSecurityAccess"){
				errorDetail = resourceManager.getString(Snowmass.RESOURCE_BUNDLE, ev.fault.faultDetail);
			}else{
				errorDetail = ev.fault.faultDetail;
			}
			Alert.show(errorDetail,ev.fault.faultCode, Alert.OK, null, null, null, Alert.OK);
		}
		
		private function enableLogout():Boolean {
			return (currentUser==null)?false:true;
		}
		
//		CONFIG::debugging
		private function showDebugButton():Boolean {
			return true;
		}
		
//		CONFIG::release
//		private function showDebugButton():Boolean { 
//			return false;
//		}
		
//		CONFIG::debugging
		private function doDebug(evt:MouseEvent):void {
			var debugPopup : Debug = Debug(PopUpManager.createPopUp(this, Debug, true));
		//	this.mainContainer.visible=false;
			PopUpManager.centerPopUp(debugPopup);
		}
		
//		CONFIG::release
//		private function doDebug():void {
//		}

		public function doDeliveryTicket():void{
			var child:DeliveryTicketMgr = new DeliveryTicketMgr();
			if (child.checkSecurityAccess())
				containerManager.openNewMDIWindow(resourceManager.getString(Snowmass.RESOURCE_BUNDLE,"deliveryTicketMgrCmd.DeliveryTicketManage"), child);
		}		
		
		/**
		 *  The labelFunction for the Language combobox.
		 *  It takes a locale such as "en_US"
		 *  and produces the localized string "English".
		 */
		private function languageComboBoxLabelFunction(item:Object):String {
			var locale:String = String(item);
			switch (locale) {
				case "de_DE":
					return "Deutsch";
					break;
				case "en_AU":
					return "English (Australia)";
					break;
				case "en_GB":
					return "English (UK)";
					break;
				case "en_US":
					return "English (US)";
					break;
				case "es_CL":
					return "Espaol (Chile)";
					break;
				case "es_CO":
					return "Espaol (Colombia)";
					break;
				case "es_ES":
					return "Espaol (Espaa)";
					break;
				case "es_MX":
					return "Espaol (Mxico)";
					break;
				case "fr_CA":
					return "Franais (Le Canada)";
					break;
				case "fr_FR":
					return "Franais (La France)";
					break;
				case "ja_JP":
					return ""
					break;
				case "lv_LV":
					return "Latvian"
					break;
				case "nl_NL":
					return "Nederlands"
					break;
				case "pt_PT":
					return "Portugus"
					break;
				case "ru_RU":
					return ""
					break;
			}
			return resourceManager.getString(RESOURCE_BUNDLE, locale);
		}
				
		/**
		 *  Comparison function for sorting the 'locales' Array,
		 *  which is the dataProvider for the Language combobox.
		 *  The sort order is locale-dependent,
		 *  because the localized language names for the locales
		 *  are presented in alphabetical order.
		 */
		private function localeCompareFunction(item1:Object, item2:Object):int {
			var language1:String = languageComboBoxLabelFunction(item1);
			var language2:String = languageComboBoxLabelFunction(item2);
			
			if (language1 < language2)
				return -1;
			if (language1 > language2)
				return 1;
			return 0;
		}
		
		/**
		 *  Repopulates the Language combobox with localized language names
		 *  for the supported locales, alphabetized by language name.
		 */
		private function updateLanguageComboBox():void {
			var oldSelectedItem:Object = languageComboBox.selectedItem;
			
			// Repopulate the combobox with locales,
			// re-sorting by localized language name.
			locales.sort(localeCompareFunction);
			languageComboBox.dataProvider = locales;
			
			languageComboBox.selectedItem = oldSelectedItem;
		}

		private function languageComboBox_changeHandler(event:Event):void {
            var newLocale:String = String(languageComboBox.selectedItem);

            if (resourceManager.getLocales().indexOf(newLocale) != -1)
            {
                completeHandler(null);
            }
            else
            {
                var resourceModuleURL:String = "Resources_" + newLocale + ".swf";
                var eventDispatcher:IEventDispatcher =
                    resourceManager.loadResourceModule(resourceModuleURL);
                eventDispatcher.addEventListener(
                    ResourceEvent.COMPLETE, completeHandler);
                eventDispatcher.addEventListener(
                	ResourceEvent.ERROR, resourceFaultHandler);
            }
            updateLanguageComboBox();
		}
		
        private function completeHandler(event:ResourceEvent):void {
            resourceManager.localeChain = [ languageComboBox.selectedItem ];
        }
        
        private function resourceFaultHandler(event:ResourceEvent):void {
			Alert.show("Error loading resources: " + event.errorText, null, Alert.OK, null, null, null, Alert.OK);
        }

        public static function getCurrencyValidator():CurrencyValidator {
        	var currencyValidator:CurrencyValidator = new CurrencyValidator();
        	currencyValidator.currencySymbol = "$"; // TODO
        	return currencyValidator;
        }
        
        
        public static function getCurrencyFormatter(showSymbol:Boolean, precision:Number):CurrencyFormatter {
        	var formatter:CurrencyFormatter = new CurrencyFormatter();
        	if (showSymbol){
        		formatter.currencySymbol = "$";
        	}else{
        		formatter.currencySymbol = "";
        	}
        	formatter.precision = precision;
        	
        	return formatter;
        }
        
        public static function formatSizeString(sizeString:String):String {
        	var returnString:String = "";
        	if (sizeString != null && sizeString.length > 0) {
        		var firstNumber:String = "";
    			var secondNumber:String = "";
    			var onFirstNumber:Boolean = true;
    			var lastCharNumber = false;
        		for (var i:int = 0;i < sizeString.length;i++) {
        			var char:String = sizeString.charAt(i);
        			if (char == "0" || char == "1" || char == "2" || char == "3" || char == "4" || char == "5" || char == "6" || char == "7" || char == "8" || char == "9" || char == ".") {
        				if ((char == "." && lastCharNumber == true) || char != ".") {
	        				if (onFirstNumber == true)
	        					firstNumber = firstNumber + char;
	        				else
	        					secondNumber = secondNumber + char;
	        			}
        				lastCharNumber = true;
        			} else {
        				if (firstNumber == "")
        					onFirstNumber = true;
        				else
        					onFirstNumber = false;
        				lastCharNumber = false;
        			}
        		}
        		returnString = firstNumber + " x " + secondNumber;
        	}
        	return returnString;
        }
        
        public static function getDateFormatter():DateFormatter {
        	var formatter:DateFormatter = new DateFormatter;
        	formatter.formatString = "MMMM DD, YYYY   L:NN:SS A";
        	return formatter;
        }
        public static function getShortDateTimeFormatter():DateFormatter {
        	var formatter:DateFormatter = new DateFormatter;
        	formatter.formatString = "MM/DD/YYYY L:NN A";
        	return formatter;
        }

        public function getApplicationRootURL():String {
        	return this.url.substr(0, this.url.lastIndexOf("/"));
        }
         
        public function getLocalizedEnum(enumerationName:String, enumerationValue:String):String {
        	return resourceManager.getString(Snowmass.RESOURCE_BUNDLE, enumerationName + '_' + enumerationValue);
        }
 
	 	private function handleLoadResult(ev:ResultEvent):void {
			
		}
	
       
        public function logUserEvent(reasonCode:int, customLabel:String, badUserName:String):void	{ 
        	var localEvent:UserEvent = new UserEvent;
        	
        	localEvent.reasonCode = reasonCode;
        	
        	if (badUserName != null) {
        		localEvent.userName = badUserName;
        	} else if (currentUser != null) {
        		localEvent.userName = currentUser.name;
        	}
        	switch(reasonCode) {
        		case Constants.USER_EVENT_LOGIN:
        			localEvent.eventString = resourceManager.getString(RESOURCE_BUNDLE, 'kUserEventLogCmd.Userlogin');
        			preferencesSystemService.getSingle("PreferencesSystem");
        			break;
        		case Constants.USER_EVENT_LOGOUT:
        			localEvent.eventString = resourceManager.getString(RESOURCE_BUNDLE, 'kUserEventLogCmd.Userlogin');
        			break;
        		case Constants.USER_EVENT_FAILED_LOGIN:
        			localEvent.eventString = resourceManager.getString(RESOURCE_BUNDLE, 'kUserEventLogCmd.Userfailedloginattem');
        			break;
        		case Constants.USER_EVENT_PASSWORD_CHANGE:
        			localEvent.eventString = resourceManager.getString(RESOURCE_BUNDLE, 'kUserEventLogCmd.Userpasswordchange');
        			break;
        		case Constants.USER_EVENT_CREDITCARD_TAKEN:
        			localEvent.eventString = resourceManager.getString(RESOURCE_BUNDLE, 'kUserEventLogCmd.CreditCardnumberseen');
        			break;
        	}
        	
        	if (localEvent.eventString != null) {
          		localEvent.eventString = StringUtil.substitute(localEvent.eventString,localEvent.userName); 
        	}
        	
        	if (customLabel != null) {
        		localEvent.eventString = localEvent.eventString.concat(" ", customLabel);
        	}
        	dataService.addUpdate(localEvent);
        }
]]>		
</mx:Script>
	<business:Services id="services" />
	<control:MainController id="controller" />
	<mx:LinkButton label="Logout" styleName="headerLogoutButtonStyle" id="logout_button" enabled="{(currentUser==null)?false:true}" click="{doLogout()}" right="10" top="5"/>
</mx:Application>
